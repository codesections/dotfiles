"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc"
#s(undo-tree [nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil (#2=[nil nil ((1 . 2)) nil (23756 17543 164743 948000) 0 nil]) ((#("pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        )
        .as_bytes()
        .to_owned()
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 19 (fontified t face font-lock-type-face) 19 23 (fontified t) 23 27 (fontified t face font-lock-keyword-face) 27 28 (fontified t) 28 36 (fontified t face font-lock-type-face) 36 43 (fontified t) 43 46 (fontified t face font-lock-keyword-face) 46 47 (fontified t) 47 49 (fontified t face font-lock-keyword-face) 49 50 (fontified t) 50 54 (fontified t face font-lock-function-name-face) 54 55 (fontified t) 55 58 (fontified t face font-lock-variable-name-face) 58 60 (fontified t) 60 64 (fontified t face font-lock-keyword-face) 64 65 (fontified t) 65 68 (fontified t face font-lock-constant-face) 68 70 (fontified t) 70 73 (fontified t face font-lock-constant-face) 73 75 (fontified t) 75 82 (fontified t face font-lock-type-face) 82 84 (fontified t) 84 92 (fontified t face font-lock-variable-name-face) 92 94 (fontified t) 94 98 (fontified t face font-lock-keyword-face) 98 99 (fontified t) 99 102 (fontified t face font-lock-constant-face) 102 104 (fontified t) 104 107 (fontified t face font-lock-constant-face) 107 109 (fontified t) 109 116 (fontified t face font-lock-type-face) 116 119 (fontified t) 119 120 (fontified t syntax-table #1=(1)) 120 121 (fontified t) 121 124 (fontified t face font-lock-type-face) 124 125 (fontified t) 125 127 (fontified t face font-lock-type-face) 127 139 (fontified t) 139 142 (fontified t face font-lock-keyword-face) 142 174 (fontified t) 174 181 (fontified t face rust-builtin-formatting-macro-face) 181 182 (fontified t) 182 192 (fontified t face font-lock-string-face) 192 194 (fontified t face rust-string-interpolation-face) 194 195 (fontified t face font-lock-string-face) 195 217 (fontified t) 217 224 (fontified t face rust-builtin-formatting-macro-face) 224 238 (fontified t) 238 246 (fontified t face font-lock-string-face) 246 258 (fontified t face rust-string-interpolation-face) 258 262 (fontified t face font-lock-string-face) 262 267 (fontified t face rust-string-interpolation-face) 267 272 (fontified t face font-lock-string-face) 272 284 (fontified t face rust-string-interpolation-face) 284 288 (fontified t face font-lock-string-face) 288 293 (fontified t face rust-string-interpolation-face) 293 298 (fontified t face font-lock-string-face) 298 421 (fontified t) 421 427 (fontified t) 427 472 (fontified t) 472 473 (fontified t) 473 475 (fontified t)) . 1) (undo-tree-id4139 . -473) (undo-tree-id4140 . -473) (undo-tree-id4141 . -475) (undo-tree-id4142 . -475) (undo-tree-id4143 . -475) (undo-tree-id4144 . -475) (undo-tree-id4145 . -475)) nil (23756 17543 164772 590000) 0 nil] [nil ([nil nil ((1 . 2)) ((#("
" 0 1 (fontified t)) . 1) (t 23752 20422 911908 616000)) (23752 20422 798823 786000) 0 nil]) ((#("pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        )
        .as_bytes()
        .to_owned()
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 19 (fontified t face font-lock-type-face) 19 23 (fontified t) 23 27 (fontified t face font-lock-keyword-face) 27 28 (fontified t) 28 36 (fontified t face font-lock-type-face) 36 43 (fontified t) 43 46 (fontified t face font-lock-keyword-face) 46 47 (fontified t) 47 49 (fontified t face font-lock-keyword-face) 49 50 (fontified t) 50 54 (fontified t face font-lock-function-name-face) 54 55 (fontified t) 55 58 (fontified t face font-lock-variable-name-face) 58 60 (fontified t) 60 64 (fontified t face font-lock-keyword-face) 64 65 (fontified t) 65 68 (fontified t face font-lock-constant-face) 68 70 (fontified t) 70 73 (fontified t face font-lock-constant-face) 73 75 (fontified t) 75 82 (fontified t face font-lock-type-face) 82 84 (fontified t) 84 92 (fontified t face font-lock-variable-name-face) 92 94 (fontified t) 94 98 (fontified t face font-lock-keyword-face) 98 99 (fontified t) 99 102 (fontified t face font-lock-constant-face) 102 104 (fontified t) 104 107 (fontified t face font-lock-constant-face) 107 109 (fontified t) 109 116 (fontified t face font-lock-type-face) 116 119 (fontified t) 119 120 (syntax-table #1# fontified t) 120 121 (fontified t) 121 124 (fontified t face font-lock-type-face) 124 125 (fontified t) 125 127 (fontified t face font-lock-type-face) 127 139 (fontified t) 139 142 (fontified t face font-lock-keyword-face) 142 174 (fontified t) 174 181 (fontified t face rust-builtin-formatting-macro-face) 181 182 (fontified t) 182 192 (fontified t face font-lock-string-face) 192 194 (fontified t face rust-string-interpolation-face) 194 195 (fontified t face font-lock-string-face) 195 217 (fontified t) 217 224 (fontified t face rust-builtin-formatting-macro-face) 224 238 (fontified t) 238 246 (fontified t face font-lock-string-face) 246 258 (fontified t face rust-string-interpolation-face) 258 262 (fontified t face font-lock-string-face) 262 267 (fontified t face rust-string-interpolation-face) 267 272 (fontified t face font-lock-string-face) 272 284 (fontified t face rust-string-interpolation-face) 284 288 (fontified t face font-lock-string-face) 288 293 (fontified t face rust-string-interpolation-face) 293 298 (fontified t face font-lock-string-face) 298 421 (fontified t) 421 427 (fontified t) 427 472 (fontified t) 472 473 (fontified t) 473 475 (fontified t)) . 1) (undo-tree-id4049 . -473) (undo-tree-id4050 . -473) (undo-tree-id4051 . -475) (undo-tree-id4052 . -475) (undo-tree-id4053 . -475) (undo-tree-id4054 . -475) (undo-tree-id4055 . -475) (undo-tree-id4056 . -475) (undo-tree-id4057 . -475) (undo-tree-id4058 . -475) (undo-tree-id4059 . -475) (undo-tree-id4060 . -475) (undo-tree-id4061 . -473) (undo-tree-id4063 . -473) (undo-tree-id4065 . -39) (undo-tree-id4067 . -131) (undo-tree-id4069 . -209) (undo-tree-id4071 . -226) (undo-tree-id4073 . -300) (undo-tree-id4075 . -336) (undo-tree-id4077 . -359) (undo-tree-id4079 . -395) (undo-tree-id4081 . -417) (undo-tree-id4083 . -427) (undo-tree-id4085 . -447) (undo-tree-id4087 . -467) (undo-tree-id4089 . -473) (undo-tree-id4091 . -475) (undo-tree-id4093 . -475) (undo-tree-id4095 . -475) (undo-tree-id4097 . -475) (undo-tree-id4099 . -475) (undo-tree-id4101 . -473) (undo-tree-id4103 . -471) (undo-tree-id4105 . -292) (undo-tree-id4107 . -288) (undo-tree-id4109 . -283) (undo-tree-id4111 . -272) (undo-tree-id4113 . -266) (undo-tree-id4115 . -262) (undo-tree-id4117 . -257) (undo-tree-id4119 . -246) (undo-tree-id4121 . -193) (undo-tree-id4123 . -192) (undo-tree-id4125 . -129) (undo-tree-id4127 . -37) (undo-tree-id4129 . 438) (undo-tree-id4131 . 437) (undo-tree-id4133 . 2) (undo-tree-id4135 . -182) (undo-tree-id4137 . -182) 474 (t 23752 20402 331820 753000)) ((1 . 476)) (23752 20440 208840 463000) 0 nil]) ((#("
" 0 1 (fontified t)) . 1)) nil (23752 20440 825657 93000) 0 nil]) ((#("use tokio::net::TcpStream;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-constant-face) 9 11 (fontified t) 11 14 (fontified t face font-lock-constant-face) 14 16 (fontified t) 16 25 (fontified t face font-lock-type-face) 25 26 (fontified t) 26 27 (fontified t)) . 1) (undo-tree-id3967 . -27) (undo-tree-id3968 . -13) (undo-tree-id3969 . -13) (undo-tree-id3970 . -13) (undo-tree-id3971 . -13) (undo-tree-id3972 . -4) (undo-tree-id3973 . -25) (undo-tree-id3974 . -4) (undo-tree-id3975 . -9) (undo-tree-id3976 . -4) (undo-tree-id3977 . -25)) nil (23752 20402 213892 821000) 0 nil]) ((#("use log::info;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 7 (fontified t face font-lock-constant-face) 7 15 (fontified t)) . 1) (undo-tree-id3978 . -15) (undo-tree-id3979 . -15) (undo-tree-id3980 . -15) (undo-tree-id3981 . -4) (undo-tree-id3982 . -13) (undo-tree-id3983 . -4) (undo-tree-id3984 . -7) (undo-tree-id3985 . -4) (undo-tree-id3986 . -13)) nil (23752 20402 213908 690000) 0 nil]) ((#("use futures::{Async, Future, Poll};
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 11 (fontified t face font-lock-constant-face) 11 14 (fontified t) 14 19 (fontified t face font-lock-type-face) 19 21 (fontified t) 21 27 (fontified t face font-lock-type-face) 27 29 (fontified t) 29 33 (fontified t face font-lock-type-face) 33 35 (fontified t) 35 36 (fontified t)) . 1) (undo-tree-id3987 . -29) (undo-tree-id3988 . -33) (undo-tree-id3989 . -21) (undo-tree-id3990 . -27) (undo-tree-id3991 . -14) (undo-tree-id3992 . -19)) nil (23752 20402 213918 459000) 0 nil]) ((#("
" 0 1 (fontified t)) . 555) (undo-tree-id3993 . -1) (undo-tree-id3994 . -1) (undo-tree-id3995 . -1) (undo-tree-id3996 . -1) (undo-tree-id3997 . -1) (undo-tree-id3998 . -1) (undo-tree-id3999 . -1) (undo-tree-id4000 . -1) (undo-tree-id4001 . -1) (undo-tree-id4002 . -1) (undo-tree-id4003 . -1) (undo-tree-id4004 . -1) (undo-tree-id4005 . -1) (undo-tree-id4006 . -1) (undo-tree-id4007 . -1) (undo-tree-id4008 . -1) (undo-tree-id4009 . -1) (undo-tree-id4010 . -1) (undo-tree-id4011 . -1) (undo-tree-id4012 . -1)) nil (23752 20402 213944 717000) 0 nil]) ((#("use tokio::net::tcp::ConnectFuture;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-constant-face) 9 11 (fontified t) 11 14 (fontified t face font-lock-constant-face) 14 16 (fontified t) 16 19 (fontified t face font-lock-constant-face) 19 21 (fontified t) 21 22 (fontified t face font-lock-type-face) 22 34 (fontified t face font-lock-type-face) 34 36 (fontified t)) . 556) (undo-tree-id4013 . -36) (undo-tree-id4014 . -36) (undo-tree-id4015 . -36) (undo-tree-id4016 . -36) (undo-tree-id4017 . -36) (undo-tree-id4018 . -36) (undo-tree-id4019 . -36) (undo-tree-id4020 . -36) (undo-tree-id4021 . -36) (undo-tree-id4022 . -36) (undo-tree-id4023 . -36) (undo-tree-id4024 . -36) (undo-tree-id4025 . -36) (undo-tree-id4026 . -36) (undo-tree-id4027 . -36) (undo-tree-id4028 . -36) (undo-tree-id4029 . -36) (undo-tree-id4030 . -36) (undo-tree-id4031 . -36) (undo-tree-id4032 . -36)) nil (23752 20402 213972 517000) 0 nil]) ((#("pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 17 (fontified t face font-lock-type-face) 17 24 (fontified t) 24 31 (fontified t face font-lock-variable-name-face) 31 33 (fontified t) 33 46 (fontified t face font-lock-type-face) 46 52 (fontified t) 52 54 (fontified t face font-lock-variable-name-face) 54 56 (fontified t) 56 61 (fontified t face font-lock-constant-face) 61 63 (fontified t) 63 67 (fontified t face font-lock-constant-face) 67 69 (fontified t) 69 73 (fontified t face font-lock-constant-face) 73 75 (fontified t) 75 81 (fontified t face font-lock-type-face) 81 82 (fontified t) 82 91 (fontified t face font-lock-type-face) 91 96 (fontified t) 96 100 (fontified t face font-lock-keyword-face) 100 101 (fontified t) 101 107 (fontified t face font-lock-type-face) 107 114 (fontified t) 114 117 (fontified t face font-lock-keyword-face) 117 118 (fontified t) 118 120 (fontified t face font-lock-keyword-face) 120 121 (fontified t) 121 124 (fontified t face font-lock-function-name-face) 124 125 (fontified t) 125 132 (fontified t face font-lock-variable-name-face) 132 134 (fontified t) 134 138 (fontified t face font-lock-keyword-face) 138 139 (fontified t) 139 142 (fontified t face font-lock-constant-face) 142 144 (fontified t) 144 147 (fontified t face font-lock-constant-face) 147 149 (fontified t) 149 156 (fontified t face font-lock-type-face) 156 158 (fontified t) 158 160 (fontified t face font-lock-variable-name-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-constant-face) 167 169 (fontified t) 169 173 (fontified t face font-lock-constant-face) 173 175 (fontified t) 175 179 (fontified t face font-lock-constant-face) 179 181 (fontified t) 181 187 (fontified t face font-lock-type-face) 187 188 (fontified t) 188 197 (fontified t face font-lock-type-face) 197 201 (fontified t) 201 202 (fontified t syntax-table #1#) 202 203 (fontified t) 203 207 (fontified t face font-lock-type-face) 207 218 (fontified t) 218 221 (fontified t face font-lock-keyword-face) 221 222 (fontified t) 222 229 (fontified t face font-lock-variable-name-face) 229 306 (fontified t) 306 331 (fontified t face font-lock-string-face) 331 342 (fontified t) 342 345 (fontified t face font-lock-keyword-face) 345 346 (fontified t) 346 353 (fontified t face font-lock-variable-name-face) 353 356 (fontified t) 356 365 (fontified t face font-lock-type-face) 365 394 (fontified t) 394 398 (fontified t face font-lock-type-face) 398 415 (fontified t) 415 423 (fontified t) 423 427 (fontified t face font-lock-keyword-face) 427 428 (fontified t) 428 434 (fontified t face font-lock-type-face) 434 435 (fontified t) 435 438 (fontified t face font-lock-keyword-face) 438 439 (fontified t) 439 445 (fontified t face font-lock-type-face) 445 452 (fontified t) 452 456 (fontified t face font-lock-keyword-face) 456 457 (fontified t) 457 461 (fontified t face font-lock-type-face) 461 468 (fontified t) 468 472 (fontified t) 472 476 (fontified t face font-lock-keyword-face) 476 477 (fontified t) 477 482 (fontified t face font-lock-type-face) 482 494 (fontified t) 494 496 (fontified t face font-lock-keyword-face) 496 497 (fontified t) 497 500 (fontified t face font-lock-function-name-face) 500 501 (fontified t face font-lock-function-name-face) 501 503 (fontified t) 503 506 (fontified t face font-lock-keyword-face) 506 507 (fontified t) 507 511 (fontified t face font-lock-keyword-face) 511 514 (fontified t) 514 515 (fontified t syntax-table #1#) 515 516 (fontified t) 516 520 (fontified t face font-lock-type-face) 520 521 (fontified t) 521 525 (fontified t face font-lock-type-face) 525 527 (fontified t) 527 531 (fontified t face font-lock-type-face) 531 533 (fontified t) 533 537 (fontified t face font-lock-type-face) 537 539 (fontified t) 539 544 (fontified t face font-lock-type-face) 544 548 (fontified t) 548 556 (fontified t) 556 561 (fontified t face font-lock-keyword-face) 561 562 (fontified t) 562 566 (fontified t face font-lock-keyword-face) 566 596 (fontified t) 596 598 (fontified t face font-lock-type-face) 598 599 (fontified t) 599 604 (fontified t face font-lock-type-face) 604 606 (fontified t) 606 611 (fontified t face font-lock-type-face) 611 622 (fontified t) 622 623 (fontified t syntax-table #1#) 623 642 (fontified t) 642 646 (fontified t face font-lock-keyword-face) 646 682 (fontified t) 682 698 (fontified t face font-lock-string-face) 698 717 (fontified t) 717 719 (fontified t face font-lock-type-face) 719 720 (fontified t) 720 725 (fontified t face font-lock-type-face) 725 727 (fontified t) 727 732 (fontified t face font-lock-type-face) 732 764 (fontified t) 764 766 (fontified t face font-lock-type-face) 766 767 (fontified t) 767 772 (fontified t face font-lock-type-face) 772 774 (fontified t) 774 782 (fontified t face font-lock-type-face) 782 785 (fontified t) 785 786 (fontified t syntax-table #1#) 786 787 (fontified t) 787 789 (fontified t face font-lock-type-face) 789 790 (fontified t) 790 795 (fontified t face font-lock-type-face) 795 797 (fontified t) 797 805 (fontified t face font-lock-type-face) 805 820 (fontified t) 820 823 (fontified t face font-lock-type-face) 823 828 (fontified t) 828 829 (fontified t syntax-table #1#) 829 848 (fontified t) 848 853 (fontified t face font-lock-preprocessor-face) 853 854 (fontified t) 854 877 (fontified t face font-lock-string-face) 877 899 (fontified t) 899 901 (fontified t face font-lock-type-face) 901 902 (fontified t) 902 907 (fontified t face font-lock-type-face) 907 909 (fontified t) 909 914 (fontified t face font-lock-type-face) 914 915 (fontified t) 915 920 (fontified t) 920 952 (fontified t)) . 592) (undo-tree-id4033 . -950) (undo-tree-id4034 . -950) (undo-tree-id4035 . -223) (undo-tree-id4036 . -347) (undo-tree-id4037 . -347) (undo-tree-id4038 . -223) (undo-tree-id4039 . -223) (undo-tree-id4040 . -20) (undo-tree-id4041 . -950) (undo-tree-id4042 . -20) (undo-tree-id4043 . -48) (undo-tree-id4044 . -20) (undo-tree-id4045 . -48) (undo-tree-id4046 . -94) (undo-tree-id4047 . -96) (undo-tree-id4048 . -950) 1542 (t 23751 40320 776358 289000)) nil (23752 20402 213997 282000) 0 nil]) ((1 . 1544) (#("use futures::{Async, Future, Poll};
use log::info;
use tokio::net::TcpStream;


pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        )
        .as_bytes()
        .to_owned()
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 11 (fontified t face font-lock-constant-face) 11 14 (fontified t) 14 19 (fontified t face font-lock-type-face) 19 21 (fontified t) 21 27 (fontified t face font-lock-type-face) 27 29 (fontified t) 29 33 (fontified t face font-lock-type-face) 33 36 (fontified t) 36 39 (fontified t face font-lock-keyword-face) 39 40 (fontified t) 40 43 (fontified t face font-lock-constant-face) 43 51 (fontified t) 51 54 (fontified t face font-lock-keyword-face) 54 55 (fontified t) 55 60 (fontified t face font-lock-constant-face) 60 62 (fontified t) 62 65 (fontified t face font-lock-constant-face) 65 67 (fontified t) 67 76 (fontified t face font-lock-type-face) 76 78 (fontified t) 78 79 (fontified t) 79 80 (fontified t) 80 83 (fontified t face font-lock-keyword-face) 83 84 (fontified t) 84 90 (fontified t face font-lock-keyword-face) 90 91 (fontified t) 91 99 (fontified t face font-lock-type-face) 99 103 (fontified t) 103 107 (fontified t face font-lock-keyword-face) 107 108 (fontified t) 108 116 (fontified t face font-lock-type-face) 116 123 (fontified t) 123 126 (fontified t face font-lock-keyword-face) 126 127 (fontified t) 127 129 (fontified t face font-lock-keyword-face) 129 130 (fontified t) 130 134 (fontified t face font-lock-function-name-face) 134 135 (fontified t) 135 138 (fontified t face font-lock-variable-name-face) 138 140 (fontified t) 140 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 153 (fontified t face font-lock-constant-face) 153 155 (fontified t) 155 162 (fontified t face font-lock-type-face) 162 164 (fontified t) 164 172 (fontified t face font-lock-variable-name-face) 172 174 (fontified t) 174 178 (fontified t face font-lock-keyword-face) 178 179 (fontified t) 179 182 (fontified t face font-lock-constant-face) 182 184 (fontified t) 184 187 (fontified t face font-lock-constant-face) 187 189 (fontified t) 189 196 (fontified t face font-lock-type-face) 196 199 (fontified t) 199 200 (fontified t syntax-table #1#) 200 201 (fontified t) 201 204 (fontified t face font-lock-type-face) 204 205 (fontified t) 205 207 (fontified t face font-lock-type-face) 207 219 (fontified t) 219 222 (fontified t face font-lock-keyword-face) 222 254 (fontified t) 254 256 (fontified t face rust-builtin-formatting-macro-face) 256 261 (fontified t face rust-builtin-formatting-macro-face) 261 262 (fontified t) 262 272 (fontified t face font-lock-string-face) 272 274 (fontified t face rust-string-interpolation-face) 274 275 (fontified t face font-lock-string-face) 275 289 (fontified t) 289 297 (fontified t) 297 304 (fontified t face rust-builtin-formatting-macro-face) 304 318 (fontified t) 318 326 (fontified t face font-lock-string-face) 326 338 (fontified t face rust-string-interpolation-face) 338 342 (fontified t face font-lock-string-face) 342 347 (fontified t face rust-string-interpolation-face) 347 352 (fontified t face font-lock-string-face) 352 364 (fontified t face rust-string-interpolation-face) 364 368 (fontified t face font-lock-string-face) 368 373 (fontified t face rust-string-interpolation-face) 373 378 (fontified t face font-lock-string-face) 378 399 (fontified t) 399 416 (fontified t) 416 488 (fontified t) 488 497 (fontified t) 497 500 (fontified t) 500 507 (fontified t) 507 556 (fontified t) 556 559 (fontified t face font-lock-keyword-face) 559 560 (fontified t) 560 565 (fontified t face font-lock-constant-face) 565 567 (fontified t) 567 570 (fontified t face font-lock-constant-face) 570 572 (fontified t) 572 575 (fontified t face font-lock-constant-face) 575 577 (fontified t) 577 580 (fontified t face font-lock-type-face) 580 590 (face font-lock-type-face fontified t) 590 592 (fontified t) 592 595 (fontified t face font-lock-keyword-face) 595 596 (fontified t) 596 602 (fontified t face font-lock-keyword-face) 602 603 (fontified t) 603 609 (fontified t face font-lock-type-face) 609 616 (fontified t) 616 623 (fontified t face font-lock-variable-name-face) 623 625 (fontified t) 625 638 (fontified t face font-lock-type-face) 638 644 (fontified t) 644 646 (fontified t face font-lock-variable-name-face) 646 648 (fontified t) 648 653 (fontified t face font-lock-constant-face) 653 655 (fontified t) 655 659 (fontified t face font-lock-constant-face) 659 661 (fontified t) 661 665 (fontified t face font-lock-constant-face) 665 667 (fontified t) 667 673 (fontified t face font-lock-type-face) 673 674 (fontified t) 674 683 (fontified t face font-lock-type-face) 683 688 (fontified t) 688 692 (fontified t face font-lock-keyword-face) 692 693 (fontified t) 693 699 (fontified t face font-lock-type-face) 699 706 (fontified t) 706 709 (fontified t face font-lock-keyword-face) 709 710 (fontified t) 710 712 (fontified t face font-lock-keyword-face) 712 713 (fontified t) 713 716 (fontified t face font-lock-function-name-face) 716 717 (fontified t) 717 724 (fontified t face font-lock-variable-name-face) 724 726 (fontified t) 726 730 (fontified t face font-lock-keyword-face) 730 731 (fontified t) 731 734 (fontified t face font-lock-constant-face) 734 736 (fontified t) 736 739 (fontified t face font-lock-constant-face) 739 741 (fontified t) 741 748 (fontified t face font-lock-type-face) 748 750 (fontified t) 750 752 (fontified t face font-lock-variable-name-face) 752 754 (fontified t) 754 759 (fontified t face font-lock-constant-face) 759 761 (fontified t) 761 765 (fontified t face font-lock-constant-face) 765 767 (fontified t) 767 771 (fontified t face font-lock-constant-face) 771 773 (fontified t) 773 779 (fontified t face font-lock-type-face) 779 780 (fontified t) 780 789 (fontified t face font-lock-type-face) 789 793 (fontified t) 793 794 (fontified t syntax-table #1#) 794 795 (fontified t) 795 799 (fontified t face font-lock-type-face) 799 802 (fontified t) 802 810 (fontified t) 810 813 (fontified t face font-lock-keyword-face) 813 814 (fontified t) 814 821 (fontified t face font-lock-variable-name-face) 821 898 (fontified t) 898 916 (fontified t face font-lock-string-face) 916 923 (fontified t face font-lock-string-face) 923 926 (fontified t) 926 934 (fontified t) 934 937 (fontified t face font-lock-keyword-face) 937 938 (fontified t) 938 945 (fontified t face font-lock-variable-name-face) 945 948 (fontified t) 948 957 (fontified t face font-lock-type-face) 957 986 (fontified t) 986 990 (fontified t face font-lock-type-face) 990 997 (fontified t) 997 1007 (fontified t) 1007 1015 (fontified t) 1015 1019 (fontified t face font-lock-keyword-face) 1019 1020 (fontified t) 1020 1026 (fontified t face font-lock-type-face) 1026 1027 (fontified t) 1027 1030 (fontified t face font-lock-keyword-face) 1030 1031 (fontified t) 1031 1037 (fontified t face font-lock-type-face) 1037 1044 (fontified t) 1044 1048 (fontified t face font-lock-keyword-face) 1048 1049 (fontified t) 1049 1053 (fontified t face font-lock-type-face) 1053 1064 (fontified t) 1064 1068 (fontified t face font-lock-keyword-face) 1068 1069 (fontified t) 1069 1074 (fontified t face font-lock-type-face) 1074 1086 (fontified t) 1086 1088 (fontified t face font-lock-keyword-face) 1088 1089 (fontified t) 1089 1092 (fontified t face font-lock-function-name-face) 1092 1093 (face font-lock-function-name-face fontified t) 1093 1095 (fontified t) 1095 1098 (face font-lock-keyword-face fontified t) 1098 1099 (fontified t) 1099 1103 (face font-lock-keyword-face fontified t) 1103 1106 (fontified t) 1106 1107 (fontified t syntax-table #1#) 1107 1108 (fontified t) 1108 1112 (face font-lock-type-face fontified t) 1112 1113 (fontified t) 1113 1117 (face font-lock-type-face fontified t) 1117 1119 (fontified t) 1119 1123 (face font-lock-type-face fontified t) 1123 1125 (fontified t) 1125 1129 (face font-lock-type-face fontified t) 1129 1131 (fontified t) 1131 1136 (face font-lock-type-face fontified t) 1136 1140 (fontified t) 1140 1148 (fontified t) 1148 1153 (fontified t face font-lock-keyword-face) 1153 1154 (fontified t) 1154 1158 (fontified t face font-lock-keyword-face) 1158 1188 (fontified t) 1188 1190 (fontified t face font-lock-type-face) 1190 1191 (fontified t) 1191 1196 (fontified t face font-lock-type-face) 1196 1198 (fontified t) 1198 1203 (fontified t face font-lock-type-face) 1203 1214 (fontified t) 1214 1215 (fontified t syntax-table #1#) 1215 1234 (fontified t) 1234 1238 (fontified t face font-lock-keyword-face) 1238 1274 (fontified t) 1274 1290 (fontified t face font-lock-string-face) 1290 1302 (fontified t) 1302 1309 (fontified t) 1309 1311 (fontified t face font-lock-type-face) 1311 1312 (fontified t) 1312 1317 (fontified t face font-lock-type-face) 1317 1319 (fontified t) 1319 1324 (fontified t face font-lock-type-face) 1324 1330 (fontified t) 1330 1356 (fontified t) 1356 1358 (fontified t face font-lock-type-face) 1358 1359 (fontified t) 1359 1364 (fontified t face font-lock-type-face) 1364 1366 (fontified t) 1366 1374 (fontified t face font-lock-type-face) 1374 1377 (fontified t) 1377 1378 (fontified t syntax-table #1#) 1378 1379 (fontified t) 1379 1381 (fontified t face font-lock-type-face) 1381 1382 (fontified t) 1382 1387 (fontified t face font-lock-type-face) 1387 1389 (fontified t) 1389 1397 (fontified t face font-lock-type-face) 1397 1412 (fontified t) 1412 1415 (fontified t face font-lock-type-face) 1415 1420 (fontified t) 1420 1421 (fontified t syntax-table #1#) 1421 1426 (fontified t) 1426 1440 (fontified t) 1440 1445 (fontified t face font-lock-preprocessor-face) 1445 1446 (fontified t) 1446 1469 (fontified t face font-lock-string-face) 1469 1475 (fontified t) 1475 1491 (fontified t) 1491 1493 (fontified t face font-lock-type-face) 1493 1494 (fontified t) 1494 1499 (fontified t face font-lock-type-face) 1499 1501 (fontified t) 1501 1506 (fontified t face font-lock-type-face) 1506 1507 (fontified t) 1507 1512 (fontified t) 1512 1544 (fontified t)) . 1) (undo-tree-id3847 . -1544) (undo-tree-id3848 . -1544) (undo-tree-id3849 . -1544) (undo-tree-id3850 . -1544) (undo-tree-id3851 . -51) (undo-tree-id3852 . -51) (undo-tree-id3853 . -51) (undo-tree-id3854 . -51) (undo-tree-id3855 . -51) (undo-tree-id3856 . -51) (undo-tree-id3857 . -51) (undo-tree-id3858 . -51) (undo-tree-id3859 . -51) (undo-tree-id3860 . -51) (undo-tree-id3861 . -51) (undo-tree-id3862 . -51) (undo-tree-id3863 . -51) (undo-tree-id3864 . -51) (undo-tree-id3865 . -51) (undo-tree-id3866 . -51) (undo-tree-id3867 . -51) (undo-tree-id3868 . -51) (undo-tree-id3869 . -51) (undo-tree-id3870 . -51) (undo-tree-id3871 . -51) (undo-tree-id3872 . -51) (undo-tree-id3873 . -51) (undo-tree-id3874 . -51) (undo-tree-id3875 . -51) (undo-tree-id3876 . -51) (undo-tree-id3877 . -51) (undo-tree-id3878 . -51) (undo-tree-id3879 . -51) (undo-tree-id3880 . -51) (undo-tree-id3881 . -51) (undo-tree-id3882 . -51) (undo-tree-id3883 . -51) (undo-tree-id3884 . -51) (undo-tree-id3885 . -51) (undo-tree-id3886 . -51) (undo-tree-id3887 . -79) (undo-tree-id3888 . -51) (undo-tree-id3889 . -79) (undo-tree-id3890 . -79) (undo-tree-id3891 . -51) (undo-tree-id3892 . -79) (undo-tree-id3893 . -79) (undo-tree-id3894 . -51) (undo-tree-id3895 . -79) (undo-tree-id3896 . -51) (undo-tree-id3897 . -79) (undo-tree-id3898 . -51) (undo-tree-id3899 . -79) (undo-tree-id3900 . -79) (undo-tree-id3901 . -79) (undo-tree-id3902 . -79) (undo-tree-id3903 . -79) (undo-tree-id3904 . -79) (undo-tree-id3905 . -79) (undo-tree-id3906 . -79) (undo-tree-id3907 . -79) (undo-tree-id3908 . -79) (undo-tree-id3909 . -79) (undo-tree-id3910 . -79) (undo-tree-id3911 . -79) (undo-tree-id3912 . -79) (undo-tree-id3913 . -79) (undo-tree-id3914 . -79) (undo-tree-id3915 . -79) (undo-tree-id3916 . -79) (undo-tree-id3917 . -79) (undo-tree-id3918 . -79) (undo-tree-id3919 . -79) (undo-tree-id3920 . -79) (undo-tree-id3921 . -79) (undo-tree-id3922 . -79) (undo-tree-id3923 . -51) (undo-tree-id3924 . -51) (undo-tree-id3925 . -51) (undo-tree-id3926 . -51) (undo-tree-id3927 . -51) (undo-tree-id3928 . -51) (undo-tree-id3929 . -79) (undo-tree-id3930 . -79) (undo-tree-id3931 . -79) (undo-tree-id3932 . -79) (undo-tree-id3933 . -79) (undo-tree-id3934 . -79) (undo-tree-id3935 . -79) (undo-tree-id3936 . -79) (undo-tree-id3937 . -79) (undo-tree-id3938 . -79) (undo-tree-id3939 . -79) (undo-tree-id3940 . -79) (undo-tree-id3941 . -51) (undo-tree-id3942 . -79) (undo-tree-id3943 . -51) (undo-tree-id3944 . -51) (undo-tree-id3945 . -79) (undo-tree-id3946 . -51) (undo-tree-id3947 . -51) (undo-tree-id3948 . -79) (undo-tree-id3949 . -51) (undo-tree-id3950 . -79) (undo-tree-id3951 . -51) (undo-tree-id3952 . -79) (undo-tree-id3953 . -51) (undo-tree-id3954 . -51) (undo-tree-id3955 . -51) (undo-tree-id3956 . -51) (undo-tree-id3957 . -51) (undo-tree-id3958 . -51) (undo-tree-id3959 . -51) (undo-tree-id3960 . -51) (undo-tree-id3961 . -51) (undo-tree-id3962 . -51) (undo-tree-id3963 . -51) (undo-tree-id3964 . -51) (undo-tree-id3965 . -51) (undo-tree-id3966 . -51)) ((1 . 1545) (#("use futures::{Async, Future, Poll};
use log::info;
use tokio::net::TcpStream;

pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        )
        .as_bytes()
        .to_owned()
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 11 (fontified t face font-lock-constant-face) 11 14 (fontified t) 14 19 (fontified t face font-lock-type-face) 19 21 (fontified t) 21 27 (fontified t face font-lock-type-face) 27 29 (fontified t) 29 33 (fontified t face font-lock-type-face) 33 35 (fontified t) 35 36 (fontified t) 36 39 (fontified t face font-lock-keyword-face) 39 40 (fontified t) 40 43 (fontified t face font-lock-constant-face) 43 51 (fontified t) 51 54 (fontified t face font-lock-keyword-face) 54 55 (fontified t) 55 60 (fontified t face font-lock-constant-face) 60 62 (fontified t) 62 65 (fontified t face font-lock-constant-face) 65 67 (fontified t) 67 76 (fontified t face font-lock-type-face) 76 77 (fontified t) 77 79 (fontified t) 79 82 (fontified t face font-lock-keyword-face) 82 83 (fontified t) 83 89 (fontified t face font-lock-keyword-face) 89 90 (fontified t) 90 98 (fontified t face font-lock-type-face) 98 102 (fontified t) 102 106 (fontified t face font-lock-keyword-face) 106 107 (fontified t) 107 115 (fontified t face font-lock-type-face) 115 122 (fontified t) 122 125 (fontified t face font-lock-keyword-face) 125 126 (fontified t) 126 128 (fontified t face font-lock-keyword-face) 128 129 (fontified t) 129 133 (fontified t face font-lock-function-name-face) 133 134 (fontified t) 134 137 (fontified t face font-lock-variable-name-face) 137 139 (fontified t) 139 143 (fontified t face font-lock-keyword-face) 143 144 (fontified t) 144 147 (fontified t face font-lock-constant-face) 147 149 (fontified t) 149 152 (fontified t face font-lock-constant-face) 152 154 (fontified t) 154 161 (fontified t face font-lock-type-face) 161 163 (fontified t) 163 171 (fontified t face font-lock-variable-name-face) 171 173 (fontified t) 173 177 (fontified t face font-lock-keyword-face) 177 178 (fontified t) 178 181 (fontified t face font-lock-constant-face) 181 183 (fontified t) 183 186 (fontified t face font-lock-constant-face) 186 188 (fontified t) 188 195 (fontified t face font-lock-type-face) 195 198 (fontified t) 198 199 (syntax-table #1# fontified t) 199 200 (fontified t) 200 203 (fontified t face font-lock-type-face) 203 204 (fontified t) 204 206 (fontified t face font-lock-type-face) 206 218 (fontified t) 218 221 (fontified t face font-lock-keyword-face) 221 253 (fontified t) 253 260 (fontified t face rust-builtin-formatting-macro-face) 260 261 (fontified t) 261 271 (fontified t face font-lock-string-face) 271 273 (fontified t face rust-string-interpolation-face) 273 274 (fontified t face font-lock-string-face) 274 296 (fontified t) 296 303 (fontified t face rust-builtin-formatting-macro-face) 303 317 (fontified t) 317 325 (fontified t face font-lock-string-face) 325 337 (fontified t face rust-string-interpolation-face) 337 341 (fontified t face font-lock-string-face) 341 346 (fontified t face rust-string-interpolation-face) 346 351 (fontified t face font-lock-string-face) 351 363 (fontified t face rust-string-interpolation-face) 363 367 (fontified t face font-lock-string-face) 367 372 (fontified t face rust-string-interpolation-face) 372 377 (fontified t face font-lock-string-face) 377 551 (fontified t) 551 552 (fontified t) 552 555 (fontified t) 555 558 (fontified t face font-lock-keyword-face) 558 559 (fontified t) 559 564 (fontified t face font-lock-constant-face) 564 566 (fontified t) 566 569 (fontified t face font-lock-constant-face) 569 571 (fontified t) 571 574 (fontified t face font-lock-constant-face) 574 576 (fontified t) 576 577 (fontified t face font-lock-type-face) 577 589 (fontified t face font-lock-type-face) 589 591 (fontified t) 591 594 (fontified t face font-lock-keyword-face) 594 595 (fontified t) 595 601 (fontified t face font-lock-keyword-face) 601 602 (fontified t) 602 608 (fontified t face font-lock-type-face) 608 615 (fontified t) 615 622 (fontified t face font-lock-variable-name-face) 622 624 (fontified t) 624 637 (fontified t face font-lock-type-face) 637 643 (fontified t) 643 645 (fontified t face font-lock-variable-name-face) 645 647 (fontified t) 647 652 (fontified t face font-lock-constant-face) 652 654 (fontified t) 654 658 (fontified t face font-lock-constant-face) 658 660 (fontified t) 660 664 (fontified t face font-lock-constant-face) 664 666 (fontified t) 666 672 (fontified t face font-lock-type-face) 672 673 (fontified t) 673 682 (fontified t face font-lock-type-face) 682 687 (fontified t) 687 691 (fontified t face font-lock-keyword-face) 691 692 (fontified t) 692 698 (fontified t face font-lock-type-face) 698 705 (fontified t) 705 708 (fontified t face font-lock-keyword-face) 708 709 (fontified t) 709 711 (fontified t face font-lock-keyword-face) 711 712 (fontified t) 712 715 (fontified t face font-lock-function-name-face) 715 716 (fontified t) 716 723 (fontified t face font-lock-variable-name-face) 723 725 (fontified t) 725 729 (fontified t face font-lock-keyword-face) 729 730 (fontified t) 730 733 (fontified t face font-lock-constant-face) 733 735 (fontified t) 735 738 (fontified t face font-lock-constant-face) 738 740 (fontified t) 740 747 (fontified t face font-lock-type-face) 747 749 (fontified t) 749 751 (fontified t face font-lock-variable-name-face) 751 753 (fontified t) 753 758 (fontified t face font-lock-constant-face) 758 760 (fontified t) 760 764 (fontified t face font-lock-constant-face) 764 766 (fontified t) 766 770 (fontified t face font-lock-constant-face) 770 772 (fontified t) 772 778 (fontified t face font-lock-type-face) 778 779 (fontified t) 779 788 (fontified t face font-lock-type-face) 788 792 (fontified t) 792 793 (syntax-table #1# fontified t) 793 794 (fontified t) 794 798 (fontified t face font-lock-type-face) 798 809 (fontified t) 809 812 (fontified t face font-lock-keyword-face) 812 813 (fontified t) 813 820 (fontified t face font-lock-variable-name-face) 820 897 (fontified t) 897 922 (fontified t face font-lock-string-face) 922 933 (fontified t) 933 936 (fontified t face font-lock-keyword-face) 936 937 (fontified t) 937 944 (fontified t face font-lock-variable-name-face) 944 947 (fontified t) 947 956 (fontified t face font-lock-type-face) 956 985 (fontified t) 985 989 (fontified t face font-lock-type-face) 989 1014 (fontified t) 1014 1018 (fontified t face font-lock-keyword-face) 1018 1019 (fontified t) 1019 1025 (fontified t face font-lock-type-face) 1025 1026 (fontified t) 1026 1029 (fontified t face font-lock-keyword-face) 1029 1030 (fontified t) 1030 1036 (fontified t face font-lock-type-face) 1036 1043 (fontified t) 1043 1047 (fontified t face font-lock-keyword-face) 1047 1048 (fontified t) 1048 1052 (fontified t face font-lock-type-face) 1052 1059 (fontified t) 1059 1063 (fontified t) 1063 1067 (fontified t face font-lock-keyword-face) 1067 1068 (fontified t) 1068 1073 (fontified t face font-lock-type-face) 1073 1085 (fontified t) 1085 1087 (fontified t face font-lock-keyword-face) 1087 1088 (fontified t) 1088 1091 (fontified t face font-lock-function-name-face) 1091 1092 (fontified t face font-lock-function-name-face) 1092 1094 (fontified t) 1094 1097 (fontified t face font-lock-keyword-face) 1097 1098 (fontified t) 1098 1102 (fontified t face font-lock-keyword-face) 1102 1105 (fontified t) 1105 1106 (syntax-table #1# fontified t) 1106 1107 (fontified t) 1107 1111 (fontified t face font-lock-type-face) 1111 1112 (fontified t) 1112 1116 (fontified t face font-lock-type-face) 1116 1118 (fontified t) 1118 1122 (fontified t face font-lock-type-face) 1122 1124 (fontified t) 1124 1128 (fontified t face font-lock-type-face) 1128 1130 (fontified t) 1130 1135 (fontified t face font-lock-type-face) 1135 1139 (fontified t) 1139 1147 (fontified t) 1147 1152 (fontified t face font-lock-keyword-face) 1152 1153 (fontified t) 1153 1157 (fontified t face font-lock-keyword-face) 1157 1187 (fontified t) 1187 1189 (fontified t face font-lock-type-face) 1189 1190 (fontified t) 1190 1195 (fontified t face font-lock-type-face) 1195 1197 (fontified t) 1197 1202 (fontified t face font-lock-type-face) 1202 1213 (fontified t) 1213 1214 (syntax-table #1# fontified t) 1214 1233 (fontified t) 1233 1237 (fontified t face font-lock-keyword-face) 1237 1273 (fontified t) 1273 1289 (fontified t face font-lock-string-face) 1289 1308 (fontified t) 1308 1310 (fontified t face font-lock-type-face) 1310 1311 (fontified t) 1311 1316 (fontified t face font-lock-type-face) 1316 1318 (fontified t) 1318 1323 (fontified t face font-lock-type-face) 1323 1355 (fontified t) 1355 1357 (fontified t face font-lock-type-face) 1357 1358 (fontified t) 1358 1363 (fontified t face font-lock-type-face) 1363 1365 (fontified t) 1365 1373 (fontified t face font-lock-type-face) 1373 1376 (fontified t) 1376 1377 (syntax-table #1# fontified t) 1377 1378 (fontified t) 1378 1380 (fontified t face font-lock-type-face) 1380 1381 (fontified t) 1381 1386 (fontified t face font-lock-type-face) 1386 1388 (fontified t) 1388 1396 (fontified t face font-lock-type-face) 1396 1411 (fontified t) 1411 1414 (fontified t face font-lock-type-face) 1414 1419 (fontified t) 1419 1420 (syntax-table #1# fontified t) 1420 1439 (fontified t) 1439 1444 (fontified t face font-lock-preprocessor-face) 1444 1445 (fontified t) 1445 1468 (fontified t face font-lock-string-face) 1468 1490 (fontified t) 1490 1492 (fontified t face font-lock-type-face) 1492 1493 (fontified t) 1493 1498 (fontified t face font-lock-type-face) 1498 1500 (fontified t) 1500 1505 (fontified t face font-lock-type-face) 1505 1543 (fontified t)) . 1) (undo-tree-id3618 . -64) (undo-tree-id3619 . -801) (undo-tree-id3620 . 566) (undo-tree-id3621 . -814) (undo-tree-id3622 . -938) (undo-tree-id3623 . -64) (undo-tree-id3624 . -51) (undo-tree-id3625 . -51) (undo-tree-id3626 . -51) (undo-tree-id3627 . -591) (undo-tree-id3628 . -608) (undo-tree-id3629 . -591) (undo-tree-id3630 . -608) (undo-tree-id3631 . -591) (undo-tree-id3632 . -608) (undo-tree-id3633 . -591) (undo-tree-id3634 . -608) (undo-tree-id3635 . -591) (undo-tree-id3636 . -608) (undo-tree-id3637 . -591) (undo-tree-id3638 . -608) (undo-tree-id3639 . -591) (undo-tree-id3640 . -608) (undo-tree-id3641 . -591) (undo-tree-id3642 . -608) (undo-tree-id3643 . -591) (undo-tree-id3644 . -608) (undo-tree-id3645 . -814) (undo-tree-id3646 . -938) (undo-tree-id3647 . -78) (undo-tree-id3648 . -938) (undo-tree-id3649 . -814) (undo-tree-id3650 . -814) (undo-tree-id3651 . -591) (undo-tree-id3652 . -608) (undo-tree-id3653 . -591) (undo-tree-id3654 . -608) (undo-tree-id3655 . -591) (undo-tree-id3656 . -608) (undo-tree-id3657 . -591) (undo-tree-id3658 . -608) (undo-tree-id3659 . -591) (undo-tree-id3660 . -608) (undo-tree-id3661 . -591) (undo-tree-id3662 . -608) (undo-tree-id3663 . -591) (undo-tree-id3664 . -608) (undo-tree-id3665 . -591) (undo-tree-id3666 . -608) (undo-tree-id3667 . -591) (undo-tree-id3668 . -608) (undo-tree-id3669 . -591) (undo-tree-id3670 . -608) (undo-tree-id3671 . -64) (undo-tree-id3672 . -64) (undo-tree-id3673 . -814) (undo-tree-id3674 . -64) (undo-tree-id3675 . -64) (undo-tree-id3676 . -591) (undo-tree-id3677 . -608) (undo-tree-id3678 . -591) (undo-tree-id3679 . -608) (undo-tree-id3680 . -64) (undo-tree-id3681 . -64) (undo-tree-id3682 . -64) (undo-tree-id3683 . -64) (undo-tree-id3684 . -64) (undo-tree-id3685 . -64) (undo-tree-id3686 . -64) (undo-tree-id3687 . -64) (undo-tree-id3688 . -64) (undo-tree-id3689 . -64) (undo-tree-id3690 . -64) (undo-tree-id3691 . -64) (undo-tree-id3692 . -64) (undo-tree-id3693 . -64) (undo-tree-id3694 . -64) (undo-tree-id3695 . -64) (undo-tree-id3696 . -64) (undo-tree-id3697 . -64) (undo-tree-id3698 . -64) (undo-tree-id3699 . -64) (undo-tree-id3700 . -64) (undo-tree-id3701 . -64) (t 23751 40320 776358 289000)) (23752 16922 567167 168000) 0 nil]) ((#("use std::sync::atomic::{AtomicUsize, Ordering};
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 7 (fontified t face font-lock-constant-face) 7 9 (fontified t) 9 13 (fontified t face font-lock-constant-face) 13 15 (fontified t) 15 21 (fontified t face font-lock-constant-face) 21 24 (fontified t) 24 35 (fontified t face font-lock-type-face) 35 37 (fontified t) 37 45 (fontified t face font-lock-type-face) 45 48 (fontified t)) . 52) (undo-tree-id3815 . -48) (undo-tree-id3816 . -48) (undo-tree-id3817 . -48) (undo-tree-id3818 . -48) (undo-tree-id3819 . -48) (undo-tree-id3820 . -48) (undo-tree-id3821 . -48) (undo-tree-id3822 . -48) (undo-tree-id3823 . -48) (undo-tree-id3824 . -48) (undo-tree-id3825 . -48) (undo-tree-id3826 . -48) (undo-tree-id3827 . -48) (undo-tree-id3828 . -48) (undo-tree-id3829 . -48) (undo-tree-id3830 . -48) (undo-tree-id3831 . -37) (undo-tree-id3832 . -45) (undo-tree-id3833 . -37) (undo-tree-id3834 . -45) (undo-tree-id3835 . -48) (undo-tree-id3836 . -48) (undo-tree-id3837 . -48) (undo-tree-id3838 . -48) (undo-tree-id3839 . -48) (undo-tree-id3840 . -48) (undo-tree-id3841 . -48) (undo-tree-id3842 . -48) (undo-tree-id3843 . -48) (undo-tree-id3844 . -48) (undo-tree-id3845 . -48) (undo-tree-id3846 . -48)) ((52 . 100)) (23752 16922 523808 748000) 0 nil]) ((#("use crate::receiver::Receiver;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 11 (fontified t) 11 19 (fontified t face font-lock-constant-face) 19 21 (fontified t) 21 29 (fontified t face font-lock-type-face) 29 30 (fontified t) 30 31 (fontified t)) . 1) (undo-tree-id3762 . -31) (undo-tree-id3763 . -31) (undo-tree-id3764 . -31) (undo-tree-id3765 . -31) (undo-tree-id3766 . -31) (undo-tree-id3767 . -31) (undo-tree-id3768 . -31) (undo-tree-id3769 . -31) (undo-tree-id3770 . -31) (undo-tree-id3771 . -31) (undo-tree-id3772 . -31) (undo-tree-id3773 . -31) (undo-tree-id3774 . -31) (undo-tree-id3775 . -31) (undo-tree-id3776 . -31) (undo-tree-id3777 . -31) (undo-tree-id3778 . -31) (undo-tree-id3779 . -31) (undo-tree-id3780 . -31) (undo-tree-id3781 . -31) (undo-tree-id3782 . -31) (undo-tree-id3783 . -31) (undo-tree-id3784 . -31) (undo-tree-id3785 . -31) (undo-tree-id3786 . -31) (undo-tree-id3787 . -31) (undo-tree-id3788 . -31) (undo-tree-id3789 . -31) (undo-tree-id3790 . -4) (undo-tree-id3791 . -9) (undo-tree-id3792 . -4) (undo-tree-id3793 . -29) (undo-tree-id3794 . -31) (undo-tree-id3795 . -31) (undo-tree-id3796 . -31) (undo-tree-id3797 . -31) (undo-tree-id3798 . -31) (undo-tree-id3799 . -31) (undo-tree-id3800 . -31) (undo-tree-id3801 . -31) (undo-tree-id3802 . -31) (undo-tree-id3803 . -31) (undo-tree-id3804 . -31) (undo-tree-id3805 . -31) (undo-tree-id3806 . -31) (undo-tree-id3807 . -31) (undo-tree-id3808 . -31) (undo-tree-id3809 . -31) (undo-tree-id3810 . -31) (undo-tree-id3811 . -31) (undo-tree-id3812 . -31) (undo-tree-id3813 . -31) (undo-tree-id3814 . -31)) ((1 . 32)) (23752 16922 481705 165000) 0 nil]) ((#("use crate::stream;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t)) . 32) (undo-tree-id3735 . -19) (undo-tree-id3736 . -19) (undo-tree-id3737 . -19) (undo-tree-id3738 . -19) (undo-tree-id3739 . -19) (undo-tree-id3740 . -19) (undo-tree-id3741 . -19) (undo-tree-id3742 . -19) (undo-tree-id3743 . -19) (undo-tree-id3744 . -19) (undo-tree-id3745 . -19) (undo-tree-id3746 . -19) (undo-tree-id3747 . -19) (undo-tree-id3748 . -19) (undo-tree-id3749 . -4) (undo-tree-id3750 . -9) (undo-tree-id3751 . -4) (undo-tree-id3752 . -17) (undo-tree-id3753 . -19) (undo-tree-id3754 . -19) (undo-tree-id3755 . -19) (undo-tree-id3756 . -19) (undo-tree-id3757 . -19) (undo-tree-id3758 . -19) (undo-tree-id3759 . -19) (undo-tree-id3760 . -19) (undo-tree-id3761 . -19)) ((32 . 51)) (23752 16922 440962 870000) 0 nil]) ((#("use crate::user::User;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 11 (fontified t) 11 15 (fontified t face font-lock-constant-face) 15 17 (fontified t) 17 21 (fontified t face font-lock-type-face) 21 23 (fontified t)) . 51) (undo-tree-id3731 . -4) (undo-tree-id3732 . -9) (undo-tree-id3733 . -4) (undo-tree-id3734 . -21)) ((51 . 74)) (23752 16922 399920 58000) 0 nil]) ((#("use std::{thread, time};
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 7 (fontified t face font-lock-constant-face) 7 25 (fontified t)) . 173) (undo-tree-id3723 . -18) (undo-tree-id3724 . -22) (undo-tree-id3725 . -10) (undo-tree-id3726 . -16) (undo-tree-id3727 . -10) (undo-tree-id3728 . -16) (undo-tree-id3729 . -18) (undo-tree-id3730 . -22)) ((173 . 198)) (23752 16922 363260 372000) 0 nil]) ((#("pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 27 (fontified t face font-lock-variable-name-face) 27 29 (fontified t) 29 40 (fontified t face font-lock-type-face) 40 43 (fontified t) 43 54 (fontified t face font-lock-type-face) 54 64 (fontified t)) . 226) (undo-tree-id3702 . -64) (undo-tree-id3703 . -64) (undo-tree-id3704 . -64) (undo-tree-id3705 . -64) (undo-tree-id3706 . -64) (undo-tree-id3707 . -64) (undo-tree-id3708 . -64) (undo-tree-id3709 . -64) (undo-tree-id3710 . -64) (undo-tree-id3711 . -64) (undo-tree-id3712 . -64) (undo-tree-id3713 . -64) (undo-tree-id3714 . -64) (undo-tree-id3715 . -64) (undo-tree-id3716 . -64) (undo-tree-id3717 . -64) (undo-tree-id3718 . -64) (undo-tree-id3719 . -64) (undo-tree-id3720 . -64) (undo-tree-id3721 . -64) (undo-tree-id3722 . -64)) ((226 . 290)) (23752 16922 323863 597000) 0 nil]) ((#("pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 26 (fontified t face font-lock-variable-name-face) 26 28 (fontified t) 28 39 (fontified t face font-lock-type-face) 39 42 (fontified t) 42 53 (fontified t face font-lock-type-face) 53 65 (fontified t)) . 290)) ((290 . 355)) (23752 16921 657826 491000) 0 nil]) ((#("
" 0 1 (fontified t)) . -1820) (undo-tree-id3605 . -1) (undo-tree-id3606 . -1) (undo-tree-id3607 . -1) (undo-tree-id3608 . -1) (undo-tree-id3609 . -1) (undo-tree-id3610 . -1) 1821) nil (23752 16920 173123 585000) 0 nil]) ((#("pub struct PubSub {}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User) -> Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);
        
        let stream_of_data_from_redis = Receiver::new();
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 17 (fontified t face font-lock-type-face) 17 22 (fontified t) 22 26 (fontified t face font-lock-keyword-face) 26 27 (fontified t) 27 33 (fontified t face font-lock-type-face) 33 36 (fontified t) 36 40 (fontified t) 40 43 (fontified t face font-lock-keyword-face) 43 44 (fontified t) 44 46 (fontified t face font-lock-keyword-face) 46 47 (fontified t) 47 51 (fontified t face font-lock-function-name-face) 51 52 (fontified t) 52 60 (fontified t face font-lock-variable-name-face) 60 62 (fontified t) 62 66 (fontified t face font-lock-keyword-face) 66 67 (fontified t) 67 70 (fontified t face font-lock-constant-face) 70 72 (fontified t) 72 75 (fontified t face font-lock-constant-face) 75 77 (fontified t) 77 84 (fontified t face font-lock-type-face) 84 86 (fontified t) 86 90 (fontified t face font-lock-variable-name-face) 90 93 (fontified t) 93 97 (fontified t face font-lock-type-face) 97 100 (fontified t) 100 101 (fontified t syntax-table #1#) 101 102 (fontified t) 102 110 (fontified t face font-lock-type-face) 110 113 (fontified t) 113 121 (fontified t) 121 126 (fontified t face font-lock-keyword-face) 126 127 (fontified t) 127 143 (fontified t face font-lock-type-face) 143 149 (fontified t) 149 157 (fontified t face font-lock-type-face) 157 159 (fontified t) 159 166 (fontified t face font-lock-type-face) 166 168 (fontified t) 168 169 (syntax-table #1# fontified t) 169 170 (fontified t) 170 185 (fontified t face font-lock-type-face) 185 191 (fontified t) 191 199 (fontified t face font-lock-type-face) 199 201 (fontified t) 201 208 (fontified t face font-lock-type-face) 208 224 (fontified t) 224 230 (fontified t face font-lock-constant-face) 230 238 (fontified t) 238 242 (fontified t face font-lock-constant-face) 242 244 (fontified t) 244 252 (fontified t face font-lock-type-face) 252 277 (fontified t) 277 284 (fontified t) 284 292 (fontified t) 292 295 (fontified t face font-lock-keyword-face) 295 296 (fontified t) 296 311 (fontified t face font-lock-variable-name-face) 311 314 (fontified t) 314 330 (fontified t face font-lock-type-face) 330 344 (fontified t) 344 352 (fontified t face font-lock-type-face) 352 354 (fontified t) 354 361 (fontified t face font-lock-type-face) 361 376 (fontified t) 376 381 (fontified t face font-lock-preprocessor-face) 381 382 (fontified t) 382 409 (fontified t face font-lock-string-face) 409 429 (fontified t) 429 437 (fontified t) 437 438 (fontified t) 438 446 (fontified t) 446 449 (fontified t face font-lock-keyword-face) 449 450 (fontified t) 450 475 (fontified t face font-lock-variable-name-face) 475 478 (fontified t) 478 486 (fontified t face font-lock-type-face) 486 495 (fontified t) 495 537 (fontified t)) . 1821) (undo-tree-id3611 . -537) (undo-tree-id3612 . -4) (undo-tree-id3613 . -537) (undo-tree-id3614 . -429) (undo-tree-id3615 . -537) (undo-tree-id3616 . -4) (undo-tree-id3617 . -537) 2358) nil (23751 40320 665200 612000) 0 nil]) ((#("
" 0 1 (fontified t)) . 2250)) nil (23751 40320 665203 50000) 0 nil]) ((#("let timeline = timeline.to_string();" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 12 (fontified t face font-lock-variable-name-face) 12 36 (fontified t)) . 2259) (t 23751 40284 283364 969000)) nil (23751 40320 665204 937000) 0 nil]) ((#("stream::" 0 6 (fontified t face font-lock-constant-face) 6 8 (fontified t)) . 2336) (undo-tree-id3509 . -8) (undo-tree-id3510 . -8) (undo-tree-id3511 . -8) (undo-tree-id3512 . -7) (undo-tree-id3513 . -8) (undo-tree-id3514 . -6) (undo-tree-id3515 . -7) (undo-tree-id3516 . -5) (undo-tree-id3517 . -6) (undo-tree-id3518 . -4) (undo-tree-id3519 . -5) (undo-tree-id3520 . -3) (undo-tree-id3521 . -4) (undo-tree-id3522 . -2) (undo-tree-id3523 . -3) (undo-tree-id3524 . -1) (undo-tree-id3525 . -2) (undo-tree-id3526 . -1)) nil (23751 40284 174015 813000) 0 nil]) ((#("stream::" 0 6 (fontified t face font-lock-constant-face) 6 8 (fontified t)) . 1923) (undo-tree-id3527 . -8) (undo-tree-id3528 . -8) (undo-tree-id3529 . -6) (t 23751 40266 230203 509000)) nil (23751 40284 174029 610000) 0 nil]) ((1 . 2411) (#("use crate::stream;
use crate::receiver::Receiver;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::{thread, time};
use tokio::net::TcpStream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        )
        .as_bytes()
        .to_owned()
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new();
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 38 (fontified t face font-lock-constant-face) 38 40 (fontified t) 40 48 (fontified t face font-lock-type-face) 48 49 (fontified t) 49 50 (fontified t) 50 53 (fontified t face font-lock-keyword-face) 53 54 (fontified t) 54 59 (fontified t face font-lock-keyword-face) 59 61 (fontified t) 61 65 (fontified t face font-lock-constant-face) 65 67 (fontified t) 67 71 (fontified t face font-lock-type-face) 71 73 (fontified t) 73 76 (fontified t face font-lock-keyword-face) 76 77 (fontified t) 77 84 (fontified t face font-lock-constant-face) 84 87 (fontified t) 87 92 (fontified t face font-lock-type-face) 92 94 (fontified t) 94 100 (fontified t face font-lock-type-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-type-face) 106 109 (fontified t) 109 112 (fontified t face font-lock-keyword-face) 112 113 (fontified t) 113 116 (fontified t face font-lock-constant-face) 116 124 (fontified t) 124 127 (fontified t face font-lock-keyword-face) 127 128 (fontified t) 128 131 (fontified t face font-lock-constant-face) 131 133 (fontified t) 133 137 (fontified t face font-lock-constant-face) 137 139 (fontified t) 139 145 (fontified t face font-lock-constant-face) 145 148 (fontified t) 148 159 (fontified t face font-lock-type-face) 159 161 (fontified t) 161 169 (fontified t face font-lock-type-face) 169 172 (fontified t) 172 175 (fontified t face font-lock-keyword-face) 175 176 (fontified t) 176 179 (fontified t face font-lock-constant-face) 179 197 (fontified t) 197 200 (fontified t face font-lock-keyword-face) 200 201 (fontified t) 201 206 (fontified t face font-lock-constant-face) 206 208 (fontified t) 208 211 (fontified t face font-lock-constant-face) 211 213 (fontified t) 213 222 (fontified t face font-lock-type-face) 222 224 (fontified t) 224 225 (fontified t) 225 228 (fontified t face font-lock-keyword-face) 228 229 (fontified t) 229 235 (fontified t face font-lock-keyword-face) 235 236 (fontified t) 236 252 (fontified t face font-lock-variable-name-face) 252 254 (fontified t) 254 265 (fontified t face font-lock-type-face) 265 268 (fontified t) 268 279 (fontified t face font-lock-type-face) 279 289 (fontified t) 289 292 (fontified t face font-lock-keyword-face) 292 293 (fontified t) 293 299 (fontified t face font-lock-keyword-face) 299 300 (fontified t) 300 315 (fontified t face font-lock-variable-name-face) 315 317 (fontified t) 317 328 (fontified t face font-lock-type-face) 328 331 (fontified t) 331 342 (fontified t face font-lock-type-face) 342 355 (fontified t) 355 358 (fontified t face font-lock-keyword-face) 358 359 (fontified t) 359 365 (fontified t face font-lock-keyword-face) 365 366 (fontified t) 366 374 (fontified t face font-lock-type-face) 374 378 (fontified t) 378 382 (fontified t face font-lock-keyword-face) 382 383 (fontified t) 383 391 (fontified t face font-lock-type-face) 391 398 (fontified t) 398 401 (fontified t face font-lock-keyword-face) 401 402 (fontified t) 402 404 (fontified t face font-lock-keyword-face) 404 405 (fontified t) 405 409 (fontified t face font-lock-function-name-face) 409 410 (fontified t) 410 413 (fontified t face font-lock-variable-name-face) 413 415 (fontified t) 415 419 (fontified t face font-lock-keyword-face) 419 420 (fontified t) 420 423 (fontified t face font-lock-constant-face) 423 425 (fontified t) 425 428 (fontified t face font-lock-constant-face) 428 430 (fontified t) 430 437 (fontified t face font-lock-type-face) 437 439 (fontified t) 439 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 474 (fontified t) 474 475 (syntax-table #1# fontified t) 475 476 (fontified t) 476 479 (fontified t face font-lock-type-face) 479 480 (fontified t) 480 482 (fontified t face font-lock-type-face) 482 486 (fontified t) 486 494 (fontified t) 494 497 (fontified t face font-lock-keyword-face) 497 529 (fontified t) 529 536 (fontified t face rust-builtin-formatting-macro-face) 536 537 (fontified t) 537 547 (fontified t face font-lock-string-face) 547 549 (fontified t face rust-string-interpolation-face) 549 550 (fontified t face font-lock-string-face) 550 563 (fontified t) 563 564 (fontified t) 564 572 (fontified t) 572 573 (fontified t face rust-builtin-formatting-macro-face) 573 579 (fontified t face rust-builtin-formatting-macro-face) 579 581 (fontified t) 581 593 (fontified t) 593 601 (fontified t face font-lock-string-face) 601 613 (fontified t face rust-string-interpolation-face) 613 617 (fontified t face font-lock-string-face) 617 622 (fontified t face rust-string-interpolation-face) 622 627 (fontified t face font-lock-string-face) 627 639 (fontified t face rust-string-interpolation-face) 639 643 (fontified t face font-lock-string-face) 643 648 (fontified t face rust-string-interpolation-face) 648 653 (fontified t face font-lock-string-face) 653 697 (fontified t) 697 714 (fontified t) 714 828 (fontified t) 828 830 (fontified t) 830 831 (fontified t) 831 834 (fontified t face font-lock-keyword-face) 834 835 (fontified t) 835 840 (fontified t face font-lock-constant-face) 840 842 (fontified t) 842 845 (fontified t face font-lock-constant-face) 845 847 (fontified t) 847 850 (fontified t face font-lock-constant-face) 850 852 (fontified t) 852 865 (fontified t face font-lock-type-face) 865 867 (fontified t) 867 870 (fontified t face font-lock-keyword-face) 870 871 (fontified t) 871 877 (fontified t face font-lock-keyword-face) 877 878 (fontified t) 878 884 (fontified t face font-lock-type-face) 884 891 (fontified t) 891 898 (fontified t face font-lock-variable-name-face) 898 900 (fontified t) 900 913 (fontified t face font-lock-type-face) 913 919 (fontified t) 919 921 (fontified t face font-lock-variable-name-face) 921 923 (fontified t) 923 928 (fontified t face font-lock-constant-face) 928 930 (fontified t) 930 934 (fontified t face font-lock-constant-face) 934 936 (fontified t) 936 940 (fontified t face font-lock-constant-face) 940 942 (fontified t) 942 948 (fontified t face font-lock-type-face) 948 949 (fontified t) 949 958 (fontified t face font-lock-type-face) 958 963 (fontified t) 963 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 974 (fontified t face font-lock-type-face) 974 977 (fontified t) 977 981 (fontified t) 981 984 (fontified t face font-lock-keyword-face) 984 985 (fontified t) 985 987 (fontified t face font-lock-keyword-face) 987 988 (fontified t) 988 991 (fontified t face font-lock-function-name-face) 991 992 (fontified t) 992 999 (fontified t face font-lock-variable-name-face) 999 1001 (fontified t) 1001 1005 (fontified t face font-lock-keyword-face) 1005 1006 (fontified t) 1006 1009 (fontified t face font-lock-constant-face) 1009 1011 (fontified t) 1011 1014 (fontified t face font-lock-constant-face) 1014 1016 (fontified t) 1016 1023 (fontified t face font-lock-type-face) 1023 1025 (fontified t) 1025 1027 (fontified t face font-lock-variable-name-face) 1027 1029 (fontified t) 1029 1034 (fontified t face font-lock-constant-face) 1034 1036 (fontified t) 1036 1040 (fontified t face font-lock-constant-face) 1040 1042 (fontified t) 1042 1046 (fontified t face font-lock-constant-face) 1046 1048 (fontified t) 1048 1050 (fontified t face font-lock-type-face) 1050 1054 (fontified t face font-lock-type-face) 1054 1055 (fontified t) 1055 1064 (fontified t face font-lock-type-face) 1064 1068 (fontified t) 1068 1069 (syntax-table #1# fontified t) 1069 1070 (fontified t) 1070 1074 (face font-lock-type-face fontified t) 1074 1077 (fontified t) 1077 1081 (fontified t) 1081 1085 (fontified t) 1085 1088 (fontified t face font-lock-keyword-face) 1088 1089 (fontified t) 1089 1096 (fontified t face font-lock-variable-name-face) 1096 1107 (fontified t) 1107 1173 (fontified t) 1173 1198 (fontified t face font-lock-string-face) 1198 1209 (fontified t) 1209 1212 (fontified t face font-lock-keyword-face) 1212 1213 (fontified t) 1213 1214 (fontified t face font-lock-variable-name-face) 1214 1220 (fontified t face font-lock-variable-name-face) 1220 1223 (fontified t) 1223 1232 (fontified t face font-lock-type-face) 1232 1253 (fontified t) 1253 1261 (fontified t) 1261 1265 (fontified t face font-lock-type-face) 1265 1290 (fontified t) 1290 1294 (fontified t face font-lock-keyword-face) 1294 1295 (fontified t) 1295 1301 (fontified t face font-lock-type-face) 1301 1302 (fontified t) 1302 1305 (fontified t face font-lock-keyword-face) 1305 1306 (fontified t) 1306 1312 (fontified t face font-lock-type-face) 1312 1319 (fontified t) 1319 1323 (fontified t face font-lock-keyword-face) 1323 1324 (fontified t) 1324 1328 (fontified t face font-lock-type-face) 1328 1330 (fontified t) 1330 1335 (fontified t) 1335 1339 (fontified t) 1339 1343 (fontified t face font-lock-keyword-face) 1343 1344 (fontified t) 1344 1349 (fontified t face font-lock-type-face) 1349 1361 (fontified t) 1361 1363 (fontified t face font-lock-keyword-face) 1363 1364 (fontified t) 1364 1368 (fontified t face font-lock-function-name-face) 1368 1370 (fontified t) 1370 1373 (fontified t face font-lock-keyword-face) 1373 1374 (fontified t) 1374 1378 (fontified t face font-lock-keyword-face) 1378 1381 (fontified t) 1381 1382 (fontified t syntax-table #1#) 1382 1383 (fontified t) 1383 1387 (fontified t face font-lock-type-face) 1387 1388 (fontified t) 1388 1392 (fontified t face font-lock-type-face) 1392 1394 (fontified t) 1394 1398 (fontified t face font-lock-type-face) 1398 1400 (fontified t) 1400 1404 (fontified t face font-lock-type-face) 1404 1406 (fontified t) 1406 1411 (fontified t face font-lock-type-face) 1411 1423 (fontified t) 1423 1428 (fontified t face font-lock-keyword-face) 1428 1429 (fontified t) 1429 1433 (fontified t face font-lock-keyword-face) 1433 1463 (fontified t) 1463 1465 (fontified t face font-lock-type-face) 1465 1466 (fontified t) 1466 1471 (fontified t face font-lock-type-face) 1471 1473 (fontified t) 1473 1478 (fontified t face font-lock-type-face) 1478 1489 (fontified t) 1489 1490 (fontified t syntax-table #1#) 1490 1509 (fontified t) 1509 1513 (fontified t face font-lock-keyword-face) 1513 1549 (fontified t) 1549 1565 (fontified t face font-lock-string-face) 1565 1577 (fontified t) 1577 1584 (fontified t) 1584 1586 (face font-lock-type-face fontified t) 1586 1587 (fontified t) 1587 1592 (face font-lock-type-face fontified t) 1592 1594 (fontified t) 1594 1599 (face font-lock-type-face fontified t) 1599 1605 (fontified t) 1631 1633 (face font-lock-type-face) 1634 1639 (face font-lock-type-face) 1641 1649 (face font-lock-type-face) 1652 1653 (syntax-table #1#) 1654 1656 (face font-lock-type-face) 1657 1662 (face font-lock-type-face) 1664 1672 (face font-lock-type-face) 1687 1690 (face font-lock-type-face) 1695 1696 (syntax-table #1#) 1715 1720 (face font-lock-preprocessor-face) 1721 1744 (face font-lock-string-face) 1766 1768 (face font-lock-type-face) 1769 1774 (face font-lock-type-face) 1776 1781 (face font-lock-type-face) 1820 1823 (face font-lock-keyword-face) 1824 1830 (face font-lock-keyword-face) 1831 1835 (face font-lock-type-face) 1835 1837 (face font-lock-type-face) 1842 1846 (face font-lock-keyword-face) 1847 1853 (face font-lock-type-face) 1860 1863 (face font-lock-keyword-face) 1864 1866 (face font-lock-keyword-face) 1867 1871 (face font-lock-function-name-face) 1872 1880 (face font-lock-variable-name-face) 1882 1886 (face font-lock-keyword-face) 1887 1890 (face font-lock-constant-face) 1892 1895 (face font-lock-constant-face) 1897 1904 (face font-lock-type-face) 1906 1910 (face font-lock-variable-name-face) 1913 1917 (face font-lock-type-face) 1920 1921 (syntax-table #1#) 1922 1928 (face font-lock-constant-face) 1930 1938 (face font-lock-type-face) 1949 1954 (face font-lock-keyword-face) 1955 1971 (face font-lock-type-face) 1977 1985 (face font-lock-type-face) 1987 1994 (face font-lock-type-face) 1996 1997 (syntax-table #1#) 1998 2013 (face font-lock-type-face) 2019 2027 (face font-lock-type-face) 2029 2036 (face font-lock-type-face) 2052 2058 (face font-lock-constant-face) 2066 2070 (face font-lock-constant-face) 2072 2080 (face font-lock-type-face) 2120 2123 (face font-lock-keyword-face) 2124 2139 (face font-lock-variable-name-face) 2142 2158 (face font-lock-type-face) 2172 2180 (face font-lock-type-face) 2182 2189 (face font-lock-type-face) 2204 2209 (face font-lock-preprocessor-face) 2210 2237 (face font-lock-string-face) 2266 2269 (face font-lock-keyword-face) 2270 2278 (face font-lock-variable-name-face)) . 1) (undo-tree-id3459 . 2361) (undo-tree-id3460 . -828) (undo-tree-id3461 . 1582) (undo-tree-id3462 . -828) (undo-tree-id3463 . -828) (undo-tree-id3464 . -538) (undo-tree-id3465 . -538) (undo-tree-id3466 . -538) (undo-tree-id3467 . -538) (undo-tree-id3468 . -355) (undo-tree-id3469 . -355) (undo-tree-id3470 . -828) (undo-tree-id3471 . -355) (undo-tree-id3472 . -355) (undo-tree-id3473 . -48) (undo-tree-id3474 . -40) (undo-tree-id3475 . -39) (undo-tree-id3476 . -40) (undo-tree-id3477 . -40) (undo-tree-id3478 . -50) (undo-tree-id3479 . -53) (undo-tree-id3480 . -40) (undo-tree-id3481 . -40) (undo-tree-id3482 . -48) (undo-tree-id3483 . -40) (undo-tree-id3484 . -50) (undo-tree-id3485 . -53) (undo-tree-id3486 . -54) (undo-tree-id3487 . -59) (undo-tree-id3488 . -47) (undo-tree-id3489 . -48) (undo-tree-id3490 . -50) (undo-tree-id3491 . -53) (undo-tree-id3492 . -50) (undo-tree-id3493 . -53) (undo-tree-id3494 . -40) (undo-tree-id3495 . -48) (undo-tree-id3496 . -47) (undo-tree-id3497 . -48) (undo-tree-id3498 . -50) (undo-tree-id3499 . -53) (undo-tree-id3500 . -49) (undo-tree-id3501 . -48) (undo-tree-id3502 . -48) (undo-tree-id3503 . -48) 49) nil (23751 40266 123252 968000) 0 nil]) ((49 . 50) (41 . 49) (#("R" 0 1 (fontified t face font-lock-type-face)) . -41) (undo-tree-id3504 . -1) (undo-tree-id3505 . -1) (undo-tree-id3506 . -1) (undo-tree-id3507 . -1) 42 (39 . 42) (31 . 39) (#("re" 0 2 (fontified t)) . -31) (undo-tree-id3508 . -2) 33 (20 . 33) (20 . 21)) nil (23751 40266 123266 986000) 0 nil]) ((#("use std::sync::{Arc, Mutex};
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 7 (fontified t face font-lock-constant-face) 7 9 (fontified t) 9 13 (fontified t face font-lock-constant-face) 13 16 (fontified t) 16 19 (fontified t face font-lock-type-face) 19 21 (fontified t) 21 26 (fontified t face font-lock-type-face) 26 29 (fontified t)) . 142)) nil (23751 40266 123270 412000) 0 nil]) ((#("use tokio::io::{ReadHalf, WriteHalf};
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-constant-face) 9 11 (fontified t) 11 13 (fontified t face font-lock-constant-face) 13 16 (fontified t) 16 24 (fontified t face font-lock-type-face) 24 26 (fontified t) 26 35 (fontified t face font-lock-type-face) 35 38 (fontified t)) . 196)) nil (23751 40266 123271 990000) 0 nil]) ((#("use warp::Stream;
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 8 (fontified t face font-lock-constant-face) 8 10 (fontified t) 10 16 (fontified t face font-lock-type-face) 16 18 (fontified t)) . 261) (t 23751 39726 974178 286000)) nil (23751 40266 123274 48000) 0 nil]) ((#("    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
" 0 4 (fontified t) 4 7 (fontified t face font-lock-keyword-face) 7 8 (fontified t) 8 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 32 (fontified t face font-lock-function-name-face) 32 33 (fontified t) 33 41 (fontified t face font-lock-variable-name-face) 41 44 (fontified t) 44 47 (fontified t face font-lock-type-face) 47 50 (fontified t) 50 51 (syntax-table #1# fontified t) 51 52 (fontified t) 52 58 (fontified t face font-lock-type-face) 58 69 (fontified t) 69 72 (fontified t face font-lock-keyword-face) 72 73 (fontified t) 73 80 (fontified t face font-lock-variable-name-face) 80 83 (fontified t) 83 90 (fontified t face rust-builtin-formatting-macro-face) 90 91 (fontified t) 91 101 (fontified t face font-lock-string-face) 101 103 (fontified t face rust-string-interpolation-face) 103 104 (fontified t face font-lock-string-face) 104 125 (fontified t) 125 128 (fontified t face font-lock-keyword-face) 128 129 (fontified t) 129 138 (fontified t face font-lock-variable-name-face) 138 141 (fontified t) 141 149 (fontified t face font-lock-type-face) 149 155 (fontified t) 155 158 (fontified t face font-lock-string-face) 158 166 (face font-lock-string-face fontified t) 166 179 (fontified t) 179 187 (fontified t) 187 192 (fontified t face font-lock-preprocessor-face) 192 193 (fontified t) 193 212 (fontified t face font-lock-string-face) 212 235 (fontified t) 235 252 (fontified t) 252 262 (fontified t) 262 265 (fontified t face font-lock-keyword-face) 265 266 (fontified t) 266 268 (fontified t face font-lock-keyword-face) 268 269 (fontified t) 269 294 (fontified t face font-lock-function-name-face) 294 295 (fontified t) 295 303 (fontified t face font-lock-variable-name-face) 303 306 (fontified t) 306 309 (fontified t face font-lock-type-face) 309 312 (fontified t) 312 313 (syntax-table #1# fontified t) 313 314 (fontified t) 314 320 (fontified t face font-lock-type-face) 320 331 (fontified t) 331 334 (fontified t face font-lock-keyword-face) 334 335 (fontified t) 335 342 (fontified t face font-lock-variable-name-face) 342 345 (fontified t) 345 352 (fontified t face rust-builtin-formatting-macro-face) 352 353 (fontified t) 353 363 (fontified t face font-lock-string-face) 363 365 (fontified t face rust-string-interpolation-face) 365 366 (fontified t face font-lock-string-face) 366 387 (fontified t) 387 390 (fontified t face font-lock-keyword-face) 390 391 (fontified t) 391 402 (fontified t face font-lock-variable-name-face) 402 405 (fontified t) 405 413 (fontified t face font-lock-type-face) 413 419 (fontified t) 419 432 (fontified t face font-lock-string-face) 432 453 (fontified t) 453 458 (fontified t face font-lock-preprocessor-face) 458 459 (fontified t) 459 482 (fontified t face font-lock-string-face) 482 530 (fontified t)) . 883) (undo-tree-id3439 . -529) (undo-tree-id3440 . -52) (undo-tree-id3441 . -529) (undo-tree-id3442 . -415) (undo-tree-id3443 . -418) (undo-tree-id3444 . -405) (undo-tree-id3445 . -413) (undo-tree-id3446 . -151) (undo-tree-id3447 . -154) (undo-tree-id3448 . -141) (undo-tree-id3449 . -149) (undo-tree-id3450 . -52) (undo-tree-id3451 . -52) (undo-tree-id3452 . -52) (undo-tree-id3453 . -52) (undo-tree-id3454 . -52) (undo-tree-id3455 . -52) (undo-tree-id3456 . -529) (undo-tree-id3457 . -52) (undo-tree-id3458 . -529) 1412 (t 23751 39653 137845 521000)) nil (23751 39726 845777 214000) 0 nil]) ((1 . 2995) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::io::{ReadHalf, WriteHalf};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {}
impl RedisCmd {
    pub fn from(cmd: impl std::fmt::Display, timeline: impl std::fmt::Display) -> Vec<u8> {
        let (cmd, arg) = (cmd.to_string(), format!(\"timeline:{}\", timeline));
        format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        ).as_bytes().to_owned()
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new();
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 208 (fontified t face font-lock-constant-face) 208 211 (fontified t) 211 219 (fontified t face font-lock-type-face) 219 221 (fontified t) 221 230 (fontified t face font-lock-type-face) 230 233 (fontified t) 233 236 (fontified t face font-lock-keyword-face) 236 237 (fontified t) 237 242 (fontified t face font-lock-constant-face) 242 244 (fontified t) 244 247 (fontified t face font-lock-constant-face) 247 249 (fontified t) 249 258 (fontified t face font-lock-type-face) 258 260 (fontified t) 260 263 (fontified t face font-lock-keyword-face) 263 264 (fontified t) 264 268 (fontified t face font-lock-constant-face) 268 270 (fontified t) 270 276 (fontified t face font-lock-type-face) 276 279 (fontified t) 279 282 (fontified t face font-lock-keyword-face) 282 283 (fontified t) 283 289 (fontified t face font-lock-keyword-face) 289 290 (fontified t) 290 306 (fontified t face font-lock-variable-name-face) 306 308 (fontified t) 308 319 (fontified t face font-lock-type-face) 319 322 (fontified t) 322 333 (fontified t face font-lock-type-face) 333 343 (fontified t) 343 346 (fontified t face font-lock-keyword-face) 346 347 (fontified t) 347 353 (fontified t face font-lock-keyword-face) 353 354 (fontified t) 354 369 (fontified t face font-lock-variable-name-face) 369 371 (fontified t) 371 382 (fontified t face font-lock-type-face) 382 385 (fontified t) 385 396 (fontified t face font-lock-type-face) 396 409 (fontified t) 409 412 (fontified t face font-lock-keyword-face) 412 413 (fontified t) 413 419 (fontified t face font-lock-keyword-face) 419 420 (fontified t) 420 428 (fontified t face font-lock-type-face) 428 430 (fontified t) 430 432 (fontified t) 432 436 (fontified t face font-lock-keyword-face) 436 437 (fontified t) 437 445 (fontified t face font-lock-type-face) 445 448 (fontified t) 448 452 (fontified t) 452 455 (fontified t face font-lock-keyword-face) 455 456 (fontified t) 456 458 (fontified t face font-lock-keyword-face) 458 459 (fontified t) 459 463 (fontified t face font-lock-function-name-face) 463 464 (fontified t) 464 467 (fontified t face font-lock-variable-name-face) 467 469 (fontified t) 469 473 (fontified t face font-lock-keyword-face) 473 474 (fontified t) 474 477 (fontified t face font-lock-constant-face) 477 479 (fontified t) 479 482 (fontified t face font-lock-constant-face) 482 484 (fontified t) 484 491 (fontified t face font-lock-type-face) 491 493 (fontified t) 493 501 (fontified t face font-lock-variable-name-face) 501 503 (fontified t) 503 507 (fontified t face font-lock-keyword-face) 507 508 (fontified t) 508 511 (fontified t face font-lock-constant-face) 511 513 (fontified t) 513 516 (fontified t face font-lock-constant-face) 516 518 (fontified t) 518 525 (fontified t face font-lock-type-face) 525 528 (fontified t) 528 529 (fontified t syntax-table #1#) 529 530 (fontified t) 530 533 (fontified t face font-lock-type-face) 533 534 (fontified t) 534 536 (fontified t face font-lock-type-face) 536 537 (fontified t) 537 540 (fontified t) 540 548 (fontified t) 548 551 (fontified t face font-lock-keyword-face) 551 583 (fontified t) 583 590 (fontified t face rust-builtin-formatting-macro-face) 590 591 (fontified t) 591 601 (fontified t face font-lock-string-face) 601 603 (fontified t face rust-string-interpolation-face) 603 604 (fontified t face font-lock-string-face) 604 615 (fontified t) 615 618 (fontified t) 618 626 (fontified t) 626 633 (fontified t face rust-builtin-formatting-macro-face) 633 635 (fontified t) 635 647 (fontified t) 647 655 (fontified t face font-lock-string-face) 655 667 (fontified t face rust-string-interpolation-face) 667 671 (fontified t face font-lock-string-face) 671 676 (fontified t face rust-string-interpolation-face) 676 681 (fontified t face font-lock-string-face) 681 693 (fontified t face rust-string-interpolation-face) 693 697 (fontified t face font-lock-string-face) 697 702 (fontified t face rust-string-interpolation-face) 702 707 (fontified t face font-lock-string-face) 707 826 (fontified t) 826 836 (fontified t) 836 844 (fontified t) 844 855 (fontified t) 855 857 (fontified t) 857 858 (fontified t) 858 864 (fontified t) 864 868 (fontified t) 868 871 (fontified t face font-lock-keyword-face) 871 872 (fontified t) 872 874 (fontified t face font-lock-keyword-face) 874 875 (fontified t) 875 896 (fontified t face font-lock-function-name-face) 896 897 (fontified t) 897 905 (fontified t face font-lock-variable-name-face) 905 908 (fontified t) 908 911 (fontified t face font-lock-type-face) 911 914 (fontified t) 914 915 (syntax-table #1# fontified t) 915 916 (fontified t) 916 922 (fontified t face font-lock-type-face) 922 933 (fontified t) 933 936 (fontified t face font-lock-keyword-face) 936 937 (fontified t) 937 938 (fontified t face font-lock-variable-name-face) 938 944 (fontified t face font-lock-variable-name-face) 944 947 (fontified t) 947 954 (fontified t face rust-builtin-formatting-macro-face) 954 955 (fontified t) 955 965 (fontified t face font-lock-string-face) 965 967 (fontified t face rust-string-interpolation-face) 967 968 (fontified t face font-lock-string-face) 968 981 (fontified t) 981 989 (fontified t) 989 992 (fontified t face font-lock-keyword-face) 992 993 (fontified t) 993 1002 (fontified t face font-lock-variable-name-face) 1002 1005 (fontified t) 1005 1013 (fontified t face font-lock-type-face) 1013 1019 (fontified t) 1019 1030 (fontified t face font-lock-string-face) 1030 1037 (fontified t) 1037 1040 (fontified t) 1040 1043 (fontified t) 1043 1051 (fontified t) 1051 1053 (fontified t face font-lock-preprocessor-face) 1053 1056 (fontified t face font-lock-preprocessor-face) 1056 1057 (fontified t) 1057 1076 (fontified t face font-lock-string-face) 1076 1078 (fontified t) 1078 1089 (fontified t) 1089 1116 (fontified t) 1116 1118 (fontified t) 1118 1121 (fontified t) 1121 1122 (fontified t) 1122 1126 (fontified t) 1126 1129 (fontified t face font-lock-keyword-face) 1129 1130 (fontified t) 1130 1132 (fontified t face font-lock-keyword-face) 1132 1133 (fontified t) 1133 1157 (fontified t face font-lock-function-name-face) 1157 1158 (fontified t face font-lock-function-name-face) 1158 1159 (fontified t) 1159 1167 (fontified t face font-lock-variable-name-face) 1167 1170 (fontified t) 1170 1173 (fontified t face font-lock-type-face) 1173 1176 (fontified t) 1176 1177 (fontified t syntax-table #1#) 1177 1178 (fontified t) 1178 1184 (fontified t face font-lock-type-face) 1184 1187 (fontified t) 1187 1195 (fontified t) 1195 1198 (fontified t face font-lock-keyword-face) 1198 1199 (fontified t) 1199 1206 (fontified t face font-lock-variable-name-face) 1206 1209 (fontified t) 1209 1216 (fontified t face rust-builtin-formatting-macro-face) 1216 1217 (fontified t) 1217 1227 (fontified t face font-lock-string-face) 1227 1229 (fontified t face rust-string-interpolation-face) 1229 1230 (fontified t face font-lock-string-face) 1230 1251 (fontified t) 1251 1254 (fontified t face font-lock-keyword-face) 1254 1255 (fontified t) 1255 1266 (fontified t face font-lock-variable-name-face) 1266 1269 (fontified t) 1269 1277 (fontified t face font-lock-type-face) 1277 1283 (fontified t) 1283 1296 (fontified t face font-lock-string-face) 1296 1317 (fontified t) 1317 1322 (fontified t face font-lock-preprocessor-face) 1322 1323 (fontified t) 1323 1346 (fontified t face font-lock-string-face) 1346 1358 (fontified t) 1358 1359 (fontified t) 1359 1364 (fontified t) 1364 1388 (fontified t) 1388 1397 (fontified t) 1397 1400 (fontified t face font-lock-keyword-face) 1400 1401 (fontified t) 1401 1406 (fontified t face font-lock-constant-face) 1406 1408 (fontified t) 1408 1411 (fontified t face font-lock-constant-face) 1411 1413 (fontified t) 1413 1416 (fontified t face font-lock-constant-face) 1416 1418 (fontified t) 1418 1431 (fontified t face font-lock-type-face) 1431 1433 (fontified t) 1433 1436 (fontified t face font-lock-keyword-face) 1436 1437 (fontified t) 1437 1443 (fontified t face font-lock-keyword-face) 1443 1444 (fontified t) 1444 1450 (fontified t face font-lock-type-face) 1450 1457 (fontified t) 1457 1464 (fontified t face font-lock-variable-name-face) 1464 1466 (fontified t) 1466 1479 (fontified t face font-lock-type-face) 1479 1481 (fontified t) 1481 1485 (fontified t) 1485 1487 (fontified t face font-lock-variable-name-face) 1487 1489 (fontified t) 1489 1494 (fontified t face font-lock-constant-face) 1494 1496 (fontified t) 1496 1500 (fontified t face font-lock-constant-face) 1500 1502 (fontified t) 1502 1506 (fontified t face font-lock-constant-face) 1506 1508 (fontified t) 1508 1514 (fontified t face font-lock-type-face) 1514 1515 (fontified t) 1515 1524 (fontified t face font-lock-type-face) 1524 1529 (fontified t) 1529 1533 (fontified t face font-lock-keyword-face) 1533 1534 (fontified t) 1534 1540 (fontified t face font-lock-type-face) 1540 1543 (fontified t) 1543 1547 (fontified t) 1547 1550 (fontified t face font-lock-keyword-face) 1550 1551 (fontified t) 1551 1553 (fontified t face font-lock-keyword-face) 1553 1554 (fontified t) 1554 1557 (fontified t face font-lock-function-name-face) 1557 1558 (fontified t) 1558 1565 (fontified t face font-lock-variable-name-face) 1565 1567 (fontified t) 1567 1571 (fontified t face font-lock-keyword-face) 1571 1572 (fontified t) 1572 1575 (fontified t face font-lock-constant-face) 1575 1577 (fontified t) 1577 1580 (fontified t face font-lock-constant-face) 1580 1582 (fontified t) 1582 1589 (fontified t face font-lock-type-face) 1589 1591 (fontified t) 1591 1593 (fontified t face font-lock-variable-name-face) 1593 1595 (fontified t) 1595 1600 (fontified t face font-lock-constant-face) 1600 1602 (fontified t) 1602 1606 (fontified t face font-lock-constant-face) 1606 1608 (fontified t) 1608 1612 (fontified t face font-lock-constant-face) 1612 1614 (fontified t) 1614 1616 (fontified t face font-lock-type-face) 1616 1620 (fontified t face font-lock-type-face) 1620 1621 (fontified t) 1621 1622 (fontified t face font-lock-type-face) 1622 1630 (fontified t face font-lock-type-face) 1630 1634 (fontified t) 1634 1635 (fontified t syntax-table #1#) 1635 1636 (fontified t) 1636 1640 (fontified t face font-lock-type-face) 1640 1643 (fontified t) 1643 1651 (fontified t) 1651 1654 (fontified t face font-lock-keyword-face) 1654 1655 (fontified t) 1655 1662 (fontified t face font-lock-variable-name-face) 1662 1687 (fontified t) 1687 1698 (fontified t) 1698 1739 (fontified t) 1739 1764 (fontified t face font-lock-string-face) 1764 1775 (fontified t) 1775 1778 (fontified t face font-lock-keyword-face) 1778 1779 (fontified t) 1779 1786 (fontified t face font-lock-variable-name-face) 1786 1789 (fontified t) 1789 1798 (fontified t face font-lock-type-face) 1798 1827 (fontified t) 1827 1831 (fontified t face font-lock-type-face) 1831 1854 (fontified t) 1854 1856 (fontified t) 1856 1859 (fontified t face font-lock-keyword-face) 1859 1860 (fontified t face font-lock-keyword-face) 1860 1861 (fontified t) 1861 1867 (fontified t face font-lock-type-face) 1867 1868 (fontified t) 1868 1871 (fontified t face font-lock-keyword-face) 1871 1872 (fontified t) 1872 1878 (fontified t face font-lock-type-face) 1878 1881 (fontified t) 1881 1885 (fontified t) 1885 1888 (fontified t face font-lock-keyword-face) 1888 1889 (fontified t face font-lock-keyword-face) 1889 1890 (fontified t) 1890 1894 (fontified t face font-lock-type-face) 1894 1901 (fontified t) 1901 1905 (fontified t) 1905 1909 (fontified t face font-lock-keyword-face) 1909 1910 (fontified t) 1910 1915 (fontified t face font-lock-type-face) 1915 1927 (fontified t) 1927 1929 (fontified t face font-lock-keyword-face) 1929 1930 (fontified t) 1930 1934 (fontified t face font-lock-function-name-face) 1934 1936 (fontified t) 1936 1939 (fontified t face font-lock-keyword-face) 1939 1940 (fontified t) 1940 1944 (fontified t face font-lock-keyword-face) 1944 1947 (fontified t) 1947 1948 (fontified t syntax-table #1#) 1948 1949 (fontified t) 1949 1953 (fontified t face font-lock-type-face) 1953 1954 (fontified t) 1954 1958 (fontified t face font-lock-type-face) 1958 1960 (fontified t) 1960 1964 (fontified t face font-lock-type-face) 1964 1966 (fontified t) 1966 1970 (fontified t face font-lock-type-face) 1970 1972 (fontified t) 1972 1977 (fontified t face font-lock-type-face) 1977 1981 (fontified t) 1981 1989 (fontified t) 1989 1994 (fontified t face font-lock-keyword-face) 1994 1995 (fontified t) 1995 1999 (fontified t face font-lock-keyword-face) 1999 2029 (fontified t) 2029 2031 (fontified t face font-lock-type-face) 2031 2032 (fontified t) 2032 2037 (fontified t face font-lock-type-face) 2037 2039 (fontified t) 2039 2043 (fontified t face font-lock-type-face) 2043 2044 (face font-lock-type-face fontified t) 2044 2055 (fontified t) 2055 2056 (syntax-table #1# fontified t) 2056 2059 (fontified t) 2075 2079 (face font-lock-keyword-face) 2115 2131 (face font-lock-string-face) 2150 2152 (face font-lock-type-face) 2153 2158 (face font-lock-type-face) 2160 2165 (face font-lock-type-face) 2197 2198 (face font-lock-type-face) 2198 2199 (face font-lock-type-face) 2200 2205 (face font-lock-type-face) 2207 2215 (face font-lock-type-face) 2218 2219 (syntax-table #1#) 2220 2222 (face font-lock-type-face) 2223 2228 (face font-lock-type-face) 2230 2238 (face font-lock-type-face) 2253 2256 (face font-lock-type-face) 2261 2262 (syntax-table #1#) 2281 2286 (face font-lock-preprocessor-face) 2287 2310 (face font-lock-string-face) 2332 2334 (face font-lock-type-face) 2335 2340 (face font-lock-type-face) 2342 2347 (face font-lock-type-face) 2386 2389 (face font-lock-keyword-face) 2390 2396 (face font-lock-keyword-face) 2397 2403 (face font-lock-type-face) 2408 2412 (face font-lock-keyword-face) 2413 2419 (face font-lock-type-face) 2426 2429 (face font-lock-keyword-face) 2430 2432 (face font-lock-keyword-face) 2433 2437 (face font-lock-function-name-face) 2438 2446 (face font-lock-variable-name-face) 2448 2452 (face font-lock-keyword-face) 2453 2456 (face font-lock-constant-face) 2458 2461 (face font-lock-constant-face) 2463 2470 (face font-lock-type-face) 2472 2476 (face font-lock-variable-name-face) 2479 2483 (face font-lock-type-face) 2486 2487 (syntax-table #1#) 2488 2494 (face font-lock-constant-face) 2496 2504 (face font-lock-type-face) 2515 2520 (face font-lock-keyword-face) 2521 2537 (face font-lock-type-face) 2543 2551 (face font-lock-type-face) 2553 2560 (face font-lock-type-face) 2562 2563 (syntax-table #1#) 2564 2579 (face font-lock-type-face) 2585 2593 (face font-lock-type-face) 2595 2602 (face font-lock-type-face) 2618 2624 (face font-lock-constant-face) 2632 2636 (face font-lock-constant-face) 2638 2646 (face font-lock-type-face) 2686 2689 (face font-lock-keyword-face) 2690 2705 (face font-lock-variable-name-face) 2708 2724 (face font-lock-type-face) 2738 2741 (face font-lock-type-face) 2741 2746 (face font-lock-type-face) 2748 2755 (face font-lock-type-face) 2770 2775 (face font-lock-preprocessor-face) 2776 2803 (face font-lock-string-face) 2832 2835 (face font-lock-keyword-face) 2836 2844 (face font-lock-variable-name-face) 2877 2880 (face font-lock-keyword-face) 2881 2906 (face font-lock-variable-name-face) 2909 2915 (face font-lock-constant-face) 2917 2925 (face font-lock-type-face)) . 1) (undo-tree-id3294 . -615) (undo-tree-id3295 . 2475) (undo-tree-id3296 . -583) (undo-tree-id3297 . -615) (undo-tree-id3298 . -925) (undo-tree-id3299 . 1860) (undo-tree-id3300 . -933) (undo-tree-id3301 . -1097) (undo-tree-id3302 . -583) (undo-tree-id3303 . -2614) (undo-tree-id3304 . -2515) (undo-tree-id3305 . -1856) (undo-tree-id3306 . -2614) (undo-tree-id3307 . -2515) (undo-tree-id3308 . -2614) (undo-tree-id3309 . -1856) (undo-tree-id3310 . -2515) (undo-tree-id3311 . -430) (undo-tree-id3312 . -430) (undo-tree-id3313 . -430) (undo-tree-id3314 . -278) (undo-tree-id3315 . -430) (undo-tree-id3316 . -430) (undo-tree-id3317 . -278) (undo-tree-id3318 . -430) (undo-tree-id3319 . -430) (undo-tree-id3320 . -430) (undo-tree-id3321 . -745) (undo-tree-id3322 . -709) (undo-tree-id3323 . -430) (undo-tree-id3324 . -745) (undo-tree-id3325 . -745) (undo-tree-id3326 . -745) (undo-tree-id3327 . -925) (undo-tree-id3328 . -1089) (undo-tree-id3329 . -1089) (undo-tree-id3330 . -925) (undo-tree-id3331 . -864) (undo-tree-id3332 . -864) (undo-tree-id3333 . -864) (undo-tree-id3334 . -864) (undo-tree-id3335 . -864) (undo-tree-id3336 . -864) (undo-tree-id3337 . -1554) (undo-tree-id3338 . -864) (undo-tree-id3339 . -618) (undo-tree-id3340 . -864) (undo-tree-id3341 . -1554) (undo-tree-id3342 . -1554) (undo-tree-id3343 . -933) (undo-tree-id3344 . -1097) (undo-tree-id3345 . -1097) (undo-tree-id3346 . -933) (undo-tree-id3347 . -933) (undo-tree-id3348 . -468) (undo-tree-id3349 . -467) (undo-tree-id3350 . -933) (undo-tree-id3351 . -468) (undo-tree-id3352 . -468) (undo-tree-id3353 . -468) (undo-tree-id3354 . -468) (undo-tree-id3355 . -468) (undo-tree-id3356 . -468) (undo-tree-id3357 . -468) (undo-tree-id3358 . -468) (undo-tree-id3359 . -468) (undo-tree-id3360 . -468) (undo-tree-id3361 . -707) (undo-tree-id3362 . -743) (undo-tree-id3363 . -468) (undo-tree-id3364 . -707) (undo-tree-id3365 . -707) (undo-tree-id3366 . -583) (undo-tree-id3367 . -582) (undo-tree-id3368 . -707) (undo-tree-id3369 . -583) (undo-tree-id3370 . -583) (undo-tree-id3371 . -583) (undo-tree-id3372 . -583) (undo-tree-id3373 . -583) (undo-tree-id3374 . -615) (undo-tree-id3375 . -493) (undo-tree-id3376 . -493) (undo-tree-id3377 . -493) (undo-tree-id3378 . -493) (undo-tree-id3379 . -493) (undo-tree-id3380 . -493) (undo-tree-id3381 . -592) (undo-tree-id3382 . -592) (undo-tree-id3383 . -500) (undo-tree-id3384 . -1279) (undo-tree-id3385 . -1282) (undo-tree-id3386 . -1269) (undo-tree-id3387 . -1277) (undo-tree-id3388 . -409) (undo-tree-id3389 . -412) (undo-tree-id3390 . -1015) (undo-tree-id3391 . -1018) (undo-tree-id3392 . -1005) (undo-tree-id3393 . -1013) (undo-tree-id3394 . -409) (undo-tree-id3395 . -412) (undo-tree-id3396 . -221) (undo-tree-id3397 . -230) (undo-tree-id3398 . -211) (undo-tree-id3399 . -219) (undo-tree-id3400 . -162) (undo-tree-id3401 . -167) (undo-tree-id3402 . -157) (undo-tree-id3403 . -160) (undo-tree-id3404 . -157) (undo-tree-id3405 . -160) (undo-tree-id3406 . -162) (undo-tree-id3407 . -167) (undo-tree-id3408 . -211) (undo-tree-id3409 . -219) (undo-tree-id3410 . -221) (undo-tree-id3411 . -230) (undo-tree-id3412 . -409) (undo-tree-id3413 . -428) (undo-tree-id3414 . -1005) (undo-tree-id3415 . -1018) (undo-tree-id3416 . -1015) (undo-tree-id3417 . -1018) (undo-tree-id3418 . -409) (undo-tree-id3419 . -428) (undo-tree-id3420 . -1269) (undo-tree-id3421 . -1282) (undo-tree-id3422 . -1279) (undo-tree-id3423 . -1282) (undo-tree-id3424 . -591) (undo-tree-id3425 . -592) (undo-tree-id3426 . 2385) (undo-tree-id3427 . -592) (undo-tree-id3428 . 2384) (undo-tree-id3429 . -603) (undo-tree-id3430 . 2373) (undo-tree-id3431 . -604) 593) nil (23751 39653 19568 811000) 0 nil]) ((499 . 502) (494 . 499) (#("arg" 0 3 (fontified t face font-lock-variable-name-face)) . 494) (undo-tree-id3432 . -2) (undo-tree-id3433 . -2) (undo-tree-id3434 . -2) 496) nil (23751 39653 19590 7000) 0 nil]) ((#(";arg.to_string()" 0 1 (fontified t rear-nonsticky t) 1 16 (fontified t)) . 611) (undo-tree-id3435 . 15)) nil (23751 39653 19594 407000) 0 nil]) ((nil rear-nonsticky nil 611 . 612) (nil fontified nil 579 . 612) (579 . 612) 578) nil (23751 39653 19597 526000) 0 nil]) ((#("p" 0 1 (fontified t)) . -579) (undo-tree-id3436 . -1) 580 (579 . 580)) nil (23751 39653 19601 399000) 0 nil]) ((530 . 532) (#("8" 0 1 (fontified t)) . -530) (undo-tree-id3437 . -1) (undo-tree-id3438 . -1) 531 (530 . 531) (529 . 531) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -529) (526 . 530) (#("[u8]" 0 1 (fontified t) 1 3 (fontified t face font-lock-type-face) 3 4 (fontified t)) . 526)) nil (23751 39653 19609 294000) 0 nil] [nil nil ((#("[u8]" 0 1 (fontified t) 1 3 (fontified t face font-lock-type-face) 3 4 (fontified t)) . 526) (undo-tree-id3282 . -1) (undo-tree-id3283 . -1) (undo-tree-id3284 . -4) (undo-tree-id3285 . -4) (undo-tree-id3286 . 4) (undo-tree-id3287 . -1) (undo-tree-id3288 . 3) (undo-tree-id3289 . -3) (undo-tree-id3290 . 1) (undo-tree-id3291 . -4) (undo-tree-id3292 . -1)) ((526 . 530)) (23751 39534 851196 247000) 0 nil]) ((#(")" 0 1 (fontified nil)) . 833) (832 . 833) (831 . 833) (#("(" 0 1 (fontified nil)) . -831) (822 . 832)) nil (23751 39534 853309 209000) 0 nil]) ((#(")" 0 1 (fontified nil)) . 822) (821 . 822) (820 . 822) (#("(" 0 1 (fontified nil)) . -820) (811 . 821)) nil (23751 39534 851206 290000) 0 nil]) ((#("        Self { resp_cmd }
" 0 8 (fontified t) 8 12 (fontified t face font-lock-type-face) 12 26 (fontified t)) . 812) (undo-tree-id3293 . -24) 836) nil (23751 39534 851210 179000) 0 nil]) ((527 . 529) (526 . 528) (#("[" 0 1 (fontified nil)) . 526) (526 . 527) (#("String" 0 6 (fontified t face font-lock-type-face)) . 526)) ((526 . 532) (#("[" 0 1 (fontified nil)) . 526) (526 . 527) (#("[]" 0 1 (fontified nil) 1 2 (fontified nil)) . 526) (undo-tree-id3277 . 1) (undo-tree-id3278 . -1) (undo-tree-id3279 . -1) (undo-tree-id3280 . -2) (undo-tree-id3281 . -2) (#("u8" 0 2 (fontified t face font-lock-type-face)) . 527)) (23751 39476 699675 330000) 0 nil] [nil nil ((#("        Self { resp_cmd }
" 0 8 (fontified t) 8 12 (fontified t face font-lock-type-face) 12 26 (fontified t)) . 814) (undo-tree-id3236 . -8) (undo-tree-id3238 . -23) (undo-tree-id3240 . -25) (undo-tree-id3242 . -12) (undo-tree-id3244 . -23) (undo-tree-id3246 . -23) (undo-tree-id3248 . -23) (undo-tree-id3250 . -23) (undo-tree-id3252 . -25) 822) ((814 . 840) (t 23751 39275 729493 260000)) (23751 39275 613842 918000) 0 nil]) ((#("j" 0 1 (fontified t)) . -813) (undo-tree-id3254 . -1) (undo-tree-id3255 . -1) 814 (813 . 814)) nil (23751 39475 661285 576000) 0 nil]) ((#(";" 0 1 (fontified t)) . 813)) nil (23751 39275 613855 913000) 0 nil]) ((#("let resp_cmd = " 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 12 (fontified t face font-lock-variable-name-face) 12 15 (fontified t)) . 604)) nil (23751 39275 613857 605000) 0 nil]) ((526 . 532) (#("Self" 0 4 (fontified t face font-lock-type-face)) . 526)) nil (23751 39275 613859 838000) 0 nil]) ((460 . 464) (#("new" 0 3 (fontified t face font-lock-function-name-face)) . 460) (undo-tree-id3256 . -1) 461) nil (23751 39275 613863 566000) 0 nil]) ((#("
" 0 1 (fontified t)) . -431) (undo-tree-id3257 . -1) (undo-tree-id3258 . -1) (undo-tree-id3259 . -1) (undo-tree-id3260 . -1) (undo-tree-id3261 . -1) (undo-tree-id3262 . -1) (undo-tree-id3263 . -1) (undo-tree-id3264 . -1) (undo-tree-id3265 . -1) 410) nil (23751 39275 613876 273000) 0 nil]) ((#("    pub resp_cmd: String,
" 0 4 (fontified t) 4 7 (fontified t face font-lock-keyword-face) 7 8 (fontified t) 8 16 (fontified t face font-lock-variable-name-face) 16 18 (fontified t) 18 24 (fontified t face font-lock-type-face) 24 26 (fontified t)) . 432) (undo-tree-id3266 . 18) (undo-tree-id3267 . -26) (undo-tree-id3268 . -26) (undo-tree-id3269 . -26) (undo-tree-id3270 . -26) (undo-tree-id3271 . -26) (undo-tree-id3272 . -26) (undo-tree-id3273 . -26) (undo-tree-id3274 . -26) (undo-tree-id3275 . -26) (undo-tree-id3276 . -4) 436 (t 23751 39195 703158 84000)) nil (23751 39275 613891 394000) 0 nil] [nil nil ((#("    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
" 0 4 (fontified t) 4 7 (fontified t face font-lock-keyword-face) 7 8 (fontified t) 8 10 (fontified t face font-lock-keyword-face) 10 11 (fontified t) 11 32 (fontified t face font-lock-function-name-face) 32 33 (fontified t) 33 41 (fontified t face font-lock-variable-name-face) 41 44 (fontified t) 44 47 (fontified t face font-lock-type-face) 47 50 (fontified t) 50 51 (syntax-table #1# fontified t) 51 52 (fontified t) 52 58 (fontified t face font-lock-type-face) 58 69 (fontified t) 69 72 (fontified t face font-lock-keyword-face) 72 73 (fontified t) 73 80 (face font-lock-variable-name-face fontified t) 80 83 (fontified t) 83 90 (face rust-builtin-formatting-macro-face fontified t) 90 91 (fontified t) 91 101 (face font-lock-string-face fontified t) 101 103 (face rust-string-interpolation-face fontified t) 103 104 (face font-lock-string-face fontified t) 104 117 (fontified t) 117 125 (fontified t) 125 128 (fontified t face font-lock-keyword-face) 128 129 (fontified t) 129 138 (fontified t face font-lock-variable-name-face) 138 141 (fontified t) 141 149 (fontified t face font-lock-type-face) 149 155 (fontified t) 155 166 (fontified t face font-lock-string-face) 166 173 (fontified t) 173 179 (fontified t) 179 187 (fontified t) 187 192 (fontified t face font-lock-preprocessor-face) 192 193 (fontified t) 193 212 (fontified t face font-lock-string-face) 212 258 (fontified t)) . 886) (undo-tree-id3169 . -257) (undo-tree-id3170 . -7) (undo-tree-id3171 . -257) (undo-tree-id3172 . -61) (undo-tree-id3173 . -61) (undo-tree-id3174 . -225) (undo-tree-id3175 . -225) (undo-tree-id3176 . -61) (undo-tree-id3177 . -61) (undo-tree-id3178 . -257) (undo-tree-id3180 . -92) (undo-tree-id3182 . -258) (undo-tree-id3184 . -7) (undo-tree-id3185 . -7) (undo-tree-id3186 . -257) (undo-tree-id3188 . -7) (undo-tree-id3190 . -68) (undo-tree-id3192 . -124) (undo-tree-id3194 . -186) (undo-tree-id3196 . -232) (undo-tree-id3198 . -257) (undo-tree-id3200 . -257) (undo-tree-id3202 . -257) (undo-tree-id3204 . -257) (undo-tree-id3206 . -212) (undo-tree-id3208 . -212) (undo-tree-id3210 . -257) (undo-tree-id3212 . -257) (undo-tree-id3214 . -211) (undo-tree-id3216 . -210) (undo-tree-id3218 . -103) (undo-tree-id3220 . -102) (undo-tree-id3222 . -60) (undo-tree-id3224 . -60) (undo-tree-id3226 . -256) (undo-tree-id3228 . -257) (undo-tree-id3230 . -92) (undo-tree-id3232 . -51) (undo-tree-id3234 . -92) 1143) ((886 . 1144) (t 23751 37087 970771 623000)) (23751 37087 859826 412000) 0 nil]) ((439 . 440) (#("b" 0 1 (fontified t face font-lock-variable-name-face)) . -439) (undo-tree-id3235 . -1) 440 (436 . 440)) nil (23751 39192 753247 561000) 0 nil]) ((476 . 480) (t 23751 33523 574116 91000)) nil (23751 37087 859838 816000) 0 nil]) ((#("timeline, user" 0 14 (fontified t)) . 2945) (t 23751 31527 204173 794000)) nil (23751 33523 462375 111000) 0 nil]) ((1 . 3004) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::io::{ReadHalf, WriteHalf};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(
        timeline: impl std::fmt::Display,
        user: &User,
    ) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 208 (fontified t face font-lock-constant-face) 208 211 (fontified t) 211 219 (fontified t face font-lock-type-face) 219 221 (fontified t) 221 230 (fontified t face font-lock-type-face) 230 233 (fontified t) 233 236 (fontified t face font-lock-keyword-face) 236 237 (fontified t) 237 242 (fontified t face font-lock-constant-face) 242 244 (fontified t) 244 247 (fontified t face font-lock-constant-face) 247 249 (fontified t) 249 258 (fontified t face font-lock-type-face) 258 260 (fontified t) 260 263 (fontified t face font-lock-keyword-face) 263 264 (fontified t) 264 268 (fontified t face font-lock-constant-face) 268 270 (fontified t) 270 276 (fontified t face font-lock-type-face) 276 279 (fontified t) 279 282 (fontified t face font-lock-keyword-face) 282 283 (fontified t) 283 289 (fontified t face font-lock-keyword-face) 289 290 (fontified t) 290 306 (fontified t face font-lock-variable-name-face) 306 308 (fontified t) 308 319 (fontified t face font-lock-type-face) 319 322 (fontified t) 322 333 (fontified t face font-lock-type-face) 333 343 (fontified t) 343 346 (fontified t face font-lock-keyword-face) 346 347 (fontified t) 347 353 (fontified t face font-lock-keyword-face) 353 354 (fontified t) 354 369 (fontified t face font-lock-variable-name-face) 369 371 (fontified t) 371 382 (fontified t face font-lock-type-face) 382 385 (fontified t) 385 396 (fontified t face font-lock-type-face) 396 409 (fontified t) 409 412 (fontified t face font-lock-keyword-face) 412 413 (fontified t) 413 419 (fontified t face font-lock-keyword-face) 419 420 (fontified t) 420 428 (fontified t face font-lock-type-face) 428 435 (fontified t) 435 443 (fontified t face font-lock-variable-name-face) 443 445 (fontified t) 445 451 (fontified t face font-lock-type-face) 451 455 (fontified t) 455 459 (fontified t face font-lock-keyword-face) 459 460 (fontified t) 460 468 (fontified t face font-lock-type-face) 468 475 (fontified t) 475 477 (fontified t face font-lock-keyword-face) 477 478 (fontified t) 478 481 (fontified t face font-lock-function-name-face) 481 482 (fontified t) 482 485 (fontified t face font-lock-variable-name-face) 485 487 (fontified t) 487 491 (fontified t face font-lock-keyword-face) 491 492 (fontified t) 492 495 (fontified t face font-lock-constant-face) 495 497 (fontified t) 497 500 (fontified t face font-lock-constant-face) 500 502 (fontified t) 502 509 (fontified t face font-lock-type-face) 509 511 (fontified t) 511 514 (fontified t face font-lock-variable-name-face) 514 516 (fontified t) 516 520 (fontified t face font-lock-keyword-face) 520 521 (fontified t) 521 524 (fontified t face font-lock-constant-face) 524 526 (fontified t) 526 529 (fontified t face font-lock-constant-face) 529 531 (fontified t) 531 538 (fontified t face font-lock-type-face) 538 541 (fontified t) 541 542 (fontified t syntax-table #1#) 542 543 (fontified t) 543 547 (fontified t face font-lock-type-face) 547 550 (fontified t) 550 558 (fontified t) 558 561 (fontified t face font-lock-keyword-face) 561 619 (fontified t) 619 622 (fontified t face font-lock-keyword-face) 622 623 (fontified t) 623 631 (fontified t face font-lock-variable-name-face) 631 634 (fontified t) 634 641 (fontified t face rust-builtin-formatting-macro-face) 641 655 (fontified t) 655 663 (fontified t face font-lock-string-face) 663 675 (fontified t face rust-string-interpolation-face) 675 679 (fontified t face font-lock-string-face) 679 684 (fontified t face rust-string-interpolation-face) 684 689 (fontified t face font-lock-string-face) 689 701 (fontified t face rust-string-interpolation-face) 701 705 (fontified t face font-lock-string-face) 705 710 (fontified t face rust-string-interpolation-face) 710 715 (fontified t face font-lock-string-face) 715 853 (fontified t) 853 857 (fontified t face font-lock-type-face) 857 881 (fontified t) 881 884 (fontified t face font-lock-keyword-face) 884 885 (fontified t) 885 887 (fontified t face font-lock-keyword-face) 887 888 (fontified t) 888 909 (fontified t face font-lock-function-name-face) 909 910 (fontified t) 910 918 (fontified t face font-lock-variable-name-face) 918 921 (fontified t) 921 924 (fontified t face font-lock-type-face) 924 927 (fontified t) 927 928 (fontified t syntax-table #1#) 928 929 (fontified t) 929 935 (fontified t face font-lock-type-face) 935 946 (fontified t) 946 949 (fontified t face font-lock-keyword-face) 949 950 (fontified t) 950 957 (fontified t face font-lock-variable-name-face) 957 960 (fontified t) 960 967 (fontified t face rust-builtin-formatting-macro-face) 967 968 (fontified t) 968 978 (fontified t face font-lock-string-face) 978 980 (fontified t face rust-string-interpolation-face) 980 981 (fontified t face font-lock-string-face) 981 1002 (fontified t) 1002 1005 (fontified t face font-lock-keyword-face) 1005 1006 (fontified t) 1006 1015 (fontified t face font-lock-variable-name-face) 1015 1018 (fontified t) 1018 1026 (fontified t face font-lock-type-face) 1026 1032 (fontified t) 1032 1043 (fontified t face font-lock-string-face) 1043 1050 (fontified t) 1050 1056 (fontified t) 1056 1064 (fontified t) 1064 1069 (fontified t face font-lock-preprocessor-face) 1069 1070 (fontified t) 1070 1089 (fontified t face font-lock-string-face) 1089 1139 (fontified t) 1139 1142 (fontified t face font-lock-keyword-face) 1142 1143 (fontified t) 1143 1145 (fontified t face font-lock-keyword-face) 1145 1146 (fontified t) 1146 1171 (fontified t face font-lock-function-name-face) 1171 1172 (fontified t) 1172 1180 (fontified t face font-lock-variable-name-face) 1180 1183 (fontified t) 1183 1186 (fontified t face font-lock-type-face) 1186 1189 (fontified t) 1189 1190 (fontified t syntax-table #1#) 1190 1191 (fontified t) 1191 1197 (fontified t face font-lock-type-face) 1197 1208 (fontified t) 1208 1211 (fontified t face font-lock-keyword-face) 1211 1212 (fontified t) 1212 1219 (fontified t face font-lock-variable-name-face) 1219 1222 (fontified t) 1222 1229 (fontified t face rust-builtin-formatting-macro-face) 1229 1230 (fontified t) 1230 1240 (fontified t face font-lock-string-face) 1240 1242 (fontified t face rust-string-interpolation-face) 1242 1243 (fontified t face font-lock-string-face) 1243 1264 (fontified t) 1264 1267 (fontified t face font-lock-keyword-face) 1267 1268 (fontified t) 1268 1279 (fontified t face font-lock-variable-name-face) 1279 1282 (fontified t) 1282 1290 (fontified t face font-lock-type-face) 1290 1296 (fontified t) 1296 1309 (fontified t face font-lock-string-face) 1309 1330 (fontified t) 1330 1335 (fontified t face font-lock-preprocessor-face) 1335 1336 (fontified t) 1336 1359 (fontified t face font-lock-string-face) 1359 1410 (fontified t) 1410 1413 (fontified t face font-lock-keyword-face) 1413 1414 (fontified t) 1414 1419 (fontified t face font-lock-constant-face) 1419 1421 (fontified t) 1421 1424 (fontified t face font-lock-constant-face) 1424 1426 (fontified t) 1426 1429 (fontified t face font-lock-constant-face) 1429 1431 (fontified t) 1431 1444 (fontified t face font-lock-type-face) 1444 1446 (fontified t) 1446 1449 (fontified t face font-lock-keyword-face) 1449 1450 (fontified t) 1450 1456 (fontified t face font-lock-keyword-face) 1456 1457 (fontified t) 1457 1463 (fontified t face font-lock-type-face) 1463 1470 (fontified t) 1470 1477 (fontified t face font-lock-variable-name-face) 1477 1479 (fontified t) 1479 1492 (fontified t face font-lock-type-face) 1492 1498 (fontified t) 1498 1500 (fontified t face font-lock-variable-name-face) 1500 1502 (fontified t) 1502 1507 (fontified t face font-lock-constant-face) 1507 1509 (fontified t) 1509 1513 (fontified t face font-lock-constant-face) 1513 1515 (fontified t) 1515 1519 (fontified t face font-lock-constant-face) 1519 1521 (fontified t) 1521 1527 (fontified t face font-lock-type-face) 1527 1528 (fontified t) 1528 1537 (fontified t face font-lock-type-face) 1537 1542 (fontified t) 1542 1546 (fontified t face font-lock-keyword-face) 1546 1547 (fontified t) 1547 1553 (fontified t face font-lock-type-face) 1553 1556 (fontified t) 1556 1560 (fontified t) 1560 1563 (fontified t face font-lock-keyword-face) 1563 1564 (fontified t) 1564 1566 (fontified t face font-lock-keyword-face) 1566 1567 (fontified t) 1567 1570 (fontified t face font-lock-function-name-face) 1570 1571 (fontified t) 1571 1578 (fontified t face font-lock-variable-name-face) 1578 1580 (fontified t) 1580 1584 (fontified t face font-lock-keyword-face) 1584 1585 (fontified t) 1585 1588 (fontified t face font-lock-constant-face) 1588 1590 (fontified t) 1590 1593 (fontified t face font-lock-constant-face) 1593 1595 (fontified t) 1595 1602 (fontified t face font-lock-type-face) 1602 1604 (fontified t) 1604 1606 (fontified t face font-lock-variable-name-face) 1606 1608 (fontified t) 1608 1613 (fontified t face font-lock-constant-face) 1613 1615 (fontified t) 1615 1619 (fontified t face font-lock-constant-face) 1619 1621 (fontified t) 1621 1625 (fontified t face font-lock-constant-face) 1625 1627 (fontified t) 1627 1633 (fontified t face font-lock-type-face) 1633 1634 (fontified t) 1634 1643 (fontified t face font-lock-type-face) 1643 1647 (fontified t) 1647 1648 (syntax-table #1# fontified t) 1648 1649 (fontified t) 1649 1653 (fontified t face font-lock-type-face) 1653 1664 (fontified t) 1664 1667 (fontified t face font-lock-keyword-face) 1667 1668 (fontified t) 1668 1675 (fontified t face font-lock-variable-name-face) 1675 1752 (fontified t) 1752 1777 (fontified t face font-lock-string-face) 1777 1788 (fontified t) 1788 1791 (fontified t face font-lock-keyword-face) 1791 1792 (fontified t) 1792 1799 (fontified t face font-lock-variable-name-face) 1799 1802 (fontified t) 1802 1811 (fontified t face font-lock-type-face) 1811 1840 (fontified t) 1840 1844 (fontified t face font-lock-type-face) 1844 1869 (fontified t) 1869 1873 (fontified t face font-lock-keyword-face) 1873 1874 (fontified t) 1874 1880 (fontified t face font-lock-type-face) 1880 1881 (fontified t) 1881 1884 (fontified t face font-lock-keyword-face) 1884 1885 (fontified t) 1885 1891 (fontified t face font-lock-type-face) 1891 1898 (fontified t) 1898 1902 (fontified t face font-lock-keyword-face) 1902 1903 (fontified t) 1903 1907 (fontified t face font-lock-type-face) 1907 1918 (fontified t) 1918 1922 (fontified t face font-lock-keyword-face) 1922 1923 (fontified t) 1923 1928 (fontified t face font-lock-type-face) 1928 1940 (fontified t) 1940 1942 (fontified t face font-lock-keyword-face) 1942 1943 (fontified t) 1943 1947 (fontified t face font-lock-function-name-face) 1947 1949 (fontified t) 1949 1952 (fontified t face font-lock-keyword-face) 1952 1953 (fontified t) 1953 1957 (fontified t face font-lock-keyword-face) 1957 1960 (fontified t) 1960 1961 (syntax-table #1# fontified t) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-type-face) 1966 1967 (fontified t) 1967 1971 (fontified t face font-lock-type-face) 1971 1973 (fontified t) 1973 1977 (fontified t face font-lock-type-face) 1977 1979 (fontified t) 1979 1983 (fontified t face font-lock-type-face) 1983 1985 (fontified t) 1985 1990 (fontified t face font-lock-type-face) 1990 2002 (fontified t) 2002 2007 (fontified t face font-lock-keyword-face) 2007 2008 (fontified t) 2008 2012 (fontified t face font-lock-keyword-face) 2012 2042 (fontified t) 2042 2044 (fontified t face font-lock-type-face) 2044 2045 (fontified t) 2045 2050 (fontified t face font-lock-type-face) 2050 2052 (fontified t) 2052 2056 (fontified t face font-lock-type-face) 2056 2057 (face font-lock-type-face fontified t) 2057 2068 (fontified t) 2068 2069 (syntax-table #1# fontified t) 2069 2072 (fontified t) 2072 2088 (fontified t) 2088 2092 (fontified t face font-lock-keyword-face) 2092 2128 (fontified t) 2128 2144 (fontified t face font-lock-string-face) 2144 2163 (fontified t) 2163 2165 (fontified t face font-lock-type-face) 2165 2166 (fontified t) 2166 2171 (fontified t face font-lock-type-face) 2171 2173 (fontified t) 2173 2178 (fontified t face font-lock-type-face) 2178 2210 (fontified t) 2210 2212 (fontified t face font-lock-type-face) 2212 2213 (fontified t) 2213 2218 (fontified t face font-lock-type-face) 2218 2220 (fontified t) 2220 2228 (fontified t face font-lock-type-face) 2228 2231 (fontified t) 2231 2232 (syntax-table #1# fontified t) 2232 2233 (fontified t) 2233 2235 (fontified t face font-lock-type-face) 2235 2236 (fontified t) 2236 2241 (fontified t face font-lock-type-face) 2241 2243 (fontified t) 2243 2251 (fontified t face font-lock-type-face) 2251 2266 (fontified t) 2266 2269 (fontified t face font-lock-type-face) 2269 2274 (fontified t) 2274 2275 (syntax-table #1# fontified t) 2275 2278 (fontified t) 2278 2294 (fontified t) 2294 2299 (fontified t face font-lock-preprocessor-face) 2299 2300 (fontified t) 2300 2323 (fontified t face font-lock-string-face) 2323 2329 (fontified t) 2329 2345 (fontified t) 2345 2347 (fontified t face font-lock-type-face) 2347 2348 (fontified t) 2348 2353 (fontified t face font-lock-type-face) 2353 2355 (fontified t) 2355 2360 (fontified t face font-lock-type-face) 2360 2366 (fontified t) 2366 2379 (fontified t) 2379 2399 (fontified t) 2399 2402 (fontified t face font-lock-keyword-face) 2402 2403 (fontified t) 2403 2409 (fontified t face font-lock-keyword-face) 2409 2410 (fontified t) 2410 2416 (fontified t face font-lock-type-face) 2416 2421 (fontified t) 2421 2425 (fontified t face font-lock-keyword-face) 2425 2426 (fontified t) 2426 2432 (fontified t face font-lock-type-face) 2432 2439 (fontified t) 2439 2442 (fontified t face font-lock-keyword-face) 2442 2443 (fontified t) 2443 2445 (fontified t face font-lock-keyword-face) 2445 2446 (fontified t) 2446 2450 (fontified t face font-lock-function-name-face) 2450 2460 (fontified t) 2460 2468 (fontified t face font-lock-variable-name-face) 2468 2470 (fontified t) 2470 2474 (fontified t face font-lock-keyword-face) 2474 2475 (fontified t) 2475 2478 (fontified t face font-lock-constant-face) 2478 2480 (fontified t) 2480 2483 (fontified t face font-lock-constant-face) 2483 2485 (fontified t) 2485 2492 (fontified t face font-lock-type-face) 2492 2502 (fontified t) 2502 2506 (fontified t face font-lock-variable-name-face) 2506 2509 (fontified t) 2509 2513 (fontified t face font-lock-type-face) 2513 2515 (fontified t) 2515 2522 (fontified t) 2522 2523 (fontified t syntax-table #1#) 2523 2524 (fontified t) 2524 2530 (fontified t face font-lock-constant-face) 2530 2532 (fontified t) 2532 2540 (fontified t face font-lock-type-face) 2540 2543 (fontified t) 2543 2551 (fontified t) 2551 2556 (fontified t face font-lock-keyword-face) 2556 2557 (fontified t) 2557 2573 (fontified t face font-lock-type-face) 2573 2579 (fontified t) 2579 2587 (fontified t face font-lock-type-face) 2587 2589 (fontified t) 2589 2596 (fontified t face font-lock-type-face) 2596 2598 (fontified t) 2598 2599 (syntax-table #1# fontified t) 2599 2600 (fontified t) 2600 2615 (fontified t face font-lock-type-face) 2615 2621 (fontified t) 2621 2629 (fontified t face font-lock-type-face) 2629 2631 (fontified t) 2631 2638 (fontified t face font-lock-type-face) 2638 2654 (fontified t) 2654 2660 (fontified t face font-lock-constant-face) 2660 2668 (fontified t) 2668 2672 (fontified t face font-lock-constant-face) 2672 2674 (fontified t) 2674 2682 (fontified t face font-lock-type-face) 2682 2722 (fontified t) 2722 2723 (fontified t face font-lock-keyword-face) 2723 2725 (fontified t face font-lock-keyword-face) 2725 2726 (fontified t) 2726 2741 (fontified t face font-lock-variable-name-face) 2741 2744 (fontified t) 2744 2760 (fontified t face font-lock-type-face) 2760 2773 (fontified t) 2773 2774 (fontified t) 2774 2782 (fontified t face font-lock-type-face) 2782 2784 (fontified t) 2784 2791 (fontified t face font-lock-type-face) 2791 2798 (fontified t) 2798 2806 (fontified t) 2806 2811 (fontified t face font-lock-preprocessor-face) 2811 2812 (fontified t) 2812 2839 (fontified t face font-lock-string-face) 2839 2868 (fontified t) 2868 2871 (fontified t face font-lock-keyword-face) 2871 2872 (fontified t) 2872 2880 (fontified t face font-lock-variable-name-face) 2880 2913 (fontified t) 2913 2916 (fontified t face font-lock-keyword-face) 2916 2917 (fontified t) 2917 2942 (fontified t face font-lock-variable-name-face) 2942 2945 (fontified t) 2945 2951 (fontified t face font-lock-constant-face) 2951 2953 (fontified t) 2953 2961 (fontified t face font-lock-type-face) 2961 2984 (fontified t) 2984 3017 (fontified t) 3017 3026 (fontified t)) . 1) (undo-tree-id3100 . -469) (undo-tree-id3101 . -469) (undo-tree-id3102 . -469) (undo-tree-id3103 . -453) (undo-tree-id3104 . -469) (undo-tree-id3105 . -2515) (undo-tree-id3106 . -2515) (undo-tree-id3107 . -2366) (undo-tree-id3108 . -2515) (undo-tree-id3109 . -2515) (undo-tree-id3110 . -2366) (undo-tree-id3111 . -2515) (undo-tree-id3112 . -2366) (undo-tree-id3113 . -2515) (undo-tree-id3114 . -2515) (undo-tree-id3115 . -2515) (undo-tree-id3116 . -2515) (undo-tree-id3117 . -2366) (undo-tree-id3118 . -2515) (undo-tree-id3119 . -2515) (undo-tree-id3120 . -2515) (undo-tree-id3121 . -2515) (undo-tree-id3122 . -2366) (undo-tree-id3123 . -221) (undo-tree-id3124 . -230) (undo-tree-id3125 . -2439) (undo-tree-id3126 . -3026) (undo-tree-id3127 . -157) (undo-tree-id3128 . -160) (undo-tree-id3129 . -162) (undo-tree-id3130 . -167) (undo-tree-id3131 . -211) (undo-tree-id3132 . -219) (undo-tree-id3133 . -221) (undo-tree-id3134 . -230) (undo-tree-id3135 . -2439) (undo-tree-id3136 . -3023) (undo-tree-id3137 . -2439) (undo-tree-id3138 . -2442) (undo-tree-id3139 . -221) (undo-tree-id3140 . -230) (undo-tree-id3141 . -211) (undo-tree-id3142 . -219) (undo-tree-id3143 . -162) (undo-tree-id3144 . -167) (undo-tree-id3145 . -157) (undo-tree-id3146 . -160) (undo-tree-id3147 . -157) (undo-tree-id3148 . -160) (undo-tree-id3149 . -162) (undo-tree-id3150 . -167) (undo-tree-id3151 . -211) (undo-tree-id3152 . -219) (undo-tree-id3153 . -221) (undo-tree-id3154 . -230) (undo-tree-id3155 . -2439) (undo-tree-id3156 . -3023) 2516) nil (23751 31527 101592 230000) 0 nil]) ((#("        read_half: Arc<Mutex<ReadHalf<TcpStream>>>,
" 0 8 (fontified t) 8 17 (fontified t face font-lock-variable-name-face) 17 19 (fontified t) 19 22 (fontified t face font-lock-type-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-type-face) 28 29 (fontified t) 29 37 (fontified t face font-lock-type-face) 37 38 (fontified t) 38 47 (fontified t face font-lock-type-face) 47 52 (fontified t)) . 2516) (undo-tree-id3157 . -52) (undo-tree-id3158 . -52) (undo-tree-id3159 . -52) (undo-tree-id3160 . -52) (undo-tree-id3161 . -52) (undo-tree-id3162 . -52) (undo-tree-id3163 . -52) (undo-tree-id3164 . -37) (undo-tree-id3165 . -38)) nil (23751 31527 101653 509000) 0 nil]) ((#("        write_half: Arc<Mutex<WriteHalf<TcpStream>>>,
" 0 8 (fontified t) 8 18 (fontified t face font-lock-variable-name-face) 18 20 (fontified t) 20 23 (fontified t face font-lock-type-face) 23 24 (fontified t) 24 29 (fontified t face font-lock-type-face) 29 30 (fontified t) 30 39 (fontified t face font-lock-type-face) 39 40 (fontified t) 40 49 (fontified t face font-lock-type-face) 49 54 (fontified t)) . 2568) (undo-tree-id3166 . -14) (undo-tree-id3167 . -14) (undo-tree-id3168 . -14) 2582 (t 23751 31471 461148 177000)) nil (23751 31527 101662 474000) 0 nil]) ((1 . 3133) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::io::{ReadHalf, WriteHalf};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(
        timeline: impl std::fmt::Display,
        user: &User,
        read_half: Arc<Mutex<ReadHalf<TcpStream>>>,
        write_half: Arc<Mutex<WriteHalf<TcpStream>>>,
    ) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis =
            stream::Receiver::new(timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 208 (fontified t face font-lock-constant-face) 208 211 (fontified t) 211 219 (fontified t face font-lock-type-face) 219 221 (fontified t) 221 230 (fontified t face font-lock-type-face) 230 233 (fontified t) 233 236 (fontified t face font-lock-keyword-face) 236 237 (fontified t) 237 242 (fontified t face font-lock-constant-face) 242 244 (fontified t) 244 247 (fontified t face font-lock-constant-face) 247 249 (fontified t) 249 258 (fontified t face font-lock-type-face) 258 260 (fontified t) 260 263 (fontified t face font-lock-keyword-face) 263 264 (fontified t) 264 268 (fontified t face font-lock-constant-face) 268 270 (fontified t) 270 276 (fontified t face font-lock-type-face) 276 279 (fontified t) 279 282 (fontified t face font-lock-keyword-face) 282 283 (fontified t) 283 289 (fontified t face font-lock-keyword-face) 289 290 (fontified t) 290 306 (fontified t face font-lock-variable-name-face) 306 308 (fontified t) 308 319 (fontified t face font-lock-type-face) 319 322 (fontified t) 322 333 (fontified t face font-lock-type-face) 333 343 (fontified t) 343 346 (fontified t face font-lock-keyword-face) 346 347 (fontified t) 347 353 (fontified t face font-lock-keyword-face) 353 354 (fontified t) 354 369 (fontified t face font-lock-variable-name-face) 369 371 (fontified t) 371 382 (fontified t face font-lock-type-face) 382 385 (fontified t) 385 396 (fontified t face font-lock-type-face) 396 409 (fontified t) 409 412 (fontified t face font-lock-keyword-face) 412 413 (fontified t) 413 419 (fontified t face font-lock-keyword-face) 419 420 (fontified t) 420 428 (fontified t face font-lock-type-face) 428 435 (fontified t) 435 443 (fontified t face font-lock-variable-name-face) 443 445 (fontified t) 445 451 (fontified t face font-lock-type-face) 451 455 (fontified t) 455 459 (fontified t face font-lock-keyword-face) 459 460 (fontified t) 460 468 (fontified t face font-lock-type-face) 468 475 (fontified t) 475 477 (fontified t face font-lock-keyword-face) 477 478 (fontified t) 478 481 (fontified t face font-lock-function-name-face) 481 482 (fontified t) 482 485 (fontified t face font-lock-variable-name-face) 485 487 (fontified t) 487 491 (fontified t face font-lock-keyword-face) 491 492 (fontified t) 492 495 (fontified t face font-lock-constant-face) 495 497 (fontified t) 497 500 (fontified t face font-lock-constant-face) 500 502 (fontified t) 502 509 (fontified t face font-lock-type-face) 509 511 (fontified t) 511 514 (fontified t face font-lock-variable-name-face) 514 516 (fontified t) 516 520 (fontified t face font-lock-keyword-face) 520 521 (fontified t) 521 524 (fontified t face font-lock-constant-face) 524 526 (fontified t) 526 529 (fontified t face font-lock-constant-face) 529 531 (fontified t) 531 538 (fontified t face font-lock-type-face) 538 541 (fontified t) 541 542 (fontified t syntax-table #1#) 542 543 (fontified t) 543 547 (fontified t face font-lock-type-face) 547 550 (fontified t) 550 558 (fontified t) 558 561 (fontified t face font-lock-keyword-face) 561 619 (fontified t) 619 622 (fontified t face font-lock-keyword-face) 622 623 (fontified t) 623 631 (fontified t face font-lock-variable-name-face) 631 634 (fontified t) 634 641 (fontified t face rust-builtin-formatting-macro-face) 641 655 (fontified t) 655 663 (fontified t face font-lock-string-face) 663 675 (fontified t face rust-string-interpolation-face) 675 679 (fontified t face font-lock-string-face) 679 684 (fontified t face rust-string-interpolation-face) 684 689 (fontified t face font-lock-string-face) 689 701 (fontified t face rust-string-interpolation-face) 701 705 (fontified t face font-lock-string-face) 705 710 (fontified t face rust-string-interpolation-face) 710 715 (fontified t face font-lock-string-face) 715 853 (fontified t) 853 857 (fontified t face font-lock-type-face) 857 881 (fontified t) 881 884 (fontified t face font-lock-keyword-face) 884 885 (fontified t) 885 887 (fontified t face font-lock-keyword-face) 887 888 (fontified t) 888 909 (fontified t face font-lock-function-name-face) 909 910 (fontified t) 910 918 (fontified t face font-lock-variable-name-face) 918 921 (fontified t) 921 924 (fontified t face font-lock-type-face) 924 927 (fontified t) 927 928 (fontified t syntax-table #1#) 928 929 (fontified t) 929 935 (fontified t face font-lock-type-face) 935 946 (fontified t) 946 949 (fontified t face font-lock-keyword-face) 949 950 (fontified t) 950 957 (fontified t face font-lock-variable-name-face) 957 960 (fontified t) 960 967 (fontified t face rust-builtin-formatting-macro-face) 967 968 (fontified t) 968 978 (fontified t face font-lock-string-face) 978 980 (fontified t face rust-string-interpolation-face) 980 981 (fontified t face font-lock-string-face) 981 1002 (fontified t) 1002 1005 (fontified t face font-lock-keyword-face) 1005 1006 (fontified t) 1006 1015 (fontified t face font-lock-variable-name-face) 1015 1018 (fontified t) 1018 1026 (fontified t face font-lock-type-face) 1026 1032 (fontified t) 1032 1043 (fontified t face font-lock-string-face) 1043 1050 (fontified t) 1050 1056 (fontified t) 1056 1064 (fontified t) 1064 1069 (fontified t face font-lock-preprocessor-face) 1069 1070 (fontified t) 1070 1089 (fontified t face font-lock-string-face) 1089 1139 (fontified t) 1139 1142 (fontified t face font-lock-keyword-face) 1142 1143 (fontified t) 1143 1145 (fontified t face font-lock-keyword-face) 1145 1146 (fontified t) 1146 1171 (fontified t face font-lock-function-name-face) 1171 1172 (fontified t) 1172 1180 (fontified t face font-lock-variable-name-face) 1180 1183 (fontified t) 1183 1186 (fontified t face font-lock-type-face) 1186 1189 (fontified t) 1189 1190 (fontified t syntax-table #1#) 1190 1191 (fontified t) 1191 1197 (fontified t face font-lock-type-face) 1197 1208 (fontified t) 1208 1211 (fontified t face font-lock-keyword-face) 1211 1212 (fontified t) 1212 1219 (fontified t face font-lock-variable-name-face) 1219 1222 (fontified t) 1222 1229 (fontified t face rust-builtin-formatting-macro-face) 1229 1230 (fontified t) 1230 1240 (fontified t face font-lock-string-face) 1240 1242 (fontified t face rust-string-interpolation-face) 1242 1243 (fontified t face font-lock-string-face) 1243 1264 (fontified t) 1264 1267 (fontified t face font-lock-keyword-face) 1267 1268 (fontified t) 1268 1279 (fontified t face font-lock-variable-name-face) 1279 1282 (fontified t) 1282 1290 (fontified t face font-lock-type-face) 1290 1296 (fontified t) 1296 1309 (fontified t face font-lock-string-face) 1309 1330 (fontified t) 1330 1335 (fontified t face font-lock-preprocessor-face) 1335 1336 (fontified t) 1336 1359 (fontified t face font-lock-string-face) 1359 1410 (fontified t) 1410 1413 (fontified t face font-lock-keyword-face) 1413 1414 (fontified t) 1414 1419 (fontified t face font-lock-constant-face) 1419 1421 (fontified t) 1421 1424 (fontified t face font-lock-constant-face) 1424 1426 (fontified t) 1426 1429 (fontified t face font-lock-constant-face) 1429 1431 (fontified t) 1431 1444 (fontified t face font-lock-type-face) 1444 1446 (fontified t) 1446 1449 (fontified t face font-lock-keyword-face) 1449 1450 (fontified t) 1450 1456 (fontified t face font-lock-keyword-face) 1456 1457 (fontified t) 1457 1463 (fontified t face font-lock-type-face) 1463 1470 (fontified t) 1470 1477 (fontified t face font-lock-variable-name-face) 1477 1479 (fontified t) 1479 1492 (fontified t face font-lock-type-face) 1492 1498 (fontified t) 1498 1500 (fontified t face font-lock-variable-name-face) 1500 1502 (fontified t) 1502 1507 (fontified t face font-lock-constant-face) 1507 1509 (fontified t) 1509 1513 (fontified t face font-lock-constant-face) 1513 1515 (fontified t) 1515 1519 (fontified t face font-lock-constant-face) 1519 1521 (fontified t) 1521 1527 (fontified t face font-lock-type-face) 1527 1528 (fontified t) 1528 1537 (fontified t face font-lock-type-face) 1537 1542 (fontified t) 1542 1546 (fontified t face font-lock-keyword-face) 1546 1547 (fontified t) 1547 1553 (fontified t face font-lock-type-face) 1553 1556 (fontified t) 1556 1560 (fontified t) 1560 1563 (fontified t face font-lock-keyword-face) 1563 1564 (fontified t) 1564 1566 (fontified t face font-lock-keyword-face) 1566 1567 (fontified t) 1567 1570 (fontified t face font-lock-function-name-face) 1570 1571 (fontified t) 1571 1578 (fontified t face font-lock-variable-name-face) 1578 1580 (fontified t) 1580 1584 (fontified t face font-lock-keyword-face) 1584 1585 (fontified t) 1585 1588 (fontified t face font-lock-constant-face) 1588 1590 (fontified t) 1590 1593 (fontified t face font-lock-constant-face) 1593 1595 (fontified t) 1595 1602 (fontified t face font-lock-type-face) 1602 1604 (fontified t) 1604 1606 (fontified t face font-lock-variable-name-face) 1606 1608 (fontified t) 1608 1613 (fontified t face font-lock-constant-face) 1613 1615 (fontified t) 1615 1619 (fontified t face font-lock-constant-face) 1619 1621 (fontified t) 1621 1625 (fontified t face font-lock-constant-face) 1625 1627 (fontified t) 1627 1633 (fontified t face font-lock-type-face) 1633 1634 (fontified t) 1634 1643 (fontified t face font-lock-type-face) 1643 1647 (fontified t) 1647 1648 (syntax-table #1# fontified t) 1648 1649 (fontified t) 1649 1653 (fontified t face font-lock-type-face) 1653 1664 (fontified t) 1664 1667 (fontified t face font-lock-keyword-face) 1667 1668 (fontified t) 1668 1675 (fontified t face font-lock-variable-name-face) 1675 1752 (fontified t) 1752 1777 (fontified t face font-lock-string-face) 1777 1788 (fontified t) 1788 1791 (fontified t face font-lock-keyword-face) 1791 1792 (fontified t) 1792 1799 (fontified t face font-lock-variable-name-face) 1799 1802 (fontified t) 1802 1811 (fontified t face font-lock-type-face) 1811 1840 (fontified t) 1840 1844 (fontified t face font-lock-type-face) 1844 1869 (fontified t) 1869 1873 (fontified t face font-lock-keyword-face) 1873 1874 (fontified t) 1874 1880 (fontified t face font-lock-type-face) 1880 1881 (fontified t) 1881 1884 (fontified t face font-lock-keyword-face) 1884 1885 (fontified t) 1885 1891 (fontified t face font-lock-type-face) 1891 1898 (fontified t) 1898 1902 (fontified t face font-lock-keyword-face) 1902 1903 (fontified t) 1903 1907 (fontified t face font-lock-type-face) 1907 1918 (fontified t) 1918 1922 (fontified t face font-lock-keyword-face) 1922 1923 (fontified t) 1923 1928 (fontified t face font-lock-type-face) 1928 1940 (fontified t) 1940 1942 (fontified t face font-lock-keyword-face) 1942 1943 (fontified t) 1943 1947 (fontified t face font-lock-function-name-face) 1947 1949 (fontified t) 1949 1952 (fontified t face font-lock-keyword-face) 1952 1953 (fontified t) 1953 1957 (fontified t face font-lock-keyword-face) 1957 1960 (fontified t) 1960 1961 (syntax-table #1# fontified t) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-type-face) 1966 1967 (fontified t) 1967 1971 (fontified t face font-lock-type-face) 1971 1973 (fontified t) 1973 1977 (fontified t face font-lock-type-face) 1977 1979 (fontified t) 1979 1983 (fontified t face font-lock-type-face) 1983 1985 (fontified t) 1985 1990 (fontified t face font-lock-type-face) 1990 2002 (fontified t) 2002 2007 (fontified t face font-lock-keyword-face) 2007 2008 (fontified t) 2008 2012 (fontified t face font-lock-keyword-face) 2012 2042 (fontified t) 2042 2044 (fontified t face font-lock-type-face) 2044 2045 (fontified t) 2045 2050 (fontified t face font-lock-type-face) 2050 2052 (fontified t) 2052 2056 (fontified t face font-lock-type-face) 2056 2057 (face font-lock-type-face fontified t) 2057 2068 (fontified t) 2068 2069 (syntax-table #1# fontified t) 2069 2072 (fontified t) 2072 2088 (fontified t) 2088 2092 (fontified t face font-lock-keyword-face) 2092 2128 (fontified t) 2128 2144 (fontified t face font-lock-string-face) 2144 2163 (fontified t) 2163 2165 (fontified t face font-lock-type-face) 2165 2166 (fontified t) 2166 2171 (fontified t face font-lock-type-face) 2171 2173 (fontified t) 2173 2178 (fontified t face font-lock-type-face) 2178 2210 (fontified t) 2210 2212 (fontified t face font-lock-type-face) 2212 2213 (fontified t) 2213 2218 (fontified t face font-lock-type-face) 2218 2220 (fontified t) 2220 2228 (fontified t face font-lock-type-face) 2228 2231 (fontified t) 2231 2232 (syntax-table #1# fontified t) 2232 2233 (fontified t) 2233 2235 (fontified t face font-lock-type-face) 2235 2236 (fontified t) 2236 2241 (fontified t face font-lock-type-face) 2241 2243 (fontified t) 2243 2251 (fontified t face font-lock-type-face) 2251 2254 (fontified t) 2254 2266 (fontified t) 2266 2269 (fontified t face font-lock-type-face) 2269 2274 (fontified t) 2274 2275 (syntax-table #1# fontified t) 2275 2277 (fontified t) 2277 2278 (fontified t) 2278 2294 (fontified t) 2294 2299 (fontified t face font-lock-preprocessor-face) 2299 2300 (fontified t) 2300 2323 (fontified t face font-lock-string-face) 2323 2329 (fontified t) 2329 2345 (fontified t) 2345 2347 (fontified t face font-lock-type-face) 2347 2348 (fontified t) 2348 2353 (fontified t face font-lock-type-face) 2353 2355 (fontified t) 2355 2360 (fontified t face font-lock-type-face) 2360 2399 (fontified t) 2399 2402 (fontified t face font-lock-keyword-face) 2402 2403 (fontified t) 2403 2409 (fontified t face font-lock-keyword-face) 2409 2410 (fontified t) 2410 2416 (fontified t face font-lock-type-face) 2416 2421 (fontified t) 2421 2425 (fontified t face font-lock-keyword-face) 2425 2426 (fontified t) 2426 2432 (fontified t face font-lock-type-face) 2432 2439 (fontified t) 2439 2442 (fontified t face font-lock-keyword-face) 2442 2443 (fontified t) 2443 2445 (fontified t face font-lock-keyword-face) 2445 2446 (fontified t) 2446 2450 (fontified t face font-lock-function-name-face) 2450 2460 (fontified t) 2460 2468 (fontified t face font-lock-variable-name-face) 2468 2470 (fontified t) 2470 2474 (fontified t face font-lock-keyword-face) 2474 2475 (fontified t) 2475 2478 (fontified t face font-lock-constant-face) 2478 2480 (fontified t) 2480 2483 (fontified t face font-lock-constant-face) 2483 2485 (fontified t) 2485 2492 (fontified t face font-lock-type-face) 2492 2502 (fontified t) 2502 2506 (fontified t face font-lock-variable-name-face) 2506 2509 (fontified t) 2509 2513 (fontified t face font-lock-type-face) 2513 2523 (fontified t) 2523 2532 (fontified t face font-lock-variable-name-face) 2532 2534 (fontified t) 2534 2537 (fontified t face font-lock-type-face) 2537 2538 (fontified t) 2538 2543 (fontified t face font-lock-type-face) 2543 2544 (fontified t) 2544 2552 (fontified t face font-lock-type-face) 2552 2553 (fontified t) 2553 2562 (fontified t face font-lock-type-face) 2562 2575 (fontified t) 2575 2585 (fontified t face font-lock-variable-name-face) 2585 2587 (fontified t) 2587 2590 (fontified t face font-lock-type-face) 2590 2591 (fontified t) 2591 2596 (fontified t face font-lock-type-face) 2596 2597 (fontified t) 2597 2606 (fontified t face font-lock-type-face) 2606 2607 (fontified t) 2607 2616 (fontified t face font-lock-type-face) 2616 2628 (fontified t) 2628 2629 (syntax-table #1# fontified t) 2629 2630 (fontified t) 2630 2636 (fontified t face font-lock-constant-face) 2636 2638 (fontified t) 2638 2646 (fontified t face font-lock-type-face) 2646 2657 (fontified t) 2657 2662 (fontified t face font-lock-keyword-face) 2662 2663 (fontified t) 2663 2679 (fontified t face font-lock-type-face) 2679 2685 (fontified t) 2685 2693 (fontified t face font-lock-type-face) 2693 2695 (fontified t) 2695 2702 (fontified t face font-lock-type-face) 2702 2704 (fontified t) 2704 2705 (syntax-table #1# fontified t) 2705 2706 (fontified t) 2706 2721 (fontified t face font-lock-type-face) 2721 2727 (fontified t) 2727 2735 (fontified t face font-lock-type-face) 2735 2737 (fontified t) 2737 2744 (fontified t face font-lock-type-face) 2744 2760 (fontified t) 2760 2766 (fontified t face font-lock-constant-face) 2766 2774 (fontified t) 2774 2777 (fontified t face font-lock-constant-face) 2777 2778 (fontified t face font-lock-constant-face) 2778 2780 (fontified t) 2780 2788 (fontified t face font-lock-type-face) 2788 2810 (fontified t) 2810 2828 (fontified t) 2828 2829 (fontified t face font-lock-keyword-face) 2829 2831 (face font-lock-keyword-face fontified t) 2831 2832 (fontified t) 2832 2847 (face font-lock-variable-name-face fontified t) 2847 2850 (fontified t) 2850 2866 (face font-lock-type-face fontified t) 2866 2880 (fontified t) 2880 2888 (face font-lock-type-face fontified t) 2888 2890 (fontified t) 2890 2897 (face font-lock-type-face fontified t) 2897 2904 (fontified t) 2904 2912 (fontified t) 2912 2917 (fontified t face font-lock-preprocessor-face) 2917 2918 (fontified t) 2918 2945 (fontified t face font-lock-string-face) 2945 2974 (fontified t) 2974 2977 (fontified t face font-lock-keyword-face) 2977 2978 (fontified t) 2978 2986 (fontified t face font-lock-variable-name-face) 2986 3011 (fontified t) 3011 3019 (fontified t) 3019 3022 (fontified t face font-lock-keyword-face) 3022 3023 (fontified t) 3023 3048 (fontified t face font-lock-variable-name-face) 3048 3050 (fontified t) 3050 3051 (fontified t) 3051 3063 (fontified t) 3063 3069 (fontified t face font-lock-constant-face) 3069 3071 (fontified t) 3071 3079 (fontified t face font-lock-type-face) 3079 3102 (fontified t) 3102 3144 (fontified t)) . 1) (undo-tree-id3029 . -3085) (undo-tree-id3030 . -1542) (undo-tree-id3031 . -2266) (undo-tree-id3032 . -1540) (undo-tree-id3033 . -1554) (undo-tree-id3034 . -1542) (undo-tree-id3035 . -1540) (undo-tree-id3036 . -1540) (undo-tree-id3037 . -1540) (undo-tree-id3038 . -1540) (undo-tree-id3039 . -1540) (undo-tree-id3040 . -1540) (undo-tree-id3041 . -3144) (undo-tree-id3042 . -3144) (undo-tree-id3043 . -3144) (undo-tree-id3044 . -296) (undo-tree-id3045 . -296) (undo-tree-id3046 . -2621) (undo-tree-id3047 . -2633) (undo-tree-id3048 . -2633) (undo-tree-id3049 . -2366) (undo-tree-id3050 . -2621) (undo-tree-id3051 . -2633) (undo-tree-id3052 . -2633) (undo-tree-id3053 . -2633) (undo-tree-id3054 . -2366) (undo-tree-id3055 . -2633) (undo-tree-id3056 . -2633) (undo-tree-id3057 . -2366) (undo-tree-id3058 . -2633) (undo-tree-id3059 . -2633) (undo-tree-id3060 . -2633) (undo-tree-id3061 . -2266) (undo-tree-id3062 . -2290) (undo-tree-id3063 . -1542) (undo-tree-id3064 . -2633) (undo-tree-id3065 . -2266) (undo-tree-id3066 . -2266) (undo-tree-id3067 . -2266) (undo-tree-id3068 . -2266) (undo-tree-id3069 . -1542) (undo-tree-id3070 . -2266) (undo-tree-id3071 . -2523) (undo-tree-id3072 . -2532) (undo-tree-id3073 . -3085) (undo-tree-id3074 . -3085) (undo-tree-id3075 . -3085) (undo-tree-id3076 . -3085) (undo-tree-id3077 . -2366) (undo-tree-id3078 . -3063) (undo-tree-id3079 . -3069) (undo-tree-id3080 . -3085) (undo-tree-id3081 . -3093) (undo-tree-id3082 . -2266) (undo-tree-id3083 . -3085) (undo-tree-id3084 . -3085) (undo-tree-id3085 . -3085) (undo-tree-id3086 . -3085) (undo-tree-id3087 . -2366) (undo-tree-id3088 . -3085) (undo-tree-id3089 . -2366) (undo-tree-id3090 . -3085) (undo-tree-id3091 . -3085) (undo-tree-id3092 . -3085) (undo-tree-id3093 . -3085) (undo-tree-id3094 . -2366) (undo-tree-id3095 . -3085) (undo-tree-id3096 . -3085) (undo-tree-id3097 . -2366) 3086) nil (23751 31471 345981 465000) 0 nil]) ((#("te_half, " 0 9 (fontified t)) . 3086)) nil (23751 31471 345990 700000) 0 nil]) ((#("read_half, wri" 0 14 (fontified t)) . 3086) (undo-tree-id3098 . -6) (undo-tree-id3099 . -9) (t 23751 29835 852313 935000)) nil (23751 31471 345995 28000) 0 nil]) ((1 . 3168) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::io::{ReadHalf, WriteHalf};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(
        timeline: impl std::fmt::Display,
        user: &User,
        read_half: Arc<Mutex<ReadHalf<TcpStream>>>,
        write_half: Arc<Mutex<WriteHalf<TcpStream>>>,
    ) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(read_half, write_half, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 208 (fontified t face font-lock-constant-face) 208 211 (fontified t) 211 219 (fontified t face font-lock-type-face) 219 221 (fontified t) 221 230 (fontified t face font-lock-type-face) 230 233 (fontified t) 233 236 (fontified t face font-lock-keyword-face) 236 237 (fontified t) 237 242 (fontified t face font-lock-constant-face) 242 244 (fontified t) 244 247 (fontified t face font-lock-constant-face) 247 249 (fontified t) 249 258 (fontified t face font-lock-type-face) 258 260 (fontified t) 260 263 (fontified t face font-lock-keyword-face) 263 264 (fontified t) 264 268 (fontified t face font-lock-constant-face) 268 270 (fontified t) 270 276 (fontified t face font-lock-type-face) 276 277 (fontified t) 277 279 (fontified t) 279 282 (fontified t face font-lock-keyword-face) 282 283 (fontified t) 283 289 (fontified t face font-lock-keyword-face) 289 290 (fontified t) 290 306 (fontified t face font-lock-variable-name-face) 306 308 (fontified t) 308 319 (fontified t face font-lock-type-face) 319 322 (fontified t) 322 333 (fontified t face font-lock-type-face) 333 343 (fontified t) 343 346 (fontified t face font-lock-keyword-face) 346 347 (fontified t) 347 353 (fontified t face font-lock-keyword-face) 353 354 (fontified t) 354 369 (fontified t face font-lock-variable-name-face) 369 371 (fontified t) 371 382 (fontified t face font-lock-type-face) 382 385 (fontified t) 385 396 (fontified t face font-lock-type-face) 396 409 (fontified t) 409 412 (fontified t face font-lock-keyword-face) 412 413 (fontified t) 413 419 (fontified t face font-lock-keyword-face) 419 420 (fontified t) 420 428 (fontified t face font-lock-type-face) 428 435 (fontified t) 435 443 (fontified t face font-lock-variable-name-face) 443 445 (fontified t) 445 451 (fontified t face font-lock-type-face) 451 455 (fontified t) 455 459 (fontified t face font-lock-keyword-face) 459 460 (fontified t) 460 468 (fontified t face font-lock-type-face) 468 475 (fontified t) 475 477 (fontified t face font-lock-keyword-face) 477 478 (fontified t) 478 481 (fontified t face font-lock-function-name-face) 481 482 (fontified t) 482 485 (fontified t face font-lock-variable-name-face) 485 487 (fontified t) 487 491 (fontified t face font-lock-keyword-face) 491 492 (fontified t) 492 495 (fontified t face font-lock-constant-face) 495 497 (fontified t) 497 500 (fontified t face font-lock-constant-face) 500 502 (fontified t) 502 509 (fontified t face font-lock-type-face) 509 511 (fontified t) 511 514 (fontified t face font-lock-variable-name-face) 514 516 (fontified t) 516 520 (fontified t face font-lock-keyword-face) 520 521 (fontified t) 521 524 (fontified t face font-lock-constant-face) 524 526 (fontified t) 526 529 (fontified t face font-lock-constant-face) 529 531 (fontified t) 531 538 (fontified t face font-lock-type-face) 538 541 (fontified t) 541 542 (syntax-table #1# fontified t) 542 543 (fontified t) 543 547 (fontified t face font-lock-type-face) 547 558 (fontified t) 558 561 (fontified t face font-lock-keyword-face) 561 619 (fontified t) 619 622 (fontified t face font-lock-keyword-face) 622 623 (fontified t) 623 631 (fontified t face font-lock-variable-name-face) 631 634 (fontified t) 634 641 (fontified t face rust-builtin-formatting-macro-face) 641 655 (fontified t) 655 663 (fontified t face font-lock-string-face) 663 675 (fontified t face rust-string-interpolation-face) 675 679 (fontified t face font-lock-string-face) 679 684 (fontified t face rust-string-interpolation-face) 684 689 (fontified t face font-lock-string-face) 689 701 (fontified t face rust-string-interpolation-face) 701 705 (fontified t face font-lock-string-face) 705 710 (fontified t face rust-string-interpolation-face) 710 715 (fontified t face font-lock-string-face) 715 733 (fontified t) 733 753 (fontified t) 753 760 (fontified t) 760 776 (fontified t) 776 777 (fontified t) 777 812 (fontified t) 812 853 (fontified t) 853 857 (fontified t face font-lock-type-face) 857 881 (fontified t) 881 884 (fontified t face font-lock-keyword-face) 884 885 (fontified t) 885 887 (fontified t face font-lock-keyword-face) 887 888 (fontified t) 888 909 (fontified t face font-lock-function-name-face) 909 910 (fontified t) 910 918 (fontified t face font-lock-variable-name-face) 918 921 (fontified t) 921 924 (fontified t face font-lock-type-face) 924 927 (fontified t) 927 928 (syntax-table #1# fontified t) 928 929 (fontified t) 929 935 (fontified t face font-lock-type-face) 935 946 (fontified t) 946 949 (fontified t face font-lock-keyword-face) 949 950 (fontified t) 950 957 (fontified t face font-lock-variable-name-face) 957 960 (fontified t) 960 967 (fontified t face rust-builtin-formatting-macro-face) 967 968 (fontified t) 968 978 (fontified t face font-lock-string-face) 978 980 (fontified t face rust-string-interpolation-face) 980 981 (fontified t face font-lock-string-face) 981 1002 (fontified t) 1002 1005 (fontified t face font-lock-keyword-face) 1005 1006 (fontified t) 1006 1015 (fontified t face font-lock-variable-name-face) 1015 1018 (fontified t) 1018 1026 (fontified t face font-lock-type-face) 1026 1032 (fontified t) 1032 1043 (fontified t face font-lock-string-face) 1043 1064 (fontified t) 1064 1069 (fontified t face font-lock-preprocessor-face) 1069 1070 (fontified t) 1070 1089 (fontified t face font-lock-string-face) 1089 1139 (fontified t) 1139 1142 (fontified t face font-lock-keyword-face) 1142 1143 (fontified t) 1143 1145 (fontified t face font-lock-keyword-face) 1145 1146 (fontified t) 1146 1171 (fontified t face font-lock-function-name-face) 1171 1172 (fontified t) 1172 1180 (fontified t face font-lock-variable-name-face) 1180 1183 (fontified t) 1183 1186 (fontified t face font-lock-type-face) 1186 1189 (fontified t) 1189 1190 (syntax-table #1# fontified t) 1190 1191 (fontified t) 1191 1197 (fontified t face font-lock-type-face) 1197 1208 (fontified t) 1208 1211 (fontified t face font-lock-keyword-face) 1211 1212 (fontified t) 1212 1219 (fontified t face font-lock-variable-name-face) 1219 1222 (fontified t) 1222 1229 (fontified t face rust-builtin-formatting-macro-face) 1229 1230 (fontified t) 1230 1240 (fontified t face font-lock-string-face) 1240 1242 (fontified t face rust-string-interpolation-face) 1242 1243 (fontified t face font-lock-string-face) 1243 1253 (fontified t) 1253 1256 (fontified t) 1256 1264 (fontified t) 1264 1267 (fontified t face font-lock-keyword-face) 1267 1268 (fontified t) 1268 1276 (fontified t face font-lock-variable-name-face) 1276 1279 (fontified t face font-lock-variable-name-face) 1279 1282 (fontified t) 1282 1290 (fontified t face font-lock-type-face) 1290 1296 (fontified t) 1296 1309 (fontified t face font-lock-string-face) 1309 1312 (fontified t) 1312 1322 (fontified t) 1322 1330 (fontified t) 1330 1335 (fontified t face font-lock-preprocessor-face) 1335 1336 (fontified t) 1336 1359 (fontified t face font-lock-string-face) 1359 1410 (fontified t) 1410 1413 (fontified t face font-lock-keyword-face) 1413 1414 (fontified t) 1414 1419 (fontified t face font-lock-constant-face) 1419 1421 (fontified t) 1421 1424 (fontified t face font-lock-constant-face) 1424 1426 (fontified t) 1426 1429 (fontified t face font-lock-constant-face) 1429 1431 (fontified t) 1431 1444 (fontified t face font-lock-type-face) 1444 1446 (fontified t) 1446 1449 (fontified t face font-lock-keyword-face) 1449 1450 (fontified t) 1450 1456 (fontified t face font-lock-keyword-face) 1456 1457 (fontified t) 1457 1463 (fontified t face font-lock-type-face) 1463 1470 (fontified t) 1470 1477 (fontified t face font-lock-variable-name-face) 1477 1479 (fontified t) 1479 1492 (fontified t face font-lock-type-face) 1492 1498 (fontified t) 1498 1500 (fontified t face font-lock-variable-name-face) 1500 1502 (fontified t) 1502 1507 (fontified t face font-lock-constant-face) 1507 1509 (fontified t) 1509 1513 (fontified t face font-lock-constant-face) 1513 1515 (fontified t) 1515 1519 (fontified t face font-lock-constant-face) 1519 1521 (fontified t) 1521 1527 (fontified t face font-lock-type-face) 1527 1528 (fontified t) 1528 1537 (fontified t face font-lock-type-face) 1537 1542 (fontified t) 1542 1546 (fontified t face font-lock-keyword-face) 1546 1547 (fontified t) 1547 1553 (fontified t face font-lock-type-face) 1553 1560 (fontified t) 1560 1563 (fontified t face font-lock-keyword-face) 1563 1564 (fontified t) 1564 1566 (fontified t face font-lock-keyword-face) 1566 1567 (fontified t) 1567 1570 (fontified t face font-lock-function-name-face) 1570 1571 (fontified t) 1571 1578 (fontified t face font-lock-variable-name-face) 1578 1580 (fontified t) 1580 1584 (fontified t face font-lock-keyword-face) 1584 1585 (fontified t) 1585 1588 (fontified t face font-lock-constant-face) 1588 1590 (fontified t) 1590 1593 (fontified t face font-lock-constant-face) 1593 1595 (fontified t) 1595 1602 (fontified t face font-lock-type-face) 1602 1604 (fontified t) 1604 1606 (fontified t face font-lock-variable-name-face) 1606 1608 (fontified t) 1608 1613 (fontified t face font-lock-constant-face) 1613 1615 (fontified t) 1615 1619 (fontified t face font-lock-constant-face) 1619 1621 (fontified t) 1621 1625 (fontified t face font-lock-constant-face) 1625 1627 (fontified t) 1627 1633 (fontified t face font-lock-type-face) 1633 1634 (fontified t) 1634 1643 (fontified t face font-lock-type-face) 1643 1647 (fontified t) 1647 1648 (fontified t syntax-table #1#) 1648 1649 (fontified t) 1649 1653 (fontified t face font-lock-type-face) 1653 1664 (fontified t) 1664 1667 (fontified t face font-lock-keyword-face) 1667 1668 (fontified t) 1668 1675 (fontified t face font-lock-variable-name-face) 1675 1752 (fontified t) 1752 1756 (fontified t face font-lock-string-face) 1756 1777 (face font-lock-string-face fontified t) 1777 1780 (fontified t) 1780 1788 (fontified t) 1788 1791 (fontified t face font-lock-keyword-face) 1791 1792 (fontified t) 1792 1799 (fontified t face font-lock-variable-name-face) 1799 1802 (fontified t) 1802 1811 (fontified t face font-lock-type-face) 1811 1822 (fontified t) 1822 1832 (fontified t) 1832 1840 (fontified t) 1840 1844 (fontified t face font-lock-type-face) 1844 1869 (fontified t) 1869 1873 (fontified t face font-lock-keyword-face) 1873 1874 (fontified t) 1874 1880 (fontified t face font-lock-type-face) 1880 1881 (fontified t) 1881 1884 (fontified t face font-lock-keyword-face) 1884 1885 (fontified t) 1885 1891 (fontified t face font-lock-type-face) 1891 1898 (fontified t) 1898 1902 (fontified t face font-lock-keyword-face) 1902 1903 (fontified t) 1903 1907 (fontified t face font-lock-type-face) 1907 1918 (fontified t) 1918 1922 (fontified t face font-lock-keyword-face) 1922 1923 (fontified t) 1923 1928 (fontified t face font-lock-type-face) 1928 1940 (fontified t) 1940 1942 (fontified t face font-lock-keyword-face) 1942 1943 (fontified t) 1943 1947 (fontified t face font-lock-function-name-face) 1947 1949 (fontified t) 1949 1952 (fontified t face font-lock-keyword-face) 1952 1953 (fontified t) 1953 1957 (fontified t face font-lock-keyword-face) 1957 1960 (fontified t) 1960 1961 (syntax-table #1# fontified t) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-type-face) 1966 1967 (fontified t) 1967 1971 (fontified t face font-lock-type-face) 1971 1973 (fontified t) 1973 1977 (fontified t face font-lock-type-face) 1977 1979 (fontified t) 1979 1983 (fontified t face font-lock-type-face) 1983 1985 (fontified t) 1985 1990 (fontified t face font-lock-type-face) 1990 2002 (fontified t) 2002 2007 (fontified t face font-lock-keyword-face) 2007 2008 (fontified t) 2008 2012 (fontified t face font-lock-keyword-face) 2012 2042 (fontified t) 2042 2044 (fontified t face font-lock-type-face) 2044 2045 (fontified t) 2045 2050 (fontified t face font-lock-type-face) 2050 2052 (fontified t) 2052 2057 (fontified t face font-lock-type-face) 2057 2068 (fontified t) 2068 2069 (syntax-table #1# fontified t) 2069 2088 (fontified t) 2088 2092 (fontified t face font-lock-keyword-face) 2092 2128 (fontified t) 2128 2144 (fontified t face font-lock-string-face) 2144 2163 (fontified t) 2163 2165 (fontified t face font-lock-type-face) 2165 2166 (fontified t) 2166 2171 (fontified t face font-lock-type-face) 2171 2173 (fontified t) 2173 2178 (fontified t face font-lock-type-face) 2178 2210 (fontified t) 2210 2212 (fontified t face font-lock-type-face) 2212 2213 (fontified t) 2213 2218 (fontified t face font-lock-type-face) 2218 2220 (fontified t) 2220 2228 (fontified t face font-lock-type-face) 2228 2231 (fontified t) 2231 2232 (syntax-table #1# fontified t) 2232 2233 (fontified t) 2233 2235 (fontified t face font-lock-type-face) 2235 2236 (fontified t) 2236 2241 (fontified t face font-lock-type-face) 2241 2243 (fontified t) 2243 2251 (fontified t face font-lock-type-face) 2251 2266 (fontified t) 2266 2269 (fontified t face font-lock-type-face) 2269 2274 (fontified t) 2274 2275 (syntax-table #1# fontified t) 2275 2280 (fontified t) 2280 2294 (fontified t) 2294 2299 (face font-lock-preprocessor-face fontified t) 2299 2300 (fontified t) 2300 2323 (face font-lock-string-face fontified t) 2323 2329 (fontified t) 2329 2345 (fontified t) 2345 2347 (fontified t face font-lock-type-face) 2347 2348 (fontified t) 2348 2353 (fontified t face font-lock-type-face) 2353 2355 (fontified t) 2355 2360 (fontified t face font-lock-type-face) 2360 2399 (fontified t) 2399 2402 (fontified t face font-lock-keyword-face) 2402 2403 (fontified t) 2403 2409 (fontified t face font-lock-keyword-face) 2409 2410 (fontified t) 2410 2416 (fontified t face font-lock-type-face) 2416 2421 (fontified t) 2421 2425 (fontified t face font-lock-keyword-face) 2425 2426 (fontified t) 2426 2432 (fontified t face font-lock-type-face) 2432 2439 (fontified t) 2439 2442 (fontified t face font-lock-keyword-face) 2442 2443 (fontified t) 2443 2445 (fontified t face font-lock-keyword-face) 2445 2446 (fontified t) 2446 2450 (fontified t face font-lock-function-name-face) 2450 2460 (fontified t) 2460 2468 (fontified t face font-lock-variable-name-face) 2468 2470 (fontified t) 2470 2474 (fontified t face font-lock-keyword-face) 2474 2475 (fontified t) 2475 2478 (fontified t face font-lock-constant-face) 2478 2480 (fontified t) 2480 2483 (fontified t face font-lock-constant-face) 2483 2485 (fontified t) 2485 2492 (fontified t face font-lock-type-face) 2492 2502 (fontified t) 2502 2506 (fontified t face font-lock-variable-name-face) 2506 2509 (fontified t) 2509 2513 (fontified t face font-lock-type-face) 2513 2523 (fontified t) 2523 2532 (fontified t face font-lock-variable-name-face) 2532 2534 (fontified t) 2534 2537 (fontified t face font-lock-type-face) 2537 2538 (fontified t) 2538 2543 (fontified t face font-lock-type-face) 2543 2544 (fontified t) 2544 2552 (fontified t face font-lock-type-face) 2552 2553 (fontified t) 2553 2562 (fontified t face font-lock-type-face) 2562 2575 (fontified t) 2575 2585 (fontified t face font-lock-variable-name-face) 2585 2587 (fontified t) 2587 2590 (fontified t face font-lock-type-face) 2590 2591 (fontified t) 2591 2596 (fontified t face font-lock-type-face) 2596 2597 (fontified t) 2597 2606 (fontified t face font-lock-type-face) 2606 2607 (fontified t) 2607 2616 (fontified t face font-lock-type-face) 2616 2628 (fontified t) 2628 2629 (syntax-table #1# fontified t) 2629 2630 (fontified t) 2630 2636 (fontified t face font-lock-constant-face) 2636 2638 (fontified t) 2638 2646 (fontified t face font-lock-type-face) 2646 2657 (fontified t) 2657 2662 (fontified t face font-lock-keyword-face) 2662 2663 (fontified t) 2663 2679 (fontified t face font-lock-type-face) 2679 2685 (fontified t) 2685 2693 (fontified t face font-lock-type-face) 2693 2695 (fontified t) 2695 2702 (fontified t face font-lock-type-face) 2702 2704 (fontified t) 2704 2705 (syntax-table #1# fontified t) 2705 2706 (fontified t) 2706 2721 (fontified t face font-lock-type-face) 2721 2727 (fontified t) 2727 2735 (fontified t face font-lock-type-face) 2735 2737 (fontified t) 2737 2744 (fontified t face font-lock-type-face) 2744 2760 (fontified t) 2760 2766 (fontified t face font-lock-constant-face) 2766 2774 (fontified t) 2774 2778 (fontified t face font-lock-constant-face) 2778 2780 (fontified t) 2780 2788 (fontified t face font-lock-type-face) 2788 2828 (fontified t) 2828 2829 (fontified t face font-lock-keyword-face) 2829 2831 (face font-lock-keyword-face fontified t) 2831 2832 (fontified t) 2832 2847 (face font-lock-variable-name-face fontified t) 2847 2850 (fontified t) 2850 2866 (face font-lock-type-face fontified t) 2866 2880 (fontified t) 2880 2888 (face font-lock-type-face fontified t) 2888 2890 (fontified t) 2890 2897 (face font-lock-type-face fontified t) 2897 2904 (fontified t) 2904 2912 (fontified t) 2912 2917 (fontified t face font-lock-preprocessor-face) 2917 2918 (fontified t) 2918 2945 (fontified t face font-lock-string-face) 2945 2974 (fontified t) 2974 2977 (fontified t face font-lock-keyword-face) 2977 2978 (fontified t) 2978 2986 (fontified t face font-lock-variable-name-face) 2986 3011 (fontified t) 3011 3019 (fontified t) 3019 3022 (fontified t face font-lock-keyword-face) 3022 3023 (fontified t) 3023 3048 (fontified t face font-lock-variable-name-face) 3048 3051 (fontified t) 3051 3057 (fontified t face font-lock-constant-face) 3057 3059 (fontified t) 3059 3067 (fontified t face font-lock-type-face) 3067 3073 (fontified t) 3073 3084 (fontified t) 3084 3094 (fontified t) 3094 3113 (fontified t) 3113 3155 (fontified t)) . 1) (undo-tree-id2915 . -2904) (undo-tree-id2916 . 61) (undo-tree-id2917 . -1540) (undo-tree-id2918 . -2904) (undo-tree-id2919 . -2468) (undo-tree-id2920 . -2450) (undo-tree-id2921 . -1542) (undo-tree-id2922 . -2468) (undo-tree-id2923 . -2468) (undo-tree-id2924 . -2468) (undo-tree-id2925 . -2468) (undo-tree-id2926 . -3061) (undo-tree-id2927 . -3060) (undo-tree-id2928 . -2329) (undo-tree-id2929 . -3061) (undo-tree-id2930 . -3061) (undo-tree-id2931 . -2329) (undo-tree-id2932 . -2468) (undo-tree-id2933 . -3061) (undo-tree-id2934 . -3061) (undo-tree-id2935 . -2904) (undo-tree-id2936 . -2820) (undo-tree-id2937 . -1540) (undo-tree-id2938 . -3061) (undo-tree-id2939 . -2904) (undo-tree-id2940 . -3041) (undo-tree-id2941 . -3041) (undo-tree-id2942 . -2254) (undo-tree-id2943 . -3042) (undo-tree-id2944 . -3041) (undo-tree-id2945 . -2254) (undo-tree-id2946 . -3042) (undo-tree-id2947 . -2254) (undo-tree-id2948 . -3042) (undo-tree-id2949 . -3093) (undo-tree-id2950 . -3073) (undo-tree-id2951 . -3073) (undo-tree-id2952 . -3073) (undo-tree-id2953 . -3084) (undo-tree-id2954 . -3084) (undo-tree-id2955 . -2254) (undo-tree-id2956 . -3084) (undo-tree-id2957 . -3084) (undo-tree-id2958 . -264) (undo-tree-id2959 . -268) (undo-tree-id2960 . -3084) (undo-tree-id2961 . -3084) (undo-tree-id2962 . -264) (undo-tree-id2963 . -276) (undo-tree-id2964 . -3084) (undo-tree-id2965 . -3084) (undo-tree-id2966 . -2254) (undo-tree-id2967 . -3084) (undo-tree-id2968 . -3084) (undo-tree-id2969 . -2254) (undo-tree-id2970 . -3084) (undo-tree-id2971 . -3084) (undo-tree-id2972 . -2254) (undo-tree-id2973 . -3084) (undo-tree-id2974 . -3084) (undo-tree-id2975 . -2254) (undo-tree-id2976 . -3094) (undo-tree-id2977 . -3084) (undo-tree-id2978 . -2254) (undo-tree-id2979 . -3093) (undo-tree-id2980 . -3093) (undo-tree-id2981 . -2254) 3094) nil (23751 25913 51262 254000) 0 nil]) ((3085 . 3095) (#("write_h" 0 7 (fontified t)) . -3085) (undo-tree-id2982 . -7) (undo-tree-id2983 . -5) (undo-tree-id2984 . -5) (undo-tree-id2985 . -5) (undo-tree-id2986 . -1) (undo-tree-id2987 . -4) (undo-tree-id2988 . -5) (undo-tree-id2989 . -5) (undo-tree-id2990 . -6) (undo-tree-id2991 . -5) (undo-tree-id2992 . -7) (undo-tree-id2993 . -6) (undo-tree-id2994 . -7) (undo-tree-id2995 . -7) 3092 (3090 . 3092) (#("!" 0 1 (fontified t)) . -3090) (undo-tree-id2996 . -1) (undo-tree-id2997 . -1) 3091 (3085 . 3091) (#("writ" 0 4 (fontified t)) . -3085) (undo-tree-id2998 . -4) 3089 (3083 . 3089) (3074 . 3083) (#("read" 0 4 (fontified t)) . -3074) (undo-tree-id2999 . -4) 3078 (3076 . 3078) (3074 . 3076) (#("socket" 0 6 (fontified t)) . 3074) (undo-tree-id3000 . -6) (undo-tree-id3001 . -6) (undo-tree-id3002 . -6) (undo-tree-id3003 . -6) (undo-tree-id3004 . -6) (undo-tree-id3005 . -6) (undo-tree-id3006 . -6) (undo-tree-id3007 . -6) (undo-tree-id3008 . -6) (undo-tree-id3009 . -6) (undo-tree-id3010 . -6) (undo-tree-id3011 . -6) (undo-tree-id3012 . -6) (undo-tree-id3013 . -6) (undo-tree-id3014 . -6) (undo-tree-id3015 . -6) (undo-tree-id3016 . -6) (undo-tree-id3017 . -6) (undo-tree-id3018 . -6) (undo-tree-id3019 . -6) (undo-tree-id3020 . -6) (undo-tree-id3021 . -6) (undo-tree-id3022 . -6) (undo-tree-id3023 . -6) (undo-tree-id3024 . -6) (undo-tree-id3025 . -2) (undo-tree-id3026 . -1) (undo-tree-id3027 . -2) (undo-tree-id3028 . -1) 3076 (t 23751 25735 152199 770000)) nil (23751 25913 51319 736000) 0 nil]) ((#("Read, AsyncWrite, Error, " 0 4 (fontified t face font-lock-type-face) 4 6 (fontified t) 6 16 (fontified t face font-lock-type-face) 16 18 (fontified t) 18 23 (fontified t face font-lock-type-face) 23 25 (fontified t)) . 212) (undo-tree-id2905 . -18) (undo-tree-id2906 . -23) (undo-tree-id2907 . -6) (undo-tree-id2908 . -16) (undo-tree-id2909 . -4) (undo-tree-id2910 . -4) (undo-tree-id2911 . -6) (undo-tree-id2912 . -16) (undo-tree-id2913 . -18) (undo-tree-id2914 . -23)) nil (23751 25735 53787 721000) 0 nil]) ((#("Async" 0 5 (fontified t face font-lock-type-face)) . 212) (t 23751 25725 905630 692000)) nil (23751 25735 53794 94000) 0 nil]) ((1 . 3171) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;
use tokio::io::{AsyncRead, AsyncWrite, Error, ReadHalf, WriteHalf};

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(
        timeline: impl std::fmt::Display,
        user: &User,
        read_half: Arc<Mutex<ReadHalf<TcpStream>>>,
        write_half: Arc<Mutex<WriteHalf<TcpStream>>>,
    ) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 41 (fontified t) 41 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 209 (fontified t face font-lock-constant-face) 209 211 (fontified t) 211 220 (fontified t face font-lock-type-face) 220 222 (fontified t) 222 225 (fontified t face font-lock-keyword-face) 225 226 (fontified t) 226 230 (fontified t face font-lock-constant-face) 230 232 (fontified t) 232 238 (fontified t face font-lock-type-face) 238 239 (fontified t) 239 240 (fontified t rear-nonsticky t) 240 243 (fontified t face font-lock-keyword-face) 243 244 (fontified t) 244 249 (fontified t face font-lock-constant-face) 249 251 (fontified t) 251 253 (fontified t face font-lock-constant-face) 253 256 (fontified t) 256 265 (fontified t face font-lock-type-face) 265 267 (fontified t) 267 277 (fontified t face font-lock-type-face) 277 279 (fontified t) 279 284 (fontified t face font-lock-type-face) 284 286 (fontified t) 286 294 (fontified t face font-lock-type-face) 294 296 (fontified t) 296 305 (fontified t face font-lock-type-face) 305 307 (fontified t) 307 308 (fontified t) 308 309 (fontified t) 309 312 (fontified t face font-lock-keyword-face) 312 313 (fontified t) 313 319 (fontified t face font-lock-keyword-face) 319 320 (fontified t) 320 336 (fontified t face font-lock-variable-name-face) 336 338 (fontified t) 338 349 (fontified t face font-lock-type-face) 349 352 (fontified t) 352 363 (fontified t face font-lock-type-face) 363 373 (fontified t) 373 376 (fontified t face font-lock-keyword-face) 376 377 (fontified t) 377 383 (fontified t face font-lock-keyword-face) 383 384 (fontified t) 384 399 (fontified t face font-lock-variable-name-face) 399 401 (fontified t) 401 412 (fontified t face font-lock-type-face) 412 415 (fontified t) 415 426 (fontified t face font-lock-type-face) 426 439 (fontified t) 439 442 (fontified t face font-lock-keyword-face) 442 443 (fontified t) 443 449 (fontified t face font-lock-keyword-face) 449 450 (fontified t) 450 458 (fontified t face font-lock-type-face) 458 465 (fontified t) 465 473 (fontified t face font-lock-variable-name-face) 473 475 (fontified t) 475 481 (fontified t face font-lock-type-face) 481 485 (fontified t) 485 489 (fontified t face font-lock-keyword-face) 489 490 (fontified t) 490 498 (fontified t face font-lock-type-face) 498 505 (fontified t) 505 507 (fontified t face font-lock-keyword-face) 507 508 (fontified t) 508 511 (fontified t face font-lock-function-name-face) 511 512 (fontified t) 512 515 (fontified t face font-lock-variable-name-face) 515 517 (fontified t) 517 521 (fontified t face font-lock-keyword-face) 521 522 (fontified t) 522 525 (fontified t face font-lock-constant-face) 525 527 (fontified t) 527 530 (fontified t face font-lock-constant-face) 530 532 (fontified t) 532 539 (fontified t face font-lock-type-face) 539 541 (fontified t) 541 544 (fontified t face font-lock-variable-name-face) 544 546 (fontified t) 546 550 (fontified t face font-lock-keyword-face) 550 551 (fontified t) 551 554 (fontified t face font-lock-constant-face) 554 556 (fontified t) 556 559 (fontified t face font-lock-constant-face) 559 561 (fontified t) 561 568 (fontified t face font-lock-type-face) 568 571 (fontified t) 571 572 (syntax-table #1# fontified t) 572 573 (fontified t) 573 577 (fontified t face font-lock-type-face) 577 587 (fontified t) 587 588 (fontified t) 588 591 (fontified t face font-lock-keyword-face) 591 609 (fontified t) 609 641 (fontified t) 641 649 (fontified t) 649 652 (fontified t face font-lock-keyword-face) 652 653 (fontified t) 653 661 (fontified t face font-lock-variable-name-face) 661 664 (fontified t) 664 671 (fontified t face rust-builtin-formatting-macro-face) 671 685 (fontified t) 685 693 (fontified t face font-lock-string-face) 693 705 (fontified t face rust-string-interpolation-face) 705 709 (fontified t face font-lock-string-face) 709 714 (fontified t face rust-string-interpolation-face) 714 719 (fontified t face font-lock-string-face) 719 731 (fontified t face rust-string-interpolation-face) 731 735 (fontified t face font-lock-string-face) 735 740 (fontified t face rust-string-interpolation-face) 740 745 (fontified t face font-lock-string-face) 745 808 (fontified t) 808 842 (fontified t) 842 883 (fontified t) 883 887 (fontified t face font-lock-type-face) 887 911 (fontified t) 911 914 (fontified t face font-lock-keyword-face) 914 915 (fontified t) 915 917 (fontified t face font-lock-keyword-face) 917 918 (fontified t) 918 939 (fontified t face font-lock-function-name-face) 939 940 (fontified t) 940 948 (fontified t face font-lock-variable-name-face) 948 951 (fontified t) 951 954 (fontified t face font-lock-type-face) 954 957 (fontified t) 957 958 (syntax-table #1# fontified t) 958 959 (fontified t) 959 965 (fontified t face font-lock-type-face) 965 976 (fontified t) 976 979 (fontified t face font-lock-keyword-face) 979 980 (fontified t) 980 987 (fontified t face font-lock-variable-name-face) 987 990 (fontified t) 990 997 (fontified t face rust-builtin-formatting-macro-face) 997 998 (fontified t) 998 1008 (fontified t face font-lock-string-face) 1008 1010 (fontified t face rust-string-interpolation-face) 1010 1011 (fontified t face font-lock-string-face) 1011 1032 (fontified t) 1032 1035 (fontified t face font-lock-keyword-face) 1035 1036 (fontified t) 1036 1045 (fontified t face font-lock-variable-name-face) 1045 1048 (fontified t) 1048 1056 (fontified t face font-lock-type-face) 1056 1062 (fontified t) 1062 1073 (fontified t face font-lock-string-face) 1073 1094 (fontified t) 1094 1099 (fontified t face font-lock-preprocessor-face) 1099 1100 (fontified t) 1100 1119 (fontified t face font-lock-string-face) 1119 1141 (fontified t) 1141 1159 (fontified t) 1159 1169 (fontified t) 1169 1172 (fontified t face font-lock-keyword-face) 1172 1173 (fontified t) 1173 1175 (fontified t face font-lock-keyword-face) 1175 1176 (fontified t) 1176 1201 (fontified t face font-lock-function-name-face) 1201 1202 (fontified t) 1202 1210 (fontified t face font-lock-variable-name-face) 1210 1213 (fontified t) 1213 1216 (fontified t face font-lock-type-face) 1216 1219 (fontified t) 1219 1220 (syntax-table #1# fontified t) 1220 1221 (fontified t) 1221 1227 (fontified t face font-lock-type-face) 1227 1238 (fontified t) 1238 1241 (fontified t face font-lock-keyword-face) 1241 1242 (fontified t) 1242 1249 (fontified t face font-lock-variable-name-face) 1249 1252 (fontified t) 1252 1259 (fontified t face rust-builtin-formatting-macro-face) 1259 1260 (fontified t) 1260 1270 (fontified t face font-lock-string-face) 1270 1272 (fontified t face rust-string-interpolation-face) 1272 1273 (fontified t face font-lock-string-face) 1273 1294 (fontified t) 1294 1297 (fontified t face font-lock-keyword-face) 1297 1298 (fontified t) 1298 1309 (fontified t face font-lock-variable-name-face) 1309 1312 (fontified t) 1312 1320 (fontified t face font-lock-type-face) 1320 1326 (fontified t) 1326 1339 (fontified t face font-lock-string-face) 1339 1342 (fontified t) 1342 1352 (fontified t) 1352 1360 (fontified t) 1360 1365 (fontified t face font-lock-preprocessor-face) 1365 1366 (fontified t) 1366 1389 (fontified t face font-lock-string-face) 1389 1440 (fontified t) 1440 1443 (fontified t face font-lock-keyword-face) 1443 1444 (fontified t) 1444 1449 (fontified t face font-lock-constant-face) 1449 1451 (fontified t) 1451 1454 (fontified t face font-lock-constant-face) 1454 1456 (fontified t) 1456 1459 (fontified t face font-lock-constant-face) 1459 1461 (fontified t) 1461 1474 (fontified t face font-lock-type-face) 1474 1476 (fontified t) 1476 1479 (fontified t face font-lock-keyword-face) 1479 1480 (fontified t) 1480 1486 (fontified t face font-lock-keyword-face) 1486 1487 (fontified t) 1487 1493 (fontified t face font-lock-type-face) 1493 1500 (fontified t) 1500 1507 (fontified t face font-lock-variable-name-face) 1507 1509 (fontified t) 1509 1522 (fontified t face font-lock-type-face) 1522 1528 (fontified t) 1528 1530 (fontified t face font-lock-variable-name-face) 1530 1532 (fontified t) 1532 1537 (fontified t face font-lock-constant-face) 1537 1539 (fontified t) 1539 1543 (fontified t face font-lock-constant-face) 1543 1545 (fontified t) 1545 1549 (fontified t face font-lock-constant-face) 1549 1551 (fontified t) 1551 1557 (fontified t face font-lock-type-face) 1557 1558 (fontified t) 1558 1567 (fontified t face font-lock-type-face) 1567 1572 (fontified t) 1572 1576 (fontified t face font-lock-keyword-face) 1576 1577 (fontified t) 1577 1583 (fontified t face font-lock-type-face) 1583 1590 (fontified t) 1590 1593 (fontified t face font-lock-keyword-face) 1593 1594 (fontified t) 1594 1596 (fontified t face font-lock-keyword-face) 1596 1597 (fontified t) 1597 1600 (fontified t face font-lock-function-name-face) 1600 1601 (fontified t) 1601 1608 (fontified t face font-lock-variable-name-face) 1608 1610 (fontified t) 1610 1614 (fontified t face font-lock-keyword-face) 1614 1615 (fontified t) 1615 1618 (fontified t face font-lock-constant-face) 1618 1620 (fontified t) 1620 1623 (fontified t face font-lock-constant-face) 1623 1625 (fontified t) 1625 1632 (fontified t face font-lock-type-face) 1632 1634 (fontified t) 1634 1636 (fontified t face font-lock-variable-name-face) 1636 1638 (fontified t) 1638 1643 (fontified t face font-lock-constant-face) 1643 1645 (fontified t) 1645 1649 (fontified t face font-lock-constant-face) 1649 1651 (fontified t) 1651 1655 (fontified t face font-lock-constant-face) 1655 1657 (fontified t) 1657 1659 (fontified t face font-lock-type-face) 1659 1663 (fontified t face font-lock-type-face) 1663 1664 (fontified t) 1664 1673 (fontified t face font-lock-type-face) 1673 1677 (fontified t) 1677 1678 (syntax-table #1# fontified t) 1678 1679 (fontified t) 1679 1683 (fontified t face font-lock-type-face) 1683 1686 (fontified t) 1686 1694 (fontified t) 1694 1697 (fontified t face font-lock-keyword-face) 1697 1698 (fontified t) 1698 1705 (fontified t face font-lock-variable-name-face) 1705 1782 (fontified t) 1782 1807 (fontified t face font-lock-string-face) 1807 1818 (fontified t) 1818 1821 (fontified t face font-lock-keyword-face) 1821 1822 (fontified t) 1822 1829 (fontified t face font-lock-variable-name-face) 1829 1832 (fontified t) 1832 1841 (fontified t face font-lock-type-face) 1841 1852 (fontified t) 1852 1862 (fontified t) 1870 1874 (face font-lock-type-face) 1899 1903 (face font-lock-keyword-face) 1904 1910 (face font-lock-type-face) 1911 1914 (face font-lock-keyword-face) 1915 1921 (face font-lock-type-face) 1928 1932 (face font-lock-keyword-face) 1933 1937 (face font-lock-type-face) 1948 1952 (face font-lock-keyword-face) 1953 1958 (face font-lock-type-face) 1970 1972 (face font-lock-keyword-face) 1973 1977 (face font-lock-function-name-face) 1979 1982 (face font-lock-keyword-face) 1983 1987 (face font-lock-keyword-face) 1990 1991 (syntax-table #1#) 1992 1996 (face font-lock-type-face) 1997 2001 (face font-lock-type-face) 2003 2007 (face font-lock-type-face) 2009 2013 (face font-lock-type-face) 2015 2020 (face font-lock-type-face) 2032 2037 (face font-lock-keyword-face) 2038 2042 (face font-lock-keyword-face) 2072 2074 (face font-lock-type-face) 2075 2080 (face font-lock-type-face) 2082 2087 (face font-lock-type-face) 2098 2099 (syntax-table #1#) 2118 2122 (face font-lock-keyword-face) 2158 2174 (face font-lock-string-face) 2193 2195 (face font-lock-type-face) 2196 2201 (face font-lock-type-face) 2203 2208 (face font-lock-type-face) 2240 2242 (face font-lock-type-face) 2243 2248 (face font-lock-type-face) 2250 2258 (face font-lock-type-face) 2261 2262 (syntax-table #1#) 2263 2265 (face font-lock-type-face) 2266 2271 (face font-lock-type-face) 2273 2281 (face font-lock-type-face) 2296 2299 (face font-lock-type-face) 2304 2305 (syntax-table #1#) 2324 2329 (face font-lock-preprocessor-face) 2330 2353 (face font-lock-string-face) 2375 2377 (face font-lock-type-face) 2378 2383 (face font-lock-type-face) 2385 2390 (face font-lock-type-face) 2429 2432 (face font-lock-keyword-face) 2433 2439 (face font-lock-keyword-face) 2440 2446 (face font-lock-type-face) 2451 2455 (face font-lock-keyword-face) 2456 2462 (face font-lock-type-face) 2469 2472 (face font-lock-keyword-face) 2473 2475 (face font-lock-keyword-face) 2476 2480 (face font-lock-function-name-face) 2490 2498 (face font-lock-variable-name-face) 2500 2504 (face font-lock-keyword-face) 2505 2508 (face font-lock-constant-face) 2510 2513 (face font-lock-constant-face) 2515 2522 (face font-lock-type-face) 2532 2536 (face font-lock-variable-name-face) 2539 2543 (face font-lock-type-face) 2553 2562 (face font-lock-variable-name-face) 2564 2567 (face font-lock-type-face) 2568 2573 (face font-lock-type-face) 2574 2582 (face font-lock-type-face) 2583 2592 (face font-lock-type-face) 2604 2605 (rear-nonsticky t) 2605 2610 (face font-lock-variable-name-face) 2610 2615 (face font-lock-variable-name-face) 2617 2620 (face font-lock-type-face) 2621 2626 (face font-lock-type-face) 2627 2636 (face font-lock-type-face) 2637 2646 (face font-lock-type-face) 2658 2659 (syntax-table #1#) 2660 2666 (face font-lock-constant-face) 2668 2676 (face font-lock-type-face) 2687 2692 (face font-lock-keyword-face) 2693 2709 (face font-lock-type-face) 2715 2723 (face font-lock-type-face) 2725 2732 (face font-lock-type-face) 2734 2735 (syntax-table #1#) 2736 2751 (face font-lock-type-face) 2757 2765 (face font-lock-type-face) 2767 2774 (face font-lock-type-face) 2790 2796 (face font-lock-constant-face) 2804 2808 (face font-lock-constant-face) 2810 2818 (face font-lock-type-face) 2858 2861 (face font-lock-keyword-face) 2862 2877 (face font-lock-variable-name-face) 2880 2896 (face font-lock-type-face) 2910 2918 (face font-lock-type-face) 2920 2927 (face font-lock-type-face) 2942 2947 (face font-lock-preprocessor-face) 2948 2975 (face font-lock-string-face) 3004 3007 (face font-lock-keyword-face) 3008 3016 (face font-lock-variable-name-face) 3049 3052 (face font-lock-keyword-face) 3053 3078 (face font-lock-variable-name-face) 3081 3087 (face font-lock-constant-face) 3089 3097 (face font-lock-type-face)) . 1) (undo-tree-id2804 . -307) (undo-tree-id2805 . 533) (undo-tree-id2806 . -240) (undo-tree-id2807 . -307) (undo-tree-id2808 . -1586) (undo-tree-id2809 . -2579) (undo-tree-id2810 . -19) (undo-tree-id2811 . -19) (undo-tree-id2812 . -3100) (undo-tree-id2813 . -3101) (undo-tree-id2814 . -2308) (undo-tree-id2815 . -19) (undo-tree-id2816 . -3100) (undo-tree-id2817 . -3100) (undo-tree-id2818 . -3100) (undo-tree-id2819 . -3100) (undo-tree-id2820 . -3100) (undo-tree-id2821 . -3100) (undo-tree-id2822 . -3100) (undo-tree-id2823 . -228) (undo-tree-id2824 . -229) (undo-tree-id2825 . -228) (undo-tree-id2826 . -228) (undo-tree-id2827 . -3100) (undo-tree-id2828 . -228) (undo-tree-id2829 . -228) (undo-tree-id2830 . -2030) (undo-tree-id2831 . -2066) (undo-tree-id2832 . -1586) (undo-tree-id2833 . -2030) (undo-tree-id2834 . -2030) (undo-tree-id2835 . -1586) (undo-tree-id2836 . -228) (undo-tree-id2837 . -2030) (undo-tree-id2838 . -2638) (undo-tree-id2839 . -2647) (undo-tree-id2840 . -4) (undo-tree-id2841 . -17) (undo-tree-id2842 . -23) (undo-tree-id2843 . -40) (undo-tree-id2844 . -130) (undo-tree-id2845 . -138) (undo-tree-id2846 . -157) (undo-tree-id2847 . -160) (undo-tree-id2848 . -162) (undo-tree-id2849 . -167) (undo-tree-id2850 . -180) (undo-tree-id2851 . -186) (undo-tree-id2852 . -188) (undo-tree-id2853 . -192) (undo-tree-id2854 . -2574) (undo-tree-id2855 . -2582) (undo-tree-id2856 . -2627) (undo-tree-id2857 . -2636) (undo-tree-id2858 . -3103) (undo-tree-id2859 . -3109) (undo-tree-id2860 . -2469) (undo-tree-id2861 . -3167) (undo-tree-id2862 . -2469) (undo-tree-id2863 . -2472) (undo-tree-id2864 . -3103) (undo-tree-id2865 . -3109) (undo-tree-id2866 . -2627) (undo-tree-id2867 . -2636) (undo-tree-id2868 . -2574) (undo-tree-id2869 . -2582) (undo-tree-id2870 . -2574) (undo-tree-id2871 . -2582) (undo-tree-id2872 . -2627) (undo-tree-id2873 . -2636) (undo-tree-id2874 . -3103) (undo-tree-id2875 . -3109) (undo-tree-id2876 . -2469) (undo-tree-id2877 . -3167) (undo-tree-id2878 . -2579) (undo-tree-id2879 . -2580) (undo-tree-id2880 . -1586) (undo-tree-id2881 . -2650) (undo-tree-id2882 . -2579) (undo-tree-id2883 . -2579) (undo-tree-id2884 . -2579) (undo-tree-id2885 . -2579) (undo-tree-id2886 . -1586) (undo-tree-id2887 . -2579) (undo-tree-id2888 . -2579) (undo-tree-id2889 . -2579) (undo-tree-id2890 . -2579) (undo-tree-id2891 . -1586) (undo-tree-id2892 . -240) (undo-tree-id2893 . -93) (undo-tree-id2894 . -78) (undo-tree-id2895 . -141) (undo-tree-id2896 . -93) (undo-tree-id2897 . -170) (undo-tree-id2898 . -141) (undo-tree-id2899 . -195) (undo-tree-id2900 . -170) (undo-tree-id2901 . -222) (undo-tree-id2902 . -195) (undo-tree-id2903 . -240) (undo-tree-id2904 . -222) 241) nil (23751 25725 795240 563000) 0 nil]) ((nil rear-nonsticky nil 240 . 241) (#("
" 0 1 (fontified nil)) . -308) (240 . 309) 223) nil (23751 25725 795270 629000) 0 nil]) ((2579 . 2580) (#(">" 0 1 (fontified t)) . -2570) (2569 . 2571) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2569) (2569 . 2570) (2560 . 2569)) nil (23751 25725 795280 973000) 0 nil]) ((2525 . 2526) (#(">" 0 1 (fontified t)) . -2516) (2515 . 2517) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2515) (2507 . 2516)) nil (23751 25725 795289 742000) 0 nil]) ((2528 . 2533) (#("read" 0 4 (fontified t face font-lock-variable-name-face)) . 2528)) nil (23751 25725 795295 141000) 0 nil]) ((nil rear-nonsticky nil 2527 . 2528) (#("
" 0 1 (fontified nil)) . -2561) (2519 . 2562) 2494) nil (23751 25725 795300 962000) 0 nil]) ((2486 . 2495) (#("socket" 0 6 (fontified t face font-lock-variable-name-face)) . 2486) (t 23751 24710 31328 113000)) nil (23751 25725 795306 562000) 0 nil]) ((1 . 3036) (#("use crate::stream;
use std::sync::{Arc, Mutex};
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
pub struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    pub fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(
        timeline: impl std::fmt::Display,
        user: &User,
        socket: Arc<Mutex<TcpStream>>,
    ) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t rear-nonsticky t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 26 (fontified t face font-lock-constant-face) 26 28 (fontified t) 28 32 (fontified t face font-lock-constant-face) 32 35 (fontified t) 35 38 (fontified t face font-lock-type-face) 38 40 (fontified t) 40 45 (fontified t face font-lock-type-face) 45 47 (fontified t) 47 48 (fontified t) 48 51 (fontified t face font-lock-keyword-face) 51 52 (fontified t) 52 57 (fontified t face font-lock-keyword-face) 57 59 (fontified t) 59 63 (fontified t face font-lock-constant-face) 63 65 (fontified t) 65 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 74 (fontified t face font-lock-keyword-face) 74 75 (fontified t) 75 82 (fontified t face font-lock-constant-face) 82 85 (fontified t) 85 90 (fontified t face font-lock-type-face) 90 92 (fontified t) 92 98 (fontified t face font-lock-type-face) 98 100 (fontified t) 100 104 (fontified t face font-lock-type-face) 104 107 (fontified t) 107 110 (fontified t face font-lock-keyword-face) 110 111 (fontified t) 111 114 (fontified t face font-lock-constant-face) 114 122 (fontified t) 122 125 (fontified t face font-lock-keyword-face) 125 126 (fontified t) 126 129 (fontified t face font-lock-constant-face) 129 131 (fontified t) 131 135 (fontified t face font-lock-constant-face) 135 137 (fontified t) 137 143 (fontified t face font-lock-constant-face) 143 146 (fontified t) 146 157 (fontified t face font-lock-type-face) 157 159 (fontified t) 159 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 209 (fontified t face font-lock-constant-face) 209 211 (fontified t) 211 220 (fontified t face font-lock-type-face) 220 222 (fontified t) 222 225 (fontified t face font-lock-keyword-face) 225 226 (fontified t) 226 230 (fontified t face font-lock-constant-face) 230 232 (fontified t) 232 238 (fontified t face font-lock-type-face) 238 241 (fontified t) 241 244 (fontified t face font-lock-keyword-face) 244 245 (fontified t) 245 251 (fontified t face font-lock-keyword-face) 251 252 (fontified t) 252 268 (fontified t face font-lock-variable-name-face) 268 270 (fontified t) 270 281 (fontified t face font-lock-type-face) 281 284 (fontified t) 284 295 (fontified t face font-lock-type-face) 295 305 (fontified t) 305 308 (fontified t face font-lock-keyword-face) 308 309 (fontified t) 309 315 (fontified t face font-lock-keyword-face) 315 316 (fontified t) 316 331 (fontified t face font-lock-variable-name-face) 331 333 (fontified t) 333 344 (fontified t face font-lock-type-face) 344 347 (fontified t) 347 358 (fontified t face font-lock-type-face) 358 371 (fontified t) 371 374 (fontified t face font-lock-keyword-face) 374 375 (fontified t) 375 381 (fontified t face font-lock-keyword-face) 381 382 (fontified t) 382 390 (fontified t face font-lock-type-face) 390 397 (fontified t) 397 405 (fontified t face font-lock-variable-name-face) 405 407 (fontified t) 407 413 (fontified t face font-lock-type-face) 413 417 (fontified t) 417 421 (fontified t face font-lock-keyword-face) 421 422 (fontified t) 422 430 (fontified t face font-lock-type-face) 430 437 (fontified t) 437 439 (fontified t face font-lock-keyword-face) 439 440 (fontified t) 440 443 (fontified t face font-lock-function-name-face) 443 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 473 (fontified t) 473 476 (fontified t face font-lock-variable-name-face) 476 478 (fontified t) 478 482 (fontified t face font-lock-keyword-face) 482 483 (fontified t) 483 486 (fontified t face font-lock-constant-face) 486 488 (fontified t) 488 491 (fontified t face font-lock-constant-face) 491 493 (fontified t) 493 500 (fontified t face font-lock-type-face) 500 503 (fontified t) 503 504 (syntax-table #1# fontified t) 504 505 (fontified t) 505 509 (fontified t face font-lock-type-face) 509 520 (fontified t) 520 523 (fontified t face font-lock-keyword-face) 523 529 (fontified t) 529 548 (fontified t) 548 573 (fontified t) 573 581 (fontified t) 581 584 (fontified t face font-lock-keyword-face) 584 585 (fontified t) 585 593 (fontified t face font-lock-variable-name-face) 593 596 (fontified t) 596 603 (fontified t face rust-builtin-formatting-macro-face) 603 617 (fontified t) 617 625 (fontified t face font-lock-string-face) 625 637 (fontified t face rust-string-interpolation-face) 637 641 (fontified t face font-lock-string-face) 641 646 (fontified t face rust-string-interpolation-face) 646 651 (fontified t face font-lock-string-face) 651 663 (fontified t face rust-string-interpolation-face) 663 667 (fontified t face font-lock-string-face) 667 672 (fontified t face rust-string-interpolation-face) 672 677 (fontified t face font-lock-string-face) 677 815 (fontified t) 815 819 (fontified t face font-lock-type-face) 819 843 (fontified t) 843 846 (fontified t face font-lock-keyword-face) 846 847 (fontified t) 847 849 (fontified t face font-lock-keyword-face) 849 850 (fontified t) 850 871 (fontified t face font-lock-function-name-face) 871 872 (fontified t) 872 880 (fontified t face font-lock-variable-name-face) 880 883 (fontified t) 883 886 (fontified t face font-lock-type-face) 886 889 (fontified t) 889 890 (fontified t syntax-table #1#) 890 891 (fontified t) 891 897 (fontified t face font-lock-type-face) 897 908 (fontified t) 908 911 (fontified t face font-lock-keyword-face) 911 912 (fontified t) 912 919 (fontified t face font-lock-variable-name-face) 919 922 (fontified t) 922 929 (fontified t face rust-builtin-formatting-macro-face) 929 930 (fontified t) 930 940 (fontified t face font-lock-string-face) 940 942 (fontified t face rust-string-interpolation-face) 942 943 (fontified t face font-lock-string-face) 943 964 (fontified t) 964 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 977 (fontified t face font-lock-variable-name-face) 977 980 (fontified t) 980 988 (fontified t face font-lock-type-face) 988 994 (fontified t) 994 1005 (fontified t face font-lock-string-face) 1005 1026 (fontified t) 1026 1031 (fontified t face font-lock-preprocessor-face) 1031 1032 (fontified t) 1032 1051 (fontified t face font-lock-string-face) 1051 1073 (fontified t) 1073 1091 (fontified t) 1091 1101 (fontified t) 1101 1104 (fontified t face font-lock-keyword-face) 1104 1105 (fontified t) 1105 1107 (fontified t face font-lock-keyword-face) 1107 1108 (fontified t) 1108 1133 (fontified t face font-lock-function-name-face) 1133 1134 (fontified t) 1134 1142 (fontified t face font-lock-variable-name-face) 1142 1145 (fontified t) 1145 1148 (fontified t face font-lock-type-face) 1148 1151 (fontified t) 1151 1152 (fontified t syntax-table #1#) 1152 1153 (fontified t) 1153 1159 (fontified t face font-lock-type-face) 1159 1170 (fontified t) 1170 1173 (fontified t face font-lock-keyword-face) 1173 1174 (fontified t) 1174 1181 (fontified t face font-lock-variable-name-face) 1181 1184 (fontified t) 1184 1191 (fontified t face rust-builtin-formatting-macro-face) 1191 1192 (fontified t) 1192 1202 (fontified t face font-lock-string-face) 1202 1204 (fontified t face rust-string-interpolation-face) 1204 1205 (fontified t face font-lock-string-face) 1205 1226 (fontified t) 1226 1229 (fontified t face font-lock-keyword-face) 1229 1230 (fontified t) 1230 1241 (fontified t face font-lock-variable-name-face) 1241 1244 (fontified t) 1244 1252 (fontified t face font-lock-type-face) 1252 1258 (fontified t) 1258 1271 (fontified t face font-lock-string-face) 1271 1292 (fontified t) 1292 1297 (fontified t face font-lock-preprocessor-face) 1297 1298 (fontified t) 1298 1321 (fontified t face font-lock-string-face) 1321 1372 (fontified t) 1372 1375 (fontified t face font-lock-keyword-face) 1375 1376 (fontified t) 1376 1381 (fontified t face font-lock-constant-face) 1381 1383 (fontified t) 1383 1386 (fontified t face font-lock-constant-face) 1386 1388 (fontified t) 1388 1391 (fontified t face font-lock-constant-face) 1391 1393 (fontified t) 1393 1406 (fontified t face font-lock-type-face) 1406 1408 (fontified t) 1408 1411 (fontified t face font-lock-keyword-face) 1411 1412 (fontified t) 1412 1418 (fontified t face font-lock-keyword-face) 1418 1419 (fontified t) 1419 1425 (fontified t face font-lock-type-face) 1425 1428 (fontified t) 1428 1432 (fontified t) 1432 1439 (fontified t face font-lock-variable-name-face) 1439 1441 (fontified t) 1441 1454 (fontified t face font-lock-type-face) 1454 1460 (fontified t) 1460 1462 (fontified t face font-lock-variable-name-face) 1462 1464 (fontified t) 1464 1469 (fontified t face font-lock-constant-face) 1469 1471 (fontified t) 1471 1475 (fontified t face font-lock-constant-face) 1475 1477 (fontified t) 1477 1481 (fontified t face font-lock-constant-face) 1481 1483 (fontified t) 1483 1489 (fontified t face font-lock-type-face) 1489 1490 (fontified t) 1490 1499 (fontified t face font-lock-type-face) 1499 1504 (fontified t) 1504 1508 (fontified t face font-lock-keyword-face) 1508 1509 (fontified t) 1509 1515 (fontified t face font-lock-type-face) 1515 1518 (fontified t) 1518 1522 (fontified t) 1522 1525 (fontified t face font-lock-keyword-face) 1525 1526 (fontified t) 1526 1528 (fontified t face font-lock-keyword-face) 1528 1529 (fontified t) 1529 1532 (fontified t face font-lock-function-name-face) 1532 1533 (fontified t) 1533 1540 (fontified t face font-lock-variable-name-face) 1540 1542 (fontified t) 1542 1546 (fontified t face font-lock-keyword-face) 1546 1547 (fontified t) 1547 1550 (fontified t face font-lock-constant-face) 1550 1552 (fontified t) 1552 1555 (fontified t face font-lock-constant-face) 1555 1557 (fontified t) 1557 1564 (fontified t face font-lock-type-face) 1564 1566 (fontified t) 1566 1568 (fontified t face font-lock-variable-name-face) 1568 1570 (fontified t) 1570 1575 (fontified t face font-lock-constant-face) 1575 1577 (fontified t) 1577 1581 (fontified t face font-lock-constant-face) 1581 1583 (fontified t) 1583 1587 (fontified t face font-lock-constant-face) 1587 1589 (fontified t) 1589 1591 (fontified t face font-lock-type-face) 1591 1595 (face font-lock-type-face fontified t) 1595 1596 (fontified t) 1596 1599 (face font-lock-type-face fontified t) 1599 1605 (face font-lock-type-face fontified t) 1605 1609 (fontified t) 1609 1610 (syntax-table #1# fontified t) 1610 1611 (fontified t) 1611 1615 (face font-lock-type-face fontified t) 1615 1618 (fontified t) 1626 1629 (face font-lock-keyword-face) 1630 1637 (face font-lock-variable-name-face) 1714 1739 (face font-lock-string-face) 1750 1753 (face font-lock-keyword-face) 1754 1761 (face font-lock-variable-name-face) 1764 1773 (face font-lock-type-face) 1802 1806 (face font-lock-type-face) 1831 1835 (face font-lock-keyword-face) 1836 1842 (face font-lock-type-face) 1843 1846 (face font-lock-keyword-face) 1847 1853 (face font-lock-type-face) 1860 1864 (face font-lock-keyword-face) 1865 1869 (face font-lock-type-face) 1880 1884 (face font-lock-keyword-face) 1885 1890 (face font-lock-type-face) 1902 1904 (face font-lock-keyword-face) 1905 1909 (face font-lock-function-name-face) 1911 1914 (face font-lock-keyword-face) 1915 1919 (face font-lock-keyword-face) 1922 1923 (syntax-table #1#) 1924 1928 (face font-lock-type-face) 1929 1933 (face font-lock-type-face) 1935 1939 (face font-lock-type-face) 1941 1945 (face font-lock-type-face) 1947 1952 (face font-lock-type-face) 1964 1969 (face font-lock-keyword-face) 1970 1974 (face font-lock-keyword-face) 2004 2006 (face font-lock-type-face) 2007 2012 (face font-lock-type-face) 2014 2019 (face font-lock-type-face) 2030 2031 (syntax-table #1#) 2050 2054 (face font-lock-keyword-face) 2090 2106 (face font-lock-string-face) 2125 2127 (face font-lock-type-face) 2128 2133 (face font-lock-type-face) 2135 2140 (face font-lock-type-face) 2172 2174 (face font-lock-type-face) 2175 2180 (face font-lock-type-face) 2182 2190 (face font-lock-type-face) 2193 2194 (syntax-table #1#) 2195 2197 (face font-lock-type-face) 2198 2203 (face font-lock-type-face) 2205 2213 (face font-lock-type-face) 2228 2231 (face font-lock-type-face) 2236 2237 (syntax-table #1#) 2256 2261 (face font-lock-preprocessor-face) 2262 2285 (face font-lock-string-face) 2307 2309 (face font-lock-type-face) 2310 2315 (face font-lock-type-face) 2317 2322 (face font-lock-type-face) 2361 2364 (face font-lock-keyword-face) 2365 2371 (face font-lock-keyword-face) 2372 2378 (face font-lock-type-face) 2383 2387 (face font-lock-keyword-face) 2388 2394 (face font-lock-type-face) 2401 2404 (face font-lock-keyword-face) 2405 2407 (face font-lock-keyword-face) 2408 2412 (face font-lock-function-name-face) 2422 2430 (face font-lock-variable-name-face) 2432 2436 (face font-lock-keyword-face) 2437 2440 (face font-lock-constant-face) 2442 2445 (face font-lock-constant-face) 2447 2454 (face font-lock-type-face) 2464 2468 (face font-lock-variable-name-face) 2471 2475 (face font-lock-type-face) 2485 2491 (face font-lock-variable-name-face) 2493 2496 (face font-lock-type-face) 2497 2502 (face font-lock-type-face) 2503 2512 (face font-lock-type-face) 2523 2524 (syntax-table #1#) 2525 2531 (face font-lock-constant-face) 2533 2541 (face font-lock-type-face) 2552 2557 (face font-lock-keyword-face) 2558 2574 (face font-lock-type-face) 2580 2588 (face font-lock-type-face) 2590 2597 (face font-lock-type-face) 2599 2600 (syntax-table #1#) 2601 2616 (face font-lock-type-face) 2622 2630 (face font-lock-type-face) 2632 2639 (face font-lock-type-face) 2655 2658 (face font-lock-constant-face) 2658 2661 (face font-lock-constant-face) 2669 2673 (face font-lock-constant-face) 2675 2683 (face font-lock-type-face) 2723 2726 (face font-lock-keyword-face) 2727 2742 (face font-lock-variable-name-face) 2745 2761 (face font-lock-type-face) 2775 2783 (face font-lock-type-face) 2785 2792 (face font-lock-type-face) 2807 2812 (face font-lock-preprocessor-face) 2813 2840 (face font-lock-string-face) 2869 2872 (face font-lock-keyword-face) 2873 2881 (face font-lock-variable-name-face) 2914 2917 (face font-lock-keyword-face) 2918 2925 (face font-lock-variable-name-face) 2925 2943 (face font-lock-variable-name-face) 2946 2952 (face font-lock-constant-face) 2954 2962 (face font-lock-type-face)) . 1) (undo-tree-id2722 . -47) (undo-tree-id2723 . 532) (undo-tree-id2724 . -19) (undo-tree-id2725 . -47) (undo-tree-id2726 . -1372) (undo-tree-id2727 . 819) (undo-tree-id2728 . -1372) (undo-tree-id2729 . -2160) (undo-tree-id2730 . -1518) (undo-tree-id2731 . -2502) (undo-tree-id2732 . -2412) (undo-tree-id2733 . -2412) (undo-tree-id2734 . -2412) (undo-tree-id2735 . -2412) (undo-tree-id2736 . -2412) (undo-tree-id2737 . -2412) (undo-tree-id2738 . -2412) (undo-tree-id2739 . -170) (undo-tree-id2740 . -2160) (undo-tree-id2741 . -2160) (undo-tree-id2742 . -1518) (undo-tree-id2743 . -1372) (undo-tree-id2744 . -2160) (undo-tree-id2745 . -2160) (undo-tree-id2746 . -1524) (undo-tree-id2747 . -1524) (undo-tree-id2748 . -774) (undo-tree-id2749 . -2160) (undo-tree-id2750 . -1524) (undo-tree-id2751 . -1524) (undo-tree-id2752 . -1411) (undo-tree-id2753 . -1411) (undo-tree-id2754 . -774) (undo-tree-id2755 . -1524) (undo-tree-id2756 . -1411) (undo-tree-id2757 . -1411) (undo-tree-id2758 . -1411) (undo-tree-id2759 . -1375) (undo-tree-id2760 . -1375) (undo-tree-id2761 . -170) (undo-tree-id2762 . -170) (undo-tree-id2763 . -1375) (undo-tree-id2764 . -170) (undo-tree-id2765 . -2401) (undo-tree-id2766 . -2404) (undo-tree-id2767 . -2497) (undo-tree-id2768 . -2502) (undo-tree-id2769 . -2493) (undo-tree-id2770 . -2496) (undo-tree-id2771 . -2493) (undo-tree-id2772 . -2496) (undo-tree-id2773 . -2497) (undo-tree-id2774 . -2502) (undo-tree-id2775 . -2401) (undo-tree-id2776 . -3032) (undo-tree-id2777 . -2502) (undo-tree-id2778 . -2475) (undo-tree-id2779 . -1518) (undo-tree-id2780 . -170) (undo-tree-id2781 . -2502) (undo-tree-id2782 . -2502) (undo-tree-id2783 . -2502) (undo-tree-id2784 . -2502) (undo-tree-id2785 . -1518) (undo-tree-id2786 . -2502) (undo-tree-id2787 . -2502) (undo-tree-id2788 . -1518) (undo-tree-id2789 . -2502) (undo-tree-id2790 . -2502) (undo-tree-id2791 . -19) (undo-tree-id2792 . -2502) (undo-tree-id2793 . -2502) (undo-tree-id2794 . -1518) (undo-tree-id2795 . -2813) (undo-tree-id2796 . -2814) (undo-tree-id2797 . -2502) (undo-tree-id2798 . -2502) (undo-tree-id2799 . -2502) (undo-tree-id2800 . -2502) (undo-tree-id2801 . -1518) (undo-tree-id2802 . -19) 20) nil (23751 24709 934428 732000) 0 nil]) ((nil rear-nonsticky nil 19 . 20) (#("
" 0 1 (fontified nil)) . -48) (19 . 49) 1) nil (23751 24709 934437 937000) 0 nil]) ((2484 . 2485) (#(">" 0 1 (fontified t)) . -2475) (2485 . 2486) (#(">" 0 1 (fontified t)) . -2476) 2475 (2474 . 2476) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2474) (2469 . 2475) (2468 . 2470) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2468) (2465 . 2469) (#("<" 0 1 (fontified t)) . -2465) (undo-tree-id2803 . -1) 2466 (2465 . 2466) (t 23751 24344 19800 657000)) nil (23751 24709 934445 250000) 0 nil]) ((1380 . 1384) (t 23751 24334 796510 352000)) nil (23751 24343 910804 134000) 0 nil]) (1386) nil (23751 24343 910810 65000) 0 nil]) ((1489 . 1493) (t 23751 24276 676777 840000)) nil (23751 24334 701833 615000) 0 nil]) ((1 . 2987) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User, socket: TcpStream) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 41 (fontified t) 41 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 77 (fontified t) 77 78 (fontified t rear-nonsticky t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 92 (fontified t) 92 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 166 (fontified t) 166 169 (fontified t face font-lock-keyword-face) 169 170 (fontified t) 170 175 (fontified t face font-lock-constant-face) 175 177 (fontified t) 177 180 (fontified t face font-lock-constant-face) 180 182 (fontified t) 182 191 (fontified t face font-lock-type-face) 191 193 (fontified t) 193 196 (fontified t face font-lock-keyword-face) 196 197 (fontified t) 197 201 (fontified t face font-lock-constant-face) 201 203 (fontified t) 203 209 (fontified t face font-lock-type-face) 209 211 (fontified t) 211 212 (fontified t) 212 215 (fontified t face font-lock-keyword-face) 215 216 (fontified t) 216 222 (fontified t face font-lock-keyword-face) 222 223 (fontified t) 223 239 (fontified t face font-lock-variable-name-face) 239 241 (fontified t) 241 252 (fontified t face font-lock-type-face) 252 255 (fontified t) 255 266 (fontified t face font-lock-type-face) 266 276 (fontified t) 276 279 (fontified t face font-lock-keyword-face) 279 280 (fontified t) 280 286 (fontified t face font-lock-keyword-face) 286 287 (fontified t) 287 302 (fontified t face font-lock-variable-name-face) 302 304 (fontified t) 304 315 (fontified t face font-lock-type-face) 315 318 (fontified t) 318 329 (fontified t face font-lock-type-face) 329 341 (fontified t) 341 342 (fontified t) 342 345 (fontified t face font-lock-keyword-face) 345 346 (fontified t) 346 352 (fontified t face font-lock-keyword-face) 352 353 (fontified t) 353 361 (fontified t face font-lock-type-face) 361 368 (fontified t) 368 376 (fontified t face font-lock-variable-name-face) 376 378 (fontified t) 378 384 (fontified t face font-lock-type-face) 384 388 (fontified t) 388 392 (fontified t face font-lock-keyword-face) 392 393 (fontified t) 393 401 (fontified t face font-lock-type-face) 401 408 (fontified t) 408 410 (fontified t face font-lock-keyword-face) 410 411 (fontified t) 411 414 (fontified t face font-lock-function-name-face) 414 415 (fontified t) 415 418 (fontified t face font-lock-variable-name-face) 418 420 (fontified t) 420 424 (fontified t face font-lock-keyword-face) 424 425 (fontified t) 425 428 (fontified t face font-lock-constant-face) 428 430 (fontified t) 430 433 (fontified t face font-lock-constant-face) 433 435 (fontified t) 435 442 (fontified t face font-lock-type-face) 442 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 474 (fontified t) 474 475 (syntax-table #1# fontified t) 475 476 (fontified t) 476 480 (fontified t face font-lock-type-face) 480 483 (fontified t) 483 491 (fontified t) 491 494 (fontified t face font-lock-keyword-face) 494 515 (fontified t) 515 518 (fontified t) 518 533 (fontified t) 533 534 (fontified t) 534 544 (fontified t) 544 552 (fontified t) 552 555 (fontified t face font-lock-keyword-face) 555 556 (fontified t) 556 557 (fontified t face font-lock-variable-name-face) 557 564 (fontified t face font-lock-variable-name-face) 564 567 (fontified t) 567 574 (fontified t face rust-builtin-formatting-macro-face) 574 576 (fontified t) 576 578 (fontified t) 578 588 (fontified t) 588 593 (face font-lock-string-face fontified t) 593 596 (face font-lock-string-face fontified t) 596 608 (face rust-string-interpolation-face fontified t) 608 612 (face font-lock-string-face fontified t) 612 617 (face rust-string-interpolation-face fontified t) 617 622 (face font-lock-string-face fontified t) 622 634 (face rust-string-interpolation-face fontified t) 634 638 (face font-lock-string-face fontified t) 638 643 (face rust-string-interpolation-face fontified t) 643 648 (face font-lock-string-face fontified t) 648 650 (fontified t) 650 712 (fontified t) 712 745 (fontified t) 745 786 (fontified t) 786 790 (fontified t face font-lock-type-face) 790 814 (fontified t) 814 817 (fontified t face font-lock-keyword-face) 817 818 (fontified t) 818 820 (fontified t face font-lock-keyword-face) 820 821 (fontified t) 821 842 (fontified t face font-lock-function-name-face) 842 843 (fontified t) 843 851 (fontified t face font-lock-variable-name-face) 851 854 (fontified t) 854 857 (fontified t face font-lock-type-face) 857 860 (fontified t) 860 861 (fontified t syntax-table #1#) 861 862 (fontified t) 862 868 (fontified t face font-lock-type-face) 868 871 (fontified t) 871 879 (fontified t) 879 882 (fontified t face font-lock-keyword-face) 882 883 (fontified t) 883 890 (fontified t face font-lock-variable-name-face) 890 893 (fontified t) 893 900 (fontified t face rust-builtin-formatting-macro-face) 900 901 (fontified t) 901 911 (fontified t face font-lock-string-face) 911 913 (fontified t face rust-string-interpolation-face) 913 914 (fontified t face font-lock-string-face) 914 935 (fontified t) 935 938 (fontified t face font-lock-keyword-face) 938 939 (fontified t) 939 948 (fontified t face font-lock-variable-name-face) 948 951 (fontified t) 951 959 (fontified t face font-lock-type-face) 959 965 (fontified t) 965 976 (fontified t face font-lock-string-face) 976 983 (fontified t) 983 989 (fontified t) 989 997 (fontified t) 997 1001 (fontified t face font-lock-preprocessor-face) 1001 1002 (fontified t face font-lock-preprocessor-face) 1002 1003 (fontified t) 1003 1019 (fontified t face font-lock-string-face) 1019 1021 (fontified t face font-lock-string-face) 1021 1022 (fontified t face font-lock-string-face) 1022 1035 (fontified t) 1035 1041 (fontified t) 1041 1044 (fontified t) 1044 1062 (fontified t) 1062 1072 (fontified t) 1072 1073 (fontified t face font-lock-keyword-face) 1073 1075 (fontified t face font-lock-keyword-face) 1075 1076 (fontified t) 1076 1078 (fontified t face font-lock-keyword-face) 1078 1079 (fontified t) 1079 1104 (fontified t face font-lock-function-name-face) 1104 1105 (fontified t) 1105 1113 (fontified t face font-lock-variable-name-face) 1113 1116 (fontified t) 1116 1119 (fontified t face font-lock-type-face) 1119 1122 (fontified t) 1122 1123 (fontified t syntax-table #1#) 1123 1124 (fontified t) 1124 1130 (fontified t face font-lock-type-face) 1130 1133 (fontified t) 1133 1141 (fontified t) 1141 1144 (fontified t face font-lock-keyword-face) 1144 1145 (fontified t) 1145 1150 (fontified t face font-lock-variable-name-face) 1150 1152 (face font-lock-variable-name-face fontified t) 1152 1155 (fontified t) 1155 1162 (face rust-builtin-formatting-macro-face fontified t) 1162 1163 (fontified t) 1163 1173 (face font-lock-string-face fontified t) 1173 1175 (face rust-string-interpolation-face fontified t) 1175 1176 (face font-lock-string-face fontified t) 1176 1189 (fontified t) 1189 1197 (fontified t) 1197 1200 (fontified t face font-lock-keyword-face) 1200 1201 (fontified t) 1201 1212 (fontified t face font-lock-variable-name-face) 1212 1215 (fontified t) 1215 1223 (fontified t face font-lock-type-face) 1223 1229 (fontified t) 1229 1242 (fontified t face font-lock-string-face) 1242 1245 (fontified t) 1245 1255 (fontified t) 1255 1263 (fontified t) 1263 1267 (fontified t face font-lock-preprocessor-face) 1267 1268 (fontified t face font-lock-preprocessor-face) 1268 1269 (fontified t) 1269 1289 (fontified t face font-lock-string-face) 1289 1291 (fontified t face font-lock-string-face) 1291 1292 (fontified t face font-lock-string-face) 1292 1305 (fontified t) 1305 1343 (fontified t) 1343 1346 (fontified t face font-lock-keyword-face) 1346 1347 (fontified t) 1347 1352 (fontified t face font-lock-constant-face) 1352 1354 (fontified t) 1354 1357 (fontified t face font-lock-constant-face) 1357 1359 (fontified t) 1359 1362 (fontified t face font-lock-constant-face) 1362 1364 (fontified t) 1364 1365 (fontified t face font-lock-type-face) 1365 1377 (fontified t face font-lock-type-face) 1377 1379 (fontified t) 1379 1385 (fontified t face font-lock-keyword-face) 1385 1386 (fontified t) 1386 1392 (fontified t face font-lock-type-face) 1392 1399 (fontified t) 1399 1406 (fontified t face font-lock-variable-name-face) 1406 1408 (fontified t) 1408 1421 (fontified t face font-lock-type-face) 1421 1427 (fontified t) 1427 1429 (fontified t face font-lock-variable-name-face) 1429 1431 (fontified t) 1431 1436 (fontified t face font-lock-constant-face) 1436 1438 (fontified t) 1438 1442 (fontified t face font-lock-constant-face) 1442 1444 (fontified t) 1444 1448 (fontified t face font-lock-constant-face) 1448 1450 (fontified t) 1450 1456 (fontified t face font-lock-type-face) 1456 1457 (fontified t) 1457 1466 (fontified t face font-lock-type-face) 1466 1471 (fontified t) 1471 1475 (fontified t face font-lock-keyword-face) 1475 1476 (fontified t) 1476 1482 (fontified t face font-lock-type-face) 1482 1489 (fontified t) 1489 1491 (fontified t face font-lock-keyword-face) 1491 1492 (fontified t) 1492 1495 (fontified t face font-lock-function-name-face) 1495 1496 (fontified t) 1496 1503 (fontified t face font-lock-variable-name-face) 1503 1505 (fontified t) 1505 1509 (fontified t face font-lock-keyword-face) 1509 1510 (fontified t) 1510 1513 (fontified t face font-lock-constant-face) 1513 1515 (fontified t) 1515 1518 (fontified t face font-lock-constant-face) 1518 1520 (fontified t) 1520 1527 (fontified t face font-lock-type-face) 1527 1529 (fontified t) 1529 1531 (fontified t face font-lock-variable-name-face) 1531 1532 (fontified t) 1532 1533 (fontified t) 1533 1538 (fontified t face font-lock-constant-face) 1538 1540 (fontified t) 1540 1544 (fontified t face font-lock-constant-face) 1544 1546 (fontified t) 1546 1550 (fontified t face font-lock-constant-face) 1550 1552 (fontified t) 1552 1558 (fontified t face font-lock-type-face) 1558 1559 (fontified t) 1559 1562 (fontified t face font-lock-type-face) 1562 1568 (fontified t face font-lock-type-face) 1568 1572 (fontified t) 1572 1573 (fontified t syntax-table #1#) 1573 1574 (fontified t) 1574 1578 (fontified t face font-lock-type-face) 1578 1581 (fontified t) 1581 1589 (fontified t) 1589 1592 (fontified t face font-lock-keyword-face) 1592 1593 (fontified t) 1593 1600 (fontified t face font-lock-variable-name-face) 1600 1630 (fontified t) 1630 1633 (fontified t) 1633 1636 (fontified t) 1636 1677 (fontified t) 1677 1689 (fontified t face font-lock-string-face) 1689 1702 (face font-lock-string-face fontified t) 1702 1705 (fontified t) 1705 1713 (fontified t) 1713 1716 (fontified t face font-lock-keyword-face) 1716 1717 (fontified t) 1717 1724 (fontified t face font-lock-variable-name-face) 1724 1727 (fontified t) 1727 1736 (fontified t face font-lock-type-face) 1736 1755 (fontified t) 1755 1757 (fontified t) 1757 1765 (fontified t) 1765 1769 (fontified t face font-lock-type-face) 1769 1786 (fontified t) 1786 1794 (fontified t) 1794 1798 (fontified t face font-lock-keyword-face) 1798 1799 (fontified t) 1799 1805 (fontified t face font-lock-type-face) 1805 1806 (fontified t) 1806 1809 (fontified t face font-lock-keyword-face) 1809 1810 (fontified t) 1810 1816 (fontified t face font-lock-type-face) 1816 1819 (fontified t) 1819 1823 (fontified t) 1823 1827 (fontified t face font-lock-keyword-face) 1827 1828 (fontified t) 1828 1832 (fontified t face font-lock-type-face) 1832 1843 (fontified t) 1843 1847 (fontified t face font-lock-keyword-face) 1847 1848 (fontified t) 1848 1853 (fontified t face font-lock-type-face) 1853 1860 (fontified t) 1860 1865 (fontified t) 1865 1867 (fontified t face font-lock-keyword-face) 1867 1868 (fontified t) 1868 1872 (fontified t face font-lock-function-name-face) 1872 1874 (fontified t) 1874 1877 (fontified t face font-lock-keyword-face) 1877 1878 (fontified t) 1878 1879 (fontified t face font-lock-keyword-face) 1879 1882 (fontified t face font-lock-keyword-face) 1882 1885 (fontified t) 1885 1886 (syntax-table #1# fontified t) 1886 1887 (fontified t) 1887 1891 (fontified t face font-lock-type-face) 1891 1892 (fontified t) 1892 1896 (fontified t face font-lock-type-face) 1896 1898 (fontified t) 1898 1902 (fontified t face font-lock-type-face) 1902 1904 (fontified t) 1904 1908 (fontified t face font-lock-type-face) 1908 1910 (fontified t) 1910 1915 (fontified t face font-lock-type-face) 1915 1919 (fontified t) 1919 1927 (fontified t) 1927 1932 (fontified t face font-lock-keyword-face) 1932 1933 (fontified t) 1933 1937 (fontified t face font-lock-keyword-face) 1937 1967 (fontified t) 1967 1969 (fontified t face font-lock-type-face) 1969 1970 (fontified t) 1970 1975 (fontified t face font-lock-type-face) 1975 1977 (fontified t) 1977 1982 (fontified t face font-lock-type-face) 1982 1993 (fontified t) 1993 1994 (syntax-table #1# fontified t) 1994 1997 (fontified t) 1997 2013 (fontified t) 2013 2017 (fontified t face font-lock-keyword-face) 2017 2052 (fontified t) 2052 2053 (fontified t) 2053 2062 (fontified t face font-lock-string-face) 2062 2063 (fontified t face font-lock-string-face) 2063 2069 (fontified t face font-lock-string-face) 2069 2071 (fontified t) 2071 2072 (fontified t) 2072 2088 (fontified t) 2088 2090 (fontified t face font-lock-type-face) 2090 2091 (fontified t) 2091 2096 (fontified t face font-lock-type-face) 2096 2097 (fontified t) 2097 2098 (fontified t) 2098 2103 (fontified t face font-lock-type-face) 2103 2109 (fontified t) 2109 2135 (fontified t) 2135 2137 (fontified t face font-lock-type-face) 2137 2138 (fontified t) 2138 2143 (fontified t face font-lock-type-face) 2143 2145 (fontified t) 2145 2153 (fontified t face font-lock-type-face) 2153 2156 (fontified t) 2156 2157 (syntax-table #1# fontified t) 2157 2158 (fontified t) 2158 2160 (fontified t face font-lock-type-face) 2160 2161 (fontified t) 2161 2166 (fontified t face font-lock-type-face) 2166 2168 (fontified t) 2168 2176 (fontified t face font-lock-type-face) 2176 2191 (fontified t) 2191 2194 (fontified t face font-lock-type-face) 2194 2199 (fontified t) 2199 2200 (syntax-table #1# fontified t) 2200 2203 (fontified t) 2203 2205 (fontified t) 2205 2219 (fontified t) 2219 2223 (fontified t face font-lock-preprocessor-face) 2223 2224 (fontified t face font-lock-preprocessor-face) 2224 2225 (fontified t) 2225 2245 (fontified t face font-lock-string-face) 2245 2247 (fontified t face font-lock-string-face) 2247 2248 (fontified t face font-lock-string-face) 2248 2254 (fontified t) 2254 2257 (fontified t) 2257 2270 (fontified t) 2270 2272 (face font-lock-type-face fontified t) 2272 2273 (fontified t) 2273 2278 (face font-lock-type-face fontified t) 2278 2280 (fontified t) 2280 2285 (face font-lock-type-face fontified t) 2285 2286 (fontified t) 2286 2291 (fontified t) 2291 2324 (fontified t) 2324 2327 (fontified t face font-lock-keyword-face) 2327 2328 (fontified t) 2328 2334 (fontified t face font-lock-keyword-face) 2334 2335 (fontified t) 2335 2341 (fontified t face font-lock-type-face) 2341 2343 (fontified t) 2343 2345 (fontified t) 2345 2346 (fontified t) 2346 2347 (fontified t face font-lock-keyword-face) 2347 2350 (fontified t face font-lock-keyword-face) 2350 2351 (fontified t) 2351 2357 (fontified t face font-lock-type-face) 2357 2360 (fontified t) 2360 2364 (fontified t) 2364 2367 (fontified t face font-lock-keyword-face) 2367 2368 (fontified t) 2368 2370 (fontified t face font-lock-keyword-face) 2370 2371 (fontified t) 2371 2375 (fontified t face font-lock-function-name-face) 2375 2376 (fontified t) 2376 2384 (fontified t face font-lock-variable-name-face) 2384 2386 (fontified t) 2386 2390 (fontified t face font-lock-keyword-face) 2390 2391 (fontified t) 2391 2394 (fontified t face font-lock-constant-face) 2394 2396 (fontified t) 2396 2399 (fontified t face font-lock-constant-face) 2399 2401 (fontified t) 2401 2408 (fontified t face font-lock-type-face) 2408 2410 (fontified t) 2410 2414 (fontified t face font-lock-variable-name-face) 2414 2417 (fontified t) 2417 2421 (fontified t face font-lock-type-face) 2421 2423 (fontified t) 2423 2429 (fontified t face font-lock-variable-name-face) 2429 2431 (fontified t) 2431 2440 (fontified t face font-lock-type-face) 2440 2443 (fontified t) 2443 2444 (fontified t syntax-table #1#) 2444 2445 (fontified t) 2445 2451 (fontified t face font-lock-constant-face) 2451 2453 (fontified t) 2453 2461 (fontified t face font-lock-type-face) 2461 2464 (fontified t) 2464 2472 (fontified t) 2472 2477 (fontified t face font-lock-keyword-face) 2477 2478 (fontified t) 2478 2494 (fontified t face font-lock-type-face) 2494 2500 (fontified t) 2500 2508 (fontified t face font-lock-type-face) 2508 2510 (fontified t) 2510 2517 (fontified t face font-lock-type-face) 2517 2519 (fontified t) 2519 2520 (syntax-table #1# fontified t) 2520 2521 (fontified t) 2521 2536 (fontified t face font-lock-type-face) 2536 2542 (fontified t) 2542 2550 (fontified t face font-lock-type-face) 2550 2552 (fontified t) 2552 2559 (fontified t face font-lock-type-face) 2559 2575 (fontified t) 2575 2581 (fontified t face font-lock-constant-face) 2581 2588 (fontified t) 2588 2589 (fontified t) 2589 2593 (fontified t face font-lock-constant-face) 2593 2595 (fontified t) 2595 2603 (fontified t face font-lock-type-face) 2603 2625 (fontified t) 2625 2643 (fontified t) 2643 2646 (fontified t face font-lock-keyword-face) 2646 2647 (fontified t) 2647 2662 (fontified t face font-lock-variable-name-face) 2662 2665 (fontified t) 2665 2681 (fontified t face font-lock-type-face) 2681 2695 (fontified t) 2695 2703 (fontified t face font-lock-type-face) 2703 2705 (fontified t) 2705 2712 (fontified t face font-lock-type-face) 2712 2719 (fontified t) 2719 2727 (fontified t) 2727 2731 (fontified t face font-lock-preprocessor-face) 2731 2732 (fontified t face font-lock-preprocessor-face) 2732 2733 (fontified t) 2733 2734 (fontified t face font-lock-string-face) 2734 2736 (fontified t face font-lock-string-face) 2736 2760 (fontified t face font-lock-string-face) 2760 2770 (fontified t) 2770 2773 (fontified t) 2773 2776 (fontified t) 2776 2780 (fontified t) 2780 2781 (fontified t) 2781 2789 (fontified t) 2789 2792 (fontified t face font-lock-keyword-face) 2792 2793 (fontified t) 2793 2801 (fontified t face font-lock-variable-name-face) 2801 2826 (fontified t) 2826 2834 (fontified t) 2834 2837 (fontified t face font-lock-keyword-face) 2837 2838 (fontified t) 2838 2863 (fontified t face font-lock-variable-name-face) 2863 2866 (fontified t) 2866 2872 (fontified t face font-lock-constant-face) 2872 2874 (fontified t) 2874 2882 (fontified t face font-lock-type-face) 2882 2900 (fontified t) 2900 2913 (fontified t) 2913 2953 (fontified t) 2953 2955 (fontified t)) . 1) (undo-tree-id2357 . -2781) (undo-tree-id2358 . 515) (undo-tree-id2359 . -211) (undo-tree-id2360 . -211) (undo-tree-id2361 . -2781) (undo-tree-id2362 . 174) (undo-tree-id2363 . -2781) (undo-tree-id2364 . -2781) (undo-tree-id2365 . -2072) (undo-tree-id2366 . -2953) (undo-tree-id2367 . -36) (undo-tree-id2368 . -36) (undo-tree-id2369 . -212) (undo-tree-id2370 . -212) (undo-tree-id2371 . -93) (undo-tree-id2372 . -93) (undo-tree-id2373 . -252) (undo-tree-id2374 . -19) (undo-tree-id2375 . -19) (undo-tree-id2376 . -2254) (undo-tree-id2377 . -2203) (undo-tree-id2378 . -778) (undo-tree-id2379 . -2953) (undo-tree-id2380 . -2953) (undo-tree-id2381 . -2072) (undo-tree-id2382 . -2781) (undo-tree-id2383 . -1471) (undo-tree-id2384 . -2781) (undo-tree-id2385 . -42) (undo-tree-id2386 . -19) (undo-tree-id2387 . -92) (undo-tree-id2388 . -2953) (undo-tree-id2389 . -2254) (undo-tree-id2390 . -2953) (undo-tree-id2391 . -2781) (undo-tree-id2392 . -2781) (undo-tree-id2393 . -2254) (undo-tree-id2394 . -2781) (undo-tree-id2395 . -2254) (undo-tree-id2396 . -2781) (undo-tree-id2397 . -2884) (undo-tree-id2398 . -2885) (undo-tree-id2399 . -2254) (undo-tree-id2400 . -2884) (undo-tree-id2401 . -2884) (undo-tree-id2402 . -2324) (undo-tree-id2403 . -1379) (undo-tree-id2404 . -342) (undo-tree-id2405 . -1839) (undo-tree-id2406 . -1819) (undo-tree-id2407 . -2360) (undo-tree-id2408 . -1861) (undo-tree-id2409 . -1485) (undo-tree-id2410 . -1068) (undo-tree-id2411 . -810) (undo-tree-id2412 . -404) (undo-tree-id2413 . -2346) (undo-tree-id2414 . -1794) (undo-tree-id2415 . -1471) (undo-tree-id2416 . -388) (undo-tree-id2417 . -2884) (undo-tree-id2418 . -2884) (undo-tree-id2419 . -2324) (undo-tree-id2420 . -2781) (undo-tree-id2421 . -2343) (undo-tree-id2422 . -2343) (undo-tree-id2423 . -2254) (undo-tree-id2424 . -2884) (undo-tree-id2425 . -2343) (undo-tree-id2426 . -2343) (undo-tree-id2427 . -2343) (undo-tree-id2428 . -2343) (undo-tree-id2429 . -2343) (undo-tree-id2430 . -2343) (undo-tree-id2431 . -2343) (undo-tree-id2432 . -1705) (undo-tree-id2433 . -211) (undo-tree-id2434 . -2343) (undo-tree-id2435 . -2343) (undo-tree-id2436 . -2343) (undo-tree-id2437 . -2429) (undo-tree-id2438 . -2430) (undo-tree-id2439 . -2324) (undo-tree-id2440 . -2781) (undo-tree-id2441 . -2429) (undo-tree-id2442 . -2429) (undo-tree-id2443 . -2781) (undo-tree-id2444 . -2781) (undo-tree-id2445 . -2324) (undo-tree-id2446 . -2781) (undo-tree-id2447 . -2781) (undo-tree-id2448 . -2781) (undo-tree-id2449 . -2781) (undo-tree-id2450 . -2781) (undo-tree-id2451 . -2324) (undo-tree-id2452 . -2781) (undo-tree-id2453 . -2781) (undo-tree-id2454 . -2324) (undo-tree-id2455 . -2781) (undo-tree-id2456 . -2324) (undo-tree-id2457 . -2781) (undo-tree-id2458 . -2429) (undo-tree-id2459 . -2780) (undo-tree-id2460 . -2781) (undo-tree-id2461 . -2324) (undo-tree-id2462 . -2719) (undo-tree-id2463 . -2780) (undo-tree-id2464 . -2324) (undo-tree-id2465 . -2635) (undo-tree-id2466 . -2719) (undo-tree-id2467 . -2324) (undo-tree-id2468 . -2625) (undo-tree-id2469 . -2635) (undo-tree-id2470 . -2324) (undo-tree-id2471 . -2563) (undo-tree-id2472 . -2625) (undo-tree-id2473 . -2324) (undo-tree-id2474 . -2464) (undo-tree-id2475 . -2563) (undo-tree-id2476 . -2324) (undo-tree-id2477 . -2360) (undo-tree-id2478 . -2464) (undo-tree-id2479 . -2324) (undo-tree-id2480 . -2361) (undo-tree-id2481 . -2360) (undo-tree-id2482 . -2324) (undo-tree-id2483 . -2362) (undo-tree-id2484 . -2361) (undo-tree-id2485 . -2324) (undo-tree-id2486 . -2363) (undo-tree-id2487 . -2362) (undo-tree-id2488 . -2324) (undo-tree-id2489 . -2364) (undo-tree-id2490 . -2363) (undo-tree-id2491 . -2324) (undo-tree-id2492 . -2365) (undo-tree-id2493 . -2364) (undo-tree-id2494 . -2324) (undo-tree-id2495 . -2366) (undo-tree-id2496 . -2365) (undo-tree-id2497 . -2324) (undo-tree-id2498 . -2367) (undo-tree-id2499 . -2366) (undo-tree-id2500 . -2324) (undo-tree-id2501 . -2368) (undo-tree-id2502 . -2367) (undo-tree-id2503 . -2324) (undo-tree-id2504 . -2369) (undo-tree-id2505 . -2368) (undo-tree-id2506 . -2324) (undo-tree-id2507 . -2370) (undo-tree-id2508 . -2369) (undo-tree-id2509 . -2324) (undo-tree-id2510 . -2371) (undo-tree-id2511 . -2370) (undo-tree-id2512 . -2324) (undo-tree-id2513 . -2372) (undo-tree-id2514 . -2371) (undo-tree-id2515 . -2324) (undo-tree-id2516 . -2373) (undo-tree-id2517 . -2372) (undo-tree-id2518 . -2324) (undo-tree-id2519 . -2374) (undo-tree-id2520 . -2373) (undo-tree-id2521 . -2324) (undo-tree-id2522 . -2375) (undo-tree-id2523 . -2374) (undo-tree-id2524 . -2324) (undo-tree-id2525 . -2376) (undo-tree-id2526 . -2375) (undo-tree-id2527 . -2324) (undo-tree-id2528 . -2377) (undo-tree-id2529 . -2376) (undo-tree-id2530 . -2324) (undo-tree-id2531 . -2378) (undo-tree-id2532 . -2377) (undo-tree-id2533 . -2324) (undo-tree-id2534 . -2379) (undo-tree-id2535 . -2378) (undo-tree-id2536 . -2324) (undo-tree-id2537 . -2380) (undo-tree-id2538 . -2379) (undo-tree-id2539 . -2324) (undo-tree-id2540 . -2381) (undo-tree-id2541 . -2380) (undo-tree-id2542 . -2324) (undo-tree-id2543 . -2382) (undo-tree-id2544 . -2381) (undo-tree-id2545 . -2324) (undo-tree-id2546 . -2383) (undo-tree-id2547 . -2382) (undo-tree-id2548 . -2324) (undo-tree-id2549 . -2384) (undo-tree-id2550 . -2383) (undo-tree-id2551 . -2324) (undo-tree-id2552 . -2385) (undo-tree-id2553 . -2384) (undo-tree-id2554 . -2324) (undo-tree-id2555 . -2386) (undo-tree-id2556 . -2385) (undo-tree-id2557 . -2324) (undo-tree-id2558 . -2387) (undo-tree-id2559 . -2386) (undo-tree-id2560 . -2324) (undo-tree-id2561 . -2388) (undo-tree-id2562 . -2387) (undo-tree-id2563 . -2324) (undo-tree-id2564 . -2389) (undo-tree-id2565 . -2388) (undo-tree-id2566 . -2324) (undo-tree-id2567 . -2390) (undo-tree-id2568 . -2389) (undo-tree-id2569 . -2324) (undo-tree-id2570 . -2391) (undo-tree-id2571 . -2390) (undo-tree-id2572 . -2324) (undo-tree-id2573 . -2392) (undo-tree-id2574 . -2391) (undo-tree-id2575 . -2324) (undo-tree-id2576 . -2393) (undo-tree-id2577 . -2392) (undo-tree-id2578 . -2324) (undo-tree-id2579 . -2394) (undo-tree-id2580 . -2393) (undo-tree-id2581 . -2324) (undo-tree-id2582 . -2395) (undo-tree-id2583 . -2394) (undo-tree-id2584 . -2324) (undo-tree-id2585 . -2396) (undo-tree-id2586 . -2395) (undo-tree-id2587 . -2324) (undo-tree-id2588 . -2397) (undo-tree-id2589 . -2396) (undo-tree-id2590 . -2324) (undo-tree-id2591 . -2398) (undo-tree-id2592 . -2397) (undo-tree-id2593 . -2324) (undo-tree-id2594 . -2399) (undo-tree-id2595 . -2398) (undo-tree-id2596 . -2324) (undo-tree-id2597 . -2400) (undo-tree-id2598 . -2399) (undo-tree-id2599 . -2324) (undo-tree-id2600 . -2401) (undo-tree-id2601 . -2400) (undo-tree-id2602 . -2324) (undo-tree-id2603 . -2402) (undo-tree-id2604 . -2401) (undo-tree-id2605 . -2324) (undo-tree-id2606 . -2403) (undo-tree-id2607 . -2402) (undo-tree-id2608 . -2324) (undo-tree-id2609 . -2404) (undo-tree-id2610 . -2403) (undo-tree-id2611 . -2324) (undo-tree-id2612 . -2405) (undo-tree-id2613 . -2404) (undo-tree-id2614 . -2324) (undo-tree-id2615 . -2406) (undo-tree-id2616 . -2405) (undo-tree-id2617 . -2324) (undo-tree-id2618 . -2407) (undo-tree-id2619 . -2406) (undo-tree-id2620 . -2324) (undo-tree-id2621 . -2408) (undo-tree-id2622 . -2407) (undo-tree-id2623 . -2324) (undo-tree-id2624 . -2409) (undo-tree-id2625 . -2408) (undo-tree-id2626 . -2324) (undo-tree-id2627 . -2410) (undo-tree-id2628 . -2409) (undo-tree-id2629 . -2324) (undo-tree-id2630 . -2411) (undo-tree-id2631 . -2410) (undo-tree-id2632 . -2324) (undo-tree-id2633 . -2412) (undo-tree-id2634 . -2411) (undo-tree-id2635 . -2324) (undo-tree-id2636 . -2413) (undo-tree-id2637 . -2412) (undo-tree-id2638 . -2324) (undo-tree-id2639 . -2414) (undo-tree-id2640 . -2413) (undo-tree-id2641 . -2324) (undo-tree-id2642 . -2415) (undo-tree-id2643 . -2414) (undo-tree-id2644 . -2324) (undo-tree-id2645 . -2416) (undo-tree-id2646 . -2415) (undo-tree-id2647 . -2324) (undo-tree-id2648 . -2417) (undo-tree-id2649 . -2416) (undo-tree-id2650 . -2324) (undo-tree-id2651 . -2418) (undo-tree-id2652 . -2417) (undo-tree-id2653 . -2324) (undo-tree-id2654 . -2419) (undo-tree-id2655 . -2418) (undo-tree-id2656 . -2324) (undo-tree-id2657 . -2420) (undo-tree-id2658 . -2419) (undo-tree-id2659 . -2324) (undo-tree-id2660 . -2421) (undo-tree-id2661 . -2420) (undo-tree-id2662 . -2324) (undo-tree-id2663 . -2422) (undo-tree-id2664 . -2421) (undo-tree-id2665 . -2324) (undo-tree-id2666 . -2423) (undo-tree-id2667 . -2422) (undo-tree-id2668 . -2324) (undo-tree-id2669 . -2424) (undo-tree-id2670 . -2423) (undo-tree-id2671 . -2324) (undo-tree-id2672 . -2425) (undo-tree-id2673 . -2424) (undo-tree-id2674 . -2324) (undo-tree-id2675 . -2426) (undo-tree-id2676 . -2425) (undo-tree-id2677 . -2324) (undo-tree-id2678 . -2427) (undo-tree-id2679 . -2426) (undo-tree-id2680 . -2324) (undo-tree-id2681 . -2428) (undo-tree-id2682 . -2427) (undo-tree-id2683 . -2324) (undo-tree-id2684 . -2429) (undo-tree-id2685 . -2428) (undo-tree-id2686 . -2324) (undo-tree-id2687 . -2430) (undo-tree-id2688 . -2429) (undo-tree-id2689 . -2324) (undo-tree-id2690 . -2431) (undo-tree-id2691 . -2430) (undo-tree-id2692 . -2324) (undo-tree-id2693 . -2431) (undo-tree-id2694 . -2431) (undo-tree-id2695 . -2324) (undo-tree-id2696 . -2430) (undo-tree-id2697 . -2431) (undo-tree-id2698 . -2324) (undo-tree-id2699 . -2364) (undo-tree-id2700 . -2367) (undo-tree-id2701 . -2364) (undo-tree-id2702 . -2461) (undo-tree-id2703 . -2429) (undo-tree-id2704 . -2430) (undo-tree-id2705 . -2324) (undo-tree-id2706 . -2423) (undo-tree-id2707 . -2429) (undo-tree-id2708 . -2888) (undo-tree-id2709 . -2894) (undo-tree-id2710 . -2429) (undo-tree-id2711 . -2429) (undo-tree-id2712 . -2324) 2430) nil (23751 24276 576751 502000) 0 nil]) ((#("&" 0 1 (fontified t)) . 2432)) nil (23751 24276 576793 672000) 0 nil]) ((#("        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };

" 0 8 (fontified t) 8 11 (fontified t face font-lock-keyword-face) 11 17 (fontified t) 17 20 (fontified t face font-lock-keyword-face) 20 27 (fontified t) 27 32 (fontified t face font-lock-constant-face) 32 34 (fontified t) 34 38 (fontified t face font-lock-constant-face) 38 40 (fontified t) 40 44 (fontified t face font-lock-constant-face) 44 66 (fontified t) 66 69 (fontified t face font-lock-keyword-face) 69 70 (fontified t) 70 76 (fontified t face font-lock-variable-name-face) 76 77 (fontified t) 77 79 (fontified t) 79 80 (fontified t face font-lock-type-face) 80 81 (fontified t face font-lock-type-face) 81 83 (fontified t face font-lock-type-face) 83 85 (fontified t face font-lock-type-face) 85 91 (fontified t) 91 95 (fontified t face font-lock-string-face) 95 107 (fontified t face font-lock-string-face) 107 114 (fontified t) 114 123 (fontified t) 123 128 (fontified t face font-lock-constant-face) 128 136 (fontified t) 136 143 (fontified t face font-lock-constant-face) 143 145 (fontified t) 145 151 (fontified t face font-lock-constant-face) 151 158 (fontified t) 158 162 (fontified t face font-lock-keyword-face) 162 180 (fontified t) 180 183 (fontified t) 183 185 (fontified t) 185 188 (face font-lock-keyword-face fontified t) 188 189 (fontified t) 189 195 (face font-lock-variable-name-face fontified t) 195 198 (fontified t) 198 202 (face font-lock-keyword-face fontified t) 202 205 (fontified t) 205 217 (fontified t) 217 219 (fontified t face font-lock-keyword-face) 219 220 (fontified t) 220 223 (fontified t face font-lock-keyword-face) 223 224 (fontified t) 224 226 (fontified t face font-lock-type-face) 226 227 (fontified t) 227 232 (fontified t face font-lock-type-face) 232 234 (fontified t) 234 239 (fontified t face font-lock-type-face) 239 240 (fontified t) 240 244 (fontified t face font-lock-type-face) 244 282 (fontified t) 282 287 (fontified t face font-lock-keyword-face) 287 319 (fontified t) 319 325 (fontified t face font-lock-constant-face) 325 333 (fontified t) 333 337 (fontified t face font-lock-constant-face) 337 339 (fontified t) 339 341 (fontified t face font-lock-type-face) 341 347 (fontified t face font-lock-type-face) 347 368 (fontified t) 368 380 (fontified t)) . 2783) (undo-tree-id2713 . -379) (undo-tree-id2714 . -379) (undo-tree-id2715 . -42) (undo-tree-id2716 . -42) (undo-tree-id2717 . -58) (undo-tree-id2718 . -114) (undo-tree-id2719 . -58) (undo-tree-id2720 . -58) (undo-tree-id2721 . -379)) nil (23751 24276 576809 617000) 0 nil] [nil ([nil nil ((#("&" 0 1 (fontified t)) . 2432)) ((2432 . 2433)) (23751 24251 780136 108000) 0 nil]) ((#("        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };

" 0 8 (fontified t) 8 11 (fontified t face font-lock-keyword-face) 11 17 (fontified t) 17 20 (fontified t face font-lock-keyword-face) 20 27 (fontified t) 27 32 (fontified t face font-lock-constant-face) 32 34 (fontified t) 34 38 (fontified t face font-lock-constant-face) 38 40 (fontified t) 40 44 (fontified t face font-lock-constant-face) 44 66 (fontified t) 66 69 (fontified t face font-lock-keyword-face) 69 70 (fontified t) 70 76 (fontified t face font-lock-variable-name-face) 76 77 (fontified t) 77 79 (fontified t) 79 80 (fontified t face font-lock-type-face) 80 81 (fontified t face font-lock-type-face) 81 83 (fontified t face font-lock-type-face) 83 85 (fontified t face font-lock-type-face) 85 91 (fontified t) 91 95 (fontified t face font-lock-string-face) 95 107 (fontified t face font-lock-string-face) 107 114 (fontified t) 114 123 (fontified t) 123 128 (fontified t face font-lock-constant-face) 128 136 (fontified t) 136 143 (fontified t face font-lock-constant-face) 143 145 (fontified t) 145 151 (fontified t face font-lock-constant-face) 151 158 (fontified t) 158 162 (fontified t face font-lock-keyword-face) 162 180 (fontified t) 180 183 (fontified t) 183 185 (fontified t) 185 188 (face font-lock-keyword-face fontified t) 188 189 (fontified t) 189 195 (face font-lock-variable-name-face fontified t) 195 198 (fontified t) 198 202 (face font-lock-keyword-face fontified t) 202 205 (fontified t) 205 217 (fontified t) 217 219 (fontified t face font-lock-keyword-face) 219 220 (fontified t) 220 223 (fontified t face font-lock-keyword-face) 223 224 (fontified t) 224 226 (fontified t face font-lock-type-face) 226 227 (fontified t) 227 232 (fontified t face font-lock-type-face) 232 234 (fontified t) 234 239 (fontified t face font-lock-type-face) 239 240 (fontified t) 240 244 (fontified t face font-lock-type-face) 244 282 (fontified t) 282 287 (fontified t face font-lock-keyword-face) 287 319 (fontified t) 319 325 (fontified t face font-lock-constant-face) 325 333 (fontified t) 333 337 (fontified t face font-lock-constant-face) 337 339 (fontified t) 339 341 (fontified t face font-lock-type-face) 341 347 (fontified t face font-lock-type-face) 347 368 (fontified t) 368 380 (fontified t)) . 2783) (undo-tree-id2340 . -379) (undo-tree-id2341 . -25) (undo-tree-id2342 . -379) (undo-tree-id2343 . -11) (undo-tree-id2344 . -42) (undo-tree-id2345 . -42) (undo-tree-id2346 . -58) (undo-tree-id2347 . -114) (undo-tree-id2348 . -58) (undo-tree-id2349 . -58) (undo-tree-id2350 . -25) (undo-tree-id2351 . -379) (undo-tree-id2352 . -379) (undo-tree-id2353 . -379) 3162) ((2783 . 3163)) (23751 24251 781949 284000) 0 nil]) ((2433 . 2442) (#("Tcp" 0 3 (fontified t face font-lock-type-face)) . -2433) (undo-tree-id2354 . -3) 2436 (2434 . 2436) (2433 . 2434) (#("t" 0 1 (fontified t)) . -2433) (undo-tree-id2355 . -1) (#("c" 0 1 (fontified t)) . -2434) (undo-tree-id2356 . -1) 2435 (2424 . 2435) (2422 . 2424) (t 23751 23800 445286 556000)) nil (23751 24252 173818 827000) 0 nil] [nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil ([nil nil ((1 . 3645) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>,
}

impl PubSub {
    pub fn new() -> Self {
        Self { socket: Arc::new(Mutex::new(None))}
    }
    pub fn from(self, timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let socket = if let Some(socket) = *self.socket.lock().unwrap() {
            socket
        } else {
            let (tx, mut rx) = tokio::sync::mpsc::channel(5);
            let socket = Socket::new(\"127.0.0.1:6379\", tx);

            tokio::spawn(futures::future::lazy(move || socket));

            loop {
                if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                    break msg;
                }
                thread::sleep(time::Duration::from_millis(100));
            }
        };

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 209 (fontified t face font-lock-constant-face) 209 211 (fontified t) 211 220 (fontified t face font-lock-type-face) 220 222 (fontified t) 222 225 (fontified t face font-lock-keyword-face) 225 226 (fontified t) 226 230 (fontified t face font-lock-constant-face) 230 232 (fontified t) 232 238 (fontified t face font-lock-type-face) 238 241 (fontified t) 241 244 (fontified t face font-lock-keyword-face) 244 245 (fontified t) 245 251 (fontified t face font-lock-keyword-face) 251 252 (fontified t) 252 268 (fontified t face font-lock-variable-name-face) 268 270 (fontified t) 270 281 (fontified t face font-lock-type-face) 281 284 (fontified t) 284 295 (fontified t face font-lock-type-face) 295 305 (fontified t) 305 308 (fontified t face font-lock-keyword-face) 308 309 (fontified t) 309 315 (fontified t face font-lock-keyword-face) 315 316 (fontified t) 316 331 (fontified t face font-lock-variable-name-face) 331 333 (fontified t) 333 344 (fontified t face font-lock-type-face) 344 347 (fontified t) 347 358 (fontified t face font-lock-type-face) 358 371 (fontified t) 371 374 (fontified t face font-lock-keyword-face) 374 375 (fontified t) 375 381 (fontified t face font-lock-keyword-face) 381 382 (fontified t) 382 390 (fontified t face font-lock-type-face) 390 397 (fontified t) 397 405 (fontified t face font-lock-variable-name-face) 405 407 (fontified t) 407 413 (fontified t face font-lock-type-face) 413 417 (fontified t) 417 421 (fontified t face font-lock-keyword-face) 421 422 (fontified t) 422 430 (fontified t face font-lock-type-face) 430 437 (fontified t) 437 439 (fontified t face font-lock-keyword-face) 439 440 (fontified t) 440 443 (fontified t face font-lock-function-name-face) 443 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 473 (fontified t) 473 476 (fontified t face font-lock-variable-name-face) 476 478 (fontified t) 478 482 (fontified t face font-lock-keyword-face) 482 483 (fontified t) 483 486 (fontified t face font-lock-constant-face) 486 488 (fontified t) 488 491 (fontified t face font-lock-constant-face) 491 493 (fontified t) 493 500 (fontified t face font-lock-type-face) 500 503 (fontified t) 503 504 (fontified t syntax-table #1#) 504 505 (fontified t) 505 509 (fontified t face font-lock-type-face) 509 512 (fontified t) 512 520 (fontified t) 520 523 (fontified t face font-lock-keyword-face) 523 581 (fontified t) 581 584 (fontified t face font-lock-keyword-face) 584 585 (fontified t) 585 593 (fontified t face font-lock-variable-name-face) 593 596 (fontified t) 596 603 (fontified t face rust-builtin-formatting-macro-face) 603 617 (fontified t) 617 625 (fontified t face font-lock-string-face) 625 637 (fontified t face rust-string-interpolation-face) 637 641 (fontified t face font-lock-string-face) 641 646 (fontified t face rust-string-interpolation-face) 646 651 (fontified t face font-lock-string-face) 651 663 (fontified t face rust-string-interpolation-face) 663 667 (fontified t face font-lock-string-face) 667 672 (fontified t face rust-string-interpolation-face) 672 677 (fontified t face font-lock-string-face) 677 815 (fontified t) 815 819 (fontified t face font-lock-type-face) 819 843 (fontified t) 843 846 (fontified t face font-lock-keyword-face) 846 847 (fontified t) 847 849 (fontified t face font-lock-keyword-face) 849 850 (fontified t) 850 871 (fontified t face font-lock-function-name-face) 871 872 (fontified t) 872 880 (fontified t face font-lock-variable-name-face) 880 883 (fontified t) 883 886 (fontified t face font-lock-type-face) 886 889 (fontified t) 889 890 (fontified t syntax-table #1#) 890 891 (fontified t) 891 897 (fontified t face font-lock-type-face) 897 908 (fontified t) 908 911 (fontified t face font-lock-keyword-face) 911 912 (fontified t) 912 919 (fontified t face font-lock-variable-name-face) 919 922 (fontified t) 922 929 (fontified t face rust-builtin-formatting-macro-face) 929 930 (fontified t) 930 940 (fontified t face font-lock-string-face) 940 942 (fontified t face rust-string-interpolation-face) 942 943 (fontified t face font-lock-string-face) 943 964 (fontified t) 964 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 977 (fontified t face font-lock-variable-name-face) 977 980 (fontified t) 980 988 (fontified t face font-lock-type-face) 988 994 (fontified t) 994 1005 (fontified t face font-lock-string-face) 1005 1012 (fontified t) 1012 1018 (fontified t) 1018 1026 (fontified t) 1026 1031 (fontified t face font-lock-preprocessor-face) 1031 1032 (fontified t) 1032 1051 (fontified t face font-lock-string-face) 1051 1101 (fontified t) 1101 1104 (fontified t face font-lock-keyword-face) 1104 1105 (fontified t) 1105 1107 (fontified t face font-lock-keyword-face) 1107 1108 (fontified t) 1108 1133 (fontified t face font-lock-function-name-face) 1133 1134 (fontified t) 1134 1142 (fontified t face font-lock-variable-name-face) 1142 1145 (fontified t) 1145 1148 (fontified t face font-lock-type-face) 1148 1151 (fontified t) 1151 1152 (fontified t syntax-table #1#) 1152 1153 (fontified t) 1153 1159 (fontified t face font-lock-type-face) 1159 1170 (fontified t) 1170 1173 (fontified t face font-lock-keyword-face) 1173 1174 (fontified t) 1174 1181 (fontified t face font-lock-variable-name-face) 1181 1184 (fontified t) 1184 1191 (fontified t face rust-builtin-formatting-macro-face) 1191 1192 (fontified t) 1192 1202 (fontified t face font-lock-string-face) 1202 1204 (fontified t face rust-string-interpolation-face) 1204 1205 (fontified t face font-lock-string-face) 1205 1226 (fontified t) 1226 1229 (fontified t face font-lock-keyword-face) 1229 1230 (fontified t) 1230 1241 (fontified t face font-lock-variable-name-face) 1241 1244 (fontified t) 1244 1252 (fontified t face font-lock-type-face) 1252 1258 (fontified t) 1258 1271 (fontified t face font-lock-string-face) 1271 1292 (fontified t) 1292 1297 (fontified t face font-lock-preprocessor-face) 1297 1298 (fontified t) 1298 1321 (fontified t face font-lock-string-face) 1321 1372 (fontified t) 1372 1375 (fontified t face font-lock-keyword-face) 1375 1376 (fontified t) 1376 1381 (fontified t face font-lock-constant-face) 1381 1383 (fontified t) 1383 1386 (fontified t face font-lock-constant-face) 1386 1388 (fontified t) 1388 1391 (fontified t face font-lock-constant-face) 1391 1393 (fontified t) 1393 1406 (fontified t face font-lock-type-face) 1406 1408 (fontified t) 1408 1414 (fontified t face font-lock-keyword-face) 1414 1415 (fontified t) 1415 1421 (fontified t face font-lock-type-face) 1421 1428 (fontified t) 1428 1435 (fontified t face font-lock-variable-name-face) 1435 1437 (fontified t) 1437 1450 (fontified t face font-lock-type-face) 1450 1456 (fontified t) 1456 1458 (fontified t face font-lock-variable-name-face) 1458 1460 (fontified t) 1460 1465 (fontified t face font-lock-constant-face) 1465 1467 (fontified t) 1467 1471 (fontified t face font-lock-constant-face) 1471 1473 (fontified t) 1473 1477 (fontified t face font-lock-constant-face) 1477 1479 (fontified t) 1479 1485 (fontified t face font-lock-type-face) 1485 1486 (fontified t) 1486 1495 (fontified t face font-lock-type-face) 1495 1500 (fontified t) 1500 1504 (fontified t face font-lock-keyword-face) 1504 1505 (fontified t) 1505 1511 (fontified t face font-lock-type-face) 1511 1518 (fontified t) 1518 1520 (fontified t face font-lock-keyword-face) 1520 1521 (fontified t) 1521 1524 (fontified t face font-lock-function-name-face) 1524 1525 (fontified t) 1525 1532 (fontified t face font-lock-variable-name-face) 1532 1534 (fontified t) 1534 1538 (fontified t face font-lock-keyword-face) 1538 1539 (fontified t) 1539 1542 (fontified t face font-lock-constant-face) 1542 1544 (fontified t) 1544 1547 (fontified t face font-lock-constant-face) 1547 1549 (fontified t) 1549 1556 (fontified t face font-lock-type-face) 1556 1558 (fontified t) 1558 1560 (fontified t face font-lock-variable-name-face) 1560 1562 (fontified t) 1562 1567 (fontified t face font-lock-constant-face) 1567 1569 (fontified t) 1569 1573 (fontified t face font-lock-constant-face) 1573 1575 (fontified t) 1575 1579 (fontified t face font-lock-constant-face) 1579 1581 (fontified t) 1581 1587 (fontified t face font-lock-type-face) 1587 1588 (fontified t) 1588 1597 (fontified t face font-lock-type-face) 1597 1601 (fontified t) 1601 1602 (fontified t syntax-table #1#) 1602 1603 (fontified t) 1603 1607 (fontified t face font-lock-type-face) 1607 1610 (fontified t) 1786 1794 (fontified t) 1794 1798 (fontified t face font-lock-type-face) 1798 1815 (fontified t) 1815 1823 (fontified t) 1823 1827 (fontified t face font-lock-keyword-face) 1827 1828 (fontified t) 1828 1834 (fontified t face font-lock-type-face) 1834 1835 (fontified t) 1835 1838 (fontified t face font-lock-keyword-face) 1838 1839 (fontified t) 1839 1845 (fontified t face font-lock-type-face) 1845 1852 (fontified t) 1852 1856 (fontified t face font-lock-keyword-face) 1856 1857 (fontified t) 1857 1861 (fontified t face font-lock-type-face) 1861 1872 (fontified t) 1872 1876 (fontified t face font-lock-keyword-face) 1876 1877 (fontified t) 1877 1882 (fontified t face font-lock-type-face) 1882 1894 (fontified t) 1894 1896 (fontified t face font-lock-keyword-face) 1896 1897 (fontified t) 1897 1901 (fontified t face font-lock-function-name-face) 1901 1903 (fontified t) 1903 1906 (fontified t face font-lock-keyword-face) 1906 1907 (fontified t) 1907 1911 (fontified t face font-lock-keyword-face) 1911 1914 (fontified t) 1914 1915 (syntax-table #1# fontified t) 1915 1916 (fontified t) 1916 1920 (fontified t face font-lock-type-face) 1920 1921 (fontified t) 1921 1925 (fontified t face font-lock-type-face) 1925 1927 (fontified t) 1927 1931 (fontified t face font-lock-type-face) 1931 1933 (fontified t) 1933 1937 (fontified t face font-lock-type-face) 1937 1939 (fontified t) 1939 1944 (fontified t face font-lock-type-face) 1944 1948 (fontified t) 1948 1956 (fontified t) 1956 1961 (fontified t face font-lock-keyword-face) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-keyword-face) 1966 1983 (fontified t) 1983 1996 (fontified t) 1996 1998 (fontified t face font-lock-type-face) 1998 1999 (fontified t) 1999 2004 (fontified t face font-lock-type-face) 2004 2006 (fontified t) 2006 2011 (fontified t face font-lock-type-face) 2011 2022 (fontified t) 2022 2023 (syntax-table #1# fontified t) 2023 2042 (fontified t) 2042 2046 (fontified t face font-lock-keyword-face) 2046 2082 (fontified t) 2082 2098 (fontified t face font-lock-string-face) 2098 2117 (fontified t) 2117 2119 (fontified t face font-lock-type-face) 2119 2120 (fontified t) 2120 2125 (fontified t face font-lock-type-face) 2125 2127 (fontified t) 2127 2132 (fontified t face font-lock-type-face) 2132 2164 (fontified t) 2164 2166 (fontified t face font-lock-type-face) 2166 2167 (fontified t) 2167 2172 (fontified t face font-lock-type-face) 2172 2174 (fontified t) 2174 2182 (fontified t face font-lock-type-face) 2182 2185 (fontified t) 2185 2186 (syntax-table #1# fontified t) 2186 2187 (fontified t) 2187 2189 (fontified t face font-lock-type-face) 2189 2190 (fontified t) 2190 2195 (fontified t face font-lock-type-face) 2195 2197 (fontified t) 2197 2205 (fontified t face font-lock-type-face) 2205 2220 (fontified t) 2220 2223 (fontified t face font-lock-type-face) 2223 2228 (fontified t) 2228 2229 (syntax-table #1# fontified t) 2229 2248 (fontified t) 2248 2253 (fontified t face font-lock-preprocessor-face) 2253 2254 (fontified t) 2254 2277 (fontified t face font-lock-string-face) 2277 2299 (fontified t) 2299 2301 (fontified t face font-lock-type-face) 2301 2302 (fontified t) 2302 2307 (fontified t face font-lock-type-face) 2307 2309 (fontified t) 2309 2314 (fontified t face font-lock-type-face) 2314 2315 (fontified t) 2315 2320 (fontified t) 2320 2353 (fontified t) 2353 2356 (fontified t face font-lock-keyword-face) 2356 2357 (fontified t) 2357 2363 (fontified t face font-lock-keyword-face) 2363 2364 (fontified t) 2364 2370 (fontified t face font-lock-type-face) 2370 2377 (fontified t) 2377 2383 (fontified t face font-lock-variable-name-face) 2383 2385 (fontified t) 2385 2388 (fontified t face font-lock-type-face) 2388 2389 (fontified t) 2389 2394 (fontified t face font-lock-type-face) 2394 2395 (fontified t) 2395 2401 (fontified t face font-lock-type-face) 2401 2402 (fontified t) 2402 2411 (fontified t face font-lock-type-face) 2411 2416 (fontified t) 2416 2418 (fontified t) 2418 2419 (fontified t) 2419 2423 (fontified t face font-lock-keyword-face) 2423 2424 (fontified t) 2424 2430 (fontified t face font-lock-type-face) 2430 2432 (fontified t) 2432 2433 (fontified t) 2433 2437 (fontified t) 2437 2440 (fontified t face font-lock-keyword-face) 2440 2441 (fontified t) 2441 2443 (fontified t face font-lock-keyword-face) 2443 2444 (fontified t) 2444 2447 (fontified t face font-lock-function-name-face) 2447 2451 (fontified t) 2451 2452 (fontified t syntax-table #1#) 2452 2453 (fontified t) 2453 2457 (fontified t face font-lock-type-face) 2457 2458 (fontified t) 2458 2459 (fontified t) 2459 2460 (fontified t) 2460 2468 (fontified t) 2468 2472 (fontified t face font-lock-type-face) 2472 2473 (fontified t) 2473 2475 (fontified t) 2475 2481 (fontified t face font-lock-variable-name-face) 2481 2483 (fontified t) 2483 2486 (fontified t face font-lock-type-face) 2486 2491 (fontified t) 2491 2492 (fontified t) 2492 2497 (fontified t face font-lock-type-face) 2497 2502 (fontified t) 2502 2503 (fontified t) 2503 2507 (fontified t face font-lock-type-face) 2507 2508 (fontified t) 2508 2509 (fontified t) 2509 2510 (fontified t) 2510 2511 (fontified t) 2511 2515 (fontified t) 2515 2516 (fontified t) 2516 2517 (fontified t) 2517 2521 (fontified t) 2521 2524 (fontified t face font-lock-keyword-face) 2524 2525 (fontified t) 2525 2527 (fontified t face font-lock-keyword-face) 2527 2528 (fontified t) 2528 2532 (fontified t face font-lock-function-name-face) 2532 2533 (fontified t) 2533 2537 (fontified t face font-lock-keyword-face) 2537 2539 (fontified t) 2539 2547 (fontified t face font-lock-variable-name-face) 2547 2549 (fontified t) 2549 2553 (fontified t face font-lock-keyword-face) 2553 2554 (fontified t) 2554 2557 (fontified t face font-lock-constant-face) 2557 2559 (fontified t) 2559 2562 (fontified t face font-lock-constant-face) 2562 2564 (fontified t) 2564 2567 (fontified t face font-lock-type-face) 2567 2571 (fontified t face font-lock-type-face) 2571 2573 (fontified t) 2573 2577 (fontified t face font-lock-variable-name-face) 2577 2580 (fontified t) 2580 2584 (fontified t face font-lock-type-face) 2584 2587 (fontified t) 2587 2588 (syntax-table #1# fontified t) 2588 2589 (fontified t) 2589 2595 (fontified t face font-lock-constant-face) 2595 2597 (fontified t) 2597 2605 (fontified t face font-lock-type-face) 2605 2608 (fontified t) 2608 2616 (fontified t) 2616 2621 (fontified t face font-lock-keyword-face) 2621 2622 (fontified t) 2622 2638 (fontified t face font-lock-type-face) 2638 2644 (fontified t) 2644 2652 (fontified t face font-lock-type-face) 2652 2654 (fontified t) 2654 2661 (fontified t face font-lock-type-face) 2661 2663 (fontified t) 2663 2664 (syntax-table #1# fontified t) 2664 2665 (fontified t) 2665 2680 (fontified t face font-lock-type-face) 2680 2686 (fontified t) 2686 2694 (fontified t face font-lock-type-face) 2694 2696 (fontified t) 2696 2703 (fontified t face font-lock-type-face) 2703 2719 (fontified t) 2719 2725 (fontified t face font-lock-constant-face) 2725 2733 (fontified t) 2733 2737 (fontified t face font-lock-constant-face) 2737 2739 (fontified t) 2739 2747 (fontified t face font-lock-type-face) 2747 2787 (fontified t) 2787 2790 (fontified t face font-lock-keyword-face) 2790 2791 (fontified t) 2791 2806 (fontified t face font-lock-variable-name-face) 2806 2809 (fontified t) 2809 2825 (fontified t face font-lock-type-face) 2825 2839 (fontified t) 2839 2847 (fontified t face font-lock-type-face) 2847 2849 (fontified t) 2849 2856 (fontified t face font-lock-type-face) 2856 2871 (fontified t) 2871 2876 (fontified t face font-lock-preprocessor-face) 2876 2877 (fontified t) 2877 2904 (fontified t face font-lock-string-face) 2904 2925 (fontified t) 2925 2933 (fontified t) 2933 2936 (fontified t face font-lock-keyword-face) 2936 2937 (fontified t) 2937 2943 (fontified t face font-lock-variable-name-face) 2943 2946 (fontified t) 2946 2948 (fontified t face font-lock-keyword-face) 2948 2949 (fontified t) 2949 2952 (fontified t face font-lock-keyword-face) 2952 2953 (fontified t) 2953 2957 (fontified t face font-lock-type-face) 2957 2969 (fontified t) 2969 2973 (fontified t face font-lock-keyword-face) 2973 2988 (fontified t) 2988 2994 (fontified t) 2994 2996 (fontified t) 2996 2999 (fontified t) 2999 3011 (fontified t) 3011 3012 (fontified t) 3012 3017 (fontified t) 3017 3018 (fontified t) 3018 3028 (fontified t) 3028 3032 (fontified t face font-lock-keyword-face) 3032 3047 (fontified t) 3047 3050 (fontified t face font-lock-keyword-face) 3050 3056 (fontified t) 3056 3059 (fontified t face font-lock-keyword-face) 3059 3066 (fontified t) 3066 3071 (fontified t face font-lock-constant-face) 3071 3073 (fontified t) 3073 3077 (fontified t face font-lock-constant-face) 3077 3079 (fontified t) 3079 3083 (fontified t face font-lock-constant-face) 3083 3109 (fontified t) 3109 3112 (fontified t face font-lock-keyword-face) 3112 3113 (fontified t) 3113 3118 (fontified t face font-lock-variable-name-face) 3118 3119 (fontified t face font-lock-variable-name-face) 3119 3122 (fontified t) 3122 3128 (fontified t face font-lock-type-face) 3128 3134 (fontified t) 3134 3150 (fontified t face font-lock-string-face) 3150 3157 (fontified t) 3157 3170 (fontified t) 3170 3175 (fontified t face font-lock-constant-face) 3175 3183 (fontified t) 3183 3190 (fontified t face font-lock-constant-face) 3190 3192 (fontified t) 3192 3198 (fontified t face font-lock-constant-face) 3198 3205 (fontified t) 3205 3209 (fontified t face font-lock-keyword-face) 3209 3236 (fontified t) 3236 3240 (fontified t face font-lock-keyword-face) 3240 3259 (fontified t) 3259 3261 (fontified t face font-lock-keyword-face) 3261 3262 (fontified t) 3262 3265 (fontified t face font-lock-keyword-face) 3265 3266 (fontified t) 3266 3268 (fontified t face font-lock-type-face) 3268 3269 (fontified t) 3269 3274 (fontified t face font-lock-type-face) 3274 3276 (fontified t) 3276 3281 (fontified t face font-lock-type-face) 3281 3282 (fontified t) 3282 3286 (fontified t face font-lock-type-face) 3286 3328 (fontified t) 3328 3333 (fontified t face font-lock-keyword-face) 3333 3373 (fontified t) 3373 3379 (fontified t face font-lock-constant-face) 3379 3387 (fontified t) 3387 3391 (fontified t face font-lock-constant-face) 3391 3393 (fontified t) 3393 3401 (fontified t face font-lock-type-face) 3401 3422 (fontified t) 3422 3435 (fontified t) 3435 3456 (fontified t) 3456 3459 (fontified t face font-lock-keyword-face) 3459 3460 (fontified t) 3460 3468 (fontified t face font-lock-variable-name-face) 3468 3499 (fontified t) 3499 3501 (fontified t) 3501 3504 (fontified t face font-lock-keyword-face) 3504 3505 (fontified t) 3505 3518 (fontified t face font-lock-variable-name-face) 3518 3530 (face font-lock-variable-name-face fontified t) 3530 3533 (fontified t) 3533 3539 (face font-lock-constant-face fontified t) 3539 3541 (fontified t) 3541 3549 (face font-lock-type-face fontified t) 3549 3580 (fontified t)) . 1) (undo-tree-id612 . -2953) (undo-tree-id613 . 1115) (undo-tree-id614 . -2418) (undo-tree-id615 . -2953) (undo-tree-id616 . -2953) (undo-tree-id617 . -3016) (undo-tree-id618 . -2418) (undo-tree-id619 . -2953) (undo-tree-id621 . -2475) (undo-tree-id623 . -2475) (undo-tree-id625 . -1815) (undo-tree-id627 . -1815) (undo-tree-id628 . -2475) (undo-tree-id629 . -2506) (undo-tree-id631 . -2492) (undo-tree-id633 . -2877) (undo-tree-id635 . -2491) (undo-tree-id637 . -2492) (undo-tree-id639 . -1815) (undo-tree-id641 . -2492) (undo-tree-id643 . -2494) (undo-tree-id645 . -1815) (undo-tree-id647 . -2494) (undo-tree-id649 . -2496) (undo-tree-id651 . -1815) (undo-tree-id653 . -2496) (undo-tree-id655 . -2498) (undo-tree-id657 . -1815) (undo-tree-id659 . -2498) (undo-tree-id661 . -2500) (undo-tree-id663 . -1815) (undo-tree-id665 . -2500) (undo-tree-id667 . -2502) (undo-tree-id669 . -1815) (undo-tree-id671 . -2502) (undo-tree-id673 . -2502) (undo-tree-id675 . -2503) (undo-tree-id677 . -2502) (undo-tree-id679 . -2504) (undo-tree-id681 . -1815) (undo-tree-id683 . -2504) (undo-tree-id685 . -2506) (undo-tree-id687 . -1815) (undo-tree-id689 . -2506) (undo-tree-id691 . -2506) (undo-tree-id693 . -1815) (undo-tree-id695 . -2524) (undo-tree-id697 . -2605) 2507) ((1 . 3623) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>,
}

impl PubSub {
    pub fn new() -> Self {
        Self {
            socket: Arc::new(Mutex::new(None)),
        }
    }
    pub fn from(self, timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let socket = if let Some(socket) = *self.socket.lock().unwrap() {
            socket
        } else {
            let (tx, mut rx) = tokio::sync::mpsc::channel(5);
            let socket = Socket::new(\"127.0.0.1:6379\", tx);

            tokio::spawn(futures::future::lazy(move || socket));

            loop {
                if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                    break msg;
                }
                thread::sleep(time::Duration::from_millis(100));
            }
        };

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 209 (fontified t face font-lock-constant-face) 209 211 (fontified t) 211 220 (fontified t face font-lock-type-face) 220 222 (fontified t) 222 225 (fontified t face font-lock-keyword-face) 225 226 (fontified t) 226 230 (fontified t face font-lock-constant-face) 230 232 (fontified t) 232 238 (fontified t face font-lock-type-face) 238 241 (fontified t) 241 244 (fontified t face font-lock-keyword-face) 244 245 (fontified t) 245 251 (fontified t face font-lock-keyword-face) 251 252 (fontified t) 252 268 (fontified t face font-lock-variable-name-face) 268 270 (fontified t) 270 281 (fontified t face font-lock-type-face) 281 284 (fontified t) 284 295 (fontified t face font-lock-type-face) 295 305 (fontified t) 305 308 (fontified t face font-lock-keyword-face) 308 309 (fontified t) 309 315 (fontified t face font-lock-keyword-face) 315 316 (fontified t) 316 331 (fontified t face font-lock-variable-name-face) 331 333 (fontified t) 333 344 (fontified t face font-lock-type-face) 344 347 (fontified t) 347 358 (fontified t face font-lock-type-face) 358 371 (fontified t) 371 374 (fontified t face font-lock-keyword-face) 374 375 (fontified t) 375 381 (fontified t face font-lock-keyword-face) 381 382 (fontified t) 382 390 (fontified t face font-lock-type-face) 390 397 (fontified t) 397 405 (fontified t face font-lock-variable-name-face) 405 407 (fontified t) 407 413 (fontified t face font-lock-type-face) 413 417 (fontified t) 417 421 (fontified t face font-lock-keyword-face) 421 422 (fontified t) 422 430 (fontified t face font-lock-type-face) 430 437 (fontified t) 437 439 (fontified t face font-lock-keyword-face) 439 440 (fontified t) 440 443 (fontified t face font-lock-function-name-face) 443 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 473 (fontified t) 473 476 (fontified t face font-lock-variable-name-face) 476 478 (fontified t) 478 482 (fontified t face font-lock-keyword-face) 482 483 (fontified t) 483 486 (fontified t face font-lock-constant-face) 486 488 (fontified t) 488 491 (fontified t face font-lock-constant-face) 491 493 (fontified t) 493 500 (fontified t face font-lock-type-face) 500 503 (fontified t) 503 504 (fontified t syntax-table #1#) 504 505 (fontified t) 505 509 (fontified t face font-lock-type-face) 509 512 (fontified t) 512 520 (fontified t) 520 523 (fontified t face font-lock-keyword-face) 523 581 (fontified t) 581 584 (fontified t face font-lock-keyword-face) 584 585 (fontified t) 585 593 (fontified t face font-lock-variable-name-face) 593 596 (fontified t) 596 603 (fontified t face rust-builtin-formatting-macro-face) 603 617 (fontified t) 617 625 (fontified t face font-lock-string-face) 625 637 (fontified t face rust-string-interpolation-face) 637 641 (fontified t face font-lock-string-face) 641 646 (fontified t face rust-string-interpolation-face) 646 651 (fontified t face font-lock-string-face) 651 663 (fontified t face rust-string-interpolation-face) 663 667 (fontified t face font-lock-string-face) 667 672 (fontified t face rust-string-interpolation-face) 672 677 (fontified t face font-lock-string-face) 677 815 (fontified t) 815 819 (fontified t face font-lock-type-face) 819 843 (fontified t) 843 846 (fontified t face font-lock-keyword-face) 846 847 (fontified t) 847 849 (fontified t face font-lock-keyword-face) 849 850 (fontified t) 850 871 (fontified t face font-lock-function-name-face) 871 872 (fontified t) 872 880 (fontified t face font-lock-variable-name-face) 880 883 (fontified t) 883 886 (fontified t face font-lock-type-face) 886 889 (fontified t) 889 890 (fontified t syntax-table #1#) 890 891 (fontified t) 891 897 (fontified t face font-lock-type-face) 897 908 (fontified t) 908 911 (fontified t face font-lock-keyword-face) 911 912 (fontified t) 912 919 (fontified t face font-lock-variable-name-face) 919 922 (fontified t) 922 929 (fontified t face rust-builtin-formatting-macro-face) 929 930 (fontified t) 930 940 (fontified t face font-lock-string-face) 940 942 (fontified t face rust-string-interpolation-face) 942 943 (fontified t face font-lock-string-face) 943 964 (fontified t) 964 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 977 (fontified t face font-lock-variable-name-face) 977 980 (fontified t) 980 988 (fontified t face font-lock-type-face) 988 994 (fontified t) 994 1005 (fontified t face font-lock-string-face) 1005 1012 (fontified t) 1012 1018 (fontified t) 1018 1026 (fontified t) 1026 1031 (fontified t face font-lock-preprocessor-face) 1031 1032 (fontified t) 1032 1051 (fontified t face font-lock-string-face) 1051 1101 (fontified t) 1101 1104 (fontified t face font-lock-keyword-face) 1104 1105 (fontified t) 1105 1107 (fontified t face font-lock-keyword-face) 1107 1108 (fontified t) 1108 1133 (fontified t face font-lock-function-name-face) 1133 1134 (fontified t) 1134 1142 (fontified t face font-lock-variable-name-face) 1142 1145 (fontified t) 1145 1148 (fontified t face font-lock-type-face) 1148 1151 (fontified t) 1151 1152 (fontified t syntax-table #1#) 1152 1153 (fontified t) 1153 1159 (fontified t face font-lock-type-face) 1159 1170 (fontified t) 1170 1173 (fontified t face font-lock-keyword-face) 1173 1174 (fontified t) 1174 1181 (fontified t face font-lock-variable-name-face) 1181 1184 (fontified t) 1184 1191 (fontified t face rust-builtin-formatting-macro-face) 1191 1192 (fontified t) 1192 1202 (fontified t face font-lock-string-face) 1202 1204 (fontified t face rust-string-interpolation-face) 1204 1205 (fontified t face font-lock-string-face) 1205 1226 (fontified t) 1226 1229 (fontified t face font-lock-keyword-face) 1229 1230 (fontified t) 1230 1241 (fontified t face font-lock-variable-name-face) 1241 1244 (fontified t) 1244 1252 (fontified t face font-lock-type-face) 1252 1258 (fontified t) 1258 1271 (fontified t face font-lock-string-face) 1271 1292 (fontified t) 1292 1297 (fontified t face font-lock-preprocessor-face) 1297 1298 (fontified t) 1298 1321 (fontified t face font-lock-string-face) 1321 1372 (fontified t) 1372 1375 (fontified t face font-lock-keyword-face) 1375 1376 (fontified t) 1376 1381 (fontified t face font-lock-constant-face) 1381 1383 (fontified t) 1383 1386 (fontified t face font-lock-constant-face) 1386 1388 (fontified t) 1388 1391 (fontified t face font-lock-constant-face) 1391 1393 (fontified t) 1393 1406 (fontified t face font-lock-type-face) 1406 1408 (fontified t) 1408 1414 (fontified t face font-lock-keyword-face) 1414 1415 (fontified t) 1415 1421 (fontified t face font-lock-type-face) 1421 1428 (fontified t) 1428 1435 (fontified t face font-lock-variable-name-face) 1435 1437 (fontified t) 1437 1450 (fontified t face font-lock-type-face) 1450 1456 (fontified t) 1456 1458 (fontified t face font-lock-variable-name-face) 1458 1460 (fontified t) 1460 1465 (fontified t face font-lock-constant-face) 1465 1467 (fontified t) 1467 1471 (fontified t face font-lock-constant-face) 1471 1473 (fontified t) 1473 1477 (fontified t face font-lock-constant-face) 1477 1479 (fontified t) 1479 1485 (fontified t face font-lock-type-face) 1485 1486 (fontified t) 1486 1495 (fontified t face font-lock-type-face) 1495 1500 (fontified t) 1500 1504 (fontified t face font-lock-keyword-face) 1504 1505 (fontified t) 1505 1511 (fontified t face font-lock-type-face) 1511 1518 (fontified t) 1518 1520 (fontified t face font-lock-keyword-face) 1520 1521 (fontified t) 1521 1524 (fontified t face font-lock-function-name-face) 1524 1525 (fontified t) 1525 1532 (fontified t face font-lock-variable-name-face) 1532 1534 (fontified t) 1534 1538 (fontified t face font-lock-keyword-face) 1538 1539 (fontified t) 1539 1542 (fontified t face font-lock-constant-face) 1542 1544 (fontified t) 1544 1547 (fontified t face font-lock-constant-face) 1547 1549 (fontified t) 1549 1556 (fontified t face font-lock-type-face) 1556 1558 (fontified t) 1558 1560 (fontified t face font-lock-variable-name-face) 1560 1562 (fontified t) 1562 1567 (fontified t face font-lock-constant-face) 1567 1569 (fontified t) 1569 1573 (fontified t face font-lock-constant-face) 1573 1575 (fontified t) 1575 1579 (fontified t face font-lock-constant-face) 1579 1581 (fontified t) 1581 1587 (fontified t face font-lock-type-face) 1587 1588 (fontified t) 1588 1597 (fontified t face font-lock-type-face) 1597 1601 (fontified t) 1601 1602 (fontified t syntax-table #1#) 1602 1603 (fontified t) 1603 1607 (fontified t face font-lock-type-face) 1607 1610 (fontified t) 1823 1827 (face font-lock-keyword-face) 1828 1834 (face font-lock-type-face) 1835 1838 (face font-lock-keyword-face) 1839 1845 (face font-lock-type-face) 1852 1856 (face font-lock-keyword-face) 1857 1861 (face font-lock-type-face) 1868 1872 (fontified t) 1872 1876 (fontified t face font-lock-keyword-face) 1876 1877 (fontified t) 1877 1882 (fontified t face font-lock-type-face) 1882 1894 (fontified t) 1894 1896 (fontified t face font-lock-keyword-face) 1896 1897 (fontified t) 1897 1901 (fontified t face font-lock-function-name-face) 1901 1903 (fontified t) 1903 1906 (fontified t face font-lock-keyword-face) 1906 1907 (fontified t) 1907 1911 (fontified t face font-lock-keyword-face) 1911 1914 (fontified t) 1914 1915 (syntax-table #1# fontified t) 1915 1916 (fontified t) 1916 1920 (fontified t face font-lock-type-face) 1920 1921 (fontified t) 1921 1925 (fontified t face font-lock-type-face) 1925 1927 (fontified t) 1927 1931 (fontified t face font-lock-type-face) 1931 1933 (fontified t) 1933 1937 (fontified t face font-lock-type-face) 1937 1939 (fontified t) 1939 1944 (fontified t face font-lock-type-face) 1944 1956 (fontified t) 1956 1961 (fontified t face font-lock-keyword-face) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-keyword-face) 1966 1996 (fontified t) 1996 1998 (fontified t face font-lock-type-face) 1998 1999 (fontified t) 1999 2004 (fontified t face font-lock-type-face) 2004 2006 (fontified t) 2006 2011 (fontified t face font-lock-type-face) 2011 2022 (fontified t) 2022 2023 (syntax-table #1# fontified t) 2023 2042 (fontified t) 2042 2046 (fontified t face font-lock-keyword-face) 2046 2082 (fontified t) 2082 2098 (fontified t face font-lock-string-face) 2098 2117 (fontified t) 2117 2119 (fontified t face font-lock-type-face) 2119 2120 (fontified t) 2120 2125 (fontified t face font-lock-type-face) 2125 2127 (fontified t) 2127 2132 (fontified t face font-lock-type-face) 2132 2164 (fontified t) 2164 2166 (fontified t face font-lock-type-face) 2166 2167 (fontified t) 2167 2172 (fontified t face font-lock-type-face) 2172 2174 (fontified t) 2174 2182 (fontified t face font-lock-type-face) 2182 2185 (fontified t) 2185 2186 (syntax-table #1# fontified t) 2186 2187 (fontified t) 2187 2189 (fontified t face font-lock-type-face) 2189 2190 (fontified t) 2190 2195 (fontified t face font-lock-type-face) 2195 2197 (fontified t) 2197 2205 (fontified t face font-lock-type-face) 2205 2220 (fontified t) 2220 2223 (fontified t face font-lock-type-face) 2223 2228 (fontified t) 2228 2229 (syntax-table #1# fontified t) 2229 2248 (fontified t) 2248 2253 (fontified t face font-lock-preprocessor-face) 2253 2254 (fontified t) 2254 2277 (fontified t face font-lock-string-face) 2277 2299 (fontified t) 2299 2301 (fontified t face font-lock-type-face) 2301 2302 (fontified t) 2302 2307 (fontified t face font-lock-type-face) 2307 2309 (fontified t) 2309 2314 (fontified t face font-lock-type-face) 2314 2320 (fontified t) 2320 2353 (fontified t) 2353 2356 (fontified t face font-lock-keyword-face) 2356 2357 (fontified t) 2357 2363 (fontified t face font-lock-keyword-face) 2363 2364 (fontified t) 2364 2368 (fontified t face font-lock-type-face) 2368 2370 (face font-lock-type-face fontified t) 2370 2373 (fontified t) 2373 2377 (fontified t) 2377 2383 (fontified t face font-lock-variable-name-face) 2383 2385 (fontified t) 2385 2388 (fontified t face font-lock-type-face) 2388 2389 (fontified t) 2389 2394 (fontified t face font-lock-type-face) 2394 2395 (fontified t) 2395 2401 (fontified t face font-lock-type-face) 2401 2402 (fontified t) 2402 2411 (fontified t face font-lock-type-face) 2411 2419 (fontified t) 2419 2423 (fontified t face font-lock-keyword-face) 2423 2424 (fontified t) 2424 2430 (fontified t face font-lock-type-face) 2430 2437 (fontified t) 2437 2440 (fontified t face font-lock-keyword-face) 2440 2441 (fontified t) 2441 2443 (fontified t face font-lock-keyword-face) 2443 2444 (fontified t) 2444 2447 (fontified t face font-lock-function-name-face) 2447 2451 (fontified t) 2451 2452 (syntax-table #1# fontified t) 2452 2453 (fontified t) 2453 2457 (fontified t face font-lock-type-face) 2457 2460 (fontified t) 2460 2468 (fontified t) 2468 2472 (fontified t face font-lock-type-face) 2472 2474 (fontified t) 2474 2487 (fontified t) 2487 2493 (fontified t face font-lock-variable-name-face) 2493 2495 (fontified t) 2495 2498 (fontified t face font-lock-type-face) 2498 2504 (fontified t) 2504 2509 (fontified t face font-lock-type-face) 2509 2515 (fontified t) 2515 2519 (fontified t face font-lock-type-face) 2519 2543 (fontified t) 2543 2546 (fontified t face font-lock-keyword-face) 2546 2547 (fontified t) 2547 2549 (fontified t face font-lock-keyword-face) 2549 2550 (fontified t) 2550 2554 (fontified t face font-lock-function-name-face) 2554 2555 (fontified t) 2555 2559 (fontified t face font-lock-keyword-face) 2559 2561 (fontified t) 2561 2569 (fontified t face font-lock-variable-name-face) 2569 2571 (fontified t) 2571 2575 (fontified t face font-lock-keyword-face) 2575 2576 (fontified t) 2576 2579 (fontified t face font-lock-constant-face) 2579 2581 (fontified t) 2581 2584 (fontified t face font-lock-constant-face) 2584 2586 (fontified t) 2586 2593 (fontified t face font-lock-type-face) 2593 2595 (fontified t) 2595 2599 (fontified t face font-lock-variable-name-face) 2599 2602 (fontified t) 2602 2606 (fontified t face font-lock-type-face) 2606 2609 (fontified t) 2609 2610 (syntax-table #1# fontified t) 2610 2611 (fontified t) 2611 2617 (fontified t face font-lock-constant-face) 2617 2619 (fontified t) 2619 2627 (fontified t face font-lock-type-face) 2627 2638 (fontified t) 2638 2643 (fontified t face font-lock-keyword-face) 2643 2644 (fontified t) 2644 2660 (fontified t face font-lock-type-face) 2660 2666 (fontified t) 2666 2674 (fontified t face font-lock-type-face) 2674 2676 (fontified t) 2676 2683 (fontified t face font-lock-type-face) 2683 2685 (fontified t) 2685 2686 (syntax-table #1# fontified t) 2686 2687 (fontified t) 2687 2702 (fontified t face font-lock-type-face) 2702 2708 (fontified t) 2708 2716 (fontified t face font-lock-type-face) 2716 2718 (fontified t) 2718 2725 (fontified t face font-lock-type-face) 2725 2741 (fontified t) 2741 2747 (fontified t face font-lock-constant-face) 2747 2755 (fontified t) 2755 2759 (fontified t face font-lock-constant-face) 2759 2761 (fontified t) 2761 2769 (fontified t face font-lock-type-face) 2769 2809 (fontified t) 2809 2812 (fontified t face font-lock-keyword-face) 2812 2813 (fontified t) 2813 2828 (fontified t face font-lock-variable-name-face) 2828 2831 (fontified t) 2831 2847 (fontified t face font-lock-type-face) 2847 2861 (fontified t) 2861 2869 (fontified t face font-lock-type-face) 2869 2871 (fontified t) 2871 2873 (fontified t face font-lock-type-face) 2873 2878 (face font-lock-type-face fontified t) 2878 2885 (fontified t) 2885 2893 (fontified t) 2893 2898 (fontified t face font-lock-preprocessor-face) 2898 2899 (fontified t) 2899 2926 (fontified t face font-lock-string-face) 2926 2955 (fontified t) 2955 2958 (fontified t face font-lock-keyword-face) 2958 2959 (fontified t) 2959 2965 (fontified t face font-lock-variable-name-face) 2965 2968 (fontified t) 2968 2970 (fontified t face font-lock-keyword-face) 2970 2971 (fontified t) 2971 2974 (fontified t face font-lock-keyword-face) 2974 2975 (fontified t) 2975 2979 (fontified t face font-lock-type-face) 2979 2991 (fontified t) 2991 2995 (fontified t face font-lock-keyword-face) 2995 3021 (fontified t) 3021 3050 (fontified t) 3050 3054 (fontified t face font-lock-keyword-face) 3054 3069 (fontified t) 3069 3072 (fontified t face font-lock-keyword-face) 3072 3078 (fontified t) 3078 3081 (fontified t face font-lock-keyword-face) 3081 3088 (fontified t) 3088 3093 (fontified t face font-lock-constant-face) 3093 3095 (fontified t) 3095 3099 (fontified t face font-lock-constant-face) 3099 3101 (fontified t) 3101 3105 (fontified t face font-lock-constant-face) 3105 3131 (fontified t) 3131 3134 (fontified t face font-lock-keyword-face) 3134 3135 (fontified t) 3135 3141 (fontified t face font-lock-variable-name-face) 3141 3144 (fontified t) 3144 3150 (fontified t face font-lock-type-face) 3150 3156 (fontified t) 3156 3172 (fontified t face font-lock-string-face) 3172 3192 (fontified t) 3192 3197 (fontified t face font-lock-constant-face) 3197 3205 (fontified t) 3205 3212 (fontified t face font-lock-constant-face) 3212 3214 (fontified t) 3214 3220 (fontified t face font-lock-constant-face) 3220 3227 (fontified t) 3227 3231 (fontified t face font-lock-keyword-face) 3231 3258 (fontified t) 3258 3262 (fontified t face font-lock-keyword-face) 3262 3281 (fontified t) 3281 3283 (fontified t face font-lock-keyword-face) 3283 3284 (fontified t) 3284 3287 (fontified t face font-lock-keyword-face) 3287 3288 (fontified t) 3288 3290 (fontified t face font-lock-type-face) 3290 3291 (fontified t) 3291 3296 (fontified t face font-lock-type-face) 3296 3298 (fontified t) 3298 3303 (fontified t face font-lock-type-face) 3303 3304 (fontified t) 3304 3308 (fontified t face font-lock-type-face) 3308 3350 (fontified t) 3350 3355 (fontified t face font-lock-keyword-face) 3355 3385 (fontified t) 3385 3395 (fontified t) 3395 3401 (face font-lock-constant-face fontified t) 3401 3409 (fontified t) 3409 3413 (face font-lock-constant-face fontified t) 3413 3415 (fontified t) 3415 3423 (face font-lock-type-face fontified t) 3423 3444 (fontified t) 3478 3481 (face font-lock-keyword-face) 3482 3490 (face font-lock-variable-name-face) 3523 3526 (face font-lock-keyword-face) 3527 3552 (face font-lock-variable-name-face) 3555 3561 (face font-lock-constant-face) 3563 3571 (face font-lock-type-face)) . 1) (undo-tree-id716 . -2446) (undo-tree-id717 . -1868) (undo-tree-id718 . -2446) (undo-tree-id719 . -2543) (undo-tree-id720 . -2627) (undo-tree-id721 . -2446) (undo-tree-id722 . -2473) (undo-tree-id723 . -1868) (undo-tree-id724 . -2446) (undo-tree-id725 . -2446) (undo-tree-id726 . -2353) (undo-tree-id727 . -2370) (undo-tree-id728 . -2353) (undo-tree-id729 . -2370) (undo-tree-id730 . -2353) (undo-tree-id731 . -2370) (undo-tree-id732 . -2543) (undo-tree-id733 . -2627) (undo-tree-id734 . -2543) (undo-tree-id735 . -2627) (undo-tree-id736 . -2543) (undo-tree-id737 . -2627) (undo-tree-id738 . -2543) (undo-tree-id739 . -2627) (undo-tree-id740 . -2543) (undo-tree-id741 . -2627) (undo-tree-id742 . -2543) (undo-tree-id743 . -2627) (undo-tree-id744 . -2543) (undo-tree-id745 . -2627) (undo-tree-id746 . -2543) (undo-tree-id747 . -2627) (undo-tree-id748 . -2543) (undo-tree-id749 . -2627) (undo-tree-id750 . -2543) (undo-tree-id751 . -2627) (undo-tree-id752 . -2543) (undo-tree-id753 . -2627) (undo-tree-id754 . -2543) (undo-tree-id755 . -2627) (undo-tree-id756 . -2543) (undo-tree-id757 . -2627) (undo-tree-id758 . -2543) (undo-tree-id759 . -2627) (undo-tree-id760 . -2543) (undo-tree-id761 . -2627) (undo-tree-id762 . -2446) (undo-tree-id763 . -2446) (undo-tree-id764 . -1868) (undo-tree-id765 . -2446) (undo-tree-id766 . -2446) (undo-tree-id767 . -1868) (undo-tree-id768 . -2446) (undo-tree-id769 . -2446) (undo-tree-id770 . -1868) (undo-tree-id771 . -2446) (undo-tree-id772 . -2446) (undo-tree-id773 . -2446) (undo-tree-id774 . -1868) (undo-tree-id775 . -2446) (undo-tree-id776 . -2446) (undo-tree-id777 . -2446) (undo-tree-id778 . -1868) (undo-tree-id779 . -1868) (undo-tree-id780 . -2446) (undo-tree-id781 . -2488) (undo-tree-id782 . -2446) (undo-tree-id783 . -2446) (undo-tree-id784 . -1868) (undo-tree-id785 . -2473) (undo-tree-id786 . -2446) (undo-tree-id787 . -1868) (undo-tree-id788 . -2899) (undo-tree-id789 . -2900) (undo-tree-id790 . -2488) (undo-tree-id791 . -2473) (undo-tree-id792 . -1868) (undo-tree-id793 . -2377) (undo-tree-id794 . -2383) (undo-tree-id795 . -2487) (undo-tree-id796 . -2493) (undo-tree-id797 . -2996) (undo-tree-id798 . -3002) (undo-tree-id799 . -2488) (undo-tree-id800 . -2488) (undo-tree-id801 . -1868) (t 23751 19532 724915 746000)) (23751 19532 618912 176000) 0 nil]) ((2504 . 2508) (2503 . 2505) (#("(" 0 1 (fontified nil)) . -2503) (undo-tree-id699 . -1) (2493 . 2504)) ((#("Mutex::new(" 0 5 (fontified nil face font-lock-type-face) 5 10 (fontified nil) 10 11 (fontified nil)) . 2493) (undo-tree-id802 . -10) (undo-tree-id803 . -10) (undo-tree-id804 . -10) (undo-tree-id805 . -10) (undo-tree-id806 . -10) (undo-tree-id807 . -10) (undo-tree-id808 . -10) (2503 . 2504) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2503) (undo-tree-id809 . 1) (undo-tree-id810 . -1) (undo-tree-id811 . -1) (undo-tree-id812 . -1) (undo-tree-id813 . -1) (undo-tree-id814 . -1) (undo-tree-id815 . -1) (undo-tree-id816 . -1) (#("None" 0 4 (fontified t face font-lock-type-face)) . 2504) (undo-tree-id817 . -3) (undo-tree-id818 . -3) (undo-tree-id819 . -3) (undo-tree-id820 . -3) (undo-tree-id821 . -3) (undo-tree-id822 . -3) (undo-tree-id823 . -3)) (23751 23780 318853 695000) 0 nil]) ((#(")" 0 1 (fontified nil)) . 2494) (2493 . 2494) (2492 . 2494) (#("(" 0 1 (fontified nil)) . -2492) (2484 . 2493) (#("N" 0 1 (fontified t face font-lock-type-face)) . -2484) (undo-tree-id700 . -1) (#("e" 0 1 (fontified t face font-lock-type-face)) . -2485) (undo-tree-id701 . -1) (#("w" 0 1 (fontified t face font-lock-type-face)) . -2486) (undo-tree-id702 . -1) 2487 (2480 . 2487) (#("w" 0 1 (fontified t)) . -2480) (undo-tree-id703 . -1) 2481 (2476 . 2481) (#("A" 0 1 (fontified t face font-lock-type-face)) . -2476) (undo-tree-id705 . -1) (undo-tree-id706 . -1) (undo-tree-id707 . -1) (#("r" 0 1 (fontified t face font-lock-type-face)) . -2477) (undo-tree-id708 . -1) (#("c" 0 1 (fontified t face font-lock-type-face)) . -2478) (undo-tree-id709 . -1) (#(":" 0 1 (fontified t)) . -2479) (undo-tree-id710 . -1) (#(":" 0 1 (fontified t)) . -2480) (undo-tree-id711 . -1) 2481 (2477 . 2481) (2475 . 2477) (2474 . 2476) (#("{" 0 1 (fontified nil)) . -2474) (2474 . 2475)) ((#("{" 0 1 (fontified nil)) . 2474) (undo-tree-id824 . 1) (undo-tree-id825 . 1) (undo-tree-id826 . 1) (2474 . 2475) (#("{}" 0 1 (fontified nil) 1 2 (fontified nil)) . 2474) (undo-tree-id827 . 1) (undo-tree-id828 . -1) (undo-tree-id829 . -1) (undo-tree-id830 . -1) (undo-tree-id831 . -1) (undo-tree-id832 . -1) (undo-tree-id833 . -1) (undo-tree-id834 . -1) (undo-tree-id835 . -1) (undo-tree-id836 . -1) (undo-tree-id837 . -1) (undo-tree-id838 . -1) (undo-tree-id839 . 1) (undo-tree-id840 . -1) (undo-tree-id841 . 1) (undo-tree-id842 . -1) (undo-tree-id843 . 1) (undo-tree-id844 . -1) (#(" A" 0 1 (fontified nil) 1 2 (fontified nil face font-lock-type-face)) . 2475) (undo-tree-id845 . -1) (undo-tree-id846 . -1) (undo-tree-id847 . -1) (undo-tree-id848 . -2) (undo-tree-id849 . -2) (undo-tree-id850 . -1) (undo-tree-id851 . -1) (undo-tree-id852 . -1) (undo-tree-id853 . -1) (undo-tree-id854 . -1) (undo-tree-id855 . -1) (undo-tree-id856 . 1) (undo-tree-id857 . -1) (undo-tree-id858 . 1) (undo-tree-id859 . -1) (undo-tree-id860 . 1) (undo-tree-id861 . -1) (#("rc::" 0 1 (fontified nil face font-lock-type-face) 1 2 (fontified nil face font-lock-type-face) 2 3 (fontified nil) 3 4 (fontified nil)) . 2477) (undo-tree-id862 . -4) (2476 . 2481) (#("sockw" 0 4 (fontified nil face font-lock-variable-name-face) 4 5 (fontified nil)) . 2476) (undo-tree-id863 . -4) (undo-tree-id864 . -4) (undo-tree-id865 . -4) (undo-tree-id866 . -4) (undo-tree-id867 . -5) (undo-tree-id868 . -4) (undo-tree-id869 . -4) (undo-tree-id870 . -4) (undo-tree-id871 . -4) (undo-tree-id872 . -4) (undo-tree-id873 . -4) (undo-tree-id874 . 1) (undo-tree-id875 . -4) (undo-tree-id876 . 1) (undo-tree-id877 . -4) (undo-tree-id878 . 1) (undo-tree-id879 . -4) (2480 . 2481) (#("et: New" 0 2 (fontified nil face font-lock-variable-name-face) 2 4 (fontified nil) 4 5 (fontified nil face font-lock-type-face) 5 6 (fontified nil face font-lock-type-face) 6 7 (fontified nil face font-lock-type-face)) . 2480) (undo-tree-id880 . -4) (undo-tree-id881 . -4) (undo-tree-id882 . -4) (undo-tree-id883 . -4) (undo-tree-id884 . -7) (undo-tree-id885 . -4) (undo-tree-id886 . -4) (undo-tree-id887 . -4) (undo-tree-id888 . -4) (undo-tree-id889 . -4) (undo-tree-id890 . -4) (undo-tree-id891 . 3) (undo-tree-id892 . -4) (undo-tree-id893 . 3) (undo-tree-id894 . -4) (undo-tree-id895 . 3) (undo-tree-id896 . -4) (2484 . 2487) (#("Arc::new(" 0 3 (fontified nil face font-lock-type-face) 3 8 (fontified nil) 8 9 (fontified nil)) . 2484) (undo-tree-id897 . -8) (undo-tree-id898 . -8) (undo-tree-id899 . -8) (undo-tree-id900 . -8) (undo-tree-id901 . -8) (undo-tree-id902 . -8) (undo-tree-id903 . -8) (undo-tree-id904 . -8) (undo-tree-id905 . -8) (undo-tree-id906 . -8) (undo-tree-id907 . -8) (undo-tree-id908 . 1) (undo-tree-id909 . -8) (undo-tree-id910 . 1) (undo-tree-id911 . -8) (undo-tree-id912 . 1) (undo-tree-id913 . -8) (2492 . 2493) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2492) (undo-tree-id914 . 1) (undo-tree-id915 . -1) (undo-tree-id916 . -1) (undo-tree-id917 . -1) (undo-tree-id918 . -1) (undo-tree-id919 . -1) (undo-tree-id920 . -1) (undo-tree-id921 . -1) (undo-tree-id922 . -1) (undo-tree-id923 . -1) (undo-tree-id924 . -1) (undo-tree-id925 . 2) (undo-tree-id926 . -1) (undo-tree-id927 . 1) (undo-tree-id928 . -1) (undo-tree-id929 . 1) (undo-tree-id930 . -1) (#(")" 0 1 (fontified nil)) . 2493) (undo-tree-id931 . 1) (undo-tree-id932 . 1) (undo-tree-id933 . 1) (undo-tree-id934 . -1) (2494 . 2495)) (23751 23781 962876 139000) 0 nil]) ((#("}" 0 1 (fontified nil)) . -2474) (2474 . 2475) (#(" " 0 1 (fontified nil)) . -2474) (2474 . 2475) (#("}" 0 1 (fontified nil)) . -2474) (2473 . 2475) (#(":" 0 1 (fontified t)) . -2473) (undo-tree-id712 . -1) 2474 (2473 . 2474) (#(" " 0 1 (fontified t)) . -2473) (undo-tree-id713 . -1) 2474 (2470 . 2474) (#("l" 0 1 (fontified t face font-lock-type-face)) . -2470) (undo-tree-id714 . -1) 2471 (2469 . 2471) (2460 . 2469) 2437) ((#("
        " 0 1 (fontified t) 1 9 (fontified nil)) . 2460) (undo-tree-id935 . -9) (undo-tree-id936 . -9) (undo-tree-id937 . -9) (undo-tree-id938 . -9) (undo-tree-id939 . -9) (undo-tree-id940 . -9) (undo-tree-id941 . -9) (undo-tree-id942 . -9) (undo-tree-id943 . -9) (undo-tree-id944 . -9) (undo-tree-id945 . -9) (undo-tree-id946 . -1) (undo-tree-id947 . -9) (undo-tree-id948 . -9) (undo-tree-id949 . -9) (#("Sl" 0 1 (fontified nil face font-lock-type-face) 1 2 (fontified nil face font-lock-type-face)) . 2469) (undo-tree-id950 . -1) (undo-tree-id951 . -1) (undo-tree-id952 . -1) (undo-tree-id953 . -1) (undo-tree-id954 . -2) (undo-tree-id955 . -1) (undo-tree-id956 . -1) (undo-tree-id957 . -1) (undo-tree-id958 . -1) (undo-tree-id959 . -1) (undo-tree-id960 . -1) (undo-tree-id961 . -1) (undo-tree-id962 . -1) (undo-tree-id963 . -1) (2470 . 2471) (#("elf " 0 3 (fontified nil face font-lock-type-face) 3 4 (fontified nil)) . 2470) (undo-tree-id964 . -3) (undo-tree-id965 . -3) (undo-tree-id966 . -3) (undo-tree-id967 . -3) (undo-tree-id968 . -4) (undo-tree-id969 . -3) (undo-tree-id970 . -3) (undo-tree-id971 . -3) (undo-tree-id972 . -3) (undo-tree-id973 . -3) (undo-tree-id974 . -3) (undo-tree-id975 . -3) (undo-tree-id976 . -3) (undo-tree-id977 . -3) (2473 . 2474) (#(":" 0 1 (fontified nil)) . 2473) (undo-tree-id978 . -1) (2473 . 2474) (#(" }" 0 1 (fontified nil) 1 2 (fontified nil)) . 2473) (undo-tree-id979 . -1) (undo-tree-id980 . -1) (undo-tree-id981 . -1) (undo-tree-id982 . -1) (undo-tree-id983 . -1) (undo-tree-id984 . -1) (undo-tree-id985 . -1) (undo-tree-id986 . -1) (undo-tree-id987 . -1) (undo-tree-id988 . -1) (undo-tree-id989 . -1) (undo-tree-id990 . -1) (2474 . 2475) (#(" " 0 1 (fontified nil)) . 2474) (2474 . 2475) (#("}" 0 1 (fontified nil)) . 2474) (2474 . 2475)) (23751 23782 223354 85000) 0 nil]) ((2460 . 2465) (2459 . 2461) (#("{" 0 1 (fontified nil)) . -2459) (2459 . 2460)) ((#("{" 0 1 (fontified nil)) . 2459) (2459 . 2460) (#("{}" 0 1 (fontified nil) 1 2 (fontified nil)) . 2459) (undo-tree-id991 . 1) (undo-tree-id992 . -1) (undo-tree-id993 . -1) (undo-tree-id994 . -1) (undo-tree-id995 . -1) (undo-tree-id996 . -1) (undo-tree-id997 . -1) (undo-tree-id998 . -1) (undo-tree-id999 . -1) (undo-tree-id1000 . -1) (undo-tree-id1001 . -1) (undo-tree-id1002 . -1) (undo-tree-id1003 . -1) (undo-tree-id1004 . -1) (undo-tree-id1005 . -1) (undo-tree-id1006 . -1) (#("
    " 0 1 (fontified t) 1 5 (fontified t)) . 2460) (undo-tree-id1007 . 5)) (23751 23782 517648 720000) 0 nil]) ((2452 . 2459) (#(" " 0 1 (fontified nil)) . -2452) (2452 . 2453) (#(">" 0 1 (fontified nil syntax-table #1#)) . -2452) (2450 . 2453) (#(")" 0 1 (fontified nil)) . 2450) (2449 . 2450) (2448 . 2450) (#("(" 0 1 (fontified nil face font-lock-function-name-face)) . -2448) (2438 . 2449) (#("i" 0 1 (fontified t)) . -2438) (undo-tree-id715 . -1) 2439 (2438 . 2439) (2433 . 2438) 2432) ((#("
    " 0 1 (fontified t) 1 5 (fontified nil)) . 2433) (undo-tree-id1008 . -5) (undo-tree-id1009 . -5) (undo-tree-id1010 . -5) (undo-tree-id1011 . -5) (undo-tree-id1012 . -5) (undo-tree-id1013 . -5) (undo-tree-id1014 . -5) (undo-tree-id1015 . -5) (undo-tree-id1016 . -5) (undo-tree-id1017 . -5) (undo-tree-id1018 . -5) (undo-tree-id1019 . -5) (undo-tree-id1020 . -5) (undo-tree-id1021 . -5) (undo-tree-id1022 . -5) (undo-tree-id1023 . -4) (undo-tree-id1024 . -5) (undo-tree-id1025 . -1) (undo-tree-id1026 . -5) (undo-tree-id1027 . -5) (undo-tree-id1028 . -4) (#("i" 0 1 (fontified nil)) . 2438) (undo-tree-id1029 . -1) (2438 . 2439) (#("pub fn new(" 0 3 (fontified nil face font-lock-keyword-face) 3 4 (fontified nil) 4 6 (fontified nil face font-lock-keyword-face) 6 7 (fontified nil) 7 10 (fontified nil face font-lock-function-name-face) 10 11 (fontified nil face font-lock-function-name-face)) . 2438) (undo-tree-id1030 . -10) (undo-tree-id1031 . -10) (undo-tree-id1032 . -10) (undo-tree-id1033 . -10) (undo-tree-id1034 . -10) (undo-tree-id1035 . -10) (undo-tree-id1036 . -10) (undo-tree-id1037 . -10) (undo-tree-id1038 . -10) (undo-tree-id1039 . -10) (undo-tree-id1040 . -10) (undo-tree-id1041 . -10) (undo-tree-id1042 . -10) (undo-tree-id1043 . -10) (undo-tree-id1044 . -10) (undo-tree-id1045 . -10) (undo-tree-id1046 . -10) (undo-tree-id1047 . -10) (2448 . 2449) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2448) (undo-tree-id1048 . -1) (undo-tree-id1049 . -1) (undo-tree-id1050 . -1) (undo-tree-id1051 . -1) (undo-tree-id1052 . -1) (undo-tree-id1053 . -1) (undo-tree-id1054 . -1) (undo-tree-id1055 . -1) (undo-tree-id1056 . -1) (undo-tree-id1057 . -1) (undo-tree-id1058 . -1) (undo-tree-id1059 . -1) (undo-tree-id1060 . -1) (undo-tree-id1061 . -1) (undo-tree-id1062 . -1) (undo-tree-id1063 . -1) (undo-tree-id1064 . -1) (undo-tree-id1065 . -1) (#(")" 0 1 (fontified nil)) . 2449) (undo-tree-id1066 . -1) (undo-tree-id1067 . -1) (undo-tree-id1068 . -1) (undo-tree-id1069 . -1) (undo-tree-id1070 . -1) (undo-tree-id1071 . -1) (undo-tree-id1072 . -1) (undo-tree-id1073 . -1) (undo-tree-id1074 . -1) (undo-tree-id1075 . -1) (undo-tree-id1076 . -1) (undo-tree-id1077 . -1) (undo-tree-id1078 . -1) (undo-tree-id1079 . -1) (undo-tree-id1080 . -1) (undo-tree-id1081 . -1) (undo-tree-id1082 . -1) (undo-tree-id1083 . -1) (2450 . 2451) (#(" ->" 0 2 (fontified nil) 2 3 (fontified nil syntax-table #1#)) . 2450) (undo-tree-id1084 . -2) (undo-tree-id1085 . -2) (undo-tree-id1086 . -2) (undo-tree-id1087 . -2) (undo-tree-id1088 . -2) (undo-tree-id1089 . -2) (undo-tree-id1090 . -2) (undo-tree-id1091 . -2) (undo-tree-id1092 . -2) (undo-tree-id1093 . -2) (undo-tree-id1094 . -2) (undo-tree-id1095 . -2) (undo-tree-id1096 . -2) (undo-tree-id1097 . -2) (undo-tree-id1098 . -2) (undo-tree-id1099 . -2) (undo-tree-id1100 . -2) (undo-tree-id1101 . -2) (2452 . 2453) (#(" " 0 1 (fontified nil)) . 2452) (2452 . 2453) (#("> Self " 0 1 (fontified t syntax-table #1#) 1 2 (fontified t) 2 6 (fontified t face font-lock-type-face) 6 7 (fontified t)) . 2452) (undo-tree-id1102 . -7) (undo-tree-id1103 . -7) (undo-tree-id1104 . -7) (undo-tree-id1105 . -7) (undo-tree-id1106 . -6) (undo-tree-id1107 . -7) (undo-tree-id1108 . -7) (undo-tree-id1109 . -7) (undo-tree-id1110 . -7) (undo-tree-id1111 . -7) (undo-tree-id1112 . -7) (undo-tree-id1113 . -7) (undo-tree-id1114 . -7) (undo-tree-id1115 . -7) (undo-tree-id1116 . -7) (undo-tree-id1117 . -7) (undo-tree-id1118 . -7) (undo-tree-id1119 . -6)) (23751 23782 836456 36000) 0 nil]) ((2885 . 2886)) ((#("*" 0 1 (fontified t)) . 2885)) (23751 23783 153076 404000) 0 nil]) ((#(")" 0 1 (fontified nil)) . 2912) (2911 . 2912) (2910 . 2912) (#("(" 0 1 (fontified nil)) . -2910) (2910 . 2911) (2904 . 2910) (#("un" 0 2 (fontified t)) . -2904) (undo-tree-id308 . -2) (undo-tree-id309 . -2) 2906 (2903 . 2906) (t 23751 19170 626892 747000)) ((#(".un" 0 1 (fontified nil) 1 3 (fontified nil)) . 2903) (2904 . 2906) (#("unwrap" 0 6 (fontified nil)) . 2904) (#("(" 0 1 (fontified nil)) . 2910) (2910 . 2911) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2910) (#(")" 0 1 (fontified nil)) . 2911) (2912 . 2913)) (23751 23783 671850 790000) 0 nil]) ((1 . 3529) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>,
}

impl PubSub {
    pub fn from(self, timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let socket = if let Some(socket) = self.socket.lock() {
            socket
        } else {

        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        }
        };


        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 78 (fontified t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 150 (fontified t) 150 154 (fontified t face font-lock-constant-face) 154 157 (fontified t) 157 160 (fontified t face font-lock-type-face) 160 162 (fontified t) 162 167 (fontified t face font-lock-type-face) 167 170 (fontified t) 170 173 (fontified t face font-lock-keyword-face) 173 174 (fontified t) 174 177 (fontified t face font-lock-constant-face) 177 195 (fontified t) 195 198 (fontified t face font-lock-keyword-face) 198 199 (fontified t) 199 204 (fontified t face font-lock-constant-face) 204 206 (fontified t) 206 209 (fontified t face font-lock-constant-face) 209 211 (fontified t) 211 220 (fontified t face font-lock-type-face) 220 222 (fontified t) 222 225 (fontified t face font-lock-keyword-face) 225 226 (fontified t) 226 230 (fontified t face font-lock-constant-face) 230 232 (fontified t) 232 238 (fontified t face font-lock-type-face) 238 241 (fontified t) 241 244 (fontified t face font-lock-keyword-face) 244 245 (fontified t) 245 251 (fontified t face font-lock-keyword-face) 251 252 (fontified t) 252 268 (fontified t face font-lock-variable-name-face) 268 270 (fontified t) 270 281 (fontified t face font-lock-type-face) 281 284 (fontified t) 284 295 (fontified t face font-lock-type-face) 295 304 (fontified t) 304 305 (fontified t) 305 308 (fontified t face font-lock-keyword-face) 308 309 (fontified t) 309 315 (fontified t face font-lock-keyword-face) 315 316 (fontified t) 316 331 (fontified t face font-lock-variable-name-face) 331 333 (fontified t) 333 344 (fontified t face font-lock-type-face) 344 347 (fontified t) 347 358 (fontified t face font-lock-type-face) 358 371 (fontified t) 371 374 (fontified t face font-lock-keyword-face) 374 375 (fontified t) 375 381 (fontified t face font-lock-keyword-face) 381 382 (fontified t) 382 390 (fontified t face font-lock-type-face) 390 397 (fontified t) 397 405 (fontified t face font-lock-variable-name-face) 405 407 (fontified t) 407 413 (fontified t face font-lock-type-face) 413 417 (fontified t) 417 421 (fontified t face font-lock-keyword-face) 421 422 (fontified t) 422 430 (fontified t face font-lock-type-face) 430 437 (fontified t) 437 439 (fontified t face font-lock-keyword-face) 439 440 (fontified t) 440 443 (fontified t face font-lock-function-name-face) 443 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 473 (fontified t) 473 476 (fontified t face font-lock-variable-name-face) 476 478 (fontified t) 478 482 (fontified t face font-lock-keyword-face) 482 483 (fontified t) 483 486 (fontified t face font-lock-constant-face) 486 488 (fontified t) 488 491 (fontified t face font-lock-constant-face) 491 493 (fontified t) 493 500 (fontified t face font-lock-type-face) 500 503 (fontified t) 503 504 (syntax-table #1# fontified t) 504 505 (fontified t) 505 509 (fontified t face font-lock-type-face) 509 520 (fontified t) 520 523 (fontified t face font-lock-keyword-face) 523 581 (fontified t) 581 584 (fontified t face font-lock-keyword-face) 584 585 (fontified t) 585 593 (fontified t face font-lock-variable-name-face) 593 596 (fontified t) 596 603 (fontified t face rust-builtin-formatting-macro-face) 603 617 (fontified t) 617 625 (fontified t face font-lock-string-face) 625 637 (fontified t face rust-string-interpolation-face) 637 641 (fontified t face font-lock-string-face) 641 646 (fontified t face rust-string-interpolation-face) 646 651 (fontified t face font-lock-string-face) 651 663 (fontified t face rust-string-interpolation-face) 663 667 (fontified t face font-lock-string-face) 667 672 (fontified t face rust-string-interpolation-face) 672 677 (fontified t face font-lock-string-face) 677 741 (fontified t) 741 774 (fontified t) 774 804 (fontified t) 804 807 (fontified t) 807 815 (fontified t) 815 819 (fontified t face font-lock-type-face) 819 843 (fontified t) 843 846 (fontified t face font-lock-keyword-face) 846 847 (fontified t) 847 849 (fontified t face font-lock-keyword-face) 849 850 (fontified t) 850 871 (fontified t face font-lock-function-name-face) 871 872 (fontified t) 872 880 (fontified t face font-lock-variable-name-face) 880 883 (fontified t) 883 886 (fontified t face font-lock-type-face) 886 889 (fontified t) 889 890 (syntax-table #1# fontified t) 890 891 (fontified t) 891 897 (fontified t face font-lock-type-face) 897 908 (fontified t) 908 911 (fontified t face font-lock-keyword-face) 911 912 (fontified t) 912 919 (fontified t face font-lock-variable-name-face) 919 922 (fontified t) 922 929 (fontified t face rust-builtin-formatting-macro-face) 929 930 (fontified t) 930 940 (fontified t face font-lock-string-face) 940 942 (fontified t face rust-string-interpolation-face) 942 943 (fontified t face font-lock-string-face) 943 964 (fontified t) 964 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 977 (fontified t face font-lock-variable-name-face) 977 980 (fontified t) 980 988 (fontified t face font-lock-type-face) 988 994 (fontified t) 994 1005 (fontified t face font-lock-string-face) 1005 1026 (fontified t) 1026 1031 (fontified t face font-lock-preprocessor-face) 1031 1032 (fontified t) 1032 1051 (fontified t face font-lock-string-face) 1051 1101 (fontified t) 1101 1104 (fontified t face font-lock-keyword-face) 1104 1105 (fontified t) 1105 1107 (fontified t face font-lock-keyword-face) 1107 1108 (fontified t) 1108 1133 (fontified t face font-lock-function-name-face) 1133 1134 (fontified t) 1134 1142 (fontified t face font-lock-variable-name-face) 1142 1145 (fontified t) 1145 1148 (fontified t face font-lock-type-face) 1148 1151 (fontified t) 1151 1152 (syntax-table #1# fontified t) 1152 1153 (fontified t) 1153 1159 (fontified t face font-lock-type-face) 1159 1170 (fontified t) 1170 1173 (fontified t face font-lock-keyword-face) 1173 1174 (fontified t) 1174 1181 (fontified t face font-lock-variable-name-face) 1181 1184 (fontified t) 1184 1191 (fontified t face rust-builtin-formatting-macro-face) 1191 1192 (fontified t) 1192 1202 (fontified t face font-lock-string-face) 1202 1204 (fontified t face rust-string-interpolation-face) 1204 1205 (fontified t face font-lock-string-face) 1205 1226 (fontified t) 1226 1229 (fontified t face font-lock-keyword-face) 1229 1230 (fontified t) 1230 1241 (fontified t face font-lock-variable-name-face) 1241 1244 (fontified t) 1244 1252 (fontified t face font-lock-type-face) 1252 1258 (fontified t) 1258 1271 (fontified t face font-lock-string-face) 1271 1274 (fontified t) 1274 1284 (fontified t) 1284 1292 (fontified t) 1292 1297 (fontified t face font-lock-preprocessor-face) 1297 1298 (fontified t) 1298 1307 (fontified t face font-lock-string-face) 1307 1321 (fontified t face font-lock-string-face) 1321 1334 (fontified t) 1334 1372 (fontified t) 1372 1375 (fontified t face font-lock-keyword-face) 1375 1376 (fontified t) 1376 1381 (fontified t face font-lock-constant-face) 1381 1383 (fontified t) 1383 1386 (fontified t face font-lock-constant-face) 1386 1388 (fontified t) 1388 1391 (fontified t face font-lock-constant-face) 1391 1393 (fontified t) 1393 1406 (fontified t face font-lock-type-face) 1406 1408 (fontified t) 1408 1414 (fontified t face font-lock-keyword-face) 1414 1415 (fontified t) 1415 1421 (fontified t face font-lock-type-face) 1421 1428 (fontified t) 1428 1435 (fontified t face font-lock-variable-name-face) 1435 1437 (fontified t) 1437 1450 (fontified t face font-lock-type-face) 1450 1456 (fontified t) 1456 1458 (fontified t face font-lock-variable-name-face) 1458 1460 (fontified t) 1460 1465 (fontified t face font-lock-constant-face) 1465 1467 (fontified t) 1467 1471 (fontified t face font-lock-constant-face) 1471 1473 (fontified t) 1473 1477 (fontified t face font-lock-constant-face) 1477 1479 (fontified t) 1479 1485 (fontified t face font-lock-type-face) 1485 1486 (fontified t) 1486 1495 (fontified t face font-lock-type-face) 1495 1500 (fontified t) 1500 1504 (fontified t face font-lock-keyword-face) 1504 1505 (fontified t) 1505 1511 (fontified t face font-lock-type-face) 1511 1518 (fontified t) 1518 1520 (fontified t face font-lock-keyword-face) 1520 1521 (fontified t) 1521 1524 (fontified t face font-lock-function-name-face) 1524 1525 (fontified t) 1525 1532 (fontified t face font-lock-variable-name-face) 1532 1534 (fontified t) 1534 1538 (fontified t face font-lock-keyword-face) 1538 1539 (fontified t) 1539 1542 (fontified t face font-lock-constant-face) 1542 1544 (fontified t) 1544 1547 (fontified t face font-lock-constant-face) 1547 1549 (fontified t) 1549 1556 (fontified t face font-lock-type-face) 1556 1558 (fontified t) 1558 1560 (fontified t face font-lock-variable-name-face) 1560 1562 (fontified t) 1562 1567 (fontified t face font-lock-constant-face) 1567 1569 (fontified t) 1569 1573 (fontified t face font-lock-constant-face) 1573 1575 (fontified t) 1575 1579 (fontified t face font-lock-constant-face) 1579 1581 (fontified t) 1581 1587 (fontified t face font-lock-type-face) 1587 1588 (fontified t) 1588 1597 (fontified t face font-lock-type-face) 1597 1601 (fontified t) 1601 1602 (syntax-table #1# fontified t) 1602 1603 (fontified t) 1603 1607 (fontified t face font-lock-type-face) 1607 1618 (fontified t) 1618 1621 (fontified t face font-lock-keyword-face) 1621 1622 (fontified t) 1622 1629 (fontified t face font-lock-variable-name-face) 1629 1706 (fontified t) 1706 1731 (fontified t face font-lock-string-face) 1731 1742 (fontified t) 1742 1745 (fontified t face font-lock-keyword-face) 1745 1746 (fontified t) 1746 1753 (fontified t face font-lock-variable-name-face) 1753 1756 (fontified t) 1756 1765 (fontified t face font-lock-type-face) 1765 1784 (fontified t) 1784 1786 (fontified t) 1794 1798 (face font-lock-type-face) 1823 1827 (face font-lock-keyword-face) 1828 1834 (face font-lock-type-face) 1835 1838 (face font-lock-keyword-face) 1839 1845 (face font-lock-type-face) 1890 1894 (fontified t) 1894 1896 (fontified t face font-lock-keyword-face) 1896 1897 (fontified t) 1897 1901 (fontified t face font-lock-function-name-face) 1901 1903 (fontified t) 1903 1906 (fontified t face font-lock-keyword-face) 1906 1907 (fontified t) 1907 1911 (fontified t face font-lock-keyword-face) 1911 1914 (fontified t) 1914 1915 (syntax-table #1# fontified t) 1915 1916 (fontified t) 1916 1920 (fontified t face font-lock-type-face) 1920 1921 (fontified t) 1921 1925 (fontified t face font-lock-type-face) 1925 1927 (fontified t) 1927 1931 (fontified t face font-lock-type-face) 1931 1933 (fontified t) 1933 1937 (fontified t face font-lock-type-face) 1937 1939 (fontified t) 1939 1944 (fontified t face font-lock-type-face) 1944 1956 (fontified t) 1956 1961 (fontified t face font-lock-keyword-face) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-keyword-face) 1966 1996 (fontified t) 1996 1998 (fontified t face font-lock-type-face) 1998 1999 (fontified t) 1999 2004 (fontified t face font-lock-type-face) 2004 2006 (fontified t) 2006 2011 (fontified t face font-lock-type-face) 2011 2022 (fontified t) 2022 2023 (syntax-table #1# fontified t) 2023 2042 (fontified t) 2042 2046 (fontified t face font-lock-keyword-face) 2046 2082 (fontified t) 2082 2098 (fontified t face font-lock-string-face) 2098 2117 (fontified t) 2117 2119 (fontified t face font-lock-type-face) 2119 2120 (fontified t) 2120 2125 (fontified t face font-lock-type-face) 2125 2127 (fontified t) 2127 2132 (fontified t face font-lock-type-face) 2132 2164 (fontified t) 2164 2166 (fontified t face font-lock-type-face) 2166 2167 (fontified t) 2167 2172 (fontified t face font-lock-type-face) 2172 2174 (fontified t) 2174 2182 (fontified t face font-lock-type-face) 2182 2185 (fontified t) 2185 2186 (syntax-table #1# fontified t) 2186 2187 (fontified t) 2187 2189 (fontified t face font-lock-type-face) 2189 2190 (fontified t) 2190 2195 (fontified t face font-lock-type-face) 2195 2197 (fontified t) 2197 2205 (fontified t face font-lock-type-face) 2205 2220 (fontified t) 2220 2223 (fontified t face font-lock-type-face) 2223 2228 (fontified t) 2228 2229 (syntax-table #1# fontified t) 2229 2248 (fontified t) 2248 2253 (fontified t face font-lock-preprocessor-face) 2253 2254 (fontified t) 2254 2277 (fontified t face font-lock-string-face) 2277 2299 (fontified t) 2299 2301 (fontified t face font-lock-type-face) 2301 2302 (fontified t) 2302 2307 (fontified t face font-lock-type-face) 2307 2309 (fontified t) 2309 2314 (fontified t face font-lock-type-face) 2314 2353 (fontified t) 2353 2356 (fontified t face font-lock-keyword-face) 2356 2357 (fontified t) 2357 2363 (fontified t face font-lock-keyword-face) 2363 2364 (fontified t) 2364 2370 (fontified t face font-lock-type-face) 2370 2377 (fontified t) 2377 2383 (fontified t face font-lock-variable-name-face) 2383 2385 (fontified t) 2385 2388 (fontified t face font-lock-type-face) 2388 2389 (fontified t) 2389 2390 (fontified t face font-lock-type-face) 2390 2394 (face font-lock-type-face fontified t) 2394 2395 (fontified t) 2395 2401 (face font-lock-type-face fontified t) 2401 2402 (fontified t) 2402 2411 (face font-lock-type-face fontified t) 2411 2416 (fontified t) 2416 2419 (fontified t) 2419 2423 (fontified t face font-lock-keyword-face) 2423 2424 (fontified t) 2424 2430 (fontified t face font-lock-type-face) 2430 2433 (fontified t) 2433 2437 (fontified t) 2437 2440 (fontified t face font-lock-keyword-face) 2440 2441 (fontified t) 2441 2443 (fontified t face font-lock-keyword-face) 2443 2444 (fontified t) 2444 2448 (fontified t face font-lock-function-name-face) 2448 2449 (fontified t) 2449 2453 (fontified t face font-lock-keyword-face) 2453 2455 (fontified t) 2455 2463 (fontified t face font-lock-variable-name-face) 2463 2465 (fontified t) 2465 2469 (fontified t face font-lock-keyword-face) 2469 2470 (fontified t) 2470 2473 (fontified t face font-lock-constant-face) 2473 2475 (fontified t) 2475 2478 (fontified t face font-lock-constant-face) 2478 2480 (fontified t) 2480 2487 (fontified t face font-lock-type-face) 2487 2489 (fontified t) 2489 2493 (fontified t face font-lock-variable-name-face) 2493 2496 (fontified t) 2496 2500 (fontified t face font-lock-type-face) 2500 2503 (fontified t) 2503 2504 (fontified t syntax-table #1#) 2504 2505 (fontified t) 2505 2511 (fontified t face font-lock-constant-face) 2511 2513 (fontified t) 2513 2521 (fontified t face font-lock-type-face) 2521 2524 (fontified t) 2524 2532 (fontified t) 2532 2537 (fontified t face font-lock-keyword-face) 2537 2538 (fontified t) 2538 2554 (fontified t face font-lock-type-face) 2554 2560 (fontified t) 2560 2568 (fontified t face font-lock-type-face) 2568 2570 (fontified t) 2570 2577 (fontified t face font-lock-type-face) 2577 2579 (fontified t) 2579 2580 (syntax-table #1# fontified t) 2580 2581 (fontified t) 2581 2596 (fontified t face font-lock-type-face) 2596 2602 (fontified t) 2602 2610 (fontified t face font-lock-type-face) 2610 2612 (fontified t) 2612 2619 (fontified t face font-lock-type-face) 2619 2635 (fontified t) 2635 2641 (fontified t face font-lock-constant-face) 2641 2649 (fontified t) 2649 2653 (fontified t face font-lock-constant-face) 2653 2655 (fontified t) 2655 2663 (fontified t face font-lock-type-face) 2663 2703 (fontified t) 2703 2706 (fontified t face font-lock-keyword-face) 2706 2707 (fontified t) 2707 2722 (fontified t face font-lock-variable-name-face) 2722 2725 (fontified t) 2725 2741 (fontified t face font-lock-type-face) 2741 2755 (fontified t) 2755 2763 (fontified t face font-lock-type-face) 2763 2765 (fontified t) 2765 2772 (fontified t face font-lock-type-face) 2772 2779 (fontified t) 2779 2787 (fontified t) 2787 2792 (fontified t face font-lock-preprocessor-face) 2792 2793 (fontified t) 2793 2820 (fontified t face font-lock-string-face) 2820 2839 (fontified t) 2839 2840 (fontified t) 2840 2841 (fontified t) 2841 2849 (fontified t) 2849 2852 (fontified t face font-lock-keyword-face) 2852 2853 (fontified t) 2853 2859 (fontified t face font-lock-variable-name-face) 2859 2862 (fontified t) 2862 2864 (fontified t face font-lock-keyword-face) 2864 2865 (fontified t) 2865 2868 (fontified t face font-lock-keyword-face) 2868 2869 (fontified t) 2869 2873 (fontified t face font-lock-type-face) 2873 2884 (fontified t) 2884 2888 (fontified t face font-lock-keyword-face) 2888 2900 (fontified t) 2900 2901 (fontified t) 2901 2903 (fontified t) 2903 2904 (fontified t) 2904 2905 (fontified t) 2905 2923 (fontified t) 2923 2924 (fontified t) 2924 2932 (fontified t) 2932 2934 (fontified t) 2934 2938 (fontified t face font-lock-keyword-face) 2938 2939 (fontified t) 2939 2941 (fontified t) 2941 2942 (fontified t) 2942 2949 (fontified t) 2949 2950 (fontified t rear-nonsticky t) 2950 2953 (fontified t face font-lock-keyword-face) 2953 2959 (fontified t) 2959 2962 (fontified t face font-lock-keyword-face) 2962 2969 (fontified t) 2969 2974 (fontified t face font-lock-constant-face) 2974 2976 (fontified t) 2976 2980 (fontified t face font-lock-constant-face) 2980 2982 (fontified t) 2982 2986 (fontified t face font-lock-constant-face) 2986 3008 (fontified t) 3008 3011 (fontified t face font-lock-keyword-face) 3011 3012 (fontified t) 3012 3018 (fontified t face font-lock-variable-name-face) 3018 3021 (fontified t) 3021 3023 (fontified t face font-lock-type-face) 3023 3027 (fontified t face font-lock-type-face) 3027 3033 (fontified t) 3033 3049 (fontified t face font-lock-string-face) 3049 3056 (fontified t) 3056 3065 (fontified t) 3065 3070 (fontified t face font-lock-constant-face) 3070 3078 (fontified t) 3078 3085 (fontified t face font-lock-constant-face) 3085 3087 (fontified t) 3087 3093 (fontified t face font-lock-constant-face) 3093 3100 (fontified t) 3100 3104 (fontified t face font-lock-keyword-face) 3104 3119 (fontified t) 3119 3125 (fontified t) 3125 3127 (fontified t) 3127 3131 (fontified t face font-lock-keyword-face) 3131 3134 (fontified t) 3134 3146 (fontified t) 3146 3148 (fontified t face font-lock-keyword-face) 3148 3149 (fontified t) 3149 3152 (fontified t face font-lock-keyword-face) 3152 3153 (fontified t) 3153 3155 (fontified t face font-lock-type-face) 3155 3156 (fontified t) 3156 3161 (fontified t face font-lock-type-face) 3161 3163 (fontified t) 3163 3168 (fontified t face font-lock-type-face) 3168 3169 (fontified t) 3169 3173 (fontified t face font-lock-type-face) 3173 3211 (fontified t) 3211 3216 (fontified t face font-lock-keyword-face) 3216 3248 (fontified t) 3248 3254 (fontified t face font-lock-constant-face) 3254 3262 (fontified t) 3262 3266 (fontified t face font-lock-constant-face) 3266 3268 (fontified t) 3268 3276 (fontified t face font-lock-type-face) 3276 3297 (fontified t) 3297 3306 (fontified t) 3306 3307 (fontified t) 3307 3315 (fontified t) 3315 3317 (fontified t) 3317 3318 (fontified t) 3318 3319 (fontified t) 3319 3320 (fontified t) 3320 3328 (fontified t) 3328 3331 (fontified t face font-lock-keyword-face) 3331 3332 (fontified t) 3332 3340 (fontified t face font-lock-variable-name-face) 3340 3373 (fontified t) 3373 3376 (fontified t face font-lock-keyword-face) 3376 3377 (fontified t) 3377 3402 (fontified t face font-lock-variable-name-face) 3402 3405 (fontified t) 3405 3411 (fontified t face font-lock-constant-face) 3411 3413 (fontified t) 3413 3421 (fontified t face font-lock-type-face) 3421 3429 (fontified t) 3429 3439 (fontified t) 3439 3452 (fontified t) 3452 3492 (fontified t) 3492 3494 (fontified t)) . 1) (undo-tree-id227 . -3306) (undo-tree-id228 . 177) (undo-tree-id229 . -2942) (undo-tree-id230 . -3306) (undo-tree-id231 . -3319) (undo-tree-id232 . 175) (undo-tree-id233 . -3319) (undo-tree-id234 . -3319) (undo-tree-id235 . -241) (undo-tree-id236 . -241) (undo-tree-id237 . -241) (undo-tree-id238 . -2901) (undo-tree-id240 . -3316) (undo-tree-id242 . -3316) (undo-tree-id244 . -3316) (undo-tree-id246 . -3316) (undo-tree-id248 . -1948) (undo-tree-id250 . -2440) (undo-tree-id252 . -2888) (undo-tree-id254 . -2873) (undo-tree-id256 . -2881) (undo-tree-id258 . -2902) (undo-tree-id260 . -2521) (undo-tree-id262 . -3316) (undo-tree-id264 . -3305) (undo-tree-id266 . -3316) (undo-tree-id268 . -3305) (undo-tree-id270 . -3316) (undo-tree-id272 . -1948) (undo-tree-id273 . -3305) (undo-tree-id274 . -3305) (undo-tree-id276 . -3316) (undo-tree-id278 . -3305) (undo-tree-id280 . -1948) (undo-tree-id282 . -3316) (undo-tree-id284 . -3305) (undo-tree-id286 . -1948) (undo-tree-id288 . -3235) (undo-tree-id290 . -3194) (undo-tree-id292 . -3133) (undo-tree-id294 . -3235) (undo-tree-id296 . -3194) (undo-tree-id298 . -3133) (undo-tree-id300 . -3133) (undo-tree-id302 . -3305) (undo-tree-id304 . -3306) 3306) ((1 . 3495) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>,
}

impl PubSub {
    pub fn from(self, timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let socket = if let Some(socket) = self.socket.lock() {
            socket
        } else {
            let (tx, mut rx) = tokio::sync::mpsc::channel(5);
            let socket = Socket::new(\"127.0.0.1:6379\", tx);

            tokio::spawn(futures::future::lazy(move || socket));

            loop {
                if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                    break msg;
                }
                thread::sleep(time::Duration::from_millis(100));
            }
        };

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (face font-lock-keyword-face) 4 9 (face font-lock-keyword-face) 19 22 (face font-lock-keyword-face) 23 28 (face font-lock-keyword-face) 30 34 (face font-lock-constant-face) 36 40 (face font-lock-type-face) 42 45 (face font-lock-keyword-face) 46 53 (face font-lock-constant-face) 56 61 (face font-lock-type-face) 63 69 (face font-lock-type-face) 71 75 (face font-lock-type-face) 78 81 (face font-lock-keyword-face) 82 85 (face font-lock-constant-face) 93 96 (face font-lock-keyword-face) 97 100 (face font-lock-constant-face) 102 106 (face font-lock-constant-face) 108 114 (face font-lock-constant-face) 117 128 (face font-lock-type-face) 130 138 (face font-lock-type-face) 141 144 (face font-lock-keyword-face) 145 148 (face font-lock-constant-face) 150 154 (face font-lock-constant-face) 157 160 (face font-lock-type-face) 162 167 (face font-lock-type-face) 170 173 (face font-lock-keyword-face) 174 177 (face font-lock-constant-face) 195 198 (face font-lock-keyword-face) 199 204 (face font-lock-constant-face) 206 209 (face font-lock-constant-face) 211 220 (face font-lock-type-face) 222 225 (face font-lock-keyword-face) 226 230 (face font-lock-constant-face) 232 238 (face font-lock-type-face) 241 244 (face font-lock-keyword-face) 245 251 (face font-lock-keyword-face) 252 268 (face font-lock-variable-name-face) 270 281 (face font-lock-type-face) 284 295 (face font-lock-type-face) 305 308 (face font-lock-keyword-face) 309 315 (face font-lock-keyword-face) 316 331 (face font-lock-variable-name-face) 333 344 (face font-lock-type-face) 347 358 (face font-lock-type-face) 371 374 (face font-lock-keyword-face) 375 381 (face font-lock-keyword-face) 382 390 (face font-lock-type-face) 397 405 (face font-lock-variable-name-face) 407 413 (face font-lock-type-face) 417 421 (face font-lock-keyword-face) 422 430 (face font-lock-type-face) 437 439 (face font-lock-keyword-face) 440 443 (face font-lock-function-name-face) 444 447 (face font-lock-variable-name-face) 449 453 (face font-lock-keyword-face) 454 457 (face font-lock-constant-face) 459 462 (face font-lock-constant-face) 464 471 (face font-lock-type-face) 473 476 (face font-lock-variable-name-face) 478 482 (face font-lock-keyword-face) 483 486 (face font-lock-constant-face) 488 491 (face font-lock-constant-face) 493 500 (face font-lock-type-face) 503 504 (syntax-table #1#) 505 509 (face font-lock-type-face) 520 523 (face font-lock-keyword-face) 581 584 (face font-lock-keyword-face) 585 593 (face font-lock-variable-name-face) 596 603 (face rust-builtin-formatting-macro-face) 617 625 (face font-lock-string-face) 625 637 (face rust-string-interpolation-face) 637 641 (face font-lock-string-face) 641 646 (face rust-string-interpolation-face) 646 651 (face font-lock-string-face) 651 663 (face rust-string-interpolation-face) 663 667 (face font-lock-string-face) 667 672 (face rust-string-interpolation-face) 672 677 (face font-lock-string-face) 815 819 (face font-lock-type-face) 843 846 (face font-lock-keyword-face) 847 849 (face font-lock-keyword-face) 850 871 (face font-lock-function-name-face) 872 880 (face font-lock-variable-name-face) 883 886 (face font-lock-type-face) 889 890 (syntax-table #1#) 891 897 (face font-lock-type-face) 908 911 (face font-lock-keyword-face) 912 919 (face font-lock-variable-name-face) 922 929 (face rust-builtin-formatting-macro-face) 930 940 (face font-lock-string-face) 940 942 (face rust-string-interpolation-face) 942 943 (face font-lock-string-face) 964 967 (face font-lock-keyword-face) 968 977 (face font-lock-variable-name-face) 980 988 (face font-lock-type-face) 994 1005 (face font-lock-string-face) 1026 1031 (face font-lock-preprocessor-face) 1032 1051 (face font-lock-string-face) 1101 1104 (face font-lock-keyword-face) 1105 1107 (face font-lock-keyword-face) 1108 1133 (face font-lock-function-name-face) 1134 1142 (face font-lock-variable-name-face) 1145 1148 (face font-lock-type-face) 1151 1152 (syntax-table #1#) 1153 1159 (face font-lock-type-face) 1170 1173 (face font-lock-keyword-face) 1174 1181 (face font-lock-variable-name-face) 1184 1191 (face rust-builtin-formatting-macro-face) 1192 1202 (face font-lock-string-face) 1202 1204 (face rust-string-interpolation-face) 1204 1205 (face font-lock-string-face) 1226 1229 (face font-lock-keyword-face) 1230 1241 (face font-lock-variable-name-face) 1244 1252 (face font-lock-type-face) 1258 1271 (face font-lock-string-face) 1292 1297 (face font-lock-preprocessor-face) 1298 1321 (face font-lock-string-face) 1372 1375 (face font-lock-keyword-face) 1376 1381 (face font-lock-constant-face) 1383 1386 (face font-lock-constant-face) 1388 1391 (face font-lock-constant-face) 1393 1406 (face font-lock-type-face) 1408 1414 (face font-lock-keyword-face) 1415 1421 (face font-lock-type-face) 1428 1435 (face font-lock-variable-name-face) 1437 1450 (face font-lock-type-face) 1456 1458 (face font-lock-variable-name-face) 1460 1465 (face font-lock-constant-face) 1467 1471 (face font-lock-constant-face) 1473 1477 (face font-lock-constant-face) 1479 1485 (face font-lock-type-face) 1486 1495 (face font-lock-type-face) 1500 1504 (face font-lock-keyword-face) 1505 1511 (face font-lock-type-face) 1518 1520 (face font-lock-keyword-face) 1521 1524 (face font-lock-function-name-face) 1525 1532 (face font-lock-variable-name-face) 1534 1538 (face font-lock-keyword-face) 1539 1542 (face font-lock-constant-face) 1544 1547 (face font-lock-constant-face) 1549 1556 (face font-lock-type-face) 1558 1560 (face font-lock-variable-name-face) 1562 1567 (face font-lock-constant-face) 1569 1573 (face font-lock-constant-face) 1575 1579 (face font-lock-constant-face) 1581 1587 (face font-lock-type-face) 1588 1597 (face font-lock-type-face) 1601 1602 (syntax-table #1#) 1603 1607 (face font-lock-type-face) 1794 1798 (face font-lock-type-face) 1815 1823 (fontified t) 1823 1827 (fontified t face font-lock-keyword-face) 1827 1828 (fontified t) 1828 1834 (fontified t face font-lock-type-face) 1834 1835 (fontified t) 1835 1838 (fontified t face font-lock-keyword-face) 1838 1839 (fontified t) 1839 1845 (fontified t face font-lock-type-face) 1845 1852 (fontified t) 1852 1856 (fontified t face font-lock-keyword-face) 1856 1857 (fontified t) 1857 1861 (fontified t face font-lock-type-face) 1861 1872 (fontified t) 1872 1876 (fontified t face font-lock-keyword-face) 1876 1877 (fontified t) 1877 1882 (fontified t face font-lock-type-face) 1882 1894 (fontified t) 1894 1896 (fontified t face font-lock-keyword-face) 1896 1897 (fontified t) 1897 1901 (fontified t face font-lock-function-name-face) 1901 1903 (fontified t) 1903 1906 (fontified t face font-lock-keyword-face) 1906 1907 (fontified t) 1907 1911 (fontified t face font-lock-keyword-face) 1911 1914 (fontified t) 1914 1915 (syntax-table #1# fontified t) 1915 1916 (fontified t) 1916 1920 (fontified t face font-lock-type-face) 1920 1921 (fontified t) 1921 1925 (fontified t face font-lock-type-face) 1925 1927 (fontified t) 1927 1931 (fontified t face font-lock-type-face) 1931 1933 (fontified t) 1933 1937 (fontified t face font-lock-type-face) 1937 1939 (fontified t) 1939 1944 (fontified t face font-lock-type-face) 1944 1948 (fontified t) 1948 1956 (fontified t) 1956 1961 (fontified t face font-lock-keyword-face) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-keyword-face) 1966 1983 (fontified t) 1983 1996 (fontified t) 1996 1998 (fontified t face font-lock-type-face) 1998 1999 (fontified t) 1999 2004 (fontified t face font-lock-type-face) 2004 2006 (fontified t) 2006 2011 (fontified t face font-lock-type-face) 2011 2022 (fontified t) 2022 2023 (syntax-table #1# fontified t) 2023 2042 (fontified t) 2042 2046 (fontified t face font-lock-keyword-face) 2046 2082 (fontified t) 2082 2098 (fontified t face font-lock-string-face) 2098 2117 (fontified t) 2117 2119 (fontified t face font-lock-type-face) 2119 2120 (fontified t) 2120 2125 (fontified t face font-lock-type-face) 2125 2127 (fontified t) 2127 2132 (fontified t face font-lock-type-face) 2132 2164 (fontified t) 2164 2166 (fontified t face font-lock-type-face) 2166 2167 (fontified t) 2167 2172 (fontified t face font-lock-type-face) 2172 2174 (fontified t) 2174 2182 (fontified t face font-lock-type-face) 2182 2185 (fontified t) 2185 2186 (syntax-table #1# fontified t) 2186 2187 (fontified t) 2187 2189 (fontified t face font-lock-type-face) 2189 2190 (fontified t) 2190 2195 (fontified t face font-lock-type-face) 2195 2197 (fontified t) 2197 2205 (fontified t face font-lock-type-face) 2205 2220 (fontified t) 2220 2223 (fontified t face font-lock-type-face) 2223 2228 (fontified t) 2228 2229 (syntax-table #1# fontified t) 2229 2248 (fontified t) 2248 2253 (fontified t face font-lock-preprocessor-face) 2253 2254 (fontified t) 2254 2277 (fontified t face font-lock-string-face) 2277 2299 (fontified t) 2299 2301 (fontified t face font-lock-type-face) 2301 2302 (fontified t) 2302 2307 (fontified t face font-lock-type-face) 2307 2309 (fontified t) 2309 2314 (fontified t face font-lock-type-face) 2314 2315 (fontified t) 2315 2320 (fontified t) 2320 2353 (fontified t) 2353 2356 (fontified t face font-lock-keyword-face) 2356 2357 (fontified t) 2357 2363 (fontified t face font-lock-keyword-face) 2363 2364 (fontified t) 2364 2370 (fontified t face font-lock-type-face) 2370 2377 (fontified t) 2377 2383 (fontified t face font-lock-variable-name-face) 2383 2385 (fontified t) 2385 2388 (fontified t face font-lock-type-face) 2388 2389 (fontified t) 2389 2394 (fontified t face font-lock-type-face) 2394 2395 (fontified t) 2395 2401 (fontified t face font-lock-type-face) 2401 2402 (fontified t) 2402 2411 (fontified t face font-lock-type-face) 2411 2416 (fontified t) 2416 2418 (fontified t) 2418 2419 (fontified t) 2419 2423 (fontified t face font-lock-keyword-face) 2423 2424 (fontified t) 2424 2430 (fontified t face font-lock-type-face) 2430 2432 (fontified t) 2432 2433 (fontified t) 2433 2437 (fontified t) 2437 2440 (fontified t face font-lock-keyword-face) 2440 2441 (fontified t) 2441 2443 (fontified t face font-lock-keyword-face) 2443 2444 (fontified t) 2444 2448 (fontified t face font-lock-function-name-face) 2448 2449 (fontified t) 2449 2453 (fontified t face font-lock-keyword-face) 2453 2455 (fontified t) 2455 2463 (fontified t face font-lock-variable-name-face) 2463 2465 (fontified t) 2465 2469 (fontified t face font-lock-keyword-face) 2469 2470 (fontified t) 2470 2473 (fontified t face font-lock-constant-face) 2473 2475 (fontified t) 2475 2478 (fontified t face font-lock-constant-face) 2478 2480 (fontified t) 2480 2483 (fontified t face font-lock-type-face) 2483 2487 (fontified t face font-lock-type-face) 2487 2489 (fontified t) 2489 2493 (fontified t face font-lock-variable-name-face) 2493 2496 (fontified t) 2496 2500 (fontified t face font-lock-type-face) 2500 2503 (fontified t) 2503 2504 (syntax-table #1# fontified t) 2504 2505 (fontified t) 2505 2511 (fontified t face font-lock-constant-face) 2511 2513 (fontified t) 2513 2521 (fontified t face font-lock-type-face) 2521 2524 (fontified t) 2524 2532 (fontified t) 2532 2537 (fontified t face font-lock-keyword-face) 2537 2538 (fontified t) 2538 2554 (fontified t face font-lock-type-face) 2554 2560 (fontified t) 2560 2568 (fontified t face font-lock-type-face) 2568 2570 (fontified t) 2570 2577 (fontified t face font-lock-type-face) 2577 2579 (fontified t) 2579 2580 (syntax-table #1# fontified t) 2580 2581 (fontified t) 2581 2596 (fontified t face font-lock-type-face) 2596 2602 (fontified t) 2602 2610 (fontified t face font-lock-type-face) 2610 2612 (fontified t) 2612 2619 (fontified t face font-lock-type-face) 2619 2635 (fontified t) 2635 2641 (fontified t face font-lock-constant-face) 2641 2649 (fontified t) 2649 2653 (fontified t face font-lock-constant-face) 2653 2655 (fontified t) 2655 2663 (fontified t face font-lock-type-face) 2663 2703 (fontified t) 2703 2706 (fontified t face font-lock-keyword-face) 2706 2707 (fontified t) 2707 2722 (fontified t face font-lock-variable-name-face) 2722 2725 (fontified t) 2725 2736 (fontified t face font-lock-type-face) 2736 2741 (fontified t face font-lock-type-face) 2741 2755 (fontified t) 2755 2763 (fontified t face font-lock-type-face) 2763 2765 (fontified t) 2765 2772 (fontified t face font-lock-type-face) 2772 2779 (fontified t) 2779 2787 (fontified t) 2787 2792 (fontified t face font-lock-preprocessor-face) 2792 2793 (fontified t) 2793 2820 (fontified t face font-lock-string-face) 2820 2841 (fontified t) 2841 2849 (fontified t) 2849 2852 (fontified t face font-lock-keyword-face) 2852 2853 (fontified t) 2853 2859 (fontified t face font-lock-variable-name-face) 2859 2862 (fontified t) 2862 2864 (fontified t face font-lock-keyword-face) 2864 2865 (fontified t) 2865 2868 (fontified t face font-lock-keyword-face) 2868 2869 (fontified t) 2869 2873 (fontified t face font-lock-type-face) 2873 2884 (fontified t) 2884 2888 (fontified t face font-lock-keyword-face) 2888 2902 (fontified t) 2902 2905 (fontified t) 2905 2917 (fontified t) 2917 2918 (fontified t) 2918 2923 (fontified t) 2923 2924 (fontified t) 2924 2934 (fontified t) 2934 2938 (fontified t face font-lock-keyword-face) 2938 2953 (fontified t) 2953 2956 (fontified t face font-lock-keyword-face) 2956 2962 (fontified t) 2962 2965 (fontified t face font-lock-keyword-face) 2965 2972 (fontified t) 2972 2977 (fontified t face font-lock-constant-face) 2977 2979 (fontified t) 2979 2983 (fontified t face font-lock-constant-face) 2983 2985 (fontified t) 2985 2989 (fontified t face font-lock-constant-face) 2989 3015 (fontified t) 3015 3018 (fontified t face font-lock-keyword-face) 3018 3019 (fontified t) 3019 3024 (fontified t face font-lock-variable-name-face) 3024 3025 (fontified t face font-lock-variable-name-face) 3025 3028 (fontified t) 3028 3034 (fontified t face font-lock-type-face) 3034 3040 (fontified t) 3040 3056 (fontified t face font-lock-string-face) 3056 3063 (fontified t) 3063 3076 (fontified t) 3076 3081 (fontified t face font-lock-constant-face) 3081 3089 (fontified t) 3089 3096 (fontified t face font-lock-constant-face) 3096 3098 (fontified t) 3098 3104 (fontified t face font-lock-constant-face) 3104 3111 (fontified t) 3111 3115 (fontified t face font-lock-keyword-face) 3115 3142 (fontified t) 3142 3146 (fontified t face font-lock-keyword-face) 3146 3165 (fontified t) 3165 3167 (fontified t face font-lock-keyword-face) 3167 3168 (fontified t) 3168 3171 (fontified t face font-lock-keyword-face) 3171 3172 (fontified t) 3172 3174 (fontified t face font-lock-type-face) 3174 3175 (fontified t) 3175 3180 (fontified t face font-lock-type-face) 3180 3182 (fontified t) 3182 3187 (fontified t face font-lock-type-face) 3187 3188 (fontified t) 3188 3192 (fontified t face font-lock-type-face) 3192 3234 (fontified t) 3234 3239 (fontified t face font-lock-keyword-face) 3239 3269 (fontified t) 3269 3279 (fontified t) 3279 3285 (fontified t face font-lock-constant-face) 3285 3293 (fontified t) 3293 3297 (fontified t face font-lock-constant-face) 3297 3299 (fontified t) 3299 3307 (fontified t face font-lock-type-face) 3307 3328 (fontified t) 3328 3341 (fontified t) 3341 3362 (fontified t) 3362 3365 (fontified t face font-lock-keyword-face) 3365 3366 (fontified t) 3366 3374 (fontified t face font-lock-variable-name-face) 3374 3405 (fontified t) 3405 3407 (fontified t) 3407 3410 (face font-lock-keyword-face fontified t) 3410 3411 (fontified t) 3411 3424 (face font-lock-variable-name-face fontified t) 3424 3436 (face font-lock-variable-name-face fontified t) 3436 3439 (fontified t) 3439 3445 (face font-lock-constant-face fontified t) 3445 3447 (fontified t) 3447 3455 (face font-lock-type-face fontified t) 3455 3486 (fontified t)) . 1) (undo-tree-id1120 . -2869) (undo-tree-id1121 . 1096) (undo-tree-id1122 . -2418) (undo-tree-id1123 . -2869) (undo-tree-id1124 . -2869) (undo-tree-id1125 . -2922) (undo-tree-id1126 . -2418) (undo-tree-id1127 . -2869) (undo-tree-id1128 . -2432) (undo-tree-id1129 . -2432) (undo-tree-id1130 . -1815) (undo-tree-id1131 . -2432) (undo-tree-id1132 . -1815) (undo-tree-id1133 . -2432) (undo-tree-id1134 . -2902) (undo-tree-id1135 . -2432) (undo-tree-id1136 . -2432) (undo-tree-id1137 . -1815) (undo-tree-id1138 . -2432) (undo-tree-id1139 . -2432) (undo-tree-id1140 . -1815) (undo-tree-id1141 . -2793) (undo-tree-id1142 . -2794) (undo-tree-id1143 . -2432) (undo-tree-id1144 . -2432) (undo-tree-id1145 . -2432) (undo-tree-id1146 . -2432) (undo-tree-id1147 . -2432) (undo-tree-id1148 . -2432) (undo-tree-id1149 . -1815) (undo-tree-id1150 . -2432) (undo-tree-id1151 . -2432) (undo-tree-id1152 . -1815) (undo-tree-id1153 . -2432) (undo-tree-id1154 . -2432) (undo-tree-id1155 . -2432) (undo-tree-id1156 . -2432) (undo-tree-id1157 . -1815) (undo-tree-id1158 . -2431) (undo-tree-id1159 . -2432) (undo-tree-id1160 . -1815) (undo-tree-id1161 . -2793) (undo-tree-id1162 . -2794) (undo-tree-id1163 . -2884) (undo-tree-id1164 . -2431) (undo-tree-id1165 . -1815) (undo-tree-id1166 . -2444) (undo-tree-id1167 . -2448) (undo-tree-id1168 . -2449) (undo-tree-id1169 . -2453) (undo-tree-id1170 . -2453) (undo-tree-id1171 . -2457) (undo-tree-id1172 . -2444) (undo-tree-id1173 . -2447) (undo-tree-id1174 . -2902) (undo-tree-id1175 . -2884) (undo-tree-id1176 . -1815) (undo-tree-id1177 . -2901) (undo-tree-id1178 . -2902) (undo-tree-id1179 . -2901) (undo-tree-id1180 . -2902) (undo-tree-id1181 . -2901) (undo-tree-id1182 . -2902) (undo-tree-id1183 . -2901) (undo-tree-id1184 . -2902) (undo-tree-id1185 . -2819) (undo-tree-id1186 . -2820) (undo-tree-id1187 . -2819) (undo-tree-id1188 . -2820) (undo-tree-id1189 . -2901) (undo-tree-id1190 . -2902) (undo-tree-id1191 . -2901) (undo-tree-id1192 . -2902) (undo-tree-id1193 . -2900) (undo-tree-id1194 . -2901) (undo-tree-id1195 . 628) (undo-tree-id1196 . -2901) (undo-tree-id1197 . 627) (undo-tree-id1198 . -2901) (undo-tree-id1199 . 627) (undo-tree-id1200 . -2902)) (23751 23784 501356 889000) 0 nil]) ((3317 . 3318)) ((#(";" 0 1 (fontified t)) . 3317)) (23751 23785 10670 288000) 0 nil]) ((#(";" 0 1 (fontified t)) . 3307) (undo-tree-id305 . -1) (undo-tree-id306 . -1) (t 23751 19162 416936 885000)) ((3307 . 3308)) (23751 23785 703836 525000) 0 nil]) ((#("let socket = " 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 10 (fontified t face font-lock-variable-name-face) 10 13 (fontified t)) . 3128)) ((3128 . 3141)) (23751 23786 112205 567000) 0 nil]) ((nil rear-nonsticky nil 2950 . 2951) (#("
" 0 1 (fontified nil)) . -3321) (2942 . 3322)) ((#("
        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };
" 0 1 (fontified t) 1 8 (fontified nil) 8 9 (rear-nonsticky nil fontified nil) 9 12 (fontified nil face font-lock-keyword-face) 12 18 (fontified nil) 18 21 (fontified nil face font-lock-keyword-face) 21 28 (fontified nil) 28 33 (fontified nil face font-lock-constant-face) 33 35 (fontified nil) 35 39 (fontified nil face font-lock-constant-face) 39 41 (fontified nil) 41 45 (fontified nil face font-lock-constant-face) 45 59 (fontified nil) 59 67 (fontified t) 67 70 (fontified t face font-lock-keyword-face) 70 71 (fontified t) 71 77 (fontified t face font-lock-variable-name-face) 77 80 (fontified t) 80 82 (fontified t face font-lock-type-face) 82 83 (fontified t face font-lock-type-face) 83 86 (face font-lock-type-face fontified t) 86 92 (fontified t) 92 108 (face font-lock-string-face fontified t) 108 115 (fontified t) 115 124 (fontified t) 124 129 (fontified t face font-lock-constant-face) 129 137 (fontified t) 137 144 (fontified t face font-lock-constant-face) 144 146 (fontified t) 146 152 (fontified t face font-lock-constant-face) 152 159 (fontified t) 159 163 (fontified t face font-lock-keyword-face) 163 178 (fontified t) 178 184 (fontified t) 184 186 (fontified t) 186 189 (fontified t face font-lock-keyword-face) 189 190 (fontified t) 190 196 (fontified t face font-lock-variable-name-face) 196 199 (fontified t) 199 203 (fontified t face font-lock-keyword-face) 203 206 (fontified t) 206 218 (fontified t) 218 220 (fontified t face font-lock-keyword-face) 220 221 (fontified t) 221 224 (fontified t face font-lock-keyword-face) 224 225 (fontified t) 225 227 (fontified t face font-lock-type-face) 227 228 (fontified t) 228 233 (fontified t face font-lock-type-face) 233 235 (fontified t) 235 240 (fontified t face font-lock-type-face) 240 241 (fontified t) 241 245 (fontified t face font-lock-type-face) 245 283 (fontified t) 283 288 (fontified t face font-lock-keyword-face) 288 320 (fontified t) 320 326 (fontified t face font-lock-constant-face) 326 334 (fontified t) 334 338 (fontified t face font-lock-constant-face) 338 340 (fontified t) 340 348 (fontified t face font-lock-type-face) 348 369 (fontified t) 369 378 (fontified nil) 378 379 (fontified nil) 379 380 (fontified nil)) . 2942) (undo-tree-id1201 . -379) (undo-tree-id1202 . -1) (undo-tree-id1203 . -379) (undo-tree-id1204 . -377) (undo-tree-id1205 . -186) (undo-tree-id1206 . -378) (undo-tree-id1207 . -377) (undo-tree-id1208 . -378) (undo-tree-id1209 . -377) (undo-tree-id1210 . -378) (undo-tree-id1211 . -377) (undo-tree-id1212 . -378) (undo-tree-id1213 . -107) (undo-tree-id1214 . -108) (undo-tree-id1215 . -107) (undo-tree-id1216 . -108) (undo-tree-id1217 . -377) (undo-tree-id1218 . -378) (undo-tree-id1219 . -377) (undo-tree-id1220 . -378) (undo-tree-id1221 . -306) (undo-tree-id1222 . -307) (undo-tree-id1223 . -265) (undo-tree-id1224 . -266) (undo-tree-id1225 . -204) (undo-tree-id1226 . -205) (undo-tree-id1227 . -186) (undo-tree-id1228 . -378) (3321 . 3322) (nil rear-nonsticky t 2950 . 2951)) (23751 23786 408038 445000) 0 nil]) ((#("        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };
" 0 8 (fontified t) 8 11 (fontified t face font-lock-keyword-face) 11 17 (fontified t) 17 20 (fontified t face font-lock-keyword-face) 20 27 (fontified t) 27 32 (fontified t face font-lock-constant-face) 32 34 (fontified t) 34 38 (fontified t face font-lock-constant-face) 38 40 (fontified t) 40 44 (fontified t face font-lock-constant-face) 44 66 (fontified t) 66 69 (fontified t face font-lock-keyword-face) 69 70 (fontified t) 70 76 (fontified t face font-lock-variable-name-face) 76 79 (fontified t) 79 81 (fontified t face font-lock-type-face) 81 85 (fontified t face font-lock-type-face) 85 91 (fontified t) 91 107 (fontified t face font-lock-string-face) 107 114 (fontified t) 114 123 (fontified t) 123 128 (fontified t face font-lock-constant-face) 128 136 (fontified t) 136 143 (fontified t face font-lock-constant-face) 143 145 (fontified t) 145 151 (fontified t face font-lock-constant-face) 151 158 (fontified t) 158 162 (fontified t face font-lock-keyword-face) 162 183 (fontified t) 183 185 (fontified t) 185 188 (fontified t face font-lock-keyword-face) 188 189 (fontified t) 189 195 (fontified t face font-lock-variable-name-face) 195 198 (fontified t) 198 202 (fontified t face font-lock-keyword-face) 202 205 (fontified t) 205 217 (fontified t) 217 219 (fontified t face font-lock-keyword-face) 219 220 (fontified t) 220 223 (fontified t face font-lock-keyword-face) 223 224 (fontified t) 224 226 (fontified t face font-lock-type-face) 226 227 (fontified t) 227 232 (fontified t face font-lock-type-face) 232 234 (fontified t) 234 239 (fontified t face font-lock-type-face) 239 240 (fontified t) 240 244 (fontified t face font-lock-type-face) 244 282 (fontified t) 282 287 (fontified t face font-lock-keyword-face) 287 319 (fontified t) 319 325 (fontified t face font-lock-constant-face) 325 333 (fontified t) 333 337 (fontified t face font-lock-constant-face) 337 339 (fontified t) 339 347 (fontified t face font-lock-type-face) 347 379 (fontified t)) . 2954) (undo-tree-id180 . -375) (undo-tree-id181 . -7) (undo-tree-id182 . -375) (undo-tree-id184 . -11) (undo-tree-id185 . -7) (undo-tree-id186 . -375) (undo-tree-id187 . -375) (undo-tree-id188 . -375) 3329) ((2954 . 3333)) (23751 23786 715328 954000) 0 nil]) ((2943 . 2951) (#("            " 0 12 (fontified nil)) . 2942) (undo-tree-id189 . -8) (undo-tree-id190 . -8) (2950 . 2954) (2941 . 2951) (2940 . 2942) (#("{" 0 1 (fontified nil)) . -2940) (2940 . 2941) (2934 . 2940) (#("}" 0 1 (fontified nil)) . -2924) (2924 . 2925) (#(" " 0 1 (fontified nil)) . -2924) (2924 . 2925) (#("}" 0 1 (fontified nil)) . -2924) (2918 . 2925) (2905 . 2918) 2849) ((#("
            " 0 1 (fontified t) 1 13 (fontified nil)) . 2905) (undo-tree-id1229 . -7) (#("socket}" 0 6 (fontified nil) 6 7 (fontified nil)) . 2918) (2924 . 2925) (#(" " 0 1 (fontified nil)) . 2924) (2924 . 2925) (#("}" 0 1 (fontified nil)) . 2924) (2924 . 2925) (#(" else " 0 1 (fontified nil) 1 5 (fontified nil face font-lock-keyword-face) 5 6 (fontified nil)) . 2934) (undo-tree-id1230 . -6) (undo-tree-id1231 . -6) (undo-tree-id1232 . -6) (undo-tree-id1233 . -6) (undo-tree-id1234 . -6) (undo-tree-id1235 . -6) (undo-tree-id1236 . -6) (undo-tree-id1237 . -6) (undo-tree-id1238 . -6) (undo-tree-id1239 . -6) (undo-tree-id1240 . -6) (undo-tree-id1241 . -6) (undo-tree-id1242 . -6) (undo-tree-id1243 . -6) (undo-tree-id1244 . -6) (undo-tree-id1245 . -6) (undo-tree-id1246 . -6) (undo-tree-id1247 . -6) (undo-tree-id1248 . -6) (undo-tree-id1249 . -6) (undo-tree-id1250 . -6) (undo-tree-id1251 . -6) (undo-tree-id1252 . -6) (undo-tree-id1253 . -6) (undo-tree-id1254 . -6) (undo-tree-id1255 . -6) (undo-tree-id1256 . -6) (undo-tree-id1257 . -6) (undo-tree-id1258 . -6) (undo-tree-id1259 . -6) (undo-tree-id1260 . -6) (#("{" 0 1 (fontified nil)) . 2940) (2940 . 2941) (#("{}" 0 1 (fontified nil) 1 2 (fontified nil)) . 2940) (undo-tree-id1261 . -1) (undo-tree-id1262 . -1) (undo-tree-id1263 . -1) (undo-tree-id1264 . -1) (undo-tree-id1265 . -1) (undo-tree-id1266 . -1) (undo-tree-id1267 . -1) (undo-tree-id1268 . -1) (undo-tree-id1269 . -1) (undo-tree-id1270 . -1) (undo-tree-id1271 . -1) (undo-tree-id1272 . -1) (undo-tree-id1273 . -1) (undo-tree-id1274 . -1) (undo-tree-id1275 . -1) (undo-tree-id1276 . -1) (undo-tree-id1277 . -1) (undo-tree-id1278 . -1) (undo-tree-id1279 . -1) (undo-tree-id1280 . -1) (undo-tree-id1281 . -1) (undo-tree-id1282 . -1) (undo-tree-id1283 . -1) (undo-tree-id1284 . -1) (undo-tree-id1285 . -1) (undo-tree-id1286 . -1) (undo-tree-id1287 . -1) (undo-tree-id1288 . -1) (undo-tree-id1289 . -1) (undo-tree-id1290 . -1) (undo-tree-id1291 . -1) (#("
        
" 0 1 (fontified t) 1 9 (fontified nil) 9 10 (fontified nil)) . 2941) (undo-tree-id1292 . -1) (undo-tree-id1293 . -1) (undo-tree-id1294 . -1) (undo-tree-id1295 . -9) (undo-tree-id1296 . -1) (undo-tree-id1297 . -10) (undo-tree-id1298 . -1) (undo-tree-id1299 . -1) (undo-tree-id1300 . -1) (undo-tree-id1301 . -1) (undo-tree-id1302 . -1) (undo-tree-id1303 . -1) (undo-tree-id1304 . -1) (undo-tree-id1305 . -1) (undo-tree-id1306 . -1) (undo-tree-id1307 . -1) (undo-tree-id1308 . -1) (undo-tree-id1309 . -1) (undo-tree-id1310 . -1) (undo-tree-id1311 . -1) (undo-tree-id1312 . -1) (undo-tree-id1313 . -1) (undo-tree-id1314 . -1) (undo-tree-id1315 . -1) (undo-tree-id1316 . -1) (undo-tree-id1317 . -1) (undo-tree-id1318 . -1) (undo-tree-id1319 . -1) (undo-tree-id1320 . -1) (undo-tree-id1321 . -1) (undo-tree-id1322 . -1) (#("    " 0 4 (fontified nil)) . 2950) (2942 . 2954) (#("        " 0 8 (fontified t)) . 2943) (undo-tree-id1323 . -8)) (23751 23787 22625 420000) 0 nil]) ((2905 . 2914) (2904 . 2906) (#("{" 0 1 (fontified nil)) . -2904) (2903 . 2905)) ((#(" {" 0 1 (fontified nil) 1 2 (fontified nil)) . 2903) (undo-tree-id1324 . -1) (undo-tree-id1325 . -1) (undo-tree-id1326 . -1) (undo-tree-id1327 . -1) (undo-tree-id1328 . -1) (undo-tree-id1329 . -1) (undo-tree-id1330 . -1) (undo-tree-id1331 . -1) (undo-tree-id1332 . -1) (undo-tree-id1333 . -1) (undo-tree-id1334 . -1) (undo-tree-id1335 . -1) (undo-tree-id1336 . -1) (undo-tree-id1337 . -1) (undo-tree-id1338 . -1) (undo-tree-id1339 . -1) (undo-tree-id1340 . -1) (undo-tree-id1341 . -1) (undo-tree-id1342 . -1) (undo-tree-id1343 . -1) (undo-tree-id1344 . -1) (undo-tree-id1345 . -1) (undo-tree-id1346 . -1) (undo-tree-id1347 . -1) (undo-tree-id1348 . -1) (undo-tree-id1349 . -1) (undo-tree-id1350 . -1) (undo-tree-id1351 . -1) (undo-tree-id1352 . -1) (undo-tree-id1353 . -1) (undo-tree-id1354 . -1) (undo-tree-id1355 . -1) (2904 . 2905) (#("{}" 0 1 (fontified nil) 1 2 (fontified nil)) . 2904) (undo-tree-id1356 . -2) (undo-tree-id1357 . -2) (undo-tree-id1358 . -2) (undo-tree-id1359 . -2) (undo-tree-id1360 . -2) (undo-tree-id1361 . -2) (undo-tree-id1362 . -2) (undo-tree-id1363 . -2) (undo-tree-id1364 . -2) (undo-tree-id1365 . -2) (undo-tree-id1366 . -2) (undo-tree-id1367 . -2) (undo-tree-id1368 . -2) (undo-tree-id1369 . -2) (undo-tree-id1370 . -2) (undo-tree-id1371 . -2) (undo-tree-id1372 . -2) (undo-tree-id1373 . -2) (undo-tree-id1374 . -2) (undo-tree-id1375 . -2) (undo-tree-id1376 . -2) (undo-tree-id1377 . -2) (undo-tree-id1378 . -2) (undo-tree-id1379 . -2) (undo-tree-id1380 . -2) (undo-tree-id1381 . -2) (undo-tree-id1382 . -2) (undo-tree-id1383 . -2) (undo-tree-id1384 . -2) (undo-tree-id1385 . -2) (undo-tree-id1386 . -1) (undo-tree-id1387 . -2) (#("
        " 0 1 (fontified t) 1 9 (fontified t)) . 2905)) (23751 23787 410280 400000) 0 nil]) ((#("." 0 1 (fontified t)) . -2903) (undo-tree-id191 . -1) (undo-tree-id192 . -1) (#("u" 0 1 (fontified t)) . -2904) (undo-tree-id193 . -1) (undo-tree-id194 . -1) (#("n" 0 1 (fontified t)) . -2905) (undo-tree-id195 . -1) (undo-tree-id196 . -1) 2906 (2903 . 2906) (#(")" 0 1 (fontified nil)) . 2903) (2902 . 2903) (#(" " 0 1 (fontified nil)) . -2902) (2902 . 2903) (#(")" 0 1 (fontified nil)) . -2902) (2902 . 2903) (#("0" 0 1 (fontified t)) . -2902) (undo-tree-id197 . -1) (undo-tree-id198 . -1) 2903 (2902 . 2903) (2901 . 2903) (#("(" 0 1 (fontified nil)) . -2901) (2900 . 2902) (2883 . 2900) (2882 . 2883) (#(")" 0 1 (fontified nil)) . 2882) (2875 . 2882) (2874 . 2876) (#("(" 0 1 (fontified nil face font-lock-type-face)) . -2874) (2871 . 2875) (#("0" 0 1 (fontified t face font-lock-type-face)) . -2871) (undo-tree-id199 . -1) (undo-tree-id200 . -1) (#("m" 0 1 (fontified t face font-lock-type-face)) . -2872) (undo-tree-id201 . -1) (undo-tree-id202 . -1) (#("e" 0 1 (fontified t face font-lock-type-face)) . -2873) (undo-tree-id203 . -1) (undo-tree-id204 . -1) 2874 (2872 . 2874) (2870 . 2872) (#("()" 0 1 (fontified t) 1 2 (fontified t)) . 2870) (undo-tree-id205 . -1) (undo-tree-id206 . -1) 2871 (2870 . 2872) (#("(" 0 1 (fontified nil)) . -2870) (2870 . 2871) (#("s" 0 1 (fontified t face font-lock-variable-name-face)) . -2870) (undo-tree-id207 . -1) (undo-tree-id208 . -1) (#("e" 0 1 (fontified t face font-lock-variable-name-face)) . -2871) (undo-tree-id209 . -1) (undo-tree-id210 . -1) (#("l" 0 1 (fontified t face font-lock-variable-name-face)) . -2872) (undo-tree-id211 . -1) (undo-tree-id212 . -1) 2873 (2869 . 2873) (2850 . 2869) (#("i" 0 1 (fontified t)) . -2850) (undo-tree-id213 . -1) (undo-tree-id214 . -1) (#("f" 0 1 (fontified t face font-lock-keyword-face)) . -2851) (undo-tree-id215 . -1) (undo-tree-id216 . -1) (#(" " 0 1 (fontified t)) . -2852) (undo-tree-id217 . -1) (undo-tree-id218 . -1) (#("l" 0 1 (fontified t)) . -2853) (undo-tree-id219 . -1) (undo-tree-id220 . -1) (#("e" 0 1 (fontified t)) . -2854) (undo-tree-id221 . -1) (undo-tree-id222 . -1) (#("t" 0 1 (fontified t face font-lock-keyword-face)) . -2855) (undo-tree-id223 . -1) (undo-tree-id224 . -1) 2856 (2852 . 2856) (2850 . 2852) (2842 . 2850) (#("        " 0 8 (fontified nil)) . 2841) (undo-tree-id225 . -8) (undo-tree-id226 . -8) (2849 . 2850) (2840 . 2849) 2801) ((#("
        " 0 1 (fontified t) 1 9 (fontified nil)) . 2840) (undo-tree-id1388 . -9) (undo-tree-id1389 . -9) (undo-tree-id1390 . -9) (undo-tree-id1391 . -9) (undo-tree-id1392 . -9) (undo-tree-id1393 . -9) (undo-tree-id1394 . -9) (undo-tree-id1395 . -9) (undo-tree-id1396 . -9) (undo-tree-id1397 . -9) (undo-tree-id1398 . -9) (undo-tree-id1399 . -9) (undo-tree-id1400 . -9) (undo-tree-id1401 . -9) (undo-tree-id1402 . -9) (undo-tree-id1403 . -9) (undo-tree-id1404 . -9) (undo-tree-id1405 . -9) (undo-tree-id1406 . -9) (undo-tree-id1407 . -9) (undo-tree-id1408 . -9) (undo-tree-id1409 . -9) (undo-tree-id1410 . -9) (undo-tree-id1411 . -9) (undo-tree-id1412 . -9) (undo-tree-id1413 . -9) (undo-tree-id1414 . -9) (undo-tree-id1415 . -9) (undo-tree-id1416 . -9) (undo-tree-id1417 . -9) (undo-tree-id1418 . -9) (undo-tree-id1419 . -9) (undo-tree-id1420 . -9) (undo-tree-id1421 . -9) (undo-tree-id1422 . -9) (undo-tree-id1423 . -9) (undo-tree-id1424 . -9) (undo-tree-id1425 . -9) (undo-tree-id1426 . -9) (undo-tree-id1427 . -9) (undo-tree-id1428 . -9) (undo-tree-id1429 . -9) (undo-tree-id1430 . -9) (undo-tree-id1431 . -9) (undo-tree-id1432 . -9) (undo-tree-id1433 . -9) (undo-tree-id1434 . -9) (undo-tree-id1435 . -9) (undo-tree-id1436 . -9) (undo-tree-id1437 . -9) (undo-tree-id1438 . -9) (#("
" 0 1 (fontified nil)) . 2849) (undo-tree-id1439 . -1) (undo-tree-id1440 . -1) (undo-tree-id1441 . -1) (undo-tree-id1442 . -1) (undo-tree-id1443 . -1) (undo-tree-id1444 . -1) (undo-tree-id1445 . -1) (undo-tree-id1446 . -1) (undo-tree-id1447 . -1) (undo-tree-id1448 . -1) (undo-tree-id1449 . -1) (undo-tree-id1450 . -1) (undo-tree-id1451 . -1) (undo-tree-id1452 . -1) (undo-tree-id1453 . -1) (undo-tree-id1454 . -1) (undo-tree-id1455 . -1) (undo-tree-id1456 . -1) (undo-tree-id1457 . -1) (undo-tree-id1458 . -1) (undo-tree-id1459 . -1) (undo-tree-id1460 . -1) (undo-tree-id1461 . -1) (undo-tree-id1462 . -1) (undo-tree-id1463 . -1) (undo-tree-id1464 . -1) (undo-tree-id1465 . -1) (undo-tree-id1466 . -1) (undo-tree-id1467 . -1) (undo-tree-id1468 . -1) (undo-tree-id1469 . -1) (undo-tree-id1470 . -1) (undo-tree-id1471 . -1) (undo-tree-id1472 . -1) (undo-tree-id1473 . -1) (undo-tree-id1474 . -1) (undo-tree-id1475 . -1) (undo-tree-id1476 . -1) (undo-tree-id1477 . -1) (undo-tree-id1478 . -1) (undo-tree-id1479 . -1) (undo-tree-id1480 . -1) (undo-tree-id1481 . -1) (undo-tree-id1482 . -1) (undo-tree-id1483 . -1) (undo-tree-id1484 . -1) (undo-tree-id1485 . -1) (undo-tree-id1486 . -1) (undo-tree-id1487 . -1) (undo-tree-id1488 . -1) (undo-tree-id1489 . -1) (2841 . 2849) (#("        " 0 8 (fontified nil)) . 2842) (undo-tree-id1490 . -8) (undo-tree-id1491 . -8) (undo-tree-id1492 . -8) (undo-tree-id1493 . -8) (undo-tree-id1494 . -8) (undo-tree-id1495 . -8) (undo-tree-id1496 . -8) (undo-tree-id1497 . -8) (undo-tree-id1498 . -8) (undo-tree-id1499 . -8) (undo-tree-id1500 . -8) (undo-tree-id1501 . -8) (undo-tree-id1502 . -8) (undo-tree-id1503 . -8) (undo-tree-id1504 . -8) (undo-tree-id1505 . -8) (undo-tree-id1506 . -8) (undo-tree-id1507 . -8) (undo-tree-id1508 . -8) (undo-tree-id1509 . -8) (undo-tree-id1510 . -8) (undo-tree-id1511 . -8) (undo-tree-id1512 . -8) (undo-tree-id1513 . -8) (undo-tree-id1514 . -8) (undo-tree-id1515 . -8) (undo-tree-id1516 . -8) (undo-tree-id1517 . -8) (undo-tree-id1518 . -8) (undo-tree-id1519 . -8) (undo-tree-id1520 . -8) (undo-tree-id1521 . -8) (undo-tree-id1522 . -8) (undo-tree-id1523 . -8) (undo-tree-id1524 . -8) (undo-tree-id1525 . -8) (undo-tree-id1526 . -8) (undo-tree-id1527 . -8) (undo-tree-id1528 . -8) (undo-tree-id1529 . -8) (undo-tree-id1530 . -8) (undo-tree-id1531 . -7) (undo-tree-id1532 . -8) (undo-tree-id1533 . -8) (undo-tree-id1534 . -7) (undo-tree-id1535 . -8) (undo-tree-id1536 . -8) (undo-tree-id1537 . -8) (undo-tree-id1538 . -8) (undo-tree-id1539 . -8) (#("if" 0 1 (fontified nil) 1 2 (fontified nil face font-lock-keyword-face)) . 2850) (undo-tree-id1540 . -2) (undo-tree-id1541 . -2) (undo-tree-id1542 . 2) (undo-tree-id1543 . 2) (undo-tree-id1544 . 2) (#(" let" 0 1 (fontified nil) 1 2 (fontified nil) 2 3 (fontified nil) 3 4 (fontified nil face font-lock-keyword-face)) . 2852) (undo-tree-id1545 . -4) (undo-tree-id1546 . -4) (2850 . 2856) (#("let socket = if let" 0 3 (fontified nil face font-lock-keyword-face) 3 4 (fontified nil) 4 10 (fontified nil face font-lock-variable-name-face) 10 13 (fontified nil) 13 15 (fontified nil face font-lock-keyword-face) 15 16 (fontified nil) 16 19 (fontified nil face font-lock-keyword-face)) . 2850) (undo-tree-id1547 . -19) (undo-tree-id1548 . -19) (undo-tree-id1549 . -19) (undo-tree-id1550 . -19) (undo-tree-id1551 . -19) (undo-tree-id1552 . -19) (undo-tree-id1553 . -19) (undo-tree-id1554 . -19) (undo-tree-id1555 . -19) (undo-tree-id1556 . -19) (undo-tree-id1557 . -19) (undo-tree-id1558 . -19) (undo-tree-id1559 . -19) (undo-tree-id1560 . -19) (undo-tree-id1561 . -19) (undo-tree-id1562 . -19) (undo-tree-id1563 . -19) (undo-tree-id1564 . -19) (undo-tree-id1565 . -19) (undo-tree-id1566 . -19) (undo-tree-id1567 . -19) (undo-tree-id1568 . -19) (undo-tree-id1569 . -19) (undo-tree-id1570 . -19) (undo-tree-id1571 . -19) (undo-tree-id1572 . -19) (undo-tree-id1573 . -19) (undo-tree-id1574 . -19) (undo-tree-id1575 . -19) (undo-tree-id1576 . -19) (undo-tree-id1577 . -19) (undo-tree-id1578 . -19) (undo-tree-id1579 . -19) (undo-tree-id1580 . -19) (undo-tree-id1581 . -19) (undo-tree-id1582 . -19) (undo-tree-id1583 . -19) (undo-tree-id1584 . -19) (undo-tree-id1585 . -19) (undo-tree-id1586 . -19) (undo-tree-id1587 . -19) (undo-tree-id1588 . -19) (undo-tree-id1589 . -19) (undo-tree-id1590 . -19) (undo-tree-id1591 . -19) (undo-tree-id1592 . -19) (undo-tree-id1593 . -19) (undo-tree-id1594 . -19) (#(" sel" 0 1 (fontified nil) 1 2 (fontified nil face font-lock-variable-name-face) 2 3 (fontified nil face font-lock-variable-name-face) 3 4 (fontified nil face font-lock-variable-name-face)) . 2869) (undo-tree-id1595 . -1) (undo-tree-id1596 . -1) (undo-tree-id1597 . -1) (undo-tree-id1598 . -1) (undo-tree-id1599 . -4) (undo-tree-id1600 . -4) (undo-tree-id1601 . -1) (undo-tree-id1602 . -1) (undo-tree-id1603 . -1) (undo-tree-id1604 . -1) (undo-tree-id1605 . -1) (undo-tree-id1606 . -1) (undo-tree-id1607 . -1) (undo-tree-id1608 . -1) (undo-tree-id1609 . -1) (undo-tree-id1610 . -1) (undo-tree-id1611 . -1) (undo-tree-id1612 . -1) (undo-tree-id1613 . -1) (undo-tree-id1614 . -1) (undo-tree-id1615 . -1) (undo-tree-id1616 . -1) (undo-tree-id1617 . -1) (undo-tree-id1618 . -1) (undo-tree-id1619 . -1) (undo-tree-id1620 . -1) (undo-tree-id1621 . -1) (undo-tree-id1622 . -1) (undo-tree-id1623 . -1) (undo-tree-id1624 . -1) (undo-tree-id1625 . -1) (undo-tree-id1626 . -1) (undo-tree-id1627 . -1) (undo-tree-id1628 . -1) (undo-tree-id1629 . -1) (undo-tree-id1630 . -1) (undo-tree-id1631 . -1) (undo-tree-id1632 . -1) (undo-tree-id1633 . -1) (undo-tree-id1634 . -1) (undo-tree-id1635 . -1) (undo-tree-id1636 . -1) (undo-tree-id1637 . -1) (undo-tree-id1638 . -1) (undo-tree-id1639 . -1) (undo-tree-id1640 . 3) (undo-tree-id1641 . -1) (undo-tree-id1642 . 3) (undo-tree-id1643 . -1) (undo-tree-id1644 . 3) (undo-tree-id1645 . -1) (2870 . 2873) (#("(" 0 1 (fontified nil)) . 2870) (undo-tree-id1646 . 1) (undo-tree-id1647 . 1) (undo-tree-id1648 . 1) (2870 . 2871) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2870) (undo-tree-id1649 . -1) (undo-tree-id1650 . -1) (undo-tree-id1651 . 2) (undo-tree-id1652 . 2) (undo-tree-id1653 . 2) (2870 . 2872) (#("S0" 0 1 (fontified nil face font-lock-type-face) 1 2 (fontified nil face font-lock-type-face)) . 2870) (undo-tree-id1654 . -1) (undo-tree-id1655 . -1) (undo-tree-id1656 . -1) (undo-tree-id1657 . -1) (undo-tree-id1658 . -2) (undo-tree-id1659 . -2) (undo-tree-id1660 . -1) (undo-tree-id1661 . -1) (undo-tree-id1662 . -1) (undo-tree-id1663 . -1) (undo-tree-id1664 . -1) (undo-tree-id1665 . -1) (undo-tree-id1666 . -1) (undo-tree-id1667 . -1) (undo-tree-id1668 . -1) (undo-tree-id1669 . -1) (undo-tree-id1670 . -1) (undo-tree-id1671 . -1) (undo-tree-id1672 . -1) (undo-tree-id1673 . -1) (undo-tree-id1674 . -1) (undo-tree-id1675 . -1) (undo-tree-id1676 . -1) (undo-tree-id1677 . -1) (undo-tree-id1678 . -1) (undo-tree-id1679 . -1) (undo-tree-id1680 . -1) (undo-tree-id1681 . -1) (undo-tree-id1682 . -1) (undo-tree-id1683 . -1) (undo-tree-id1684 . -1) (undo-tree-id1685 . -1) (undo-tree-id1686 . -1) (undo-tree-id1687 . -1) (undo-tree-id1688 . -1) (undo-tree-id1689 . -1) (undo-tree-id1690 . -1) (undo-tree-id1691 . -1) (undo-tree-id1692 . -1) (undo-tree-id1693 . -1) (undo-tree-id1694 . -1) (undo-tree-id1695 . -1) (undo-tree-id1696 . -1) (undo-tree-id1697 . -1) (undo-tree-id1698 . -1) (undo-tree-id1699 . 1) (undo-tree-id1700 . -1) (undo-tree-id1701 . 1) (undo-tree-id1702 . -1) (undo-tree-id1703 . 1) (undo-tree-id1704 . -1) (#("me" 0 1 (fontified nil face font-lock-type-face) 1 2 (fontified nil face font-lock-type-face)) . 2872) (undo-tree-id1705 . -2) (undo-tree-id1706 . -2) (2871 . 2874) (#("ome(" 0 3 (fontified nil face font-lock-type-face) 3 4 (fontified nil face font-lock-type-face)) . 2871) (undo-tree-id1707 . -3) (undo-tree-id1708 . -3) (undo-tree-id1709 . -3) (undo-tree-id1710 . -3) (undo-tree-id1711 . -3) (undo-tree-id1712 . -3) (undo-tree-id1713 . -3) (undo-tree-id1714 . -3) (undo-tree-id1715 . -3) (undo-tree-id1716 . -3) (undo-tree-id1717 . -3) (undo-tree-id1718 . -3) (undo-tree-id1719 . -3) (undo-tree-id1720 . -3) (undo-tree-id1721 . -3) (undo-tree-id1722 . -3) (undo-tree-id1723 . -3) (undo-tree-id1724 . -3) (undo-tree-id1725 . -3) (undo-tree-id1726 . -3) (undo-tree-id1727 . -3) (undo-tree-id1728 . -3) (undo-tree-id1729 . -3) (undo-tree-id1730 . -3) (undo-tree-id1731 . -3) (undo-tree-id1732 . -3) (undo-tree-id1733 . -3) (undo-tree-id1734 . -3) (undo-tree-id1735 . -3) (undo-tree-id1736 . -3) (undo-tree-id1737 . -3) (undo-tree-id1738 . -3) (undo-tree-id1739 . -3) (undo-tree-id1740 . -3) (undo-tree-id1741 . -3) (undo-tree-id1742 . -3) (undo-tree-id1743 . -3) (undo-tree-id1744 . -3) (undo-tree-id1745 . -3) (undo-tree-id1746 . -3) (undo-tree-id1747 . -3) (undo-tree-id1748 . -3) (undo-tree-id1749 . -3) (undo-tree-id1750 . -3) (undo-tree-id1751 . -3) (undo-tree-id1752 . 1) (undo-tree-id1753 . -3) (undo-tree-id1754 . 1) (undo-tree-id1755 . -3) (undo-tree-id1756 . 1) (undo-tree-id1757 . -3) (2874 . 2875) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2874) (undo-tree-id1758 . -1) (undo-tree-id1759 . -1) (undo-tree-id1760 . -1) (undo-tree-id1761 . -1) (undo-tree-id1762 . -1) (undo-tree-id1763 . -1) (undo-tree-id1764 . -1) (undo-tree-id1765 . -1) (undo-tree-id1766 . -1) (undo-tree-id1767 . -1) (undo-tree-id1768 . -1) (undo-tree-id1769 . -1) (undo-tree-id1770 . -1) (undo-tree-id1771 . -1) (undo-tree-id1772 . -1) (undo-tree-id1773 . -1) (undo-tree-id1774 . -1) (undo-tree-id1775 . -1) (undo-tree-id1776 . -1) (undo-tree-id1777 . -1) (undo-tree-id1778 . -1) (undo-tree-id1779 . -1) (undo-tree-id1780 . -1) (undo-tree-id1781 . -1) (undo-tree-id1782 . -1) (undo-tree-id1783 . -1) (undo-tree-id1784 . -1) (undo-tree-id1785 . -1) (undo-tree-id1786 . -1) (undo-tree-id1787 . -1) (undo-tree-id1788 . -1) (undo-tree-id1789 . -1) (undo-tree-id1790 . -1) (undo-tree-id1791 . -1) (undo-tree-id1792 . -1) (undo-tree-id1793 . -1) (undo-tree-id1794 . -1) (undo-tree-id1795 . -1) (undo-tree-id1796 . -1) (undo-tree-id1797 . -1) (undo-tree-id1798 . -1) (undo-tree-id1799 . -1) (undo-tree-id1800 . -1) (undo-tree-id1801 . 1) (undo-tree-id1802 . -1) (undo-tree-id1803 . 1) (undo-tree-id1804 . -1) (undo-tree-id1805 . 1) (undo-tree-id1806 . -1) (#("socket)" 0 7 (fontified nil)) . 2875) (undo-tree-id1807 . -7) (undo-tree-id1808 . -7) (undo-tree-id1809 . -7) (undo-tree-id1810 . -7) (undo-tree-id1811 . -7) (undo-tree-id1812 . -7) (undo-tree-id1813 . -7) (undo-tree-id1814 . -7) (undo-tree-id1815 . -7) (undo-tree-id1816 . -7) (undo-tree-id1817 . -7) (undo-tree-id1818 . -7) (undo-tree-id1819 . -7) (undo-tree-id1820 . -7) (undo-tree-id1821 . -7) (undo-tree-id1822 . -7) (undo-tree-id1823 . -7) (undo-tree-id1824 . -7) (undo-tree-id1825 . -7) (undo-tree-id1826 . -7) (undo-tree-id1827 . -7) (undo-tree-id1828 . -7) (undo-tree-id1829 . -7) (undo-tree-id1830 . -7) (undo-tree-id1831 . -7) (undo-tree-id1832 . -7) (undo-tree-id1833 . -7) (undo-tree-id1834 . -7) (undo-tree-id1835 . -7) (undo-tree-id1836 . -7) (undo-tree-id1837 . -7) (undo-tree-id1838 . -7) (undo-tree-id1839 . -7) (undo-tree-id1840 . -7) (undo-tree-id1841 . -7) (undo-tree-id1842 . -7) (undo-tree-id1843 . -7) (undo-tree-id1844 . -7) (undo-tree-id1845 . -7) (undo-tree-id1846 . -7) (undo-tree-id1847 . -7) (undo-tree-id1848 . -7) (undo-tree-id1849 . -7) (undo-tree-id1850 . -7) (undo-tree-id1851 . -7) (undo-tree-id1852 . -7) (2882 . 2883) (#(" " 0 1 (fontified nil)) . 2882) (undo-tree-id1853 . -1) (undo-tree-id1854 . -1) (undo-tree-id1855 . -1) (undo-tree-id1856 . -1) (undo-tree-id1857 . -1) (undo-tree-id1858 . -1) (undo-tree-id1859 . -1) (undo-tree-id1860 . -1) (undo-tree-id1861 . -1) (undo-tree-id1862 . -1) (undo-tree-id1863 . -1) (undo-tree-id1864 . -1) (undo-tree-id1865 . -1) (undo-tree-id1866 . -1) (undo-tree-id1867 . -1) (undo-tree-id1868 . -1) (undo-tree-id1869 . -1) (undo-tree-id1870 . -1) (undo-tree-id1871 . -1) (undo-tree-id1872 . -1) (undo-tree-id1873 . -1) (undo-tree-id1874 . -1) (undo-tree-id1875 . -1) (undo-tree-id1876 . -1) (undo-tree-id1877 . -1) (undo-tree-id1878 . -1) (undo-tree-id1879 . -1) (undo-tree-id1880 . -1) (undo-tree-id1881 . -1) (undo-tree-id1882 . -1) (undo-tree-id1883 . -1) (undo-tree-id1884 . -1) (undo-tree-id1885 . -1) (undo-tree-id1886 . -1) (undo-tree-id1887 . -1) (undo-tree-id1888 . -1) (undo-tree-id1889 . -1) (undo-tree-id1890 . -1) (undo-tree-id1891 . -1) (undo-tree-id1892 . -1) (undo-tree-id1893 . -1) (undo-tree-id1894 . -1) (undo-tree-id1895 . -1) (undo-tree-id1896 . -1) (#("= self.socket.loc" 0 2 (fontified nil) 2 6 (fontified nil face font-lock-keyword-face) 6 17 (fontified nil)) . 2883) (undo-tree-id1897 . -17) (undo-tree-id1898 . -17) (undo-tree-id1899 . -17) (undo-tree-id1900 . -17) (undo-tree-id1901 . -17) (undo-tree-id1902 . -17) (undo-tree-id1903 . -17) (undo-tree-id1904 . -17) (undo-tree-id1905 . -17) (undo-tree-id1906 . -17) (undo-tree-id1907 . -17) (undo-tree-id1908 . -17) (undo-tree-id1909 . -17) (undo-tree-id1910 . -17) (undo-tree-id1911 . -17) (undo-tree-id1912 . -17) (undo-tree-id1913 . -17) (undo-tree-id1914 . -17) (undo-tree-id1915 . -17) (undo-tree-id1916 . -17) (undo-tree-id1917 . -17) (undo-tree-id1918 . -17) (undo-tree-id1919 . -17) (undo-tree-id1920 . -17) (undo-tree-id1921 . -17) (undo-tree-id1922 . -17) (undo-tree-id1923 . -17) (undo-tree-id1924 . -17) (undo-tree-id1925 . -17) (undo-tree-id1926 . -17) (undo-tree-id1927 . -17) (undo-tree-id1928 . -17) (undo-tree-id1929 . -2) (undo-tree-id1930 . -6) (undo-tree-id1931 . -2) (undo-tree-id1932 . -6) (undo-tree-id1933 . -2) (undo-tree-id1934 . -17) (undo-tree-id1935 . -2) (undo-tree-id1936 . -17) (undo-tree-id1937 . -17) (undo-tree-id1938 . -17) (undo-tree-id1939 . -17) (undo-tree-id1940 . -17) (undo-tree-id1941 . -17) (undo-tree-id1942 . -17) (undo-tree-id1943 . -17) (undo-tree-id1944 . -17) (#("k(" 0 1 (fontified nil) 1 2 (fontified nil)) . 2900) (undo-tree-id1945 . -1) (undo-tree-id1946 . -1) (undo-tree-id1947 . -1) (undo-tree-id1948 . -1) (undo-tree-id1949 . -1) (undo-tree-id1950 . -1) (undo-tree-id1951 . -1) (undo-tree-id1952 . -1) (undo-tree-id1953 . -1) (undo-tree-id1954 . -1) (undo-tree-id1955 . -1) (undo-tree-id1956 . -1) (undo-tree-id1957 . -1) (undo-tree-id1958 . -1) (undo-tree-id1959 . -1) (undo-tree-id1960 . -1) (undo-tree-id1961 . -1) (undo-tree-id1962 . -1) (undo-tree-id1963 . -1) (undo-tree-id1964 . -1) (undo-tree-id1965 . -1) (undo-tree-id1966 . -1) (undo-tree-id1967 . -1) (undo-tree-id1968 . -1) (undo-tree-id1969 . -1) (undo-tree-id1970 . -1) (undo-tree-id1971 . -1) (undo-tree-id1972 . -1) (undo-tree-id1973 . -1) (undo-tree-id1974 . -1) (undo-tree-id1975 . -1) (undo-tree-id1976 . -1) (undo-tree-id1977 . -1) (undo-tree-id1978 . -1) (undo-tree-id1979 . -1) (undo-tree-id1980 . -1) (undo-tree-id1981 . -1) (undo-tree-id1982 . -1) (undo-tree-id1983 . -1) (undo-tree-id1984 . 1) (undo-tree-id1985 . -1) (undo-tree-id1986 . 1) (undo-tree-id1987 . -1) (undo-tree-id1988 . 1) (undo-tree-id1989 . -1) (2901 . 2902) (#("()" 0 1 (fontified nil) 1 2 (fontified nil)) . 2901) (undo-tree-id1990 . -1) (undo-tree-id1991 . -1) (undo-tree-id1992 . -1) (undo-tree-id1993 . -1) (undo-tree-id1994 . -1) (undo-tree-id1995 . -1) (undo-tree-id1996 . -1) (undo-tree-id1997 . -1) (undo-tree-id1998 . -1) (undo-tree-id1999 . -1) (undo-tree-id2000 . -1) (undo-tree-id2001 . -1) (undo-tree-id2002 . -1) (undo-tree-id2003 . -1) (undo-tree-id2004 . -1) (undo-tree-id2005 . -1) (undo-tree-id2006 . -1) (undo-tree-id2007 . -1) (undo-tree-id2008 . -1) (undo-tree-id2009 . -1) (undo-tree-id2010 . -1) (undo-tree-id2011 . -1) (undo-tree-id2012 . -1) (undo-tree-id2013 . -1) (undo-tree-id2014 . -1) (undo-tree-id2015 . -1) (undo-tree-id2016 . -1) (undo-tree-id2017 . -1) (undo-tree-id2018 . -1) (undo-tree-id2019 . -1) (undo-tree-id2020 . -1) (undo-tree-id2021 . -1) (undo-tree-id2022 . -1) (undo-tree-id2023 . -1) (undo-tree-id2024 . -1) (undo-tree-id2025 . -1) (undo-tree-id2026 . -1) (undo-tree-id2027 . -1) (undo-tree-id2028 . 2) (undo-tree-id2029 . -1) (undo-tree-id2030 . 1) (undo-tree-id2031 . -1) (undo-tree-id2032 . 1) (undo-tree-id2033 . -1) (#("0" 0 1 (fontified nil)) . 2902) (undo-tree-id2034 . -1) (undo-tree-id2035 . -1) (undo-tree-id2036 . 1) (undo-tree-id2037 . 1) (2902 . 2903) (#(")" 0 1 (fontified nil)) . 2902) (undo-tree-id2038 . 1) (undo-tree-id2039 . 1) (2902 . 2903) (#(" " 0 1 (fontified nil)) . 2902) (undo-tree-id2040 . 1) (undo-tree-id2041 . 1) (2902 . 2903) (#(")" 0 1 (fontified nil)) . 2902) (undo-tree-id2042 . -1) (undo-tree-id2043 . -1) (undo-tree-id2044 . -1) (undo-tree-id2045 . -1) (undo-tree-id2046 . -1) (undo-tree-id2047 . -1) (undo-tree-id2048 . -1) (undo-tree-id2049 . -1) (undo-tree-id2050 . -1) (undo-tree-id2051 . -1) (undo-tree-id2052 . -1) (undo-tree-id2053 . -1) (undo-tree-id2054 . -1) (undo-tree-id2055 . -1) (undo-tree-id2056 . -1) (undo-tree-id2057 . -1) (undo-tree-id2058 . -1) (undo-tree-id2059 . -1) (undo-tree-id2060 . -1) (undo-tree-id2061 . -1) (undo-tree-id2062 . -1) (undo-tree-id2063 . -1) (undo-tree-id2064 . -1) (undo-tree-id2065 . -1) (undo-tree-id2066 . -1) (undo-tree-id2067 . -1) (undo-tree-id2068 . -1) (undo-tree-id2069 . -1) (undo-tree-id2070 . -1) (undo-tree-id2071 . -1) (undo-tree-id2072 . -1) (undo-tree-id2073 . -1) (undo-tree-id2074 . -1) (undo-tree-id2075 . -1) (undo-tree-id2076 . 1) (undo-tree-id2077 . 1) (undo-tree-id2078 . -1) (2903 . 2904) (#(".un" 0 1 (fontified nil) 1 2 (fontified nil) 2 3 (fontified nil)) . 2903) (undo-tree-id2079 . -3) (2903 . 2906)) (23751 23787 730662 590000) 0 nil]) ((2450 . 2456) (t 23751 19026 747660 285000)) ((#("self, " 0 4 (face font-lock-keyword-face fontified t) 4 6 (fontified t)) . 2450)) (23751 23788 122649 300000) 0 nil]) ((1 . 3390) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;
use std::sync::{Arc, Mutex};

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>
}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (fontified t face font-lock-keyword-face) 3 4 (fontified t) 4 9 (fontified t face font-lock-keyword-face) 9 18 (fontified t) 18 19 (fontified t) 19 22 (fontified t face font-lock-keyword-face) 22 23 (fontified t) 23 28 (fontified t face font-lock-keyword-face) 28 30 (fontified t) 30 34 (fontified t face font-lock-constant-face) 34 36 (fontified t) 36 40 (fontified t face font-lock-type-face) 40 41 (fontified t) 41 42 (fontified t) 42 45 (fontified t face font-lock-keyword-face) 45 46 (fontified t) 46 53 (fontified t face font-lock-constant-face) 53 56 (fontified t) 56 61 (fontified t face font-lock-type-face) 61 63 (fontified t) 63 69 (fontified t face font-lock-type-face) 69 71 (fontified t) 71 75 (fontified t face font-lock-type-face) 75 77 (fontified t) 77 78 (fontified t rear-nonsticky t) 78 81 (fontified t face font-lock-keyword-face) 81 82 (fontified t) 82 85 (fontified t face font-lock-constant-face) 85 92 (fontified t) 92 93 (fontified t) 93 96 (fontified t face font-lock-keyword-face) 96 97 (fontified t) 97 100 (fontified t face font-lock-constant-face) 100 102 (fontified t) 102 106 (fontified t face font-lock-constant-face) 106 108 (fontified t) 108 114 (fontified t face font-lock-constant-face) 114 117 (fontified t) 117 128 (fontified t face font-lock-type-face) 128 130 (fontified t) 130 138 (fontified t face font-lock-type-face) 138 141 (fontified t) 141 144 (fontified t face font-lock-keyword-face) 144 145 (fontified t) 145 148 (fontified t face font-lock-constant-face) 148 166 (fontified t) 166 169 (fontified t face font-lock-keyword-face) 169 170 (fontified t) 170 175 (fontified t face font-lock-constant-face) 175 177 (fontified t) 177 180 (fontified t face font-lock-constant-face) 180 182 (fontified t) 182 191 (fontified t face font-lock-type-face) 191 193 (fontified t) 193 196 (fontified t face font-lock-keyword-face) 196 197 (fontified t) 197 201 (fontified t face font-lock-constant-face) 201 203 (fontified t) 203 209 (fontified t face font-lock-type-face) 209 211 (fontified t) 211 214 (fontified t face font-lock-keyword-face) 214 215 (fontified t) 215 218 (fontified t face font-lock-constant-face) 218 220 (fontified t) 220 224 (fontified t face font-lock-constant-face) 224 227 (fontified t) 227 230 (fontified t face font-lock-type-face) 230 232 (fontified t) 232 237 (fontified t face font-lock-type-face) 237 239 (fontified t) 239 240 (fontified t) 240 241 (fontified t) 241 244 (fontified t face font-lock-keyword-face) 244 245 (fontified t) 245 251 (fontified t face font-lock-keyword-face) 251 252 (fontified t) 252 268 (fontified t face font-lock-variable-name-face) 268 270 (fontified t) 270 281 (fontified t face font-lock-type-face) 281 284 (fontified t) 284 295 (fontified t face font-lock-type-face) 295 305 (fontified t) 305 308 (fontified t face font-lock-keyword-face) 308 309 (fontified t) 309 315 (fontified t face font-lock-keyword-face) 315 316 (fontified t) 316 331 (fontified t face font-lock-variable-name-face) 331 333 (fontified t) 333 344 (fontified t face font-lock-type-face) 344 347 (fontified t) 347 358 (fontified t face font-lock-type-face) 358 370 (fontified t) 370 371 (fontified t) 371 374 (fontified t face font-lock-keyword-face) 374 375 (fontified t) 375 381 (fontified t face font-lock-keyword-face) 381 382 (fontified t) 382 390 (fontified t face font-lock-type-face) 390 397 (fontified t) 397 405 (fontified t face font-lock-variable-name-face) 405 407 (fontified t) 407 413 (fontified t face font-lock-type-face) 413 417 (fontified t) 417 421 (fontified t face font-lock-keyword-face) 421 422 (fontified t) 422 430 (fontified t face font-lock-type-face) 430 437 (fontified t) 437 439 (fontified t face font-lock-keyword-face) 439 440 (fontified t) 440 443 (fontified t face font-lock-function-name-face) 443 444 (fontified t) 444 447 (fontified t face font-lock-variable-name-face) 447 449 (fontified t) 449 453 (fontified t face font-lock-keyword-face) 453 454 (fontified t) 454 457 (fontified t face font-lock-constant-face) 457 459 (fontified t) 459 462 (fontified t face font-lock-constant-face) 462 464 (fontified t) 464 471 (fontified t face font-lock-type-face) 471 473 (fontified t) 473 476 (fontified t face font-lock-variable-name-face) 476 478 (fontified t) 478 482 (fontified t face font-lock-keyword-face) 482 483 (fontified t) 483 486 (fontified t face font-lock-constant-face) 486 488 (fontified t) 488 491 (fontified t face font-lock-constant-face) 491 493 (fontified t) 493 500 (fontified t face font-lock-type-face) 500 503 (fontified t) 503 504 (syntax-table #1# fontified t) 504 505 (fontified t) 505 509 (fontified t face font-lock-type-face) 509 520 (fontified t) 520 523 (fontified t face font-lock-keyword-face) 523 544 (fontified t) 544 547 (fontified t) 547 562 (fontified t) 562 563 (fontified t) 563 573 (fontified t) 573 581 (fontified t) 581 584 (fontified t face font-lock-keyword-face) 584 585 (fontified t) 585 593 (fontified t face font-lock-variable-name-face) 593 596 (fontified t) 596 603 (fontified t face rust-builtin-formatting-macro-face) 603 605 (fontified t) 605 617 (fontified t) 617 622 (fontified t face font-lock-string-face) 622 625 (fontified t face font-lock-string-face) 625 637 (fontified t face rust-string-interpolation-face) 637 641 (fontified t face font-lock-string-face) 641 646 (fontified t face rust-string-interpolation-face) 646 651 (fontified t face font-lock-string-face) 651 663 (fontified t face rust-string-interpolation-face) 663 667 (fontified t face font-lock-string-face) 667 672 (fontified t face rust-string-interpolation-face) 672 677 (fontified t face font-lock-string-face) 677 679 (fontified t) 679 741 (fontified t) 741 774 (fontified t) 774 815 (fontified t) 815 819 (fontified t face font-lock-type-face) 819 843 (fontified t) 843 846 (fontified t face font-lock-keyword-face) 846 847 (fontified t) 847 849 (fontified t face font-lock-keyword-face) 849 850 (fontified t) 850 871 (fontified t face font-lock-function-name-face) 871 872 (fontified t) 872 880 (fontified t face font-lock-variable-name-face) 880 883 (fontified t) 883 886 (fontified t face font-lock-type-face) 886 889 (fontified t) 889 890 (syntax-table #1# fontified t) 890 891 (fontified t) 891 897 (fontified t face font-lock-type-face) 897 900 (fontified t) 900 908 (fontified t) 908 911 (fontified t face font-lock-keyword-face) 911 912 (fontified t) 912 919 (fontified t face font-lock-variable-name-face) 919 922 (fontified t) 922 929 (fontified t face rust-builtin-formatting-macro-face) 929 930 (fontified t) 930 940 (fontified t face font-lock-string-face) 940 942 (fontified t face rust-string-interpolation-face) 942 943 (fontified t face font-lock-string-face) 943 964 (fontified t) 964 967 (fontified t face font-lock-keyword-face) 967 968 (fontified t) 968 977 (fontified t face font-lock-variable-name-face) 977 980 (fontified t) 980 988 (fontified t face font-lock-type-face) 988 994 (fontified t) 994 1005 (fontified t face font-lock-string-face) 1005 1018 (fontified t) 1018 1026 (fontified t) 1026 1030 (fontified t face font-lock-preprocessor-face) 1030 1031 (fontified t face font-lock-preprocessor-face) 1031 1032 (fontified t) 1032 1048 (fontified t face font-lock-string-face) 1048 1050 (fontified t face font-lock-string-face) 1050 1051 (fontified t face font-lock-string-face) 1051 1064 (fontified t) 1064 1070 (fontified t) 1070 1073 (fontified t) 1073 1091 (fontified t) 1091 1101 (fontified t) 1101 1102 (fontified t face font-lock-keyword-face) 1102 1104 (fontified t face font-lock-keyword-face) 1104 1105 (fontified t) 1105 1107 (fontified t face font-lock-keyword-face) 1107 1108 (fontified t) 1108 1133 (fontified t face font-lock-function-name-face) 1133 1134 (fontified t) 1134 1142 (fontified t face font-lock-variable-name-face) 1142 1145 (fontified t) 1145 1148 (fontified t face font-lock-type-face) 1148 1151 (fontified t) 1151 1152 (syntax-table #1# fontified t) 1152 1153 (fontified t) 1153 1159 (fontified t face font-lock-type-face) 1159 1162 (fontified t) 1162 1170 (fontified t) 1170 1173 (fontified t face font-lock-keyword-face) 1173 1174 (fontified t) 1174 1179 (fontified t face font-lock-variable-name-face) 1179 1181 (fontified t face font-lock-variable-name-face) 1181 1184 (fontified t) 1184 1191 (fontified t face rust-builtin-formatting-macro-face) 1191 1192 (fontified t) 1192 1202 (fontified t face font-lock-string-face) 1202 1204 (fontified t face rust-string-interpolation-face) 1204 1205 (fontified t face font-lock-string-face) 1205 1218 (fontified t) 1218 1226 (fontified t) 1226 1229 (fontified t face font-lock-keyword-face) 1229 1230 (fontified t) 1230 1241 (fontified t face font-lock-variable-name-face) 1241 1244 (fontified t) 1244 1252 (fontified t face font-lock-type-face) 1252 1258 (fontified t) 1258 1271 (fontified t face font-lock-string-face) 1271 1274 (fontified t) 1274 1284 (fontified t) 1284 1292 (fontified t) 1292 1296 (fontified t face font-lock-preprocessor-face) 1296 1297 (fontified t face font-lock-preprocessor-face) 1297 1298 (fontified t) 1298 1318 (fontified t face font-lock-string-face) 1318 1320 (fontified t face font-lock-string-face) 1320 1321 (fontified t face font-lock-string-face) 1321 1334 (fontified t) 1334 1372 (fontified t) 1372 1375 (fontified t face font-lock-keyword-face) 1375 1376 (fontified t) 1376 1381 (fontified t face font-lock-constant-face) 1381 1383 (fontified t) 1383 1386 (fontified t face font-lock-constant-face) 1386 1388 (fontified t) 1388 1391 (fontified t face font-lock-constant-face) 1391 1393 (fontified t) 1393 1394 (fontified t face font-lock-type-face) 1394 1406 (fontified t face font-lock-type-face) 1406 1408 (fontified t) 1408 1414 (fontified t face font-lock-keyword-face) 1414 1415 (fontified t) 1415 1421 (fontified t face font-lock-type-face) 1421 1428 (fontified t) 1428 1435 (fontified t face font-lock-variable-name-face) 1435 1437 (fontified t) 1437 1450 (fontified t face font-lock-type-face) 1450 1456 (fontified t) 1456 1458 (fontified t face font-lock-variable-name-face) 1458 1460 (fontified t) 1460 1465 (fontified t face font-lock-constant-face) 1465 1467 (fontified t) 1467 1471 (fontified t face font-lock-constant-face) 1471 1473 (fontified t) 1473 1477 (fontified t face font-lock-constant-face) 1477 1479 (fontified t) 1479 1485 (fontified t face font-lock-type-face) 1485 1486 (fontified t) 1486 1495 (fontified t face font-lock-type-face) 1495 1500 (fontified t) 1500 1504 (fontified t face font-lock-keyword-face) 1504 1505 (fontified t) 1505 1511 (fontified t face font-lock-type-face) 1511 1518 (fontified t) 1518 1520 (fontified t face font-lock-keyword-face) 1520 1521 (fontified t) 1521 1524 (fontified t face font-lock-function-name-face) 1524 1525 (fontified t) 1525 1532 (fontified t face font-lock-variable-name-face) 1532 1534 (fontified t) 1534 1538 (fontified t face font-lock-keyword-face) 1538 1539 (fontified t) 1539 1542 (fontified t face font-lock-constant-face) 1542 1544 (fontified t) 1544 1547 (fontified t face font-lock-constant-face) 1547 1549 (fontified t) 1549 1556 (fontified t face font-lock-type-face) 1556 1558 (fontified t) 1558 1560 (fontified t face font-lock-variable-name-face) 1560 1561 (fontified t) 1561 1562 (fontified t) 1562 1567 (fontified t face font-lock-constant-face) 1567 1569 (fontified t) 1569 1573 (fontified t face font-lock-constant-face) 1573 1575 (fontified t) 1575 1579 (fontified t face font-lock-constant-face) 1579 1581 (fontified t) 1581 1587 (fontified t face font-lock-type-face) 1587 1588 (fontified t) 1588 1591 (fontified t face font-lock-type-face) 1591 1597 (fontified t face font-lock-type-face) 1597 1601 (fontified t) 1601 1602 (syntax-table #1# fontified t) 1602 1603 (fontified t) 1603 1607 (fontified t face font-lock-type-face) 1607 1610 (fontified t) 1610 1618 (fontified t) 1618 1621 (fontified t face font-lock-keyword-face) 1621 1622 (fontified t) 1622 1629 (fontified t face font-lock-variable-name-face) 1629 1659 (fontified t) 1659 1665 (fontified t) 1665 1706 (fontified t) 1706 1718 (fontified t face font-lock-string-face) 1718 1731 (fontified t face font-lock-string-face) 1731 1734 (fontified t) 1734 1742 (fontified t) 1742 1745 (fontified t face font-lock-keyword-face) 1745 1746 (fontified t) 1746 1753 (fontified t face font-lock-variable-name-face) 1753 1756 (fontified t) 1756 1765 (fontified t face font-lock-type-face) 1765 1784 (fontified t) 1784 1786 (fontified t) 1914 1915 (syntax-table #1#) 2022 2023 (syntax-table #1#) 2185 2186 (syntax-table #1#) 2228 2229 (syntax-table #1#) 2299 2301 (face font-lock-type-face) 2302 2307 (face font-lock-type-face) 2309 2314 (face font-lock-type-face) 2353 2356 (face font-lock-keyword-face) 2357 2363 (face font-lock-keyword-face) 2364 2370 (face font-lock-type-face) 2377 2383 (face font-lock-variable-name-face) 2385 2388 (face font-lock-type-face) 2389 2394 (face font-lock-type-face) 2395 2401 (face font-lock-type-face) 2402 2411 (face font-lock-type-face) 2418 2419 (face font-lock-keyword-face) 2419 2422 (face font-lock-keyword-face) 2423 2429 (face font-lock-type-face) 2436 2439 (face font-lock-keyword-face) 2440 2442 (face font-lock-keyword-face) 2443 2447 (face font-lock-function-name-face) 2448 2456 (face font-lock-variable-name-face) 2458 2462 (face font-lock-keyword-face) 2463 2466 (face font-lock-constant-face) 2468 2471 (face font-lock-constant-face) 2473 2480 (face font-lock-type-face) 2482 2486 (face font-lock-variable-name-face) 2489 2493 (face font-lock-type-face) 2496 2497 (syntax-table #1#) 2498 2504 (face font-lock-constant-face) 2506 2514 (face font-lock-type-face) 2525 2530 (face font-lock-keyword-face) 2531 2547 (face font-lock-type-face) 2553 2561 (face font-lock-type-face) 2563 2570 (face font-lock-type-face) 2572 2573 (syntax-table #1#) 2574 2589 (face font-lock-type-face) 2595 2603 (face font-lock-type-face) 2605 2612 (face font-lock-type-face) 2628 2634 (face font-lock-constant-face) 2642 2646 (face font-lock-constant-face) 2648 2656 (face font-lock-type-face) 2696 2699 (face font-lock-keyword-face) 2700 2715 (face font-lock-variable-name-face) 2718 2734 (face font-lock-type-face) 2748 2756 (face font-lock-type-face) 2758 2765 (face font-lock-type-face) 2780 2784 (face font-lock-preprocessor-face) 2784 2785 (face font-lock-preprocessor-face) 2786 2787 (face font-lock-string-face) 2787 2789 (face font-lock-string-face) 2789 2813 (face font-lock-string-face) 2842 2845 (face font-lock-keyword-face) 2851 2854 (face font-lock-keyword-face) 2861 2866 (face font-lock-constant-face) 2868 2872 (face font-lock-constant-face) 2874 2878 (face font-lock-constant-face) 2900 2903 (face font-lock-keyword-face) 2904 2910 (face font-lock-variable-name-face) 2913 2915 (face font-lock-type-face) 2915 2917 (face font-lock-type-face) 2917 2919 (face font-lock-type-face) 2925 2929 (face font-lock-string-face) 2929 2941 (face font-lock-string-face) 2957 2962 (face font-lock-constant-face) 2970 2977 (face font-lock-constant-face) 2979 2985 (face font-lock-constant-face) 2992 2996 (face font-lock-keyword-face) 3019 3022 (face font-lock-keyword-face) 3023 3029 (face font-lock-variable-name-face) 3032 3036 (face font-lock-keyword-face) 3051 3053 (face font-lock-keyword-face) 3054 3057 (face font-lock-keyword-face) 3058 3060 (face font-lock-type-face) 3061 3066 (face font-lock-type-face) 3068 3073 (face font-lock-type-face) 3074 3078 (face font-lock-type-face) 3116 3121 (face font-lock-keyword-face) 3153 3159 (face font-lock-constant-face) 3167 3171 (face font-lock-constant-face) 3173 3175 (face font-lock-type-face) 3175 3181 (face font-lock-type-face) 3222 3225 (face font-lock-keyword-face) 3226 3234 (face font-lock-variable-name-face) 3267 3270 (face font-lock-keyword-face) 3271 3296 (face font-lock-variable-name-face) 3299 3305 (face font-lock-constant-face) 3307 3315 (face font-lock-type-face)) . 1) (undo-tree-id0 . -239) (undo-tree-id1 . 3148) (undo-tree-id2 . -211) (undo-tree-id3 . -239) (undo-tree-id4 . -241) (undo-tree-id5 . 3018) (undo-tree-id6 . -345) (undo-tree-id7 . -281) (undo-tree-id8 . -2101) (undo-tree-id9 . -3386) (undo-tree-id10 . -36) (undo-tree-id11 . -36) (undo-tree-id12 . -241) (undo-tree-id13 . -241) (undo-tree-id14 . -93) (undo-tree-id15 . -93) (undo-tree-id16 . -281) (undo-tree-id17 . -19) (undo-tree-id18 . -19) (undo-tree-id19 . -2283) (undo-tree-id20 . -2232) (undo-tree-id21 . -807) (undo-tree-id22 . -3386) (undo-tree-id23 . -3386) (undo-tree-id24 . -2101) (undo-tree-id26 . -3386) (undo-tree-id28 . -1295) (undo-tree-id29 . -2845) (undo-tree-id30 . -2876) (undo-tree-id31 . -1500) (undo-tree-id32 . -2876) (undo-tree-id33 . -42) (undo-tree-id34 . -19) (undo-tree-id35 . -92) (undo-tree-id36 . -3386) (undo-tree-id37 . -2283) (undo-tree-id38 . -3386) (undo-tree-id39 . -2892) (undo-tree-id40 . -2948) (undo-tree-id41 . -2283) (undo-tree-id42 . -2892) (undo-tree-id43 . -2283) (undo-tree-id44 . -2892) (undo-tree-id45 . -3317) (undo-tree-id46 . -3318) (undo-tree-id47 . -2283) (undo-tree-id48 . -3317) (undo-tree-id49 . -3317) (undo-tree-id50 . -2353) (undo-tree-id51 . -1408) (undo-tree-id52 . -371) (undo-tree-id53 . -1868) (undo-tree-id54 . -1848) (undo-tree-id55 . -2432) (undo-tree-id56 . -1890) (undo-tree-id57 . -1514) (undo-tree-id58 . -1097) (undo-tree-id59 . -839) (undo-tree-id60 . -433) (undo-tree-id61 . -2418) (undo-tree-id62 . -1823) (undo-tree-id63 . -1500) (undo-tree-id64 . -417) (undo-tree-id65 . -3317) (undo-tree-id66 . -3317) (undo-tree-id67 . -2283) (undo-tree-id68 . -2392) (undo-tree-id69 . -2392) (undo-tree-id70 . -2393) (undo-tree-id71 . -2283) (undo-tree-id72 . -3317) (undo-tree-id73 . -2392) (undo-tree-id74 . -2392) (undo-tree-id75 . -2392) (undo-tree-id76 . -2392) (undo-tree-id77 . -2392) (undo-tree-id79 . -211) (undo-tree-id81 . -211) (undo-tree-id83 . -211) (undo-tree-id85 . -211) (undo-tree-id87 . -211) (undo-tree-id89 . -211) (undo-tree-id91 . -211) (undo-tree-id93 . -211) (undo-tree-id95 . -211) (undo-tree-id97 . -211) (undo-tree-id99 . -211) (undo-tree-id101 . -211) (undo-tree-id103 . -211) (undo-tree-id105 . -211) (undo-tree-id107 . -211) (undo-tree-id109 . -240) (undo-tree-id111 . -240) (undo-tree-id113 . -211) (undo-tree-id115 . -240) (undo-tree-id117 . -240) (undo-tree-id119 . -240) (undo-tree-id121 . -240) (undo-tree-id123 . -240) (undo-tree-id125 . -240) (undo-tree-id127 . -240) (undo-tree-id129 . -240) (undo-tree-id131 . -240) (undo-tree-id133 . -240) (undo-tree-id135 . -240) (undo-tree-id137 . -240) (undo-tree-id139 . -240) (undo-tree-id141 . -240) (undo-tree-id143 . -240) (undo-tree-id145 . -2357) (undo-tree-id147 . -2357) (undo-tree-id149 . -240) (undo-tree-id151 . -240) (undo-tree-id153 . -240) (undo-tree-id155 . -240) (undo-tree-id157 . -240) (undo-tree-id158 . -240) (undo-tree-id160 . -240) (undo-tree-id162 . -240) 241) ((1 . 3389) (#("use crate::stream;
use crate::user::User;
use futures::{Async, Future, Poll};
use log::info;
use std::sync::atomic::{AtomicUsize, Ordering};
use std::sync::{Arc, Mutex};
use std::{thread, time};
use tokio::net::TcpStream;
use warp::Stream;

pub static OPEN_CONNECTIONS: AtomicUsize = AtomicUsize::new(0);
pub static MAX_CONNECTIONS: AtomicUsize = AtomicUsize::new(400);

pub struct RedisCmd {
    resp_cmd: String,
}
impl RedisCmd {
    fn new(cmd: impl std::fmt::Display, arg: impl std::fmt::Display) -> Self {
        let (cmd, arg) = (cmd.to_string(), arg.to_string());
        let resp_cmd = format!(
            \"*2\\r\\n${cmd_length}\\r\\n{cmd}\\r\\n${arg_length}\\r\\n{arg}\\r\\n\",
            cmd_length = cmd.len(),
            cmd = cmd,
            arg_length = arg.len(),
            arg = arg
        );
        Self { resp_cmd }
    }
    pub fn subscribe_to_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let subscribe = RedisCmd::new(\"subscribe\", &channel);
        info!(\"Subscribing to {}\", &channel);
        subscribe.resp_cmd
    }
    pub fn unsubscribe_from_timeline(timeline: &str) -> String {
        let channel = format!(\"timeline:{}\", timeline);
        let unsubscribe = RedisCmd::new(\"unsubscribe\", &channel);
        info!(\"Unsubscribing from {}\", &channel);
        unsubscribe.resp_cmd
    }
}

use tokio::net::tcp::ConnectFuture;
struct Socket {
    connect: ConnectFuture,
    tx: tokio::sync::mpsc::Sender<TcpStream>,
}
impl Socket {
    fn new(address: impl std::fmt::Display, tx: tokio::sync::mpsc::Sender<TcpStream>) -> Self {
        let address = address
            .to_string()
            .parse()
            .expect(\"Unable to parse address\");
        let connect = TcpStream::connect(&address);
        Self { connect, tx }
    }
}
impl Future for Socket {
    type Item = ();
    type Error = ();

    fn poll(&mut self) -> Poll<Self::Item, Self::Error> {
        match self.connect.poll() {
            Ok(Async::Ready(socket)) => {
                self.tx.clone().try_send(socket).expect(\"Socket created\");
                Ok(Async::Ready(()))
            }
            Ok(Async::NotReady) => Ok(Async::NotReady),
            Err(e) => {
                info!(\"failed to connect: {}\", e);
                Ok(Async::Ready(()))
            }
        }
    }
}

pub struct PubSub {
    socket: Arc<Mutex<Option<TcpStream>>>,
}

impl PubSub {
    pub fn from(timeline: impl std::fmt::Display, user: &User) -> stream::Receiver {
        while OPEN_CONNECTIONS.load(Ordering::Relaxed) > MAX_CONNECTIONS.load(Ordering::Relaxed) {
            thread::sleep(time::Duration::from_millis(1000));
        }
        let new_connections = OPEN_CONNECTIONS.fetch_add(1, Ordering::Relaxed) + 1;
        info!(\"{} connection(s) now open\", new_connections);

        let (tx, mut rx) = tokio::sync::mpsc::channel(5);
        let socket = Socket::new(\"127.0.0.1:6379\", tx);

        tokio::spawn(futures::future::lazy(move || socket));

        let socket = loop {
            if let Ok(Async::Ready(Some(msg))) = rx.poll() {
                break msg;
            }
            thread::sleep(time::Duration::from_millis(100));
        };

        let timeline = timeline.to_string();
        let stream_of_data_from_redis = stream::Receiver::new(socket, timeline, user);
        stream_of_data_from_redis
    }
}
" 0 3 (face font-lock-keyword-face) 4 9 (face font-lock-keyword-face) 19 22 (face font-lock-keyword-face) 23 28 (face font-lock-keyword-face) 30 34 (face font-lock-constant-face) 36 40 (face font-lock-type-face) 42 45 (face font-lock-keyword-face) 46 53 (face font-lock-constant-face) 56 61 (face font-lock-type-face) 63 69 (face font-lock-type-face) 71 75 (face font-lock-type-face) 78 81 (face font-lock-keyword-face) 82 85 (face font-lock-constant-face) 93 96 (face font-lock-keyword-face) 97 100 (face font-lock-constant-face) 102 106 (face font-lock-constant-face) 108 114 (face font-lock-constant-face) 117 128 (face font-lock-type-face) 130 138 (face font-lock-type-face) 141 144 (face font-lock-keyword-face) 145 148 (face font-lock-constant-face) 150 154 (face font-lock-constant-face) 157 160 (face font-lock-type-face) 162 167 (face font-lock-type-face) 170 173 (face font-lock-keyword-face) 174 177 (face font-lock-constant-face) 195 198 (face font-lock-keyword-face) 199 204 (face font-lock-constant-face) 206 209 (face font-lock-constant-face) 211 220 (face font-lock-type-face) 222 225 (face font-lock-keyword-face) 226 230 (face font-lock-constant-face) 232 238 (face font-lock-type-face) 241 244 (face font-lock-keyword-face) 245 251 (face font-lock-keyword-face) 252 268 (face font-lock-variable-name-face) 270 281 (face font-lock-type-face) 284 295 (face font-lock-type-face) 305 308 (face font-lock-keyword-face) 309 315 (face font-lock-keyword-face) 316 331 (face font-lock-variable-name-face) 333 344 (face font-lock-type-face) 347 358 (face font-lock-type-face) 371 374 (face font-lock-keyword-face) 375 381 (face font-lock-keyword-face) 382 390 (face font-lock-type-face) 397 405 (face font-lock-variable-name-face) 407 413 (face font-lock-type-face) 417 421 (face font-lock-keyword-face) 422 430 (face font-lock-type-face) 437 439 (face font-lock-keyword-face) 440 443 (face font-lock-function-name-face) 444 447 (face font-lock-variable-name-face) 449 453 (face font-lock-keyword-face) 454 457 (face font-lock-constant-face) 459 462 (face font-lock-constant-face) 464 471 (face font-lock-type-face) 473 476 (face font-lock-variable-name-face) 478 482 (face font-lock-keyword-face) 483 486 (face font-lock-constant-face) 488 491 (face font-lock-constant-face) 493 500 (face font-lock-type-face) 503 504 (syntax-table #1#) 505 509 (face font-lock-type-face) 520 523 (face font-lock-keyword-face) 581 584 (face font-lock-keyword-face) 585 593 (face font-lock-variable-name-face) 596 603 (face rust-builtin-formatting-macro-face) 617 625 (face font-lock-string-face) 625 637 (face rust-string-interpolation-face) 637 641 (face font-lock-string-face) 641 646 (face rust-string-interpolation-face) 646 651 (face font-lock-string-face) 651 663 (face rust-string-interpolation-face) 663 667 (face font-lock-string-face) 667 672 (face rust-string-interpolation-face) 672 677 (face font-lock-string-face) 815 819 (face font-lock-type-face) 843 846 (face font-lock-keyword-face) 847 849 (face font-lock-keyword-face) 850 871 (face font-lock-function-name-face) 872 880 (face font-lock-variable-name-face) 883 886 (face font-lock-type-face) 889 890 (syntax-table #1#) 891 897 (face font-lock-type-face) 908 911 (face font-lock-keyword-face) 912 919 (face font-lock-variable-name-face) 922 929 (face rust-builtin-formatting-macro-face) 930 940 (face font-lock-string-face) 940 942 (face rust-string-interpolation-face) 942 943 (face font-lock-string-face) 964 967 (face font-lock-keyword-face) 968 977 (face font-lock-variable-name-face) 980 988 (face font-lock-type-face) 994 1005 (face font-lock-string-face) 1026 1031 (face font-lock-preprocessor-face) 1032 1051 (face font-lock-string-face) 1101 1104 (face font-lock-keyword-face) 1105 1107 (face font-lock-keyword-face) 1108 1133 (face font-lock-function-name-face) 1134 1142 (face font-lock-variable-name-face) 1145 1148 (face font-lock-type-face) 1151 1152 (syntax-table #1#) 1153 1159 (face font-lock-type-face) 1170 1173 (face font-lock-keyword-face) 1174 1181 (face font-lock-variable-name-face) 1184 1191 (face rust-builtin-formatting-macro-face) 1192 1202 (face font-lock-string-face) 1202 1204 (face rust-string-interpolation-face) 1204 1205 (face font-lock-string-face) 1226 1229 (face font-lock-keyword-face) 1230 1241 (face font-lock-variable-name-face) 1244 1252 (face font-lock-type-face) 1258 1271 (face font-lock-string-face) 1292 1297 (face font-lock-preprocessor-face) 1298 1307 (face font-lock-string-face) 1307 1321 (face font-lock-string-face) 1372 1375 (face font-lock-keyword-face) 1376 1381 (face font-lock-constant-face) 1383 1386 (face font-lock-constant-face) 1388 1391 (face font-lock-constant-face) 1393 1406 (face font-lock-type-face) 1408 1414 (face font-lock-keyword-face) 1415 1421 (face font-lock-type-face) 1428 1435 (face font-lock-variable-name-face) 1437 1450 (face font-lock-type-face) 1456 1458 (face font-lock-variable-name-face) 1460 1465 (face font-lock-constant-face) 1467 1471 (face font-lock-constant-face) 1473 1477 (face font-lock-constant-face) 1479 1485 (face font-lock-type-face) 1486 1495 (face font-lock-type-face) 1500 1504 (face font-lock-keyword-face) 1505 1511 (face font-lock-type-face) 1518 1520 (face font-lock-keyword-face) 1521 1524 (face font-lock-function-name-face) 1525 1532 (face font-lock-variable-name-face) 1534 1538 (face font-lock-keyword-face) 1539 1542 (face font-lock-constant-face) 1544 1547 (face font-lock-constant-face) 1549 1556 (face font-lock-type-face) 1558 1560 (face font-lock-variable-name-face) 1562 1567 (face font-lock-constant-face) 1569 1573 (face font-lock-constant-face) 1575 1579 (face font-lock-constant-face) 1581 1587 (face font-lock-type-face) 1588 1597 (face font-lock-type-face) 1601 1602 (syntax-table #1#) 1603 1607 (face font-lock-type-face) 1618 1621 (face font-lock-keyword-face) 1622 1629 (face font-lock-variable-name-face) 1706 1731 (face font-lock-string-face) 1742 1745 (face font-lock-keyword-face) 1746 1753 (face font-lock-variable-name-face) 1756 1765 (face font-lock-type-face) 1794 1798 (face font-lock-type-face) 1823 1827 (face font-lock-keyword-face) 1828 1834 (face font-lock-type-face) 1835 1838 (face font-lock-keyword-face) 1839 1845 (face font-lock-type-face) 1894 1896 (face font-lock-keyword-face) 1897 1901 (face font-lock-function-name-face) 1903 1906 (face font-lock-keyword-face) 1907 1911 (face font-lock-keyword-face) 1914 1915 (syntax-table #1#) 1916 1920 (face font-lock-type-face) 1921 1925 (face font-lock-type-face) 1927 1931 (face font-lock-type-face) 1933 1937 (face font-lock-type-face) 1939 1944 (face font-lock-type-face) 1948 1956 (fontified t) 1956 1961 (fontified t face font-lock-keyword-face) 1961 1962 (fontified t) 1962 1966 (fontified t face font-lock-keyword-face) 1966 1996 (fontified t) 1996 1998 (fontified t face font-lock-type-face) 1998 1999 (fontified t) 1999 2004 (fontified t face font-lock-type-face) 2004 2006 (fontified t) 2006 2011 (fontified t face font-lock-type-face) 2011 2022 (fontified t) 2022 2023 (syntax-table #1# fontified t) 2023 2042 (fontified t) 2042 2046 (fontified t face font-lock-keyword-face) 2046 2082 (fontified t) 2082 2098 (fontified t face font-lock-string-face) 2098 2117 (fontified t) 2117 2119 (fontified t face font-lock-type-face) 2119 2120 (fontified t) 2120 2125 (fontified t face font-lock-type-face) 2125 2127 (fontified t) 2127 2132 (fontified t face font-lock-type-face) 2132 2164 (fontified t) 2164 2166 (fontified t face font-lock-type-face) 2166 2167 (fontified t) 2167 2172 (fontified t face font-lock-type-face) 2172 2174 (fontified t) 2174 2182 (fontified t face font-lock-type-face) 2182 2185 (fontified t) 2185 2186 (syntax-table #1# fontified t) 2186 2187 (fontified t) 2187 2189 (fontified t face font-lock-type-face) 2189 2190 (fontified t) 2190 2195 (fontified t face font-lock-type-face) 2195 2197 (fontified t) 2197 2205 (fontified t face font-lock-type-face) 2205 2220 (fontified t) 2220 2223 (fontified t face font-lock-type-face) 2223 2228 (fontified t) 2228 2229 (syntax-table #1# fontified t) 2229 2248 (fontified t) 2248 2253 (fontified t face font-lock-preprocessor-face) 2253 2254 (fontified t) 2254 2277 (fontified t face font-lock-string-face) 2277 2299 (fontified t) 2299 2301 (fontified t face font-lock-type-face) 2301 2302 (fontified t) 2302 2307 (fontified t face font-lock-type-face) 2307 2309 (fontified t) 2309 2314 (fontified t face font-lock-type-face) 2314 2353 (fontified t) 2353 2356 (fontified t face font-lock-keyword-face) 2356 2357 (fontified t) 2357 2363 (fontified t face font-lock-keyword-face) 2363 2364 (fontified t) 2364 2370 (fontified t face font-lock-type-face) 2370 2377 (fontified t) 2377 2383 (fontified t face font-lock-variable-name-face) 2383 2385 (fontified t) 2385 2388 (fontified t face font-lock-type-face) 2388 2389 (fontified t) 2389 2390 (fontified t face font-lock-type-face) 2390 2394 (fontified t face font-lock-type-face) 2394 2395 (fontified t) 2395 2401 (fontified t face font-lock-type-face) 2401 2402 (fontified t) 2402 2411 (fontified t face font-lock-type-face) 2411 2416 (fontified t) 2416 2419 (fontified t) 2419 2423 (fontified t face font-lock-keyword-face) 2423 2424 (fontified t) 2424 2430 (fontified t face font-lock-type-face) 2430 2433 (fontified t) 2433 2437 (fontified t) 2437 2440 (fontified t face font-lock-keyword-face) 2440 2441 (fontified t) 2441 2443 (fontified t face font-lock-keyword-face) 2443 2444 (fontified t) 2444 2448 (fontified t face font-lock-function-name-face) 2448 2449 (fontified t) 2449 2457 (fontified t face font-lock-variable-name-face) 2457 2459 (fontified t) 2459 2463 (fontified t face font-lock-keyword-face) 2463 2464 (fontified t) 2464 2467 (fontified t face font-lock-constant-face) 2467 2469 (fontified t) 2469 2472 (fontified t face font-lock-constant-face) 2472 2474 (fontified t) 2474 2481 (fontified t face font-lock-type-face) 2481 2483 (fontified t) 2483 2487 (fontified t face font-lock-variable-name-face) 2487 2490 (fontified t) 2490 2494 (fontified t face font-lock-type-face) 2494 2497 (fontified t) 2497 2498 (fontified t syntax-table #1#) 2498 2499 (fontified t) 2499 2505 (fontified t face font-lock-constant-face) 2505 2507 (fontified t) 2507 2515 (fontified t face font-lock-type-face) 2515 2518 (fontified t) 2518 2526 (fontified t) 2526 2531 (fontified t face font-lock-keyword-face) 2531 2532 (fontified t) 2532 2548 (fontified t face font-lock-type-face) 2548 2554 (fontified t) 2554 2562 (fontified t face font-lock-type-face) 2562 2564 (fontified t) 2564 2571 (fontified t face font-lock-type-face) 2571 2573 (fontified t) 2573 2574 (fontified t syntax-table #1#) 2574 2575 (fontified t) 2575 2590 (fontified t face font-lock-type-face) 2590 2596 (fontified t) 2596 2604 (fontified t face font-lock-type-face) 2604 2606 (fontified t) 2606 2613 (fontified t face font-lock-type-face) 2613 2629 (fontified t) 2629 2635 (fontified t face font-lock-constant-face) 2635 2643 (fontified t) 2643 2647 (fontified t face font-lock-constant-face) 2647 2649 (fontified t) 2649 2657 (fontified t face font-lock-type-face) 2657 2697 (fontified t) 2697 2700 (fontified t face font-lock-keyword-face) 2700 2701 (fontified t) 2701 2716 (fontified t face font-lock-variable-name-face) 2716 2719 (fontified t) 2719 2735 (fontified t face font-lock-type-face) 2735 2749 (fontified t) 2749 2757 (fontified t face font-lock-type-face) 2757 2759 (fontified t) 2759 2766 (fontified t face font-lock-type-face) 2766 2773 (fontified t) 2773 2781 (fontified t) 2781 2786 (fontified t face font-lock-preprocessor-face) 2786 2787 (fontified t) 2787 2814 (fontified t face font-lock-string-face) 2814 2833 (fontified t) 2833 2834 (fontified t) 2834 2835 (fontified t) 2835 2843 (fontified t) 2843 2846 (fontified t face font-lock-keyword-face) 2846 2852 (fontified t) 2852 2855 (fontified t face font-lock-keyword-face) 2855 2862 (fontified t) 2862 2867 (fontified t face font-lock-constant-face) 2867 2869 (fontified t) 2869 2873 (fontified t face font-lock-constant-face) 2873 2875 (fontified t) 2875 2879 (fontified t face font-lock-constant-face) 2879 2901 (fontified t) 2901 2904 (fontified t face font-lock-keyword-face) 2904 2905 (fontified t) 2905 2911 (fontified t face font-lock-variable-name-face) 2911 2914 (fontified t) 2914 2916 (fontified t face font-lock-type-face) 2916 2920 (fontified t face font-lock-type-face) 2920 2926 (fontified t) 2926 2942 (fontified t face font-lock-string-face) 2942 2949 (fontified t) 2949 2958 (fontified t) 2958 2963 (fontified t face font-lock-constant-face) 2963 2971 (fontified t) 2971 2978 (fontified t face font-lock-constant-face) 2978 2980 (fontified t) 2980 2986 (fontified t face font-lock-constant-face) 2986 2993 (fontified t) 2993 2997 (fontified t face font-lock-keyword-face) 2997 3018 (fontified t) 3018 3020 (fontified t) 3020 3023 (fontified t face font-lock-keyword-face) 3023 3024 (fontified t) 3024 3030 (fontified t face font-lock-variable-name-face) 3030 3033 (fontified t) 3033 3037 (fontified t face font-lock-keyword-face) 3037 3040 (fontified t) 3040 3052 (fontified t) 3052 3054 (fontified t face font-lock-keyword-face) 3054 3055 (fontified t) 3055 3058 (fontified t face font-lock-keyword-face) 3058 3059 (fontified t) 3059 3061 (fontified t face font-lock-type-face) 3061 3062 (fontified t) 3062 3067 (fontified t face font-lock-type-face) 3067 3069 (fontified t) 3069 3074 (fontified t face font-lock-type-face) 3074 3075 (fontified t) 3075 3079 (fontified t face font-lock-type-face) 3079 3117 (fontified t) 3117 3122 (fontified t face font-lock-keyword-face) 3122 3154 (fontified t) 3154 3160 (fontified t face font-lock-constant-face) 3160 3168 (fontified t) 3168 3172 (fontified t face font-lock-constant-face) 3172 3174 (fontified t) 3174 3182 (fontified t face font-lock-type-face) 3182 3214 (fontified t) 3214 3215 (fontified t) 3215 3223 (fontified t) 3223 3226 (fontified t face font-lock-keyword-face) 3226 3227 (fontified t) 3227 3235 (fontified t face font-lock-variable-name-face) 3235 3268 (fontified t) 3268 3271 (fontified t face font-lock-keyword-face) 3271 3272 (fontified t) 3272 3297 (fontified t face font-lock-variable-name-face) 3297 3300 (fontified t) 3300 3306 (fontified t face font-lock-constant-face) 3306 3308 (fontified t) 3308 3316 (fontified t face font-lock-type-face) 3316 3324 (fontified t) 3324 3334 (fontified t) 3334 3347 (fontified t) 3347 3387 (fontified t) 3387 3389 (fontified t)) . 1) (undo-tree-id2080 . -2833) (undo-tree-id2081 . 556) (undo-tree-id2082 . -2833) (undo-tree-id2083 . -2833) (undo-tree-id2084 . -2835) (undo-tree-id2085 . 175) (undo-tree-id2086 . -2842) (undo-tree-id2087 . -3210) (undo-tree-id2088 . -241) (undo-tree-id2089 . -241) (undo-tree-id2090 . -241) (undo-tree-id2091 . -2833) (undo-tree-id2092 . -1948) (undo-tree-id2093 . -2833) (undo-tree-id2094 . -2449) (undo-tree-id2095 . -2833) (undo-tree-id2096 . -2833) (undo-tree-id2097 . -1948) (undo-tree-id2098 . -2833) (undo-tree-id2099 . -2833) (undo-tree-id2100 . -2833) (undo-tree-id2101 . -2833) (undo-tree-id2102 . -2833) (undo-tree-id2103 . -2833) (undo-tree-id2104 . -2833) (undo-tree-id2105 . -2833) (undo-tree-id2106 . -2833) (undo-tree-id2107 . -2833) (undo-tree-id2108 . -2833) (undo-tree-id2109 . -2833) (undo-tree-id2110 . -2833) (undo-tree-id2111 . -2833) (undo-tree-id2112 . -2833) (undo-tree-id2113 . -2833) (undo-tree-id2114 . -2833) (undo-tree-id2115 . -2833) (undo-tree-id2116 . -2833) (undo-tree-id2117 . -2833) (undo-tree-id2118 . -2833) (undo-tree-id2119 . -2833) (undo-tree-id2120 . -1948) (undo-tree-id2121 . -2833) (undo-tree-id2122 . -2833) (undo-tree-id2123 . -1948) (undo-tree-id2124 . -2833) (undo-tree-id2125 . -2833) (undo-tree-id2126 . -2833) (undo-tree-id2127 . -2833) (undo-tree-id2128 . -2833) (undo-tree-id2129 . -2833) (undo-tree-id2130 . -2833) (undo-tree-id2131 . -2833) (undo-tree-id2132 . -3210) (undo-tree-id2133 . -2833) (undo-tree-id2134 . -1948) (undo-tree-id2135 . -2833) (undo-tree-id2136 . -3210) (undo-tree-id2137 . -1948) (undo-tree-id2138 . -2833) (undo-tree-id2139 . -2833) (undo-tree-id2140 . -2833) (undo-tree-id2141 . -2833) (undo-tree-id2142 . -1948) (undo-tree-id2143 . -2926) (undo-tree-id2144 . -2927) (undo-tree-id2145 . -2833) (undo-tree-id2146 . -2833) (undo-tree-id2147 . -2794) (undo-tree-id2148 . -2833) (undo-tree-id2149 . -1948) (undo-tree-id2150 . -2449) (undo-tree-id2151 . -2794) (undo-tree-id2152 . -1948)) (23751 23788 408462 492000) 0 nil]) ((240 . 241) 212) ((#("
" 0 1 (fontified t)) . 240) (undo-tree-id2153 . -1) (undo-tree-id2154 . -1) (undo-tree-id2155 . -1) (undo-tree-id2156 . -1)) (23751 23788 840138 927000) 0 nil]) ((#("
" 0 1 (fontified t rear-nonsticky t)) . 212) (undo-tree-id163 . -1) (undo-tree-id165 . -1) (undo-tree-id167 . -1) (undo-tree-id169 . -1) (undo-tree-id171 . -1) (undo-tree-id173 . -1) (undo-tree-id175 . -1)) ((212 . 213)) (23751 23790 223572 73000) 0 nil]) ((nil rear-nonsticky nil 212 . 213) (#("
" 0 1 (fontified nil)) . -241) (212 . 242)) ((#("
use std::sync::{Arc, Mutex};
" 0 1 (fontified nil rear-nonsticky nil) 1 4 (fontified nil face font-lock-keyword-face) 4 5 (fontified nil) 5 8 (fontified nil face font-lock-constant-face) 8 10 (fontified nil) 10 14 (fontified nil face font-lock-constant-face) 14 17 (fontified nil) 17 20 (fontified nil face font-lock-type-face) 20 22 (fontified nil) 22 27 (fontified nil face font-lock-type-face) 27 29 (fontified nil) 29 30 (fontified nil)) . 212) (undo-tree-id2157 . -29) (undo-tree-id2158 . -1) (undo-tree-id2159 . -29) (undo-tree-id2160 . -29) (241 . 242) (nil rear-nonsticky t 212 . 213)) (23751 23790 911604 241000) 0 nil]) ((2374 . 2383) (#("Tcp" 0 3 (fontified t face font-lock-type-face)) . -2374) (undo-tree-id176 . -3) (undo-tree-id177 . -3) 2377 (2375 . 2377) (2374 . 2375)) ((#("T" 0 1 (fontified nil face font-lock-type-face)) . 2374) (#("cp" 0 2 (fontified nil face font-lock-type-face)) . 2375) (2374 . 2377) (#("TcpStream" 0 9 (face font-lock-type-face)) . 2374)) (23751 23791 308389 913000) 0 nil]) ((2373 . 2375) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2373) (2367 . 2374) (2366 . 2368) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2366) (2361 . 2367) (2360 . 2362) (#("<" 0 1 (fontified nil face font-lock-type-face)) . -2360) (2358 . 2361) (#("e" 0 1 (fontified t face font-lock-type-face)) . -2358) (undo-tree-id178 . -1) 2359 (2357 . 2359) (2355 . 2357) (2353 . 2355) (#("w" 0 1 (fontified t)) . -2353) (undo-tree-id179 . -1) 2354 (2349 . 2354) (2344 . 2349) 2325) ((#("
    " 0 1 (fontified t) 1 5 (fontified nil)) . 2344) (undo-tree-id2161 . -5) (undo-tree-id2162 . -5) (undo-tree-id2163 . -5) (undo-tree-id2164 . -5) (undo-tree-id2165 . -5) (undo-tree-id2166 . -5) (undo-tree-id2167 . -5) (undo-tree-id2168 . -5) (undo-tree-id2169 . -5) (undo-tree-id2170 . -5) (undo-tree-id2171 . -1) (undo-tree-id2172 . -5) (undo-tree-id2173 . -5) (undo-tree-id2174 . -5) (undo-tree-id2175 . -5) (undo-tree-id2176 . -5) (undo-tree-id2177 . -5) (#("sockw" 0 4 (fontified nil face font-lock-variable-name-face) 4 5 (fontified nil)) . 2349) (undo-tree-id2178 . -4) (undo-tree-id2179 . -4) (undo-tree-id2180 . -4) (undo-tree-id2181 . -4) (undo-tree-id2182 . -4) (undo-tree-id2183 . -4) (undo-tree-id2184 . -4) (undo-tree-id2185 . -4) (undo-tree-id2186 . -5) (undo-tree-id2187 . -4) (undo-tree-id2188 . -4) (undo-tree-id2189 . -4) (undo-tree-id2190 . -4) (undo-tree-id2191 . 1) (undo-tree-id2192 . -4) (undo-tree-id2193 . 1) (undo-tree-id2194 . -4) (undo-tree-id2195 . 1) (undo-tree-id2196 . -4) (2353 . 2354) (#("et" 0 2 (fontified nil face font-lock-variable-name-face)) . 2353) (undo-tree-id2197 . -2) (undo-tree-id2198 . -2) (undo-tree-id2199 . -2) (undo-tree-id2200 . -2) (undo-tree-id2201 . -2) (undo-tree-id2202 . -2) (undo-tree-id2203 . -2) (undo-tree-id2204 . -2) (undo-tree-id2205 . -2) (undo-tree-id2206 . -2) (undo-tree-id2207 . -2) (undo-tree-id2208 . -2) (undo-tree-id2209 . -2) (undo-tree-id2210 . -2) (undo-tree-id2211 . -2) (undo-tree-id2212 . -2) (#(": " 0 2 (fontified nil)) . 2355) (undo-tree-id2213 . -2) (undo-tree-id2214 . -2) (undo-tree-id2215 . -2) (undo-tree-id2216 . -2) (undo-tree-id2217 . -2) (undo-tree-id2218 . -2) (undo-tree-id2219 . -2) (undo-tree-id2220 . -2) (undo-tree-id2221 . -2) (undo-tree-id2222 . -2) (undo-tree-id2223 . -2) (undo-tree-id2224 . -2) (undo-tree-id2225 . -2) (undo-tree-id2226 . -2) (undo-tree-id2227 . -2) (undo-tree-id2228 . -2) (#("Ae" 0 1 (fontified nil face font-lock-type-face) 1 2 (fontified nil face font-lock-type-face)) . 2357) (undo-tree-id2229 . -1) (undo-tree-id2230 . -1) (undo-tree-id2231 . -1) (undo-tree-id2232 . -1) (undo-tree-id2233 . -1) (undo-tree-id2234 . -1) (undo-tree-id2235 . -1) (undo-tree-id2236 . -1) (undo-tree-id2237 . -2) (undo-tree-id2238 . -1) (undo-tree-id2239 . -1) (undo-tree-id2240 . -1) (undo-tree-id2241 . -1) (undo-tree-id2242 . 1) (undo-tree-id2243 . -1) (undo-tree-id2244 . 1) (undo-tree-id2245 . -1) (undo-tree-id2246 . 1) (undo-tree-id2247 . -1) (2358 . 2359) (#("rc<" 0 2 (fontified nil face font-lock-type-face) 2 3 (fontified nil face font-lock-type-face)) . 2358) (undo-tree-id2248 . -2) (undo-tree-id2249 . -2) (undo-tree-id2250 . -2) (undo-tree-id2251 . -2) (undo-tree-id2252 . -2) (undo-tree-id2253 . -2) (undo-tree-id2254 . -2) (undo-tree-id2255 . -2) (undo-tree-id2256 . -2) (undo-tree-id2257 . -2) (undo-tree-id2258 . -2) (undo-tree-id2259 . -2) (undo-tree-id2260 . -2) (undo-tree-id2261 . 1) (undo-tree-id2262 . -2) (undo-tree-id2263 . 1) (undo-tree-id2264 . -2) (undo-tree-id2265 . 1) (undo-tree-id2266 . -2) (2360 . 2361) (#("<>" 0 1 (fontified nil) 1 2 (fontified nil)) . 2360) (undo-tree-id2267 . -1) (undo-tree-id2268 . -1) (undo-tree-id2269 . -1) (undo-tree-id2270 . -1) (undo-tree-id2271 . -1) (undo-tree-id2272 . -1) (undo-tree-id2273 . -1) (undo-tree-id2274 . -1) (undo-tree-id2275 . -1) (undo-tree-id2276 . -1) (undo-tree-id2277 . -1) (undo-tree-id2278 . -1) (undo-tree-id2279 . -1) (undo-tree-id2280 . 1) (undo-tree-id2281 . -1) (undo-tree-id2282 . 1) (undo-tree-id2283 . -1) (undo-tree-id2284 . 1) (undo-tree-id2285 . -1) (#("Mutex<" 0 5 (fontified nil face font-lock-type-face) 5 6 (fontified nil face font-lock-type-face)) . 2361) (undo-tree-id2286 . -3) (undo-tree-id2287 . -3) (undo-tree-id2288 . -4) (undo-tree-id2289 . -3) (undo-tree-id2290 . -3) (undo-tree-id2291 . -3) (undo-tree-id2292 . -3) (undo-tree-id2293 . -3) (undo-tree-id2294 . -5) (undo-tree-id2295 . -5) (undo-tree-id2296 . -5) (undo-tree-id2297 . -5) (undo-tree-id2298 . -5) (undo-tree-id2299 . 1) (undo-tree-id2300 . -5) (undo-tree-id2301 . 1) (undo-tree-id2302 . -5) (undo-tree-id2303 . 1) (undo-tree-id2304 . -5) (2366 . 2367) (#("<>" 0 1 (fontified nil) 1 2 (fontified nil)) . 2366) (undo-tree-id2305 . -1) (undo-tree-id2306 . -1) (undo-tree-id2307 . -1) (undo-tree-id2308 . -1) (undo-tree-id2309 . -1) (undo-tree-id2310 . 1) (undo-tree-id2311 . -1) (undo-tree-id2312 . 1) (undo-tree-id2313 . -1) (undo-tree-id2314 . 1) (undo-tree-id2315 . -1) (#("Option<" 0 6 (fontified nil face font-lock-type-face) 6 7 (fontified nil face font-lock-type-face)) . 2367) (undo-tree-id2316 . -6) (undo-tree-id2317 . -6) (undo-tree-id2318 . -6) (undo-tree-id2319 . -6) (undo-tree-id2320 . -6) (undo-tree-id2321 . 1) (undo-tree-id2322 . -6) (undo-tree-id2323 . 1) (undo-tree-id2324 . -6) (undo-tree-id2325 . 1) (undo-tree-id2326 . -6) (2373 . 2374) (#("<>" 0 1 (fontified t) 1 2 (fontified t)) . 2373) (undo-tree-id2327 . -1) (undo-tree-id2328 . -1) (undo-tree-id2329 . -1) (undo-tree-id2330 . -1) (undo-tree-id2331 . 2) (undo-tree-id2332 . -1) (undo-tree-id2333 . 1) (undo-tree-id2334 . -1) (undo-tree-id2335 . 1) (undo-tree-id2336 . -2)) (23751 23791 613644 911000) 0 nil]) ((2344 . 2345)) ((#("
" 0 1 (fontified t)) . 2344) (undo-tree-id2338 . 1) (undo-tree-id2339 . -1)) (23751 23798 47648 21000) 0 nil]) nil nil (23751 23799 23688 254000) 0 nil] #2# 87611 108 nil)